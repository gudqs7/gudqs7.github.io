<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"gudqs7.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
<meta property="og:type" content="website">
<meta property="og:title" content="gudqs7&#39;s note">
<meta property="og:url" content="https://gudqs7.github.io/index.html">
<meta property="og:site_name" content="gudqs7&#39;s note">
<meta property="og:description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="gudqs7">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://gudqs7.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>gudqs7's note</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">gudqs7's note</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">å¿ƒç´¯æ²¡é’±èººå°¸ä¸­</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>æ ‡ç­¾</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>åˆ†ç±»</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/01/23/source-code-spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/23/source-code-spring/" class="post-title-link" itemprop="url">Spring æºç ç¬”è®°</a>
        </h2>

        <div class="post-meta">
			
				<i class="fa fa-thumb-tack"></i>
				<font color="RED">ç½®é¡¶</font>
				<span class="post-meta-divider">|</span>
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-23 18:28:28" itemprop="dateCreated datePublished" datetime="2021-01-23T18:28:28+08:00">2021-01-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:49:05" itemprop="dateModified" datetime="2021-03-28T19:49:05+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-code/" itemprop="url" rel="index"><span itemprop="name">source-code</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring/" itemprop="url" rel="index"><span itemprop="name">spring</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/01/23/source-code-spring/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/23/source-code-spring/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Springæºç åˆ†æ"><a href="#Springæºç åˆ†æ" class="headerlink" title="Springæºç åˆ†æ"></a>Springæºç åˆ†æ</h1><h2 id="å…³é”®ç±»ä»‹ç»"><a href="#å…³é”®ç±»ä»‹ç»" class="headerlink" title="å…³é”®ç±»ä»‹ç»"></a>å…³é”®ç±»ä»‹ç»</h2><h3 id="ApplicationContext"><a href="#ApplicationContext" class="headerlink" title="ApplicationContext"></a>ApplicationContext</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ä¸‡èƒ½çš„ applicationContext, ä½†å®é™…ä¸Šå„ç§èƒ½åŠ›éƒ½æ˜¯ä¾èµ–äºå…¶ä»–çš„ç±», æ¯”å¦‚ getBean æ˜¯ beanFactory çš„, publishEvent æ˜¯äº‹ä»¶å¹¿æ’­å™¨çš„, ç­‰ç­‰. å…¶æœ¬èº«æ˜¯ä¸€ä¸ªç»¼åˆä½“, æ•´åˆè¿™äº›èƒ½åŠ›, ä¾¿äºå¼€å‘è€…è°ƒç”¨å’Œç†è§£.</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢åˆ—ä¸€ä¸‹ç›¸å…³çš„æ¥å£, æŠ½è±¡ç±», å’Œå…·ä½“ç±»</span></span><br><span class="line">ApplicationContext</span><br><span class="line">	æ˜¯ä¸€ä¸ªåªè¯»çš„ bean å®¹å™¨</span><br><span class="line">	å¯ä»¥åŠ è½½è§£æé…ç½®æ–‡ä»¶(å¦‚xml)</span><br><span class="line">	å¯ä»¥å‘å¸ƒäº‹ä»¶å’Œæ³¨å†Œç›‘å¬</span><br><span class="line">	å…·æœ‰å›½é™…åŒ–æ¶ˆæ¯å¤„ç†èƒ½åŠ›</span><br><span class="line">ConfigurableApplicationContext</span><br><span class="line">	æ˜¯ä¸€ä¸ªå…·æœ‰å¯é…ç½®èƒ½åŠ›çš„ å®¹å™¨(å¯è®¾ç½®å„ä¸ªå‚æ•°, å¦‚id, çˆ¶å®¹å™¨)</span><br><span class="line">	å…·æœ‰å®¹å™¨ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ, å¦‚å¯åŠ¨,åœæ­¢,å…³é—­.</span><br><span class="line">AbstractApplicationContext</span><br><span class="line">	æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æŠ½è±¡ç±», å®šä¹‰äº†å®¹å™¨çš„æ¨¡æ¿(refreshæ–¹æ³•), ä½†ç”±å…·ä½“çš„å­ç±»å®ç°éƒ¨åˆ†æ–¹æ³•</span><br><span class="line">	ç®¡ç†Beanå’ŒBeanFactoryçš„PostProcessor</span><br><span class="line">	ç®¡ç†äº‹ä»¶çš„ç›‘å¬å’Œå¤„ç†</span><br><span class="line">AbstractRefreshableApplicationContext</span><br><span class="line">	ä¸ºå¯é‡å¤åˆ·æ–°çš„å®¹å™¨æä¾›åŸºç±»</span><br><span class="line">	åŠ å…¥äº†BeanFactoryçš„ç®¡ç†(åˆ›å»º/å…³é—­ç­‰)</span><br><span class="line">AbstractRefreshableConfigApplicationContext</span><br><span class="line">	åŠ å…¥äº†configLocationå­—æ®µ, ç”¨äºæŸäº›å®¹å™¨åˆå§‹åŒ–BeanFactoryå’ŒBean</span><br><span class="line">AbstractXmlApplicationContext</span><br><span class="line">	å®šä¹‰äº†è¯»å–xmlé…ç½®æ–‡ä»¶æ¥åŠ è½½BeanFactoryçš„ä»£ç , ä½¿å¾—å­ç±»åªéœ€æä¾›é…ç½®æ–‡ä»¶åœ°å€æˆ–Resource</span><br><span class="line">ClassPathXmlApplicationContext</span><br><span class="line">	ç»§æ‰¿åŸºç±», æä¾›é…ç½®æ–‡ä»¶åœ°å€çš„æ„é€ æ–¹æ³•, è°ƒç”¨refreshåŠ è½½BeanFactory</span><br></pre></td></tr></table></figure>

<h3 id="BeanFactory"><a href="#BeanFactory" class="headerlink" title="BeanFactory"></a>BeanFactory</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">1.æ ¸å¿ƒä¸­çš„æ ¸å¿ƒ, åŠ è½½å’Œç®¡ç† beanDefinitions(Beané…ç½®ä¿¡æ¯), åˆ›å»ºå’Œç®¡ç† bean å¯¹è±¡å®ä¾‹, æ³¨å†Œå’Œç®¡ç† BeanPostProcessor(Beanæ‰©å±•)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹é¢åˆ—ä¸€ä¸‹ç›¸å…³çš„æ¥å£, æŠ½è±¡ç±», å’Œå…·ä½“ç±»</span></span><br><span class="line">BeanFactory</span><br><span class="line">  å®šä¹‰äº† Bean çš„åŸºç¡€æ“ä½œæ¥å£, å¦‚ getBean, getType, isSingleton ç­‰</span><br><span class="line"></span><br><span class="line">SingletonBeanRegistry</span><br><span class="line">  å®šä¹‰äº†å•ä¾‹å¯¹è±¡çš„æ“ä½œæ¥å£ (æ³¨å†Œ/è·å–/æ˜¯å¦å·²å­˜åœ¨) </span><br><span class="line"></span><br><span class="line">HierarchicalBeanFactory</span><br><span class="line">  å®šä¹‰äº†çˆ¶ BeanFactory çš„ç›¸å…³æ“ä½œæ¥å£(è·å–)</span><br><span class="line"></span><br><span class="line">ConfigurableBeanFactory</span><br><span class="line">  å®šä¹‰äº†å¯¹ BeanFactory åšå„ç§é…ç½®çš„æ“ä½œæ¥å£, åŒ…æ‹¬ BeanPostProcessor, setParentBeanFactory, destroyBean, registerAlias, resolveAliases ç­‰</span><br><span class="line"></span><br><span class="line">DefaultSingletonBeanRegistry</span><br><span class="line">  å®ç°äº† SingletonBeanRegistry æ¥å£, å³å®ç°äº†å•ä¾‹å¯¹è±¡çš„ç¼“å­˜ç®¡ç†, åŒ…æ‹¬ä¸€çº§/äºŒçº§/ä¸‰çº§(äºŒçº§ä¸‰çº§åªä¾èµ–å¾ªç¯ç”¨ä¸Šçš„ä¸¤ä¸ªç¼“å­˜)</span><br><span class="line">  </span><br><span class="line">FactoryBeanRegistrySupport</span><br><span class="line">  ç»§æ‰¿äº† DefaultSingletonBeanRegistry</span><br><span class="line">	å®ç°å¯¹ä½¿ç”¨ FactoryBean å­˜å‚¨å’Œè·å– bean å¯¹è±¡å®ä¾‹æ–¹å¼çš„æ”¯æŒ</span><br><span class="line">	</span><br><span class="line">AbstractBeanFactory</span><br><span class="line">  ç»§æ‰¿äº† FactoryBeanRegistrySupport</span><br><span class="line">  å®ç°äº† BeanFactory/HierarchicalBeanFactory/ConfigurableBeanFactory å®šä¹‰çš„æ¥å£</span><br><span class="line">  å®ç°äº†å…·ä½“ getBean, åŒ…æ‹¬ç¼“å­˜ç®¡ç†ç­‰</span><br><span class="line">  </span><br><span class="line">AutowireCapableBeanFactory</span><br><span class="line">  å®šä¹‰äº†æ ¹æ® class ç±»å‹è·å– BeanDefinition ä¿¡æ¯ä»¥åŠ Bean å¯¹è±¡çš„æ¥å£</span><br><span class="line"></span><br><span class="line">AbstractAutowireCapableBeanFactory</span><br><span class="line">  ç»§æ‰¿è‡ª AbstractBeanFactory </span><br><span class="line">  å®ç°äº† AutowireCapableBeanFactory ä¸­å®šä¹‰çš„æ–¹æ³•(å°±æ˜¯å®ç°äº†æ ¹æ® class è·å– bean æˆ– BeanDefinition)</span><br><span class="line">  å®ç°äº† createBean, ä¹Ÿå°±æ˜¯çœŸæ­£çš„å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„è¿‡ç¨‹, åŒ…æ‹¬å®ä¾‹åŒ–, ä¸ºéœ€è¦èµ‹å€¼çš„å­—æ®µæ³¨å…¥ç›¸åº”çš„å€¼</span><br><span class="line">  åŒæ—¶è§¦å‘äº† BeanPostProcessor çš„æ–¹æ³•è°ƒç”¨</span><br><span class="line">  </span><br><span class="line">BeanDefinitionRegistry</span><br><span class="line">  å®šä¹‰äº† BeanDefinition çš„æ³¨å†Œ/è·å–/ç§»é™¤</span><br><span class="line">  </span><br><span class="line">ListableBeanFactory</span><br><span class="line">	å®šä¹‰äº† BeanDefinition çš„å¯éå†æ€§</span><br><span class="line">  </span><br><span class="line">ConfigurableListableBeanFactory</span><br><span class="line">  ç»“åˆ ListableBeanFactory å’Œ ConfigurableBeanFactory å¹¶è¡¥å……å®Œå–„äº†å‡ ä¸ªç›¸å…³æ¥å£ (å¦‚ getBeanNamesIterator æ¥å£ )</span><br><span class="line"></span><br><span class="line">DefaultListableBeanFactory</span><br><span class="line">  ç»§æ‰¿äº† AbstractAutowireCapableBeanFactory</span><br><span class="line">  å®ç°äº† BeanDefinitionRegistry/ConfigurableListableBeanFactory çš„æ¥å£</span><br><span class="line"> </span><br><span class="line"><span class="comment"># æ€»ç»“:</span></span><br><span class="line">å®šä¹‰å¤„:</span><br><span class="line">BeanFactory(getBean)</span><br><span class="line">SingletonBeanRegistry(addSingleton)</span><br><span class="line">HierarchicalBeanFactory(getParentBeanFactory)</span><br><span class="line">ConfigurableBeanFactory(addBeanPostProcessor)</span><br><span class="line">AutowireCapableBeanFactory(autowireBean)</span><br><span class="line">BeanDefinitionRegistry(registerBeanDefinition)</span><br><span class="line">ListableBeanFactory(getBeanDefinitionNames)</span><br><span class="line">ConfigurableListableBeanFactory(getBeanNamesIterator)</span><br><span class="line"></span><br><span class="line">å®ç°å¤„:</span><br><span class="line">DefaultSingletonBeanRegistry(registerSingleton)</span><br><span class="line">FactoryBeanRegistrySupport(getObjectFromFactoryBean)</span><br><span class="line">AbstractBeanFactory(doGetBean)</span><br><span class="line">AbstractAutowireCapableBeanFactory(createBean)</span><br><span class="line">DefaultListableBeanFactory(registerBeanDefinition)</span><br></pre></td></tr></table></figure>





<h2 id="å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹"><a href="#å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹" class="headerlink" title="å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹"></a>å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.setParent(): å¤„ç†çˆ¶å®¹å™¨ </span><br><span class="line">2.setConfigLocations(): è§£æå¹¶è®¾ç½®xmlé…ç½®æ–‡ä»¶è·¯å¾„</span><br><span class="line">3.refresh(): åˆ›å»º beanFactory å¯¹è±¡å¹¶åˆå§‹åŒ–, è¯»å– xml é…ç½®æ–‡ä»¶å¾—åˆ° beanDefinitions, æ¥ç€å¤„ç†ä¸¤ç§ PostProcessor, ç„¶åæ·»åŠ å›½é™…åŒ–å¤„ç†å™¨å’Œäº‹ä»¶å¹¿æ’­å™¨ä»¥åŠç›¸åº”çš„åˆå§‹åŒ–å’Œä¸€äº›å¤„ç†, æœ€åå®ä¾‹åŒ–å•ä¾‹çš„ bean ç­‰ç­‰.</span><br><span class="line"></span><br><span class="line"><span class="comment">#å¤–åœˆç»“æŸ, å†çœ‹ refresh() é‡Œé¢çš„æ¯ä¸ªæ–¹æ³•</span></span><br><span class="line">1.prepareRefresh(): å‡†å¤‡å·¥ä½œ, ä¸€äº›å­—æ®µå€¼çš„è®¾ç½®å’Œå¤„ç†.</span><br><span class="line">2.obtainFreshBeanFactory(): åˆ›å»ºä¸€ä¸ª beanFactory å¯¹è±¡å¹¶æ³¨å†Œåˆ° applicationContext (å³èµ‹å€¼åˆ°å­—æ®µä¸Š), ç„¶åè§£æ xml é…ç½®æ–‡ä»¶(æˆ–æ³¨è§£é…ç½®)çš„ä¿¡æ¯, è§£æå¾—åˆ° beanDefinitions å¹¶æ³¨å†Œåˆ°å®¹å™¨ä¸­.</span><br><span class="line">3.ç„¶åæ˜¯ä¸€äº›å¯¹ beanFactory å¯¹è±¡çš„å®Œå–„é…ç½®çš„ä»£ç </span><br><span class="line">4.æ‰«æå¹¶æ‰§è¡Œ BeanFactoryPostProcessor(å…¶ä½œç”¨æ˜¯ä¸ºbeanFactoryå¯¹è±¡æ·»åŠ ä¸œè¥¿æä¾›æ‰©å±•æ€§), å…¶ä¸­æˆ‘è®¤è¯†çš„å°±åªæœ‰ ConfigurationClassPostProcessor(è¿™ä¸ªç±»ä½œç”¨å°±æ˜¯è§£æ @Configuration/@Component/@Import/@ImportSource/@ComponentScanç­‰åŸºç¡€æ³¨è§£).</span><br><span class="line">5.æ‰«æå®ç°äº† BeanPostProcessor æ¥å£çš„ bean å¹¶æ³¨å†Œåˆ° beanFactory ä¸­å­˜èµ·æ¥, ç­‰ createBean åˆ›å»ºå¯¹è±¡æ—¶ä¼šåœ¨å¯¹åº”çš„æ—¶æœºæ‰§è¡Œä¸€äº›å¯¹åº”çš„æ–¹æ³•(é’©å­). å¸¸è§çš„å„ç§ XxxAware å°±æ˜¯é è¿™ä¸ªå®ç°çš„å’¯.</span><br><span class="line">6.æ¥ç€, åˆå§‹åŒ–å›½é™…åŒ–èµ„æºå¤„ç†å™¨, äº‹ä»¶å¹¿æ’­å™¨, å¹¶æ³¨å†Œä¸€äº›éœ€è¦æ³¨å†Œçš„äº‹ä»¶(ä¹Ÿæ³¨å†Œå®¹å™¨å†…å®ç°å¯¹åº”æ¥å£çš„ bean)</span><br><span class="line">7.å¤„ç†ä¸€äº› beanFactory çš„é…ç½®, æ¥ç€ä¸ºæ‰€æœ‰å•ä¾‹ä¸”éæ‡’åŠ è½½çš„(ä¸å°±æ˜¯é»˜è®¤ç­–ç•¥å˜›) bean åˆ›å»ºå®ä¾‹, ç¼“å­˜èµ·æ¥.</span><br><span class="line">8.å¹¿æ’­å®¹å™¨åŠ è½½å®Œæˆäº†çš„äº‹ä»¶. ä»¥åŠå¤„ç†ç”Ÿå‘½å‘¨æœŸ.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœ€åæ€»ç»“ä¸‹, å…ˆåˆ›å»ºå®¹å™¨, å†å°†æ ¹æ®é…ç½®æ–‡ä»¶è§£æå¾—åˆ° BeanDefinition æ³¨å†Œåˆ°å®¹å™¨ä¸­, ç„¶åå¤„ç†ä¸¤å¤§æ‰©å±•(BeanFactoryPostProcessor/BeanPostProcessor), æ¥ç€æ˜¯Springçš„å›½é™…åŒ–, ä»¥åŠç›¸å½“æœ‰ç”¨çš„äº‹ä»¶å¹¿æ’­å™¨, æœ€åå®ä¾‹åŒ– bean. æ•´ä½“æ„Ÿè§‰å…¶å®å¾ˆç®€å•, ä½†å…¶å®æœ‰å¤§é‡çš„å·¥ä½œäº¤ç»™äº† BeanPostProcessor.</p>
</blockquote>
<h3 id="è¶…é•¿æºç åˆ†æè¿‡ç¨‹"><a href="#è¶…é•¿æºç åˆ†æè¿‡ç¨‹" class="headerlink" title="è¶…é•¿æºç åˆ†æè¿‡ç¨‹"></a>è¶…é•¿æºç åˆ†æè¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆéšä¾¿å†™ä¸ª main æ–¹æ³•, å¦‚æˆ‘å†™çš„, å¯æµ‹è¯•ä¾èµ–å¾ªç¯é—®é¢˜å’Œäº‹ä»¶ç›‘å¬:</span></span><br><span class="line"><span class="comment">// åŒ…å: cn.gudqs7.spring.tests, æ”¹åŠ¨åˆ™éœ€åŒæ­¥ä¿®æ”¹xmlå“¦</span></span><br><span class="line"><span class="comment">// è¿›å…¥å¯¹åº”ç±»ä»£ç : å¿«æ·é”® Cmd+Option+é¼ æ ‡ç‚¹å‡» (æˆ– Ctrl+Alt+é¼ æ ‡å·¦é”® ); å¦‚æœæ˜¯æ¥å£æ¾å¼€ Option(æˆ–Alt)é”®</span></span><br><span class="line"></span><br><span class="line">Test.java</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ApplicationContext xmlContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"application-wq.xml"</span>);</span><br><span class="line">		UserServiceImpl userService = xmlContext.getBean(UserServiceImpl<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">		userService.sayHi();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">application-wq.xml</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span> ?&gt;</span><br><span class="line">&lt;beans xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span><br><span class="line">       xmlns=<span class="string">"http://www.springframework.org/schema/beans"</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"</span> <span class="keyword">default</span>-autowire=<span class="string">"byName"</span>&gt;</span><br><span class="line"></span><br><span class="line">	&lt;bean name=<span class="string">"userService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.gudqs7.spring.tests.UserServiceImpl"</span>&gt;</span><br><span class="line">		&lt;property name="starter"&gt;&lt;ref bean="serverStarter"/&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	&lt;bean name=<span class="string">"serverStarter"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"cn.gudqs7.spring.tests.ServerStarter"</span>&gt;</span><br><span class="line">		&lt;property name="userService"&gt;&lt;ref bean="userService"/&gt;&lt;/property&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">UserServiceImpl.java</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Resource</span></span><br><span class="line">	<span class="keyword">private</span> ServerStarter starter;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(starter);</span><br><span class="line">		System.out.println(<span class="string">"Hello Spring!"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStarter</span><span class="params">(ServerStarter starter)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.starter = starter;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ServerStarter.java</span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServerStarter</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ContextRefreshedEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Inject</span></span><br><span class="line">	<span class="keyword">private</span> UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ContextRefreshedEvent event)</span> </span>&#123;</span><br><span class="line">		String applicationName = event.getApplicationContext().getApplicationName();</span><br><span class="line">		System.out.println(applicationName);</span><br><span class="line">		System.out.println(userService);</span><br><span class="line">		System.out.println(<span class="string">"========== started by gudqs7 =============="</span>);</span><br><span class="line">		System.out.println(<span class="string">"========== started by gudqs7 =============="</span>);</span><br><span class="line">		System.out.println(<span class="string">"========== started by gudqs7 =============="</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserService</span><span class="params">(UserServiceImpl userService)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userService = userService;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¥ä¸‹æ¥, è¿›å…¥ClassPathXmlApplicationContext#ClassPathXmlApplicationContext(java.lang.String) æ–¹æ³•ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶è·³è½¬åˆ°äº†</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ClassPathXmlApplicationContext</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			String[] configLocations, <span class="keyword">boolean</span> refresh, @Nullable ApplicationContext parent)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ä¸ºå®¹å™¨çš„ parent å­—æ®µèµ‹å€¼, è‹¥ parent ä¸ä¸ºç©º, ä¸”æœ‰ ConfigurableEnvironment, åˆ™åˆå¹¶æ•°æ®(å°†çˆ¶å®¹å™¨æœ‰çš„åŠ åˆ°å­å®¹å™¨ä¸­)</span></span><br><span class="line">		<span class="comment">// å³æ‰§è¡Œäº† org.springframework.context.support.AbstractApplicationContext.setParent()</span></span><br><span class="line">		<span class="keyword">super</span>(parent);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ä¸º configLocations å­—æ®µèµ‹å€¼(å‘ŠçŸ¥é…ç½®æ–‡ä»¶ä½ç½®), èµ‹å€¼å‰ä¼šæ ¹æ®ç¯å¢ƒå˜é‡è§£æ(æ­¤æ—¶ç¯å¢ƒå˜é‡ä¸­åªæœ‰ç³»ç»Ÿç¯å¢ƒå˜é‡: å¦‚JAVA_HOME).</span></span><br><span class="line">		setConfigLocations(configLocations);</span><br><span class="line">		<span class="keyword">if</span> (refresh) &#123;</span><br><span class="line">			<span class="comment">// æ³¨é‡Šåœ¨ä¸‹é¢</span></span><br><span class="line">      refresh();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç„¶åå…·ä½“çš„çœ‹ refresh æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>&#123;</span><br><span class="line">		<span class="comment">// 1.è®¾ç½®å®¹å™¨åˆå§‹çš„ä¸€äº›å±æ€§(æ—¶é—´,çŠ¶æ€)ï¼Œåˆå§‹åŒ–å ä½ç¬¦æ•°æ®æºå¹¶æ ¡éªŒæ‰€æœ‰ bean æ‰€ä½¿ç”¨çš„å ä½ç¬¦æ˜¯å¦å­˜åœ¨, æ¸…ç©ºäº‹ä»¶å’Œç›‘å¬</span></span><br><span class="line">		<span class="comment">// 2.æ¸…ç©ºé‡ç½®æ—§çš„ beanFactory, å†åˆ›å»ºæ–°çš„ beanFactory å¹¶é€šè¿‡è§£æ xmlæˆ–æ³¨è§£ åŠ è½½ beanDefinitions</span></span><br><span class="line">		<span class="comment">// 3.è®¾ç½®äº†ä¸€äº› beanFactory çš„å±æ€§, æ·»åŠ äº†å‡ ä¸ªæœ‰ç”¨çš„ BeanPostProcessor, è¿˜æ·»åŠ äº†å‡ ä¸ª bean åˆ°å®¹å™¨ä¸­(éƒ½æ˜¯ç¯å¢ƒç›¸å…³çš„ bean)</span></span><br><span class="line">		<span class="comment">// 4.å­ç±»å¯¹beanFactory æ·»åŠ è‡ªå·±çš„ç‰¹æ®Šçš„ BeanPostProcessor (å¦‚servletContxt/servletConfigæ³¨å…¥)</span></span><br><span class="line">		<span class="comment">// 5.æ‰«æå®¹å™¨ä¸­å®ç°äº† BeanFactoryPostProcessor æ¥å£çš„ bean å°†å…¶æ³¨å†Œåˆ° beanFactory ä¸­å¹¶æ‰§è¡Œ</span></span><br><span class="line">		<span class="comment">// 6.æ‰«æå®¹å™¨ä¸­å®ç°äº† BeanPostProcessor æ¥å£çš„ bean å°†å…¶æ³¨å†Œåˆ° beanFactory ä½†ä¸æ‰§è¡Œ(å®ä¾‹åŒ– bean å¯¹è±¡é‚£ä¼šæœ‰å‡ ä¸ªæ‰§è¡Œæ—¶æœº)</span></span><br><span class="line">		<span class="comment">// 7.åˆ›å»ºä¸€ä¸ªå›½é™…åŒ–èµ„æºè§£æå™¨å¹¶æ³¨å†Œåˆ° beanFactory; åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¹¿æ’­å™¨å¹¶æ³¨å†Œåˆ° beanFactory.</span></span><br><span class="line">		<span class="comment">// 8.è°ƒç”¨å­ç±»çš„å…¶ä»–åˆ·æ–°æ—¶éœ€è¦åšçš„äº‹æƒ…(æ¨¡æ¿æ–¹æ³•)</span></span><br><span class="line">		<span class="comment">// 9.æ‰«æå®¹å™¨ä¸­å®ç°äº† ApplicationListener æ¥å£çš„ bean, å°†å…¶é¢„å­˜åˆ°å¹¿æ’­å™¨ä¸­ä½†ä¸æ‰§è¡Œ</span></span><br><span class="line">		<span class="comment">//10.å®Œæˆ beanFactory çš„ä¸€äº›é…ç½®(åŒ…æ‹¬ç»ˆç»“ä¸€äº›ä¸œè¥¿, å¦‚ setTempClassLoader(null) ); å°†å•ä¾‹çš„ bean åˆ›å»ºå‡ºæ¥æ”¾å…¥å®¹å™¨ä¸­(æœªè®¾ç½®lazy-init=true)çš„ bean</span></span><br><span class="line">		<span class="comment">//11.å¹¿æ’­ ContextRefreshedEvent äº‹ä»¶ï¼Œ åˆå§‹åŒ–LifeCycleProcessoråŠè°ƒç”¨å…¶ onRefresh æ–¹æ³•.</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">			<span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">			<span class="comment">// è®¾ç½®å®¹å™¨åˆå§‹çš„ä¸€äº›å±æ€§(æ—¶é—´,çŠ¶æ€)ï¼Œåˆå§‹åŒ–å ä½ç¬¦æ•°æ®æºå¹¶æ ¡éªŒæ‰€æœ‰ bean æ‰€ä½¿ç”¨çš„å ä½ç¬¦æ˜¯å¦å­˜åœ¨, æ¸…ç©ºäº‹ä»¶å’Œç›‘å¬</span></span><br><span class="line">			prepareRefresh();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">			<span class="comment">// æ¸…ç©ºé‡ç½®æ—§çš„ beanFactory, å†åˆ›å»ºæ–°çš„ beanFactory å¹¶è§£æ xmlæˆ–æ³¨è§£ åŠ è½½ beanDefinitions</span></span><br><span class="line">			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">			<span class="comment">// è®¾ç½®äº†ä¸€äº› beanFactory çš„å±æ€§, æ·»åŠ äº†å‡ ä¸ªæœ‰ç”¨çš„ BeanPostProcessor, è¿˜æ·»åŠ äº†å‡ ä¸ª bean åˆ°å®¹å™¨ä¸­(éƒ½æ˜¯ç¯å¢ƒç›¸å…³çš„ bean)</span></span><br><span class="line">			prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">				<span class="comment">// å­ç±»å¯¹beanFactory æ·»åŠ è‡ªå·±çš„ç‰¹æ®Šçš„ BeanPostProcessor (å¦‚servletContxt/servletConfigæ³¨å…¥)</span></span><br><span class="line">				postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">				<span class="comment">// æ‰«æå®¹å™¨ä¸­å®ç°äº† BeanFactoryPostProcessor æ¥å£çš„ bean å°†å…¶æ³¨å†Œåˆ° beanFactory ä¸­å¹¶æ‰§è¡Œ</span></span><br><span class="line">				<span class="comment">//   æ‰«æ6æ¬¡, 2(BeanDefinitionRegistry/BeanFactory) x 3(ä¼˜å…ˆçº§:é«˜/ä¸­/å…¶ä»–)</span></span><br><span class="line">				invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">				<span class="comment">// æ‰«æå®¹å™¨ä¸­å®ç°äº† BeanPostProcessor æ¥å£çš„ bean å°†å…¶æ³¨å†Œåˆ° beanFactory ä½†ä¸æ‰§è¡Œ; æ‰«æ6æ¬¡: 2(MergedBeanDefinitionPostProcessor/å…¶ä»–) x 3(ä¼˜å…ˆçº§: é«˜/ä¸­/å…¶ä»–)</span></span><br><span class="line">				registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize message source for this context.</span></span><br><span class="line">				<span class="comment">// åˆ›å»ºä¸€ä¸ªå›½é™…åŒ–èµ„æºè§£æå™¨å¹¶æ³¨å†Œåˆ° beanFactory.</span></span><br><span class="line">				initMessageSource();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">				<span class="comment">// åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¹¿æ’­å™¨å¹¶æ³¨å†Œåˆ° beanFactory.</span></span><br><span class="line">				initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">				<span class="comment">// è°ƒç”¨å­ç±»çš„å…¶ä»–åˆ·æ–°æ—¶éœ€è¦åšçš„äº‹æƒ…(æ¨¡æ¿æ–¹æ³•)</span></span><br><span class="line">				onRefresh();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">				<span class="comment">// å°†å¯èƒ½å­˜åœ¨çš„ applicationListeners æ³¨å†Œåˆ°äº‹ä»¶å¹¿æ’­å™¨ä¸­(æ–°å»ºæ—¶æ˜¯ä¸å­˜åœ¨çš„),</span></span><br><span class="line">				<span class="comment">// ç„¶åæ‰«æå®¹å™¨ä¸­å®ç°äº† ApplicationListener æ¥å£çš„ bean, å°†å…¶é¢„å­˜åˆ°å¹¿æ’­å™¨ä¸­ä½†ä¸æ‰§è¡Œ</span></span><br><span class="line">				<span class="comment">// å°†ä¹‹å‰ publishEvent() æƒ³å¹¿æ’­çš„äº‹ä»¶å¹¿æ’­å‡ºå», ç„¶åå­—æ®µ earlyApplicationEvents èµ‹å€¼ä¸ºç©º(ä»£è¡¨ä¹‹åå¯ç«‹å³å¹¿æ’­)</span></span><br><span class="line">				registerListeners();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">				<span class="comment">// å®Œæˆ beanFactory çš„ä¸€äº›é…ç½®(åŒ…æ‹¬ç»ˆç»“ä¸€äº›ä¸œè¥¿, å¦‚ setTempClassLoader(null) )</span></span><br><span class="line">				<span class="comment">// æ³¨å†Œé»˜è®¤çš„è¡¨è¾¾å¼è§£æå™¨(è‹¥æ— ç›¸åº”çš„beanå­˜åœ¨)</span></span><br><span class="line">				<span class="comment">// æ‰«æå®¹å™¨ä¸­å®ç°äº† LoadTimeWeaverAware æ¥å£çš„ bean, å¹¶è§¦å‘(getBean)ä¹‹å‰æ³¨å†Œè¿‡çš„ BeanPostProcessor</span></span><br><span class="line">				<span class="comment">// å°†å•ä¾‹çš„ bean åˆ›å»ºå‡ºæ¥æ”¾å…¥å®¹å™¨ä¸­(æœªè®¾ç½®lazy-init=true)çš„ bean</span></span><br><span class="line">				finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">				<span class="comment">// å¹¿æ’­ ContextRefreshedEvent äº‹ä»¶ï¼Œ åˆå§‹åŒ–LifeCycleProcessoråŠè°ƒç”¨å…¶ onRefresh æ–¹æ³•.</span></span><br><span class="line">				finishRefresh();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">				<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">					logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">							<span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">				<span class="comment">// é”€æ¯ç¼“å­˜çš„å•ä¾‹å¯¹è±¡</span></span><br><span class="line">				destroyBeans();</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Reset 'active' flag.</span></span><br><span class="line">				<span class="comment">// å˜æ›´çŠ¶æ€</span></span><br><span class="line">				cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// Propagate exception to caller.</span></span><br><span class="line">				<span class="keyword">throw</span> ex;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">				<span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">				<span class="comment">// æ¸…ç©ºå…¬å…±å·¥å…·äº§ç”Ÿçš„ç¼“å­˜(å†…å­˜æ¾ä¸€å£æ°”).</span></span><br><span class="line">				resetCommonCaches();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æˆ‘é”™äº†, ä»£ç éƒ½æ”¾ä¸Šå»ä¸å¦‚ç»™ä¸ªGitHubåœ°å€, æ¥ä¸‹æ¥çœç•¥ä»£ç å§, åªæ”¾æ³¨é‡ŠğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„ğŸ˜„</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ¨ä¸ªçœ‹é‡Œé¢çš„æ–¹æ³•</span></span><br><span class="line">org.springframework.context.support.AbstractApplicationContext#prepareRefresh</span><br><span class="line">    <span class="comment">// 1.è®¾ç½®å®¹å™¨åˆå§‹çš„ä¸€äº›å±æ€§, å¦‚å¯åŠ¨æ—¶é—´, å½“å‰çŠ¶æ€</span></span><br><span class="line">		<span class="comment">// 2.æ‰“å°å¼€å§‹æ—¥å¿—</span></span><br><span class="line">		<span class="comment">// 3.åˆå§‹åŒ–å ä½ç¬¦æ•°æ®æº</span></span><br><span class="line">		<span class="comment">// 4.æ ¡éªŒæ‰€æœ‰ bean æ‰€ä½¿ç”¨çš„å ä½ç¬¦æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">		<span class="comment">// 5.æ¸…ç©ºäº‹ä»¶å’Œç›‘å¬</span></span><br><span class="line">		<span class="comment">// Switch to active.</span></span><br><span class="line">  </span><br><span class="line">org.springframework.context.support.AbstractRefreshableApplicationContext#refreshBeanFactory</span><br><span class="line">    <span class="comment">// 1.å­˜åœ¨æ—§çš„åˆ™å…ˆæ‘§æ¯ bean å¯¹è±¡å®ä¾‹åŠç¼“å­˜æ•°æ®, å†å°†æ—§çš„ç½®ä¸º null</span></span><br><span class="line">		<span class="comment">// 2.åˆ›å»ºä¸€ä¸ªæ–°çš„ beanFactory å¯¹è±¡, å†è®¾ç½® idåŠä¸€äº›é…ç½®</span></span><br><span class="line">		<span class="comment">// 3.æ‰«æå¹¶åŠ è½½ beanDefinations</span></span><br><span class="line">		<span class="comment">// 4.è®¾ç½®è¿™ä¸ªæ–°çš„ beanFactory å¯¹è±¡ä¸º applicationContext çš„ beanFactory å­—æ®µå€¼.</span></span><br><span class="line">  </span><br><span class="line">org.springframework.context.support.AbstractApplicationContext#prepareBeanFactory</span><br><span class="line">    <span class="comment">// 1.è®¾ç½® beanFactory çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">		<span class="comment">// 2.è®¾ç½® beanFactory çš„è¡¨è¾¾å¼è§£æå™¨</span></span><br><span class="line">		<span class="comment">// 3.1:æ³¨å†Œä¸€ä¸ª BeanPostProcessor ç”¨äºå°†å®ç°äº†ApplicationContextèƒ½åŠ›ç›¸å…³çš„Awareæ¥å£çš„ bean, è§¦å‘èµ‹å€¼setter æ³¨å…¥ applicationContext å¯¹è±¡</span></span><br><span class="line">		<span class="comment">// 3.2:è®¾ç½® beanFactory å¤„ç† bean æ—¶è¦å¿½ç•¥çš„æ¥å£(ä¸»è¦æ˜¯setteræ³¨å…¥æ—¶å¿½è§†ä¸€äº›ä¹Ÿæ˜¯setterçš„æ–¹æ³•, å› ä¸ºè¿™äº›æ–¹æ³•ä¼šç”± PostProcessor æ¥è§¦å‘)</span></span><br><span class="line">		<span class="comment">// 4.æ³¨å†Œä¸€äº›ç‰¹æ®Šçš„ bean(æ³¨å…¥è¿™äº›beanæ—¶ä¼šæ³¨å…¥ this å¯¹è±¡: å¤šåŠŸèƒ½å·¥å…·äºº ApplicationContext, å¯è§å…¶å’Œæ™®é€š bean çš„æ³¨å†Œæ–¹å¼ä¸ä¸€æ ·)</span></span><br><span class="line">		<span class="comment">// 5.æ³¨å†Œä¸€ä¸ª BeanPostProcessor ç”¨äºæ£€æµ‹åŠ è½½çš„ bean æ˜¯å¦å®ç°äº† ApplicationListener æ¥å£, è‹¥æ˜¯, åˆ™æ³¨å†Œåˆ°äº‹ä»¶å¹¿æ’­å™¨ä¸­(ä¸æ˜¯,æ˜¯æš‚å­˜åœ¨applicationListenerså­—æ®µä¸­, ç­‰äº‹ä»¶å¹¿æ’­å™¨åˆ›å»ºåæ‰æ³¨å†Œ)</span></span><br><span class="line">		<span class="comment">// 6.æ³¨å†Œä¸€ä¸ª BeanPostProcessor ç”¨äºè§¦å‘å®ç°äº† LoadTimeWeaverAware æ¥å£çš„ bean çš„ setLoadTimeWeaver() ç¤¾ä¼š LTW å®ä¾‹.</span></span><br><span class="line">		<span class="comment">// 7.æ³¨å†Œå‡ ä¸ªç¯å¢ƒç›¸å…³ bean åˆ°å®¹å™¨ä¸­(Springçš„ç¯å¢ƒå¯¹è±¡, ä»¥åŠç³»ç»Ÿç¯å¢ƒå˜é‡å’Œç³»ç»Ÿé…ç½®æ–‡ä»¶)</span></span><br><span class="line"></span><br><span class="line">org.springframework.context.support.PostProcessorRegistrationDelegate#invokeBeanFactoryPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, java.util.List&lt;org.springframework.beans.factory.config.BeanFactoryPostProcessor&gt;)</span><br><span class="line">    <span class="comment">// 1.è‹¥ beanFactory å®ç°äº† BeanDefinitionRegistry æ¥å£(new AnnotationConfigApplicationContext å°±å®ç°äº†)</span></span><br><span class="line">		<span class="comment">//    åˆ™æ‰«ææ‰€æœ‰å®ç°äº† BeanDefinitionRegistryPostProcessor æ¥å£çš„ bean, æ ¹æ®ä¼˜å…ˆçº§åˆ†ä¸‰ç±»(é«˜/ä¸­/å…¶ä»–)ä¾æ¬¡æ‰§è¡Œ</span></span><br><span class="line">		<span class="comment">// 2.ç„¶åæ‰«ææ‰€æœ‰å®ç°äº† BeanFactoryPostProcessor æ¥å£çš„ bean, ä¾æ—§æ˜¯æ ¹æ®ä¼˜å…ˆçº§åˆ†ä¸‰ç±»ä¾æ¬¡æ‰§è¡Œ.</span></span><br><span class="line">		<span class="comment">// 3.æ¯æ¬¡æ‰§è¡Œå‰éƒ½ä¼šæ ¹æ® Order ä¿¡æ¯æ’åº, å†éå†æ‰§è¡Œ</span></span><br><span class="line">  </span><br><span class="line">org.springframework.context.support.PostProcessorRegistrationDelegate#registerBeanPostProcessors(org.springframework.beans.factory.config.ConfigurableListableBeanFactory, org.springframework.context.support.AbstractApplicationContext)</span><br><span class="line">    <span class="comment">// 1.æ‰«æ6æ¬¡: 2(MergedBeanDefinitionPostProcessor/å…¶ä»–) x 3(ä¼˜å…ˆçº§: é«˜/ä¸­/å…¶ä»–)</span></span><br><span class="line">		<span class="comment">//    å°†å…¶åŠ å…¥åˆ° beanFactory çš„ beanPostProcessors é›†åˆä¸­</span></span><br><span class="line">		<span class="comment">// 2.å†æ¬¡åŠ å…¥ ApplicationListenerDetector (ç”¨äºå¤„ç†å®ç° ApplicationListener çš„ bean æ³¨å†Œåˆ°äº‹ä»¶å¹¿æ’­å™¨), ä¸»è¦æ˜¯ä½¿å…¶åœ¨é“¾æœ«å°¾, å¯ä»¥æœ€åæ‰§è¡Œ.</span></span><br><span class="line"></span><br><span class="line">org.springframework.context.support.AbstractApplicationContext#registerListeners</span><br><span class="line">    <span class="comment">// 1.å°†å¯èƒ½å­˜åœ¨çš„ applicationListeners æ³¨å†Œåˆ°äº‹ä»¶å¹¿æ’­å™¨ä¸­(æ–°å»ºæ—¶æ˜¯ä¸å­˜åœ¨çš„)</span></span><br><span class="line">		<span class="comment">// 2.æ‰«æå®¹å™¨ä¸­å®ç°äº† ApplicationListener æ¥å£çš„ bean, å°†å…¶é¢„å­˜åˆ°å¹¿æ’­å™¨ä¸­ä½†ä¸æ‰§è¡Œ</span></span><br><span class="line">		<span class="comment">// 3.å°†ä¹‹å‰ publishEvent() æƒ³å¹¿æ’­çš„äº‹ä»¶å¹¿æ’­å‡ºå», ç„¶åå­—æ®µ earlyApplicationEvents èµ‹å€¼ä¸ºç©º</span></span><br><span class="line">		<span class="comment">//    (å› ä¸º publishEvent() ä¸­æ ¹æ®æ˜¯å¦ä¸ºç©ºåˆ¤æ–­ç«‹åˆ»æ‰§è¡Œæˆ–å…ˆå­˜ç€) (å¦è¿™ä¹Ÿè§£é‡Šäº† prepareRefresh() ä¸­ä¸ºä½•è¦èµ‹å€¼ä¸€ä¸ªç©ºé›†åˆ)</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">org.springframework.context.support.AbstractApplicationContext#finishBeanFactoryInitialization</span><br><span class="line">    <span class="comment">// 1.å®Œæˆ beanFactory çš„ä¸€äº›é…ç½®</span></span><br><span class="line">		<span class="comment">// 2.æ³¨å†Œé»˜è®¤çš„è¡¨è¾¾å¼è§£æå™¨(è‹¥æ— ç›¸åº”çš„beanå­˜åœ¨)</span></span><br><span class="line">		<span class="comment">// 3.æ‰«æå®¹å™¨ä¸­å®ç°äº† LoadTimeWeaverAware æ¥å£çš„ bean, å¹¶è§¦å‘(getBean)ä¹‹å‰æ³¨å†Œè¿‡çš„ BeanPostProcessor</span></span><br><span class="line">		<span class="comment">// 4.å°†å•ä¾‹çš„ bean åˆ›å»ºå‡ºæ¥æ”¾å…¥å®¹å™¨ä¸­(æœªè®¾ç½®lazy-init=true)çš„ bean</span></span><br><span class="line"></span><br><span class="line">org.springframework.context.support.AbstractApplicationContext#finishRefresh</span><br><span class="line">    <span class="comment">// 1.æ¸…ç©ºèµ„æºç¼“å­˜</span></span><br><span class="line">		<span class="comment">// 2.åˆ›å»ºä¸€ä¸ªç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨(start, refresh, stopç­‰)å¹¶æ³¨å†Œåˆ° beanFactory</span></span><br><span class="line">		<span class="comment">// 3.è§¦å‘ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨çš„ onRefresh()</span></span><br><span class="line">		<span class="comment">// 4.å¹¿æ’­å®¹å™¨åˆ·æ–°å®Œæˆçš„äº‹ä»¶</span></span><br><span class="line">		<span class="comment">// 5.ä¸º Spring Tool Suite æä¾›æŸäº›ä¾¿æ·(æ²¡ç”¨è¿‡, ä¸çŸ¥é“...)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ç®—å¤åˆ¶å®Œäº†, å¦‚æœä½ æœ‰å¹¸ç›´æ¥è·³è¯»åˆ°è¿™é‡Œ, é‚£ä¹ˆé€ä¸Šåœ°å€ : <a href="https://github.com/gudqs7/spring-framework/tree/wq-comment" target="_blank" rel="noopener">æ³¨æ„åˆ†æ”¯å§</a> </p>
<p>å¦å¤–ä¸Šé¢æ–¹æ³•å‰å¸¦ä¸ª <strong>#</strong> çš„, å¤åˆ¶åˆ° IDEA åŒå‡» Shift ç„¶åç²˜è´´, é€‰æ‹© Symbols æœç´¢æ›´å‡†ç¡®å‘¢!</p>
</blockquote>
<h2 id="è·å–å®¹å™¨å¯¹è±¡è¿‡ç¨‹"><a href="#è·å–å®¹å™¨å¯¹è±¡è¿‡ç¨‹" class="headerlink" title="è·å–å®¹å™¨å¯¹è±¡è¿‡ç¨‹"></a>è·å–å®¹å™¨å¯¹è±¡è¿‡ç¨‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»getBean(Class type) ä¸­è¿›å…¥</span></span><br><span class="line">1.æ£€æŸ¥ applicationContext å’Œ beanFactory çš„çŠ¶æ€, è‹¥æœ‰å¼‚å¸¸åˆ™ç»™å‡ºå‡†ç¡®çš„é”™è¯¯.</span><br><span class="line">2.æ‰«æå®¹å™¨ä¸­æ‰€æœ‰æ­¤ <span class="built_in">type</span> çš„ beanName, éå†åˆ¤æ–­æ¯ä¸ª beanName æ˜¯å¦å¯ç”¨</span><br><span class="line">   å¯ç”¨åˆ™åˆ¤æ–­å¯ç”¨çš„ä¸ªæ•°æ˜¯å¦åˆšå¥½æ˜¯ä¸€ä¸ª, æ˜¯åˆ™ç›´æ¥è°ƒç”¨ getBean() è¿”å›å¯¹è±¡å®ä¾‹</span><br><span class="line">   è‹¥å¯ç”¨çš„ä¸ªæ•°è¶…è¿‡ä¸€ä¸ª, åˆ™æ ¹æ® beanDefinition çš„ isPrimary å’Œå¯¹æ¯”é…ç½®çš„ä¼˜å…ˆçº§æ˜¯å¦ä¸ºæœ‰æœ€é«˜çš„å†è¿”å›æœ€é«˜çš„</span><br><span class="line">   è‹¥éƒ½ä¸è¡Œ, åˆ™æŠ¥é”™.</span><br><span class="line">3.æ¥ç€çœ‹ getBean, å…ˆè¯•ç€ä»å•ä¾‹çš„ç¼“å­˜ä¸­è·å–, è‹¥å­˜åœ¨åˆ™è¿”å›.</span><br><span class="line">4.è‹¥ç¼“å­˜ä¸­ä¸å­˜åœ¨, åˆ™åˆ¤æ–­çˆ¶å®¹å™¨æ˜¯å¦å­˜, è‹¥å­˜åœ¨åˆ™ä»çˆ¶å®¹å™¨è·å–</span><br><span class="line">   è‹¥çˆ¶å®¹å™¨ä¸å­˜åœ¨, åˆ™è‡ªå·±æ–°å»º, å…ˆæ ‡è®° beanName åˆ° alreadyCreated ä¸­(è¡¨ç¤ºå·²ç»åˆ›å»ºäº†é˜²æ­¢é‡å¤åˆ›å»º) å†å¼€å§‹åˆ›å»ºä¸€ä¸ª bean.</span><br><span class="line">5.åˆ›å»ºä¸€ä¸ªæ–°çš„ bean å®ä¾‹, å…ˆå¤„ç† beanDefinition çš„ dependsOn å±æ€§(å³è‹¥å­˜åœ¨åˆ™å…ˆè°ƒç”¨ getBean è·å–ä¾èµ–çš„ bean)</span><br><span class="line">6.è‹¥ beanDefinition çš„è®¾ç½®æ˜¯å•ä¾‹, åˆ™é€šè¿‡é—­åŒ…å¯¹åˆ›å»ºå¯¹è±¡å‰åè¿›è¡Œä¸€äº›å¼‚å¸¸å¤„ç†å’Œç¼“å­˜å¤„ç†(ä¸»è¦æ˜¯å½»åº•åˆ›å»ºå®ŒååŠ å…¥åˆ°å•ä¾‹ä¸€çº§ç¼“å­˜, ç§»é™¤äºŒçº§å’Œä¸‰çº§ç¼“å­˜[å¾ªç¯ä¾èµ–ç›¸å…³çš„ä¸¤ä¸ªç¼“å­˜]).</span><br><span class="line">7.é€šè¿‡åå°„æ ¹æ® beanClass åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹, ç„¶åå°†å…¶æ·»åŠ åˆ° singletonFactories ä¸­(è§£å†³ä¾èµ–å¾ªç¯é—®é¢˜)</span><br><span class="line">8.è°ƒç”¨ populateBean() ä¸ºå¯¹è±¡çš„å­—æ®µ(å±æ€§)æ³¨å…¥å®ƒæ‰€éœ€è¦çš„å€¼(å¯èƒ½æ˜¯@Resource, @Valueç­‰); (æ­¤æ—¶å¯èƒ½ä¼šé‡åˆ°ä¾èµ–å¾ªç¯é—®é¢˜, ä½†è§£å†³è¿™ä¸ªé—®é¢˜çš„ç¼“å­˜åœ¨æ­¤ä¹‹å‰å°±æ·»åŠ äº†, æ‰€ä»¥ä¸æ€•)</span><br><span class="line">9.æœ€åè°ƒç”¨ initializeBean() å®Œæˆ bean çš„åˆå§‹åŒ–(è°ƒç”¨ bean çš„ä¸€äº›æ–¹æ³•, å¦‚ afterPropertiesSet), è¿”å›å¯¹è±¡å®ä¾‹.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: å…ˆæ ¹æ® type æ‰¾åˆ° beanName, æ‰¾åˆ°åæ ¹æ® beanName åˆ›å»ºå¯¹è±¡; åˆ›å»ºå¯¹è±¡å‰å…ˆæ£€æŸ¥ç¼“å­˜(å•ä¾‹), å†è€ƒè™‘çˆ¶å®¹å™¨, æœ€åæ‰æ˜¯è‡ªå·±åˆ›å»º, è‡ªå·±åˆ›å»ºä¼šå…ˆåˆ›å»º dependsOn çš„ bean å¯¹è±¡, ç„¶åæ‰é€šè¿‡åå°„å®ä¾‹åŒ–å‡ºä¸€ä¸ªå¯¹è±¡å®ä¾‹(è¿™é‡Œåå°„ç”¨åˆ°çš„classå’Œæ„é€ æ–¹æ³•, é€šè¿‡å®ç° SmartInstantiationAwareBeanPostProcessoræ¥å£éƒ½å¯è¿›è¡Œå¹²é¢„), å®ä¾‹åŒ–åå­˜åˆ°äºŒçº§ç¼“å­˜, å†ä¸ºå­—æ®µèµ‹å€¼(æ³¨å…¥); æœ€åè°ƒç”¨ bean çš„ init ç›¸å…³çš„æ¥å£(å¦‚afterPropertiesSet), å°±å¯ä»¥è¿”å›è¿™ä¸ªå¯¹è±¡å®ä¾‹äº†.</p>
</blockquote>
<h3 id="è¶…é•¿æºç åˆ†æè¿‡ç¨‹-1"><a href="#è¶…é•¿æºç åˆ†æè¿‡ç¨‹-1" class="headerlink" title="è¶…é•¿æºç åˆ†æè¿‡ç¨‹"></a>è¶…é•¿æºç åˆ†æè¿‡ç¨‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»è¿™ä¸ªæ–¹æ³•è¿›å…¥</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­å®¹å™¨çš„çŠ¶æ€, ç¡®ä¿ beanFactory å¯ç”¨.(ä¸»è¦æ˜¯è‹¥ä¸å¯ç”¨, æç¤ºçš„é”™è¯¯ä¿¡æ¯ä¼šæ¯”getBeanFacgtory()ä¸­æ›´å‡†ç¡®)</span></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ beanFactory çš„ getBean æ–¹æ³•è·å–å¯¹è±¡å¹¶è¿”å›.</span></span><br><span class="line">  assertBeanFactoryActive();</span><br><span class="line">  <span class="keyword">return</span> getBeanFactory().getBean(requiredType);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç„¶åå…¶ä»–æ‰€æœ‰æ¶‰åŠçš„æ ¸å¿ƒæ–¹æ³•çš„æ³¨é‡Š</span></span><br><span class="line">org.springframework.beans.factory.support.DefaultListableBeanFactory#resolveBean</span><br><span class="line">    <span class="comment">// è°ƒç”¨ resolveNamedBean, å¦‚å­˜åœ¨ bean åˆ™ç›´æ¥è¿”å›. (æ ¸å¿ƒ)</span></span><br><span class="line">		<span class="comment">// è‹¥ä¸å­˜åœ¨åˆ™ä»çˆ¶å®¹å™¨ä¸­å¯»æ‰¾, çˆ¶å®¹å™¨å®ç°äº† DefaultListableBeanFactory åˆ™è°ƒä¸åŒå­å®¹å™¨ç›¸åŒçš„æ–¹æ³•</span></span><br><span class="line">		<span class="comment">// è‹¥æ²¡å®ç°åˆ™ é€šè¿‡ getBeanProvider è·å–.</span></span><br><span class="line">  </span><br><span class="line">org.springframework.beans.factory.support.DefaultListableBeanFactory#resolveNamedBean(org.springframework.core.ResolvableType, java.lang.Object[], boolean)</span><br><span class="line">    <span class="comment">// 1.è°ƒç”¨ getBeanNamesForType è·å–æ‰€æœ‰ä¸ type ç›¸åŒ¹é…çš„ beanName é›†åˆ.</span></span><br><span class="line">		<span class="comment">// 2.éå†åˆ¤æ–­æ¯ä¸ª beanName æ˜¯å¦å¯ç”¨</span></span><br><span class="line">		<span class="comment">// 3.è‹¥å¯ç”¨çš„ beanName åªæœ‰ä¸€ä¸ª, åˆ™è°ƒç”¨ getBean(beanName) è·å–å¯¹è±¡å®ä¾‹å¹¶è¿”å›</span></span><br><span class="line">		<span class="comment">//   è‹¥å¯ç”¨æ•°è¶…è¿‡ä¸€ä¸ª, åˆ™è¯•ç€æ ¹æ®æ˜¯å¦ä¸»è¦ä»¥åŠé«˜ä¼˜å…ˆçº§æ¥ç¡®å®šä¸€ä¸ª beanName å®ä¾‹, è‹¥èƒ½ç¡®å®šåˆ™è¿”å›, ä¸èƒ½åˆ™æŠ¥é”™.</span></span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.support.AbstractBeanFactory#doGetBean</span><br><span class="line">    <span class="comment">// 1.è·å–å®Œæ•´çš„ beanName</span></span><br><span class="line">		<span class="comment">// 2.è°ƒç”¨ getSingleton1() æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç¼“å­˜, è¿™å±‚æ£€æŸ¥å¯é˜²æ­¢ä¾èµ–å¾ªç¯.</span></span><br><span class="line">		<span class="comment">//     è‹¥å­˜åœ¨, åˆ™é€šè¿‡ getObjectForBeanInstance() åˆ¤æ–­ç¼“å­˜çš„æ˜¯ bean è¿˜æ˜¯ FactoryBean å¹¶è¿”å›ç›¸åº”çš„å¯¹è±¡å®ä¾‹.</span></span><br><span class="line">		<span class="comment">// 3.è‹¥ä¸å­˜åœ¨, å…ˆè¯•ç€ä»çˆ¶å®¹å™¨è·å–(å­å®¹å™¨ä¸å­˜åœ¨è¿™ä¸ª beanDefinition ä¸”çˆ¶å®¹å™¨ä¸ä¸ºç©º)</span></span><br><span class="line">		<span class="comment">//     æ²¡æœ‰çˆ¶å®¹å™¨åˆ™ è°ƒç”¨ markBeanAsCreated() æ ‡è®°è¿™ä¸ª beanå·²ç»åˆ›å»ºäº† (å…ˆæ ‡è®°, å†åˆ›å»º)</span></span><br><span class="line">		<span class="comment">//     è·å– beanDefinition, åˆ¤æ–­å…¶ dependsOn å±æ€§æ˜¯å¦å­˜åœ¨, å­˜åœ¨åˆ™ å…ˆè·å–ä¾èµ–çš„ bean</span></span><br><span class="line">		<span class="comment">//     è°ƒç”¨ getSingleton2() å¤„ç†å•ä¾‹ç¼“å­˜</span></span><br><span class="line">		<span class="comment">// 4.è€Œ getSingleton2() ä¸­çš„é—­åŒ…ä¸­ æ‰§è¡Œçš„ createBean() æ–¹æ³•ä¸­åˆ™æ‰æ˜¯åˆ›å»ºå®ä¾‹å¹¶è°ƒç”¨ BeanPostProcessor</span></span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String, boolean)</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­æ˜¯å¦å­˜åœ¨äº singletonObjects ä¸­</span></span><br><span class="line">		<span class="comment">// 2.è‹¥ä¸å­˜åœ¨åˆ™åˆ¤æ–­ bean æ˜¯å¦å¤„äºåˆ›å»ºä¸­(æœªåˆ›å»ºå®Œæˆ, å¦‚å¾ªç¯ä¾èµ–æ—¶)</span></span><br><span class="line">		<span class="comment">// 3.è‹¥å¤„äºåˆ›å»ºä¸­, åˆ™åŒæ­¥ååˆ¤æ–­æ˜¯å¦å­˜åœ¨äº earlySingletonObjects (ä¹Ÿå°±æ˜¯ singletonFactories ç§»é™¤åå­˜å…¥çš„åœ°æ–¹)</span></span><br><span class="line">		<span class="comment">//      (å› ä¸ºFactoryBeanå ç”¨ç©ºé—´å¤§, è·å–å¯¹è±¡éº»çƒ¦ä¸”é€Ÿåº¦æ›´æ…¢, è¿™æ˜¯ä¸ºäº†é˜²æ­¢å¦‚æœå¾ªç¯ä¾èµ–é“¾æ¡å¾ˆé•¿ å¤šæ¬¡è·å–æµªè´¹CPUçš„é—®é¢˜)</span></span><br><span class="line">		<span class="comment">// 4.ä¸å­˜äº earlySingletonObjects åˆ™ä»£è¡¨ç¬¬ä¸€æ¬¡(ä¹Ÿåªä¼šæœ‰ä¸€æ¬¡)å– singletonFactories</span></span><br><span class="line">		<span class="comment">//    å–å‡ºåè°ƒç”¨ getObject() å¹¶å°†å…¶å­˜å…¥åˆ° earlySingletonObjects, ç„¶åä» singletonFactories ä¸­ç§»é™¤. ä»¥åå°±å°‘èµ°å‡ è¡Œä»£ç äº†.</span></span><br><span class="line">  </span><br><span class="line">org.springframework.beans.factory.support.DefaultSingletonBeanRegistry#getSingleton(java.lang.String, org.springframework.beans.factory.ObjectFactory&lt;?&gt;)</span><br><span class="line">    <span class="comment">// 1.å…ˆç¡®ä¿æ˜¯ç¬¬ä¸€æ¬¡åˆ›å»ºå•ä¾‹å¯¹è±¡, é˜²æ­¢é‡å¤åˆ›å»º</span></span><br><span class="line">		<span class="comment">// 2.è¿›è¡Œä¸€äº›å¼‚å¸¸å¤„ç†</span></span><br><span class="line">		<span class="comment">// 3.è°ƒç”¨ singletonFactory.getObject() åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">		<span class="comment">// 4.åˆ›å»ºå¯¹è±¡ç»“æŸæ·»åŠ å•ä¾‹ç¼“å­˜å’Œæ¸…ç©º singletonFactories / earlySingletonObjects ç¼“å­˜.</span></span><br><span class="line">  </span><br><span class="line">org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean(java.lang.String, org.springframework.beans.factory.support.RootBeanDefinition, java.lang.Object[])</span><br><span class="line">    <span class="comment">// 1.è°ƒç”¨ resolveBeanClass è§£æå¾—åˆ°çœŸæ­£çš„ bean class, è‹¥è§£æä¸ä¸ºç©ºä¸”å¤„äºæŸäº›æƒ…å†µä¸‹, åˆ™å¤åˆ¶ä¸€ä»½ beanDefinition å¹¶è®¾ç½® beanClass ä¸ºè§£ææ‰€å¾—</span></span><br><span class="line">		<span class="comment">// 2.æ‰§è¡Œ BeanPostProcessor çš„ postProcessorsBeforeInstantiation() æ–¹æ³•</span></span><br><span class="line">		<span class="comment">// 3.è°ƒç”¨ doCreateBean() åˆ›å»ºå¯¹è±¡ å¹¶è¿”å›</span></span><br><span class="line"></span><br><span class="line">org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#doCreateBean</span><br><span class="line">    <span class="comment">// 1.è°ƒç”¨ createBeanInstance() è·å¾—ä¸€ä¸ª å¯¹è±¡å®ä¾‹çš„ åŒ…è£…ç±»</span></span><br><span class="line">		<span class="comment">// 2.åŒæ­¥é”ä¸‹æ‰§è¡Œ BeanFactoryPostProcessor çš„ postProcessMergedBeanDefinition().</span></span><br><span class="line">		<span class="comment">// 3.æ·»åŠ  singletonFactories ç¼“å­˜, ç§»é™¤ earlySingletonObjects; è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜.</span></span><br><span class="line">		<span class="comment">// 4.è°ƒç”¨ populateBean() æ£€æŸ¥å­—æ®µæ˜¯å¦éœ€è¦æ³¨å…¥å¯¹è±¡å®ä¾‹, æ˜¯åˆ™è·å–å¯¹åº”çš„ bean æ³¨å…¥. (å¯èƒ½å¼•èµ·å¾ªç¯ä¾èµ–)</span></span><br><span class="line">		<span class="comment">// 5.è°ƒç”¨ initializeBean() æ‰§è¡Œå¯¹è±¡çš„ä¸€äº› Aware å’Œ init æ–¹æ³•å’Œ BeanPostProcessor çš„ postProcessBeforeInitialization.</span></span><br><span class="line">		<span class="comment">// 6.æœ€åè¿”å›å¯¹è±¡å®ä¾‹.</span></span><br></pre></td></tr></table></figure>





<h2 id="å„ç§å®ç°çš„åŸç†"><a href="#å„ç§å®ç°çš„åŸç†" class="headerlink" title="å„ç§å®ç°çš„åŸç†"></a>å„ç§å®ç°çš„åŸç†</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸ºä½•æˆ‘å†™çš„ class å®ç°ä¸€äº›æ¥å£(å¦‚ApplicationContextAware)åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹è±¡(å¦‚applicationContext)?</span><br><span class="line">2.ä¸ºä½•æˆ‘å†™çš„ class å®ç° ApplicationListener&lt;XxxEvent&gt; åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±èƒ½ç›‘å¬æˆ‘æƒ³çŸ¥é“çš„äº‹ä»¶?</span><br><span class="line">3.ä¸ºä½•Springä¸­é‡åˆ°å„ç§é¡ºåºé—®é¢˜, åªéœ€è¦å®ç° Ordered æ¥å£(æˆ–åŠ ä¸Š@Orderæ³¨è§£)å°±èƒ½ä½¿å…¶æœ‰åº?</span><br><span class="line">4.Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„(æŒ‡ç”¨å­—æ®µæ³¨å…¥è€Œéæ„é€ æ–¹æ³•)?</span><br><span class="line">5.Springå¯ä»¥ç”¨æ³¨è§£æ›¿æ¢XMLé…ç½®æ–‡ä»¶äº†, æ˜¯å¦‚ä½•å®ç°çš„å‘¢(å¸¸ç”¨æ³¨è§£çš„å®ç°åŸç†)?</span><br><span class="line">6.Spring AOPæ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Aspect)?</span><br><span class="line">7.Spring äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Transaction)?</span><br></pre></td></tr></table></figure>

<h3 id="ä¸ºä½•æˆ‘å†™çš„-class-å®ç°ä¸€äº›æ¥å£-å¦‚ApplicationContextAware-åå¹¶æ”¾å…¥å®¹å™¨ä¸­-å°±å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹è±¡-å¦‚applicationContext"><a href="#ä¸ºä½•æˆ‘å†™çš„-class-å®ç°ä¸€äº›æ¥å£-å¦‚ApplicationContextAware-åå¹¶æ”¾å…¥å®¹å™¨ä¸­-å°±å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹è±¡-å¦‚applicationContext" class="headerlink" title="ä¸ºä½•æˆ‘å†™çš„ class å®ç°ä¸€äº›æ¥å£(å¦‚ApplicationContextAware)åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹è±¡(å¦‚applicationContext)?"></a>ä¸ºä½•æˆ‘å†™çš„ class å®ç°ä¸€äº›æ¥å£(å¦‚ApplicationContextAware)åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±å¯ä»¥è·å–åˆ°ä¸€äº›å¯¹è±¡(å¦‚applicationContext)?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆ AbstractApplicationContext#prepareBeanFactory ä¼šæ·»åŠ ä¸€ä¸ªApplicationContextAwareProcessor</span><br><span class="line">2) è¿™ä¸ª beanPostProcessor è´Ÿè´£åœ¨beanåˆå§‹åŒ–ä¹‹å‰æ³¨å…¥contextå¯¹è±¡.</span><br><span class="line">3) è¿™ä¸ª beanPostProcessor çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ doCreateBean ä¸­çš„ postProcessBeforeInitialization()</span><br></pre></td></tr></table></figure>



<h3 id="ä¸ºä½•æˆ‘å†™çš„-class-å®ç°-ApplicationListener-åå¹¶æ”¾å…¥å®¹å™¨ä¸­-å°±èƒ½ç›‘å¬æˆ‘æƒ³çŸ¥é“çš„äº‹ä»¶"><a href="#ä¸ºä½•æˆ‘å†™çš„-class-å®ç°-ApplicationListener-åå¹¶æ”¾å…¥å®¹å™¨ä¸­-å°±èƒ½ç›‘å¬æˆ‘æƒ³çŸ¥é“çš„äº‹ä»¶" class="headerlink" title="ä¸ºä½•æˆ‘å†™çš„ class å®ç° ApplicationListener åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±èƒ½ç›‘å¬æˆ‘æƒ³çŸ¥é“çš„äº‹ä»¶?"></a>ä¸ºä½•æˆ‘å†™çš„ class å®ç° ApplicationListener<XxxEvent> åå¹¶æ”¾å…¥å®¹å™¨ä¸­, å°±èƒ½ç›‘å¬æˆ‘æƒ³çŸ¥é“çš„äº‹ä»¶?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) åœ¨ AbstractApplicationContext#registerListeners() ä¸­æ‰«æå®¹å™¨å†…æ‰€æœ‰ç›¸å…³å®ç°ç±»åŠ å…¥åˆ°äº‹ä»¶ç›‘å¬è€…é›†åˆä¸­</span><br><span class="line">2) ç„¶ååœ¨publishEventæ—¶ï¼Œéå†äº‹ä»¶ç›‘å¬è€…é›†åˆè°ƒç”¨beançš„æ–¹æ³•å³å¯ã€‚è§‚å¯Ÿè€…æ¨¡å¼ï¼</span><br><span class="line">3) å¦å¤–ä¹Ÿç”¨äº†BeanPostProcessorå»å®ç°, å« ApplicationListenerDetector, åŠ å…¥æ—¶æœºåŒ1, æ‰§è¡Œæ—¶æœºåŒ1.</span><br><span class="line">4) è‡³äºä¸ºä½•ä½¿ç”¨2ç§æœºåˆ¶, åº”è¯¥æ˜¯å› ä¸º registerListeners() æ—¶, æ‰«æåªæ˜¯å½“å‰çš„, åç»­å¯èƒ½å®¹å™¨å†…çš„ bean è¿˜ä¼šå¢åŠ (æˆ‘ä¹ŸçŒœä¸åˆ°å•¥å½¢å¼å¢åŠ , åæ­£ç®€å•å†™ä¸ªç±»è‚¯å®šä¸ä¼š), æ‰€ä»¥è¿˜æ˜¯éœ€è¦ ApplicationListenerDetector åœ¨è¿™ä¸ª Bean åˆå§‹åŒ–æ—¶åŠ å…¥åˆ°ç›‘å¬è€…ä¸­å».</span><br></pre></td></tr></table></figure>



<h3 id="ä¸ºä½•Springä¸­é‡åˆ°å„ç§é¡ºåºé—®é¢˜-åªéœ€è¦å®ç°-Ordered-æ¥å£-æˆ–åŠ ä¸Š-Orderæ³¨è§£-å°±èƒ½ä½¿å…¶æœ‰åº"><a href="#ä¸ºä½•Springä¸­é‡åˆ°å„ç§é¡ºåºé—®é¢˜-åªéœ€è¦å®ç°-Ordered-æ¥å£-æˆ–åŠ ä¸Š-Orderæ³¨è§£-å°±èƒ½ä½¿å…¶æœ‰åº" class="headerlink" title="ä¸ºä½•Springä¸­é‡åˆ°å„ç§é¡ºåºé—®é¢˜, åªéœ€è¦å®ç° Ordered æ¥å£(æˆ–åŠ ä¸Š@Orderæ³¨è§£)å°±èƒ½ä½¿å…¶æœ‰åº?"></a>ä¸ºä½•Springä¸­é‡åˆ°å„ç§é¡ºåºé—®é¢˜, åªéœ€è¦å®ç° Ordered æ¥å£(æˆ–åŠ ä¸Š@Orderæ³¨è§£)å°±èƒ½ä½¿å…¶æœ‰åº?</h3><blockquote>
<p>å› ä¸º Spring é¢„å…ˆåœ¨æ‰§è¡Œè¿™äº›ä¸œè¥¿ä¹‹å‰, è¿›è¡Œä¸€ä¸ªæ’åºåŠ¨ä½œ, ç„¶åæ‰éå†æ‰§è¡Œ. åŒ…æ‹¬AOP, BeanFactoryPostProcessor, BeanPostProcessor .</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) æ¯”å¦‚è¯´ BeanPostProcesser, å®¹å™¨æ‰«æå, ä¼šåƒå¯¹beané›†åˆæ’åº, å†éå†æ‰§è¡Œ.</span><br><span class="line">2) è¯¦ç»†è¿‡ç¨‹è§ PostProcessorRegistrationDelegate#sortPostProcessors()</span><br></pre></td></tr></table></figure>



<h3 id="Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„-æŒ‡ç”¨å­—æ®µæ³¨å…¥è€Œéæ„é€ æ–¹æ³•"><a href="#Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„-æŒ‡ç”¨å­—æ®µæ³¨å…¥è€Œéæ„é€ æ–¹æ³•" class="headerlink" title="Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„(æŒ‡ç”¨å­—æ®µæ³¨å…¥è€Œéæ„é€ æ–¹æ³•)?"></a>Springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„(æŒ‡ç”¨å­—æ®µæ³¨å…¥è€Œéæ„é€ æ–¹æ³•)?</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) é¦–å…ˆï¼Œ å‡å®šæœ‰ä¸¤ä¸ªå•ä¾‹ bean A å’Œ B, A æŒæœ‰ B, B æŒæœ‰Aï¼Œ æ„æˆå¾ªç¯</span><br><span class="line"><span class="number">2</span>) æ­¤æ—¶ç¨‹åºè°ƒç”¨getBeanè·å–Aï¼Œåˆ™åœ¨ doCreateBean ä¸­ åˆ›å»ºåå°† bean ç¼“å­˜åˆ° singletonFactories ä¸­</span><br><span class="line"><span class="number">3</span>) ç„¶åè®¾ç½®å±æ€§B, è§£æå±æ€§, éœ€è¦è·å–Bå¯¹è±¡</span><br><span class="line"><span class="number">4</span>) è·å–B, åˆ™æ‰§è¡ŒdoCreateBean åæ‰§è¡Œè§£æå±æ€§, éœ€è¦è·å– Aå¯¹è±¡ (åˆä¸€æ¬¡)</span><br><span class="line"><span class="number">5</span>) è·å–A, è¿›å…¥ doGetBean ä¸­çš„ getSingleton, æ­¤æ—¶åˆ¤æ–­ singletonFactories ä¸­æœ‰A, åˆ™å¯ä»¥ç›´æ¥å–å‡ºA</span><br><span class="line"><span class="number">6</span>) è·å¾—Aå, å³å¯å®ŒæˆBçš„å±æ€§èµ‹å€¼, ç„¶åä¼šå®ŒæˆBçš„åˆ›å»º.</span><br><span class="line"><span class="number">7</span>) Båˆ›å»ºå®Œå, Aå°±èƒ½è·å¾—B, åˆ™Aä¹Ÿå®Œæˆäº†å±æ€§èµ‹å€¼, æœ€åå®Œæˆåˆ›å»ºA.</span><br><span class="line"><span class="number">8</span>) åˆ°æ­¤, è¿”å›å³å¯.</span><br><span class="line"></span><br><span class="line">&gt; æ€»ç»“: é¦–æ¬¡è·å–A, åˆ›å»ºAå¯¹è±¡åç¼“å­˜ä¸€ä¸ªå­˜å‚¨Aå¯¹è±¡çš„ ObjectFactory å®ä¾‹, å†è§£æå±æ€§æ—¶è§¦å‘ getBean(B), åŒç†ä¹Ÿä¼šåšç¼“å­˜, ç„¶åä¹Ÿè§£æå±æ€§, è§¦å‘getBean(A), ç¬¬äºŒæ¬¡è·å–A, è¿›å…¥å¦ä¸€ä¸ªé€»è¾‘, è¿”å› ObjectFactory å®ä¾‹ä¸­å­˜å‚¨çš„å¯¹è±¡A, å³å¯å®ŒæˆgetBean(A), ç„¶åå®ŒæˆgetBean(B), å†å®Œæˆå¤–å±‚çš„getBean(A).  </span><br><span class="line">  </span><br><span class="line">TIPS:</span><br><span class="line">æ­¥éª¤<span class="number">4</span>ä¸­, ä¼šå…ˆåˆ¤æ–­ earlySingletonObjects, ä¸å­˜åœ¨æ‰åˆ¤æ–­ singletonFactories, è€Œä» singletonFactories ä¸­å–å¾—å¯¹è±¡å, åˆ™ä¼šå°†å…¶ä» singletonFactories ç§»é™¤å¹¶åŠ å…¥ earlySingletonObjects</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯å› ä¸º singletonFactories ç¼“å­˜çš„ FactoryBean, è‹¥åå¤è°ƒç”¨ getObject(), åˆ™æ¯æ¬¡è·å–éƒ½ä¼šè°ƒç”¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#getEarlyBeanReference æ–¹æ³•, è€Œæ­¤æ–¹æ³•ä¼šæ‰§è¡Œ SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference(), è¿™ä¼šå¯¼è‡´ BeanPostProcessor é‡å¤æ‰§è¡Œ, æ˜¾ç„¶æ˜¯ä¸è¡Œçš„.</span><br></pre></td></tr></table></figure>



<h3 id="Springå¯ä»¥ç”¨æ³¨è§£æ›¿æ¢XMLé…ç½®æ–‡ä»¶äº†-æ˜¯å¦‚ä½•å®ç°çš„å‘¢-å¸¸ç”¨æ³¨è§£çš„å®ç°åŸç†"><a href="#Springå¯ä»¥ç”¨æ³¨è§£æ›¿æ¢XMLé…ç½®æ–‡ä»¶äº†-æ˜¯å¦‚ä½•å®ç°çš„å‘¢-å¸¸ç”¨æ³¨è§£çš„å®ç°åŸç†" class="headerlink" title="Springå¯ä»¥ç”¨æ³¨è§£æ›¿æ¢XMLé…ç½®æ–‡ä»¶äº†, æ˜¯å¦‚ä½•å®ç°çš„å‘¢(å¸¸ç”¨æ³¨è§£çš„å®ç°åŸç†)?"></a>Springå¯ä»¥ç”¨æ³¨è§£æ›¿æ¢XMLé…ç½®æ–‡ä»¶äº†, æ˜¯å¦‚ä½•å®ç°çš„å‘¢(å¸¸ç”¨æ³¨è§£çš„å®ç°åŸç†)?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆæ˜¯æŒ‡å®šåŒ…åæˆ–æŒ‡å®šç±»å</span><br><span class="line">	å¦‚æŒ‡å®šåŒ…ååˆ™ scan æ—¶ä¼šæ‰§è¡Œ, å¦‚æŒ‡å®šç±»ååˆ™åœ¨æ„é€ æ–¹æ³•åˆå§‹åŒ– reader æ—¶æ‰§è¡Œ</span><br><span class="line">2) æ— è®ºå“ªç§, æœ€ç»ˆéƒ½ä¼šèµ°ä¸€æ®µä»£ç  AnnotationConfigUtils#registerAnnotationConfigProcessors()</span><br><span class="line">3) è¿™æ®µä»£ç ä¼šæ·»åŠ ä¸€äº› BeanFactoryPostProcessor</span><br><span class="line">	å¦‚ ConfigurationClassPostProcessor è´Ÿè´£è§£æ @Configuration&#x2F;@Import&#x2F;@Bean ç­‰æ³¨è§£</span><br><span class="line">    	ç„¶åç”± ConfigurationClassBeanDefinitionReader è´Ÿè´£å°†ä¿¡æ¯è½¬æ¢æˆBeanDefinitionå†æ³¨å†Œåˆ°å®¹å™¨ã€‚</span><br><span class="line">	å¦‚ AutowiredAnnotationBeanPostProcessor è´Ÿè´£è§£æ @Autowired&#x2F;@Value æ³¨è§£</span><br><span class="line">    å¦‚ CommonAnnotationBeanPostProcessor è´Ÿè´£è§£æ @Resource æ³¨è§£</span><br><span class="line">    è§£ææ”¾åœ¨ postProcessProperties() æ–¹æ³•ä¸­ï¼Œ å…ˆæ‰«æbeançš„å­—æ®µå’Œæ–¹æ³•ï¼Œ ç„¶åä¸€ä¸€è°ƒç”¨æ–¹æ³•å’Œä¸ºå­—æ®µæ³¨å…¥å€¼</span><br><span class="line">4) ä¹‹å, ä»–ä¼šå°†æ‰«æçš„ç±»æ”¾åˆ° beanDefinitions ä¸­(æˆ–æŒ‡å®šçš„ç±»æ³¨å†Œè¿›å»)</span><br><span class="line">5) BeanFactoryåŠ è½½å®Œæ¯•å, å›åˆ°AbstractApplicationContextçš„refreshé€»è¾‘</span><br><span class="line">	å¦‚ä¼šæ‰§è¡Œ postProcessBeanFactory(), è°ƒç”¨å‰é¢åŠ å…¥çš„ConfigurationClassPostProcessor</span><br><span class="line">	ç„¶åä¼šæ·»åŠ æ›´å¤šçš„ç±»åˆ°å®¹å™¨ä¸­.</span><br><span class="line">    </span><br><span class="line">æ³¨æ„äº‹é¡¹ï¼š</span><br><span class="line">    @Configuration å’Œ @Componentçš„åŒºåˆ«ï¼Ÿ</span><br><span class="line">    è§‚å¯Ÿå‘ç°ï¼Œå³ä½¿ä½¿ç”¨@Component å…¶ä¸‹å¸¦ @Bean çš„æ–¹æ³•ä¾ç„¶å¯ä»¥æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚æ‰€ä»¥ä¼¼ä¹ä¸¤è€…æ²¡æœ‰åŒºåˆ«ï¼Ÿ</span><br><span class="line">    ä»”ç»†æŸ¥çœ‹æºç å’Œèµ„æ–™åï¼Œå‘ç° postProcessBeanFactory() æ–¹æ³•åœ¨ processConfigBeanDefinitions() åè¿˜ä¼šè°ƒç”¨ enhanceConfigurationClasses()</span><br><span class="line">    è€Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­, å¯¹å‰é¢è§£æäº†class æ˜¯ CONFIGURATION_CLASS_FULL (å³ä»£è¡¨@Configuration)çš„ç±»</span><br><span class="line">    ä¼šç”Ÿæˆä¸€ä¸ª cglib çš„ä»£ç†, è¿™æ ·è·å–@Beanæ³¨è§£çš„æ–¹æ³•çš„beanæ—¶,ä¸ä¼šæ¯æ¬¡è°ƒç”¨æ–¹æ³•new ä¸€ä¸ª, è€Œæ˜¯æœ‰ç¼“å­˜.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: å°±æ˜¯åˆ©ç”¨ BeanFactoryPostProcessor å¯è·å– BeanDefinitionRegistry å¯¹è±¡, ç„¶åæ‰«æå®¹å™¨å†…å¸¦æœ‰æ³¨è§£çš„ bean, è§£æè¿™äº›æ³¨è§£å¾—åˆ°ä¸€äº› BeanDefinition, å†é€šè¿‡è·å¾—çš„ BeanDefinitionRegistryå¯¹è±¡æ³¨å†Œåˆ° BeanFactory ä¸­.</p>
</blockquote>
<h3 id="Spring-AOPæ˜¯å¦‚ä½•å®ç°çš„-æŒ‡-Aspect"><a href="#Spring-AOPæ˜¯å¦‚ä½•å®ç°çš„-æŒ‡-Aspect" class="headerlink" title="Spring AOPæ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Aspect)?"></a>Spring AOPæ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Aspect)?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1) ä½¿ç”¨ @EnableAspectJAutoProxy</span><br><span class="line">2) @EnableAspectJAutoProxy ä¸­ä½¿ç”¨äº† @Import(AspectJAutoProxyRegistrar.class)</span><br><span class="line">3) ConfigurationClassPostProcessor ä¼šè§£æ@Import, è¿›å…¥ registerBeanDefinitions() ä¸­</span><br><span class="line">4) registerBeanDefinitions() ä¸­æ·»åŠ äº† AnnotationAwareAspectJAutoProxyCreator åˆ°å®¹å™¨ä¸­</span><br><span class="line">5) AnnotationAwareAspectJAutoProxyCreator æœ¬è´¨ä¸Šæ—¶ä¸€ä¸ª BeanPostProcessor</span><br><span class="line">6) å› æ­¤åœ¨ createBean æ—¶, ä¼šè¢«è‡ªåŠ¨è°ƒç”¨. å…¶ä¸­ postProcessAfterInitialization() è´Ÿè´£åˆ›å»ºä»£ç†å¯¹è±¡</span><br><span class="line">7) è€Œ getAdvicesAndAdvisorsForBean() åˆ™è´Ÿè´£æŸ¥æ‰¾å¯¹åº”çš„å¢å¼º. ç„¶åä¼šè°ƒç”¨å­ç±»çš„findCandidateAdvisors</span><br><span class="line">8) å¦‚ AnnotationAwareAspectJAutoProxyCreator#findCandidateAdvisors() è´Ÿè´£æ³¨è§£ç¼–å†™å¢å¼º@Before&#x2F;@Afterç­‰</span><br><span class="line">9) ç®€å•è¯´ä¸‹é€»è¾‘, å°±æ˜¯æŸ¥æ‰¾å®¹å™¨æ‰€æœ‰ç±», åˆ¤æ–­è¿™ä¸ªç±»æœ‰æ²¡æœ‰ @Aspect æ³¨è§£, ç„¶åå…ˆæ‰¾å‡ºæ‰€æœ‰Pointcut</span><br><span class="line">	å†éå†æ‰€æœ‰æ–¹æ³•, æ‰¾å‡ºæ–¹æ³•ä¸Šå¸¦æœ‰@Beforeç­‰æ³¨è§£ä¸”æœ‰å…³è”çš„Pointcutçš„æ–¹æ³•,</span><br><span class="line">    ç„¶åä½¿ç”¨è¿™ä¸ªæ–¹æ³•å’Œå…³è”çš„Pointcut æ¥new ä¸€ä¸ªAdvisor, åŠ å…¥åˆ°Advisoré›†åˆä¸­, éå†ç»“æŸåè¿”å›å³å¯.</span><br><span class="line">10) æŸ¥æ‰¾åˆ°æ‰€æœ‰çš„å¢å¼ºå, å†æ¯”è¾ƒPointcutè¡¨è¾¾å¼æ˜¯å¦åŒ¹é…å½“å‰çš„bean, å¦‚å¯ä»¥åˆ™åŠ å…¥.</span><br><span class="line">11) æ ¹æ®æ‰¾åˆ°çš„Advisoré›†åˆ, åˆ›å»ºä¸€ä¸ªå¸¦é…ç½®(advisoré›†åˆç­‰)çš„ä»£ç†å¯¹è±¡, ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•å‰</span><br><span class="line">12) ä¼šå…ˆæ ¹æ®é…ç½®ä¸­çš„advisoré›†åˆç”Ÿæˆä¸€ä¸ªæ‰§è¡Œé“¾, ç„¶ååœ¨æ‹¦æˆªä»£ç†æ–¹æ³•å¤„è°ƒç”¨. æ‰§è¡Œé“¾ä¼šè´Ÿè´£æ‰§è¡Œé€šçŸ¥.</span><br><span class="line">13) ä¸åŒçš„é€šçŸ¥ç”±ä¸åŒçš„é€‚é…å™¨æ‰§è¡Œ.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“å°±æ˜¯é€šè¿‡ @EnableAspectJAutoProxy çš„@Import, ä½¿å¾—ç¨‹åºæœ€ç»ˆä¼šæ‰§è¡Œ AnnotationAwareAspectJAutoProxyCreator çš„ postProcessAfterInitialization(å¯¹è±¡åˆå§‹åŒ–åè°ƒç”¨) æ–¹æ³•, è¿™ä¸ªæ–¹æ³•åœ¨ BeanFactoryåˆ›å»ºå®Œå¯¹è±¡åè§¦å‘, æ­¤æ—¶ä¾¿å¯é€šè¿‡ CGlib ç­‰åŠ¨æ€ä»£ç†æŠ€æœ¯ä¸º åˆ›å»ºçš„ bean å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡, ç„¶åè¿™ä¸ªä»£ç†å¯¹è±¡ä¼šæ ¹æ® Pointcut æ‰¾åˆ°å…³è”çš„ Advisor,  å¹¶åœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œå¯¹åº”çš„ Advisor, å¦‚ @Beforeäº§ç”Ÿçš„Advisor ä¼šåœ¨æ‰§è¡Œäº† bean å¯¹è±¡çš„æŒ‡å®šæ–¹æ³•(çœ‹Pointcuté…ç½®)åæ‰§è¡Œ.</p>
</blockquote>
<h3 id="Spring-äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„-æŒ‡-Transaction"><a href="#Spring-äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„-æŒ‡-Transaction" class="headerlink" title="Spring äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Transaction)?"></a>Spring äº‹åŠ¡æ˜¯å¦‚ä½•å®ç°çš„(æŒ‡@Transaction)?</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">0) äº‹åŠ¡æ˜¯ç”±AOPå®ç°çš„, æ‰€ä»¥éœ€è¦æ‰¾åˆ°å¯¹åº”çš„Pointcut å’Œ Advisor</span><br><span class="line">1) æ‰“å¼€äº† @EnableTransactionManagement æ³¨è§£</span><br><span class="line">2) ç„¶å@Import äº† TransactionManagementConfigurationSelector</span><br><span class="line">3) ä¹‹åå¯¼å…¥äº† ProxyTransactionManagementConfiguration åˆ°å®¹å™¨ä¸­</span><br><span class="line">4) ProxyTransactionManagementConfiguration å¸¦æœ‰ @Configuration</span><br><span class="line">5) @Bean æ³¨å…¥äº†ä¸€ä¸ªé€šç”¨çš„Advisor: BeanFactoryTransactionAttributeSourceAdvisor</span><br><span class="line">6) è¿™ä¸ªAdvisorçš„ Pointcut æ˜¯ç”± TransactionAttributeSourcePointcut å®ç°çš„</span><br><span class="line">	å®ç°é€»è¾‘æ˜¯ TransactionAttributeSourcePointcut çš„ matches()</span><br><span class="line">    è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº† getTransactionAttributeSource() è·å– AnnotationTransactionAttributeSource</span><br><span class="line">    ç„¶åé€šè¿‡ getTransactionAttribute() è°ƒç”¨äº† findTransactionAttribute()</span><br><span class="line">    æœ€ç»ˆä½¿ç”¨SpringTransactionAnnotationParser ç±»åˆ¤æ–­æ–¹æ³•æ˜¯å¦æœ‰@Transactionalæ³¨è§£</span><br><span class="line">    å¹¶è§£ææ³¨è§£ä¿¡æ¯ç„¶åè¿”å›. å¦å¤–è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥è·å–@Transactionalæ³¨è§£çš„ä¿¡æ¯, è€Œè¿™é‡Œåªç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™ä¸ªæ–¹æ³•.</span><br><span class="line">7) TransactionInterceptor æ˜¯ä¸€ä¸ªAdvisor</span><br><span class="line">    ä¹Ÿå¯ä»¥é€šè¿‡AnnotationTransactionAttributeSourceè·å–@Transactionalæ³¨è§£ä¸Šçš„ä¿¡æ¯</span><br><span class="line">    ç„¶ååœ¨invokeä¸­, æ‹¦æˆªæ–¹æ³•, æ‰“å¼€äº‹åŠ¡, åœ¨æ‰§è¡Œå®Œæ–¹æ³•å, æäº¤äº‹åŠ¡, æŠ¥é”™æ—¶å›æ»šäº‹åŠ¡</span><br><span class="line">    è¿™ä¸ª Advisor ä¸åŒäºä¼ ç»Ÿçš„å‰ç½®&#x2F;åç½®, è€Œæ˜¯æ›´å…·ä½“çš„ MethodInterceptor(åŠ¨æ€ä»£ç†ç›´æ¥ç›¸å…³).</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: å°±æ˜¯åŸºäºAOPå®ç°çš„, åªéœ€æ‰¾åˆ°å¯¹åº”çš„ Pointcut å’Œ Advisor å³å¯. Pointcut å°±æ˜¯æ ¹æ® @Transaction æ³¨è§£åˆ¤æ–­æ–¹æ³•æ˜¯å¦éœ€è¦ä»£ç†, è¿™ä¸ªå¾ˆç®€å•; æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ Advisor ä¸æ˜¯æˆ‘ä»¬å†™AOPé‚£ç§ @Before,@Aroundä¹‹ç±»çš„, è€Œæ˜¯æ›´æ¥è¿‘åŠ¨æ€ä»£ç†åŸå§‹çš„è¯­æ³•çš„ MethodInterceptor å³ TransactionInterceptor.</p>
</blockquote>
<h2 id="BeanFactoryPostProcessor-ç›¸å…³ç±»åˆ†æ"><a href="#BeanFactoryPostProcessor-ç›¸å…³ç±»åˆ†æ" class="headerlink" title="BeanFactoryPostProcessor ç›¸å…³ç±»åˆ†æ"></a>BeanFactoryPostProcessor ç›¸å…³ç±»åˆ†æ</h2><h3 id="BeanFactoryPostProcessor-ç”Ÿæ•ˆåŸç†"><a href="#BeanFactoryPostProcessor-ç”Ÿæ•ˆåŸç†" class="headerlink" title="BeanFactoryPostProcessor ç”Ÿæ•ˆåŸç†"></a>BeanFactoryPostProcessor ç”Ÿæ•ˆåŸç†</h3><blockquote>
<p>ç”Ÿæ•ˆåŸç†å°±æ˜¯, ApplicationContext çš„ refresh æ–¹æ³•ä¸­ä¼šæ‰«æå‡ºå®¹å™¨ä¸­å®ç°äº† BeanFactoryPostProcessor æ¥å£çš„ bean, å°†å…¶æ’åºåæ‰§è¡Œç›¸åº”çš„æ¥å£, è¿™æ ·æˆ‘ä»¬å†™çš„ç±»å®ç°çš„ç›¸åº”çš„æ¥å£çš„æ–¹æ³•å°±è¢«æ‰§è¡Œäº†.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å¸¸ç”¨çš„ BeanFactoryPostProcessor</span><br><span class="line"><span class="comment"># ConfigurationClassPostProcessor</span></span><br><span class="line">è¿™ä¸ªç±»ä½œç”¨å°±æ˜¯è§£æ @Configuration/@Component/@Import/@ImportSource/@ComponentScan ç­‰åŸºç¡€æ³¨è§£. æ˜¯æ³¨è§£å¼€å‘çš„åŸºçŸ³, æ›´æ˜¯ Spring Boot çš„åŸºçŸ³.</span><br></pre></td></tr></table></figure>



<h2 id="BeanPostProcessor-ç›¸å…³ç±»åˆ†æ"><a href="#BeanPostProcessor-ç›¸å…³ç±»åˆ†æ" class="headerlink" title="BeanPostProcessor ç›¸å…³ç±»åˆ†æ"></a>BeanPostProcessor ç›¸å…³ç±»åˆ†æ</h2><h3 id="BeanPostProcessor-ç”Ÿæ•ˆåŸç†"><a href="#BeanPostProcessor-ç”Ÿæ•ˆåŸç†" class="headerlink" title="BeanPostProcessor ç”Ÿæ•ˆåŸç†"></a>BeanPostProcessor ç”Ÿæ•ˆåŸç†</h3><blockquote>
<p>åœ¨ refresh() ä¸­ä¼šæ‰«æå®¹å™¨ä¸­æ‰€æœ‰ å®ç°äº† BeanPostProcessor æ¥å£çš„ç±», æ·»åŠ åˆ° BeanFactory çš„ beanPostProcessors å­—æ®µä¸­(æ˜¯ä¸ªList[CopyOnWriteArrayListè‡ªå®šä¹‰ç‰ˆ, è‡ªå®šä¹‰åŠ å…¥äº†æ¸…ç©ºç¼“å­˜çš„é€»è¾‘]), ç„¶ååœ¨ BeanFactory åˆ›å»ºå¯¹è±¡æ—¶ createBean() åœ¨é€‚å½“çš„æ—¶æœºè°ƒç”¨å¯¹åº”çš„æ–¹æ³•.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">æœ‰å“ªå‡ ç§ BeanPostProcessor (é»˜è®¤çš„+æ‰©å±•)</span><br><span class="line">1.InstantiationAwareBeanPostProcessor</span><br><span class="line">	postProcessAfterInstantiation: å¯¹è±¡å®ä¾‹åŒ–åè°ƒç”¨</span><br><span class="line">	postProcessBeforeInstantiation: å¯¹è±¡å®ä¾‹åŒ–å‰è°ƒç”¨</span><br><span class="line">	postProcessProperties: è®¾ç½®å±æ€§å€¼å‰</span><br><span class="line">	postProcessPropertyValues: è®¾ç½®å±æ€§å€¼å‰, è‹¥ä¸Šä¸ªæ–¹æ³•ä¸å¤„ç†(è¿”å›null)æ‰ä¼šè§¦å‘</span><br><span class="line"></span><br><span class="line">2.SmartInstantiationAwareBeanPostProcessor</span><br><span class="line">  predictBeanType: è·å–ä¸€ä¸ª bean çš„ class ç±»å‹å‰è°ƒç”¨</span><br><span class="line">  getEarlyBeanReference: è·å–ä¸€ä¸ªäºŒçº§ç¼“å­˜å¯¹è±¡(singletonFactoriesçš„getObject)æ—¶è°ƒç”¨</span><br><span class="line">  determineCandidateConstructors: å†³å®šä¸€ä¸ª bean å®ä¾‹åŒ–çš„æ„é€ å‚æ•°æ˜¯ä»€ä¹ˆæ—¶è°ƒç”¨</span><br><span class="line">	</span><br><span class="line">3.DestructionAwareBeanPostProcessor</span><br><span class="line">	postProcessBeforeDestruction: å¯¹è±¡é”€æ¯å‰è°ƒç”¨</span><br><span class="line">	requiresDestruction: åˆ¤æ–­è¿™ä¸ªç±»é’ˆå¯¹æŸä¸ª bean æ˜¯å¦æ‰§è¡Œ postProcessBeforeDestruction()</span><br><span class="line">	</span><br><span class="line">4.MergedBeanDefinitionPostProcessor</span><br><span class="line">  postProcessMergedBeanDefinition: åœ¨åˆ›å»ºå¯¹è±¡å‰è°ƒç”¨, å¯å¯¹ BeanDefinition åšä¿®æ”¹</span><br><span class="line">  resetBeanDefinition: åœ¨é‡ç½® BeanDefinition æ—¶è°ƒç”¨, ç”¨äºæ¸…ç©º PostProcessor å¯¹åº”çš„ç¼“å­˜</span><br><span class="line">	</span><br><span class="line">5.BeanPostProcessor(åŸºç¡€)</span><br><span class="line">  postProcessBeforeInitialization: åˆ›å»ºå¯¹è±¡å(ä¹Ÿè®¾ç½®å¥½äº†å­—æ®µ), åœ¨è°ƒç”¨ init ä¹‹å‰è°ƒç”¨</span><br><span class="line">  postProcessAfterInitialization: åœ¨åˆ›å»ºå¯¹è±¡æ—¶, è°ƒç”¨äº† init ä¹‹åè°ƒç”¨</span><br><span class="line">  </span><br><span class="line">æ€»ç»“: </span><br><span class="line">0.å¯¹ BeanDefinition åšå¹²é¢„</span><br><span class="line">1.å¯¹è±¡å®ä¾‹åŒ–è¿‡ç¨‹ä¸­(å¯¹class/æ„é€ å‚æ•°è¿›è¡Œå¹²é¢„)</span><br><span class="line">2.å¯¹è±¡å®ä¾‹åŒ–å‰å</span><br><span class="line">3.å¯¹è±¡è®¾ç½®å±æ€§å‰, å¯¹å±æ€§åšå¹²é¢„</span><br><span class="line">4.å¯¹è±¡åˆå§‹åŒ–(init)å‰å</span><br><span class="line">5.å¯¹è±¡é”€æ¯å‰</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒç”¨æ—¶æœº"><a href="#è°ƒç”¨æ—¶æœº" class="headerlink" title="è°ƒç”¨æ—¶æœº"></a>è°ƒç”¨æ—¶æœº</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 1.1: InstantiationAwareBeanPostProcessor çš„ postProcessAfterInstantiation()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean ç¬¬ä¸€æ®µ</span></span><br><span class="line"><span class="comment">// 1.2: InstantiationAwareBeanPostProcessor çš„ postProcessProperties()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean ç¬¬äºŒæ®µ</span></span><br><span class="line"><span class="comment">// 1.3: InstantiationAwareBeanPostProcessor çš„ postProcessPropertyValues</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.populateBean ç¬¬ä¸‰æ®µ</span></span><br><span class="line"><span class="comment">// 1.4: InstantiationAwareBeanPostProcessor çš„ postProcessBeforeInstantiation()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyBeanPostProcessorsBeforeInstantiation ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.1: SmartInstantiationAwareBeanPostProcessor çš„ predictBeanType()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.predictBeanType ä¸­</span></span><br><span class="line"><span class="comment">// 2.2: SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.getEarlyBeanReference ä¸­</span></span><br><span class="line"><span class="comment">// 2.3: SmartInstantiationAwareBeanPostProcessor çš„ determineCandidateConstructors()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.1: MergedBeanDefinitionPostProcessor çš„ postProcessMergedBeanDefinition()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.applyMergedBeanDefinitionPostProcessors ä¸­</span></span><br><span class="line"><span class="comment">// 3.2: MergedBeanDefinitionPostProcessor çš„ resetBeanDefinition()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.DefaultListableBeanFactory.resetBeanDefinition ä¸­</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.1: DestructionAwareBeanPostProcessor çš„ postProcessBeforeDestruction()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.DisposableBeanAdapter.destroy ä¸­</span></span><br><span class="line"><span class="comment">// 4.2: DestructionAwareBeanPostProcessor çš„ requiresDestruction()</span></span><br><span class="line"><span class="comment">//   åœ¨ org.springframework.beans.factory.support.DisposableBeanAdapter.filterPostProcessors å’Œ org.springframework.beans.factory.support.DisposableBeanAdapter.hasApplicableProcessors ä¸­</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ‰å“ªäº›å¸¸ç”¨çš„ BeanPostProcessor</span></span><br><span class="line">1.AsyncAnnotationBeanPostProcessor: ç”¨äºåœ¨å°† @Async ç›¸åº”çš„ Advisor åŠ å…¥åˆ°å¯¹è±¡çš„ä»£ç†ä¸­</span><br><span class="line">2.ScheduledAnnotationBeanPostProcessor: ç”¨äºå¤„ç† @Scheduled æ³¨è§£, å°† bean ç”Ÿäº§ä»£ç†ç±»</span><br><span class="line">3.AnnotationAwareAspectJAutoProxyCreator: AOP å®ç°æ ¸å¿ƒç±»</span><br><span class="line">4.AutowiredAnnotationBeanPostProcessor: ç”¨äºå¤„ç† @Autowired æ³¨è§£</span><br><span class="line">5.ApplicationListenerDetector: ç”¨äºå¤„ç†å®ç° ApplicationListener æ¥å£çš„ bean å¯¹è±¡, å°†å…¶æ·»åŠ åˆ°äº‹ä»¶å¹¿æ’­å™¨çš„ç›‘å¬è€…é›†åˆä¸­.</span><br><span class="line">...</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2020/05/20/interview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/interview/" class="post-title-link" itemprop="url">ä¸€é¡¿ä¹±å†™</a>
        </h2>

        <div class="post-meta">
			
				<i class="fa fa-thumb-tack"></i>
				<font color="RED">ç½®é¡¶</font>
				<span class="post-meta-divider">|</span>
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-05-20 08:48:14" itemprop="dateCreated datePublished" datetime="2020-05-20T08:48:14+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:55:35" itemprop="dateModified" datetime="2021-03-28T19:55:35+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2020/05/20/interview/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/05/20/interview/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ä¸€å¥è¯"><a href="#ä¸€å¥è¯" class="headerlink" title="ä¸€å¥è¯"></a>ä¸€å¥è¯</h2><h3 id="è¯´ä¸€ä¸‹ä½ é‡æ„ä»£ç éƒ½åšäº†ä»€ä¹ˆ"><a href="#è¯´ä¸€ä¸‹ä½ é‡æ„ä»£ç éƒ½åšäº†ä»€ä¹ˆ" class="headerlink" title="è¯´ä¸€ä¸‹ä½ é‡æ„ä»£ç éƒ½åšäº†ä»€ä¹ˆ?"></a>è¯´ä¸€ä¸‹ä½ é‡æ„ä»£ç éƒ½åšäº†ä»€ä¹ˆ?</h3><blockquote>
<p>é¦–å…ˆæ˜¯ä¸¤å±‚æ”¹æˆä¸‰å±‚, æŠŠcontroller çš„ä»£ç å°½é‡è¿ç§»åˆ° service å±‚. ç„¶åå°†è¯·æ±‚é£æ ¼å’Œå“åº”æ•°æ®ç»“æ„ç»Ÿä¸€. è¿˜æœ‰å°±æ˜¯å¤„ç†å…¨å±€å¼‚å¸¸, æœ€åå¯¹æŸäº›é‡å¤ä»£ç å°è£…æˆå·¥å…·ç±». å¦å¤–è¿˜ä¼šæ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯ä½¿ç”¨ä¸€äº›è®¾è®¡æ¨¡å¼, æé«˜ä»£ç å¯æ‰©å±•æ€§, é™ä½ä»£ç ä¹‹é—´çš„è€¦åˆæ€§.</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯-JVM"><a href="#ä»€ä¹ˆæ˜¯-JVM" class="headerlink" title="ä»€ä¹ˆæ˜¯ JVM?"></a>ä»€ä¹ˆæ˜¯ JVM?</h3><blockquote>
<p> JVM å°±æ˜¯ç”±ç¼–è¯‘å™¨, ç±»åŠ è½½å™¨, æ‰§è¡Œå¼•æ“, è¿è¡Œæ—¶æ•°æ®åŒºç»„æˆ. å…¶ä¸­æ•°æ®åŒºåŒ…å« å †,æ ˆ,æœ¬åœ°æ–¹æ³•æ ˆ, æ–¹æ³•åŒºå’Œç¨‹åºè®¡æ•°å™¨(PC å¯„å­˜å™¨), å…¶ä¸­æ ˆæ˜¯ç”±å±€éƒ¨å˜é‡è¡¨, æ“ä½œæ•°æ ˆ, åŠ¨æ€é“¾æ¥, è¿”å›åœ°å€ç»„æˆçš„.</p>
</blockquote>
<h3 id="ä½ æ˜¯æ€ä¹ˆå¯¹-jvm-åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„"><a href="#ä½ æ˜¯æ€ä¹ˆå¯¹-jvm-åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„" class="headerlink" title="ä½ æ˜¯æ€ä¹ˆå¯¹ jvm åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„?"></a>ä½ æ˜¯æ€ä¹ˆå¯¹ jvm åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„?</h3><blockquote>
<p>æ ¹æ®æœåŠ¡å™¨çš„é…ç½®, è°ƒæ•´é’å¹´ä»£å’Œè€å¹´ä»£çš„å†…å­˜å¤§å°åŠæ¯”ä¾‹, åœ¨å›æ”¶é¢‘ç‡å’Œå›æ”¶é€Ÿåº¦ä¸Šåšå–èˆ, ä½¿ç”¨ G1 åƒåœ¾å›æ”¶æœŸæ§åˆ¶ STW åœé¡¿æ—¶é—´, æé«˜ååé‡.</p>
</blockquote>
<h3 id="è¯´è¯´-MySQL-ä¼˜åŒ–"><a href="#è¯´è¯´-MySQL-ä¼˜åŒ–" class="headerlink" title="è¯´è¯´ MySQL ä¼˜åŒ–"></a>è¯´è¯´ MySQL ä¼˜åŒ–</h3><blockquote>
<p>é¦–å…ˆæ˜¯ SQL æŸ¥è¯¢ä¼˜åŒ–, é€šè¿‡å¯¹è”è¡¨å­—æ®µ, æŸ¥è¯¢æ¡ä»¶, åˆ†ç»„å­—æ®µ, æ’åºå­—æ®µè¿›è¡Œç»¼åˆåˆ†æ, æ ¹æ®æœ€å·¦åŸåˆ™å»ºç«‹ä¸€ä¸ªæˆ–å¤šä¸ªå¤åˆç´¢å¼•, ç„¶åä½¿ç”¨ explain åˆ†æSQLæ‰§è¡Œè®¡åˆ’, åˆ¤æ–­ç´¢å¼•ä½¿ç”¨æƒ…å†µ, æ ¹æ®åˆ†æç»“æœè¿›ä¸€æ­¥æ”¹è¿›ç´¢å¼•.</p>
<p>ç„¶åæ˜¯å¯¹äºæ•°æ®é‡å¤§çš„è¡¨, è€ƒè™‘å‚ç›´æˆ–æ°´å¹³åˆ†è¡¨, è¯»å¤šå†™å°‘çš„æƒ…å†µ, å¯ä»¥ä¸€ä¸»å¤šä»é›†ç¾¤. å¦å¤–å¯¹äºä¸€äº›ç»Ÿè®¡ç±»çš„æŸ¥è¯¢, å¯ä»¥ç”¨å®šæ—¶ä»»åŠ¡å°†ç»Ÿè®¡ç»“æœå­˜å‚¨èµ·æ¥, è€Œéå®æ—¶æŸ¥è¯¢.</p>
</blockquote>
<h3 id="ä½ ç”¨-Redis-åšäº†ä»€ä¹ˆ"><a href="#ä½ ç”¨-Redis-åšäº†ä»€ä¹ˆ" class="headerlink" title="ä½ ç”¨ Redis åšäº†ä»€ä¹ˆ?"></a>ä½ ç”¨ Redis åšäº†ä»€ä¹ˆ?</h3><blockquote>
<p>å°†é«˜è®¿é—®çš„é¦–é¡µå•†å“åˆ—è¡¨ç¼“å­˜åˆ° redis ä¸­, é¿å…æ•°æ®åº“ç“¶é¢ˆ, æé«˜å“åº”é€Ÿåº¦. </p>
<p>å•†å“åŒæ­¥é—®é¢˜: å®šæ—¶ä»»åŠ¡åˆ·æ–°. æˆ–ä¿®æ”¹å•†å“æ—¶æ›´æ–°, ç¼“å­˜è®¾ç½®å¤±æ•ˆæ—¶é—´, å¤±æ•ˆåè‡ªåŠ¨è¯»å–æ•°æ®åº“.</p>
<p>å°†è´­ç‰©è½¦æ•°æ®å­˜æ”¾åˆ° redis, æé«˜è´­ç‰©è½¦äº¤äº’ä½“éªŒ(åŠ å¿«å“åº”é€Ÿåº¦).</p>
</blockquote>
<h3 id="ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšäº†ä»€ä¹ˆ"><a href="#ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšäº†ä»€ä¹ˆ" class="headerlink" title="ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšäº†ä»€ä¹ˆ?"></a>ä½ ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åšäº†ä»€ä¹ˆ?</h3><blockquote>
<p>è§£è€¦: å¦‚ä¸‹å•ç³»ç»Ÿè°ƒç”¨åº“å­˜ç³»ç»Ÿå‡åº“å­˜, è‹¥è°ƒç”¨æ—¶åº“å­˜ç³»ç»ŸæŒ‚äº†æˆ–å‡ºé”™äº†, ä¸‹å•ç³»ç»Ÿè¿˜éœ€è¦åšé‡è¯•å¤„ç†, å¼‚å¸¸å¤„ç†, æ­¤æ—¶å¯å°†å‡åº“å­˜è¯·æ±‚æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­, åº“å­˜ç³»ç»Ÿè¯»å–æ¶ˆæ¯è¿›è¡Œå¤„ç†, è‹¥å‡ºé”™åˆ™æ”¾å›æ¶ˆæ¯é˜Ÿåˆ—é‡è¯•. è¿™æ ·å³ä½¿ä»£ç  bug å¯¼è‡´ä¸€ç›´ä¸æˆåŠŸä¹Ÿå¯åœ¨å‡çº§åè‡ªåŠ¨é‡è¯•, æ— éœ€äººå·¥å¹²é¢„. å¦å¾®ä¿¡æ”¯ä»˜å›è°ƒä¹Ÿå¯å¦‚æ­¤å¤„ç†.</p>
<p>å‰Šå³°: å¦‚ç§’æ€ç¬é—´è¯·æ±‚è¿‡é«˜, å¯å°†è¯·æ±‚æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­, å¦ä¸€ç«¯ç¼“æ…¢æ¶ˆè´¹, å¯é˜²æ­¢ç³»ç»Ÿå¡ä½.</p>
<p>å¼‚æ­¥: æ¯”å¦‚ä¸‹å•åå‘é€ä¸‹å•é€šçŸ¥, æœ‰çŸ­ä¿¡é€šçŸ¥, å¾®ä¿¡å…¬ä¼—å·é€šçŸ¥ç­‰, ä¸€ä¸ªä¸€ä¸ªå‘é€ä¼šå¯¼è‡´ä¸‹å•è¿™ä¸ªè¯·æ±‚å“åº”å¾ˆæ…¢, å› æ­¤å¯ä»¥å°†å‡ ä¸ªé€šçŸ¥åšæˆä¸€ä¸ªæ¶ˆæ¯, æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—, ç”±å¦ä¸€å¤„ä»£ç å¼‚æ­¥æ‰§è¡Œ.</p>
</blockquote>
<h3 id="ä½ ä½¿ç”¨çº¿ç¨‹æ± åšäº†ä»€ä¹ˆ"><a href="#ä½ ä½¿ç”¨çº¿ç¨‹æ± åšäº†ä»€ä¹ˆ" class="headerlink" title="ä½ ä½¿ç”¨çº¿ç¨‹æ± åšäº†ä»€ä¹ˆ?"></a>ä½ ä½¿ç”¨çº¿ç¨‹æ± åšäº†ä»€ä¹ˆ?</h3><blockquote>
<p>å°†çº¿ç¨‹æ± å°è£…åˆ°ä¸€ä¸ªå·¥å…·ç±»ä¸­, å·¥å…·ç±»å†åšæˆå•ä¾‹æ¨¡å¼. è¿™æ ·ä½¿ç”¨åˆ°å¤šçº¿ç¨‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªå…¬å…±çº¿ç¨‹æ± , å‡å°‘çº¿ç¨‹å¯¹è±¡åˆ›å»ºé”€æ¯. æé«˜çº¿ç¨‹çš„åˆ©ç”¨ç‡.</p>
<p>ä¸€äº›åœ°æ–¹å¼‚æ­¥æ“ä½œ, æ‹¦æˆªå™¨æ·»åŠ è¯·æ±‚æ—¥å¿—æ—¶å¼‚æ­¥æ·»åŠ .</p>
</blockquote>
<h3 id="ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼"><a href="#ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼" class="headerlink" title="ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼?"></a>ä½ åœ¨ä»£ç ä¸­ä½¿ç”¨äº†å“ªäº›è®¾è®¡æ¨¡å¼?</h3><blockquote>
<p>å•ä¾‹æ¨¡å¼, é™æ€å·¥å‚æ¨¡å¼, æ¨¡æ¿æ–¹æ³•, è§‚å¯Ÿè€…, è£…é¥°è€…, ç­–ç•¥æ¨¡å¼, çŠ¶æ€æ¨¡å¼, èŒè´£é“¾æ¨¡å¼.</p>
<p>è§‚å¯Ÿè€…: ç›‘å¬å•†å“ä¿¡æ¯æ›´æ–°, æ ¹æ®ä½£é‡‘å˜åŒ–å¹…åº¦å†³å®šæ˜¯å¦åˆ é™¤, æ ¹æ®ä½£é‡‘å˜åŒ–å’Œä»·æ ¼å˜åŒ–å¹…åº¦å†³å®šæ˜¯å¦é€šçŸ¥ç”¨æˆ·æ”¶è—å•†å“å˜åŒ–.</p>
<p>ç­–ç•¥æ¨¡å¼: è®¢å•ä¸åŒç±»å‹, å¯¹åº”çš„å•†å“æºä¸åŒ, æŸ¥è¯¢æ•°æ®æ–¹å¼ä¸åŒ, å› æ­¤ä½¿ç”¨ç­–ç•¥æ¨¡å¼, ä¾¿äºæ–°å¢ç±»å‹çš„æ‰©å±•.</p>
<p>çŠ¶æ€æ¨¡å¼: çº¢åŒ…çŠ¶æ€çš„å˜åŒ–, å¯ä»¥åšæˆçŠ¶æ€æ¨¡å¼, ä½¿å¾—çº¢åŒ…æ–°å¢çŠ¶æ€æ—¶æ‰©å±•æ›´ç®€å•.</p>
</blockquote>
<h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><h3 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">é‡å¤ä»£ç é‡æ„, æŠ½è±¡å‡ºå·¥å…·ç±», è¿”å›å€¼&#x2F;è‡ªå®šä¹‰å¼‚å¸¸ æ•´ç†é‡æ„, ç»Ÿä¸€è¯·æ±‚é£æ ¼</span><br><span class="line">ä½¿ç”¨çŠ¶æ€æ¨¡å¼&#x2F;ç­–ç•¥æ¨¡å¼ä¼˜åŒ– if&#x2F;else</span><br><span class="line">ä½¿ç”¨å·¥å‚æ¨¡å¼ç»Ÿä¸€ç®¡ç†éœ€è¦çš„å®ä¾‹å¯¹è±¡, å¦‚å·¥å…·ç±», é‚®ä»¶æœåŠ¡ç­‰</span><br><span class="line">å°è£…é€šç”¨ CRUD æ¥å£åŠå®ç°, å‡å°‘ Dao å±‚ä»£ç </span><br><span class="line"></span><br><span class="line">æ¨¡å—çš„æ‹†åˆ†, æ•°æ®åº“åˆ†åº“åˆ†è¡¨, å¾®æœåŠ¡æ‹†åˆ†</span><br></pre></td></tr></table></figure>

<h3 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h3><h4 id="MySQL-é›†ç¾¤"><a href="#MySQL-é›†ç¾¤" class="headerlink" title="MySQL é›†ç¾¤"></a>MySQL é›†ç¾¤</h4><blockquote>
<p>MySQL é»˜è®¤æ”¯æŒä¸»ä»æ¶æ„é›†ç¾¤, å¯é…åˆ mycat å®ç°è¯»å†™åˆ†ç¦».</p>
</blockquote>
<h4 id="Redis-é›†ç¾¤"><a href="#Redis-é›†ç¾¤" class="headerlink" title="Redis é›†ç¾¤"></a>Redis é›†ç¾¤</h4><blockquote>
<p>Redis Cluster, Codis</p>
</blockquote>
<h4 id="Tomcat-é›†ç¾¤"><a href="#Tomcat-é›†ç¾¤" class="headerlink" title="Tomcat é›†ç¾¤"></a>Tomcat é›†ç¾¤</h4><blockquote>
<p>tomcat é›†ç¾¤ä¸€èˆ¬éœ€è¦è€ƒè™‘ session å…±äº«, å¯é€šè¿‡ redis å®ç° session å…±äº«.</p>
</blockquote>
<h3 id="åˆ†å¸ƒå¼"><a href="#åˆ†å¸ƒå¼" class="headerlink" title="åˆ†å¸ƒå¼"></a>åˆ†å¸ƒå¼</h3><h4 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h4><blockquote>
<p>Spring Cloud æ˜¯ä¸€å¥—åˆ†å¸ƒå¼å¼€å‘çš„è§£å†³æ–¹æ¡ˆ, é›†åˆäº†åˆ†å¸ƒå¼è°ƒç”¨, é“¾è·¯è¿½è¸ª, é™çº§å¤„ç†, æœåŠ¡æ³¨å†Œå‘ç°.</p>
</blockquote>
<h4 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h4><blockquote>
<p>Dubbo æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ RPC è°ƒç”¨æ¡†æ¶, åº•å±‚ä½¿ç”¨ netty æ¡†æ¶.</p>
</blockquote>
<h3 id="è¿ç»´"><a href="#è¿ç»´" class="headerlink" title="è¿ç»´"></a>è¿ç»´</h3><h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><blockquote>
<p>docker æ˜¯ä¸€ä¸ªå®¹å™¨, æä¾›äº†æ ‡å‡†åŒ–çš„æ¥å£, å¯ç”¨äºå¿«é€Ÿæ„å»ºéƒ¨ç½²ç¯å¢ƒ, ç®€åŒ–éƒ¨ç½²æµç¨‹</p>
</blockquote>
<h4 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h4><blockquote>
<p>docker-compose ä½¿ç”¨ yml æ–‡ä»¶æè¿°å®¹å™¨é—´çš„å…³ç³»ä»¥åŠå®¹å™¨çš„é…ç½®, å¯ç”¨äºå¿«é€Ÿæ„å»ºå¤æ‚çš„è¿è¡Œç¯å¢ƒ.</p>
</blockquote>
<h4 id="K8s"><a href="#K8s" class="headerlink" title="K8s"></a>K8s</h4><blockquote>
<p>K8s æ˜¯ä¸€ä¸ªæ ¹æ®å®¹å™¨å¿«é€Ÿæ­å»ºå’Œç®¡ç†é›†ç¾¤çš„å·¥å…·.</p>
</blockquote>
<h2 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h2><h3 id="JVM-å†…å­˜æ¨¡å‹"><a href="#JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="JVM å†…å­˜æ¨¡å‹"></a>JVM å†…å­˜æ¨¡å‹</h3><blockquote>
<p>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜åŒºåŸŸ, å¤šçº¿ç¨‹ä¹‹é—´é€šä¿¡ä¸»è¦é€šè¿‡å…±äº«å†…å­˜æ¥å®ç°.</p>
</blockquote>
<ul>
<li>æœ‰åºæ€§: åœ¨ CPU æ‰§è¡ŒæŒ‡ä»¤æ—¶, å¯èƒ½ä¼šå¯¹é happens-before æŒ‡ä»¤è¿›è¡Œé‡æ’, ä¼˜åŒ–æ‰§è¡Œæ•ˆç‡. åœ¨å•çº¿ç¨‹æƒ…å†µ, å¾€å¾€ä¸ä¼šäº§ç”Ÿé—®é¢˜, ä½†æ¶‰åŠå¤šçº¿ç¨‹æ—¶, å¯èƒ½å¯¼è‡´ bug.</li>
<li>å¯è§æ€§: ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå…±äº«å˜é‡, å¦ä¸€ä¸ªçº¿ç¨‹ä¸ä¼šçŸ¥é“è¿™ä¸ªæ”¹å˜, è¿™å°±æ˜¯ä¸å¯è§, è¦ç¡®ä¿å¯è§æ€§, ä¸€èˆ¬ä½¿ç”¨ volatile å…³é”®è¯, å½“ç„¶, åŠ é”ä¹Ÿå¯ä»¥.</li>
<li>åŸå­æ€§: å³å¯¹äºæŸä»£ç , å®é™…æ‰§è¡Œæ—¶ä¼šåˆ†ä¸ºå¥½å‡ ä¸ªåŸå­æŒ‡ä»¤, ç¡®ä¿åŸå­æ€§å¿…é¡»åŠ é” (å¦‚synchronized) å¤„ç†</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">happens-before:</span><br><span class="line">è¯»åå†™</span><br><span class="line">å†™åå†™</span><br><span class="line">é”åè§£é”</span><br><span class="line">å¯ä¼ é€’æ€§</span><br></pre></td></tr></table></figure>

<h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><blockquote>
<p>çº¿ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„, ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹.</p>
<p>è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºçš„æŠ½è±¡, ä¸€ä¸ªç¨‹åºè¿è¡Œåä¸€èˆ¬ä¸ºä¸€ä¸ªè¿›ç¨‹.</p>
</blockquote>
<p>çº¿ç¨‹çŠ¶æ€:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.New (æ–°å»º)</span><br><span class="line">2.Runnable (å°±ç»ª)</span><br><span class="line">3.Running (è¿è¡Œä¸­)</span><br><span class="line">4.Blocked (é˜»å¡)</span><br><span class="line">5.WAITING (ç­‰å¾…)</span><br><span class="line">6.TIMED_WAITING (è¶…æ—¶ç­‰å¾…)</span><br><span class="line">7.Dead (æ­»äº¡)</span><br><span class="line"></span><br><span class="line">[t:threadå¯¹è±¡, obj: åŒæ­¥å—ä¸­çš„å¯¹è±¡]</span><br><span class="line">New: new Thread()</span><br><span class="line">Runnable: t.start(), t.yield()</span><br><span class="line">Running: after t.start() and cpu run it</span><br><span class="line">Blocked: when enter synchronized block</span><br><span class="line">WAITING: obj.wait(), t.join(), LockSupport.park()</span><br><span class="line">TIMED_WAITING: Thread.sleep(x), obj.wait(x), t.join(x)</span><br><span class="line">Dead: when t.run() is over</span><br></pre></td></tr></table></figure>



<h3 id="JVM-å¯¹è±¡ç»“æ„"><a href="#JVM-å¯¹è±¡ç»“æ„" class="headerlink" title="JVM å¯¹è±¡ç»“æ„"></a>JVM å¯¹è±¡ç»“æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å¯¹è±¡å¤´:</span><br><span class="line">	Mark Word(hash, é”çŠ¶æ€, åˆ†ä»£å¹´é¾„)</span><br><span class="line">	ç±»å‹æŒ‡é’ˆ</span><br><span class="line">	[æ•°ç»„é•¿åº¦]</span><br><span class="line">å®ä¾‹æ•°æ®</span><br><span class="line">å¯¹é½</span><br></pre></td></tr></table></figure>



<h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">æ ‡è®°ç®—æ³•:</span><br><span class="line">	1.å¼•ç”¨è®¡æ•°æ³•</span><br><span class="line">	2.å¯è¾¾æ€§åˆ†æç®—æ³•(æ ¹æœç´¢)(æ ¹å¯¹è±¡: æ ˆä¸­çš„å¯¹è±¡, é™æ€å±æ€§å¼•ç”¨å¯¹è±¡, å¸¸é‡å¼•ç”¨å¯¹è±¡)</span><br><span class="line">å›æ”¶ç®—æ³•:</span><br><span class="line">	1.æ ‡è®°-æ¸…é™¤ç®—æ³•</span><br><span class="line">	2.æ ‡è®°-æ•´ç†ç®—æ³•</span><br><span class="line">	3.æ ‡è®°-å¤åˆ¶ç®—æ³•</span><br><span class="line">	4.åˆ†ä»£ç®—æ³•( Eden åŒº(å¤åˆ¶ç®—æ³•)--&gt; Survivor åŒº(ç¼“å­˜, å¤åˆ¶ç®—æ³•) --&gt; Old åŒº(æ ‡è®°-æ•´ç†)</span><br><span class="line"></span><br><span class="line">å›æ”¶å™¨: (å‰ 3 ä¸ª Young GC ä½¿ç”¨, åé¢çš„ Full GC ä½¿ç”¨)</span><br><span class="line">	1.Serial (ä¸²è¡Œ, å¤åˆ¶ç®—æ³•)</span><br><span class="line">	2.ParNew (å¤šçº¿ç¨‹, å¤åˆ¶ç®—æ³•)</span><br><span class="line">	3.Parallel Scavenge (å¤šçº¿ç¨‹, æ”¹è¿›ç‰ˆ, å¯æ§åˆ¶ååé‡)</span><br><span class="line">	4.Serial Old(å•çº¿ç¨‹, æ ‡è®°-æ•´ç†)</span><br><span class="line">	5.Parallel Old (å¤šçº¿ç¨‹, æ§åˆ¶ååé‡, æ ‡è®°-æ•´ç†ç®—æ³•)</span><br><span class="line">	6.CMS (å¤šçº¿ç¨‹, ä½åœé¡¿, æ ‡è®°-æ¸…é™¤ç®—æ³•) : åˆå§‹(STW)-å¹¶å‘-é‡æ–°(STW)-æ¸…é™¤</span><br><span class="line">	7.G1 (å¤šçº¿ç¨‹, CMS å‡çº§ç‰ˆ, æ ‡è®°-æ•´ç†ç®—æ³•): åˆå§‹(STW)-å¹¶å‘-æœ€ç»ˆ(STW)-ç­›é€‰æ¸…é™¤(å¯æ§åˆ¶åœé¡¿æ—¶é—´)</span><br></pre></td></tr></table></figure>



<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h3><h4 id="ç´¢å¼•åŸç†"><a href="#ç´¢å¼•åŸç†" class="headerlink" title="ç´¢å¼•åŸç†"></a>ç´¢å¼•åŸç†</h4><blockquote>
<p>MySQL ç´¢å¼•ä¸€èˆ¬é€‰æ‹© B+æ ‘åšä¸ºæ•°æ®ç»“æ„å­˜å‚¨. B+ æ ‘çš„ä¼˜ç‚¹æ˜¯, å¯¹æ–‡ä»¶IOçš„è®¿é—®æ¬¡æ•°æ§åˆ¶åœ¨ 3 æ¬¡, ä¿è¯é€Ÿåº¦çš„åŒæ—¶, èƒ½å­˜å‚¨åƒä¸‡è¡Œæ•°æ®.</p>
</blockquote>
<h4 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å¯¹å¸¸ç”¨åˆ—æ·»åŠ ç´¢å¼•, è§†å…·ä½“æƒ…å†µé€‰æ‹©å•ä¸€ç´¢å¼•æˆ–å¤åˆç´¢å¼•(ä¸€èˆ¬ä¸ºå¤åˆ)</span><br><span class="line">2.é€šè¿‡ Explain è¯­å¥åˆ†ææ‰§è¡Œè®¡åˆ’, å°† type æå‡åˆ°è‡³å°‘ index çº§åˆ«.</span><br><span class="line">3.é€šè¿‡ Explain è¯­å¥åˆ†ææ‰§è¡Œè®¡åˆ’, å°† extra ä¸­ Using filesortæ¶ˆé™¤(æ’åºåˆ—åŠ ç´¢å¼•), Using join bufferæ¶ˆé™¤ (é€šè¿‡ç»™å…³è”è¡¨çš„å…³è”åˆ—åŠ ç´¢å¼•), Using temporary (ä¸€èˆ¬é€šè¿‡åˆ†ç»„åˆ—åŠ ç´¢å¼•), Using where(æ ¹æ®æœ€å·¦åŸåˆ™å¯¹æ¡ä»¶åˆ—åŠ å¤åˆç´¢å¼•)</span><br></pre></td></tr></table></figure>



<h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ACID:</span><br><span class="line">A: åŸå­æ€§, å¤šä¸ªæ“ä½œè¦ä¹ˆéƒ½åš, è¦ä¹ˆéƒ½ä¸åš</span><br><span class="line">C: ä¸€è‡´æ€§, æ•°æ®åº“æ–‡ä»¶çš„çŠ¶æ€å¿…é¡»ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€.</span><br><span class="line">I: éš”ç¦»æ€§, äº‹ç‰©ä¹‹é—´ç›¸äº’éš”ç¦», äº’ä¸å½±å“.</span><br><span class="line">D: æŒç»­æ€§, ä¸€ä¸ªäº‹åŠ¡ä¸€ä½†æäº¤, åˆ™å¯¹æ•°æ®åº“çš„æ”¹å˜æ˜¯æ°¸ä¹…çš„.</span><br></pre></td></tr></table></figure>



<h3 id="æ•°æ®åº“éš”ç¦»çº§åˆ«"><a href="#æ•°æ®åº“éš”ç¦»çº§åˆ«" class="headerlink" title="æ•°æ®åº“éš”ç¦»çº§åˆ«"></a>æ•°æ®åº“éš”ç¦»çº§åˆ«</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.è¯»æœªæäº¤: å¯è¯»å–å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ(å¦‚æ›´æ–°äº†æŸä¸ªå­—æ®µ), å¯èƒ½ä¼šé€ æˆè¯»å–é”™è¯¯çš„æ•°æ®(æœªæäº¤çš„äº‹åŠ¡å›æ»šäº†), é€ æˆè„è¯».</span><br><span class="line">2.è¯»å·²æäº¤: å¯è¯»å–å…¶ä»–å·²æäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ, 2æ¬¡è¯»å–æ•°æ®è¿˜æ˜¯å¯èƒ½ä¸ä¸€è‡´(å…¶ä»–äº‹åŠ¡åˆæäº¤äº†), é€ æˆä¸å¯é‡å¤è¯».</span><br><span class="line">3.å¯é‡å¤è¯»: ç¡®ä¿åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–æ•°æ®æ—¶, ä¼šçœ‹åˆ°ç›¸åŒçš„æ•°æ®. ä½†å¯èƒ½é€ æˆå¹»è¯», å¦‚æ‰¹é‡ä¿®æ”¹ç™»å½•å¯†ç å, å¦ä¸€ä¸ªäº‹åŠ¡æ–°å¢äº†ä¸€æ¡è®°å½•, å¯¼è‡´æ–°çºªå½•æœªä¿®æ”¹.</span><br><span class="line">4.ä¸²è¡ŒåŒ–: äº‹åŠ¡ä¸²è¡ŒåŒ–æ‰§è¡Œ, æ•ˆç‡ä½.</span><br></pre></td></tr></table></figure>

<h4 id="MySQL-é»˜è®¤éš”ç¦»çº§åˆ«"><a href="#MySQL-é»˜è®¤éš”ç¦»çº§åˆ«" class="headerlink" title="MySQL é»˜è®¤éš”ç¦»çº§åˆ«"></a>MySQL é»˜è®¤éš”ç¦»çº§åˆ«</h4><p><code>å¯é‡è¯»è¯»</code></p>
<h3 id="æ•°æ®åº“é”"><a href="#æ•°æ®åº“é”" class="headerlink" title="æ•°æ®åº“é”"></a>æ•°æ®åº“é”</h3><h4 id="é”åŸç†"><a href="#é”åŸç†" class="headerlink" title="é”åŸç†"></a>é”åŸç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¡Œé”: åˆ†ä¸ºæ’å®ƒé”(X) å’Œå…±äº«é”(S). å³å†™é”å’Œè¯»é”.</span><br><span class="line">è¡¨é”: åˆ†ä¸ºå…ƒæ•°æ®é”(MDL)å’Œè¡¨é”.</span><br></pre></td></tr></table></figure>

<h4 id="é”è§¦å‘æ–¹å¼"><a href="#é”è§¦å‘æ–¹å¼" class="headerlink" title="é”è§¦å‘æ–¹å¼"></a>é”è§¦å‘æ–¹å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¡Œé”: éšå¼(æ¡ä»¶å¸¦æœ‰ç´¢å¼•åˆ™é”å¯¹åº”åˆ—, ä¸å¸¦ç´¢å¼•åˆ™é”å…¨éƒ¨è¡Œ, RR æ€»ä¼šå¸¦æœ‰ GAP é”, RC ä¸ä¼š), æ˜¾å¼(ä½¿ç”¨ for update, lock in share mode)</span><br><span class="line">è¡¨é”: éšå¼(å¯¹æ•´ä¸ªè¡¨ä¸å¸¦æ¡ä»¶è¿›è¡Œå¢åˆ æ”¹, æˆ–ä»»ä½• DDL æ“ä½œ) æ˜¾ç¤º(ä½¿ç”¨ for update, lock in share mode)</span><br></pre></td></tr></table></figure>



<h2 id="æºç å’Œæ¡†æ¶"><a href="#æºç å’Œæ¡†æ¶" class="headerlink" title="æºç å’Œæ¡†æ¶"></a>æºç å’Œæ¡†æ¶</h2><h3 id="ReentrantLock"><a href="#ReentrantLock" class="headerlink" title="ReentrantLock"></a><code>ReentrantLock</code></h3><h4 id="åŠ é”æµç¨‹-lock"><a href="#åŠ é”æµç¨‹-lock" class="headerlink" title="åŠ é”æµç¨‹ lock()"></a>åŠ é”æµç¨‹ <code>lock()</code></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) acquire(): å°è¯•è·å–ä¸€ä¸ªè®¸å¯è¯, è·å–æˆåŠŸåˆ™ç›´æ¥è¿”å›(lockç»“æŸ), è·å–å¤±è´¥åˆ™éœ€è¦æ’é˜Ÿ</span><br><span class="line"><span class="number">2</span>) tryAcquire(): åˆ¤æ–­å½“å‰è®¸å¯è¯æ•°é‡(state), è‹¥ä¸º<span class="number">0</span>åˆ™å°è¯•è·å–</span><br><span class="line">     åˆ†å…¬å¹³å’Œéå…¬å¹³, å…¬å¹³é”ä¼šåˆ¤æ–­ hasQueuedPredecessors, éå…¬å¹³åˆ™ç›´æ¥æŠ¢ compareAndSetState</span><br><span class="line">     è‹¥ä¸ä¸º<span class="number">0</span>, åˆ™åˆ¤æ–­æŒæœ‰é”çš„äººæ˜¯å¦ä¸ºæˆ‘æœ¬èº«, æ˜¯åˆ™å¢åŠ å½“å‰è®¸å¯è¯æ•°é‡, è¿”å›<span class="keyword">true</span>è·å–æˆåŠŸ</span><br><span class="line">     ä¸æ˜¯åˆ™ è¿”å› <span class="keyword">false</span>, è·å–å¤±è´¥(å°†æ’é˜Ÿ).</span><br><span class="line"><span class="number">3</span>) addWaiter(): AQS é˜Ÿåˆ—å°¾éƒ¨æ·»åŠ ä¸€ä¸ª Node(waiter=X[ç‹¬å é”]), è‹¥ tail ä¸å­˜åœ¨, åˆ™å…ˆåˆå§‹åŒ–ä¸€ä¸ª ç©ºhead[ç©ºæŒ‡ä¸ä»£è¡¨ä»»ä½•çº¿ç¨‹] åå†åŠ å…¥é˜Ÿåˆ—</span><br><span class="line"><span class="number">4</span>) acquireQueued: è¿›å…¥é˜Ÿåˆ—çš„èŠ‚ç‚¹, å°è¯•è·å–è®¸å¯è¯, å¤±è´¥åˆ™ park()</span><br><span class="line">     å…ˆåˆ¤æ–­nodeçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸º head èŠ‚ç‚¹, è‹¥æ˜¯, åˆ™è¦å°è¯•è·å–ä¸€æ¬¡è®¸å¯è¯(å› ä¸ºè¿™è¯´æ˜ä¸Šä¸€ä¸ªçº¿ç¨‹å·²ç»åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº†, ä¹Ÿè®¸å·²ç»èµ°å®Œäº†unlock() æ–¹æ³•(å³å·²ç»è¿è¡Œè¿‡å”¤é†’é˜Ÿåˆ—ä¸‹ä¸€ä½çš„ä»£ç äº†,è€Œå› ä¸ºä½ é‚£æ—¶è¿˜ä¸åœ¨é˜Ÿåˆ—ä¸­æˆ–æ²¡è¿›å…¥ç¡çœ ä¸­, å”¤é†’ä»£ç æ˜¯æ— æ„ä¹‰çš„), è€Œä½ åˆ™åˆšåŠ å…¥é˜Ÿåˆ—, å¦‚æœä½ æ­¤æ—¶ç›´æ¥park()å»ç­‰å¾…å”¤é†’, åˆ™æ ¹æœ¬æ— äººå”¤é†’ä½ , åŒç†ä½ çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå°±ç­‰ä¸åˆ°ä½ å»å”¤é†’å®ƒ.)</span><br><span class="line">     å¦‚æœä¸æ˜¯, è®¾ç½®äº†ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„ waitStatus ä¸º SINGLE å, è‡ªå·±ç¡çœ  park(), ç­‰å¾…å”¤é†’</span><br><span class="line"></span><br><span class="line">å”¤é†’å:  </span><br><span class="line"><span class="number">5</span>) åˆ¤æ–­ä¸Šä¸€ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ head, ä¸€èˆ¬æ¥è¯´æ˜¯(å› ä¸ºunkockå”¤é†’çš„ä¸€èˆ¬å°±æ˜¯head.next)</span><br><span class="line">     å¦‚æœä¸æ˜¯åˆ™è¿›å…¥ shouldParkAfterFailedAcquire: å°†é˜Ÿåˆ—ä¸­ä¸€äº›å·²å–æ¶ˆçš„èŠ‚ç‚¹ä»é˜Ÿåˆ—ä¸­åˆ é™¤, é‡æ–°è®¾ç½®èŠ‚ç‚¹çš„prev</span><br><span class="line">     å› ä¸ºæ˜¯<span class="keyword">for</span>å¾ªç¯, æ‰€ä»¥åˆä¼šå†å›æ¥åˆ¤æ–­, è¿™æ—¶åº”è¯¥æ˜¯headäº†, å°è¯•è·å–è®¸å¯è¯, <span class="number">2</span>ç§å¯èƒ½, éå…¬å¹³æ—¶è¢«åˆšlockçš„äººæŠ¢äº†(æ¦‚ç‡è¾ƒå°å§), å¦ä¸€ç§å°±æ˜¯è·å–æˆåŠŸ</span><br><span class="line">     è·å–æˆåŠŸå, æŠŠåŸheadèŠ‚ç‚¹åˆ æ‰, è‡ªå·±è®¾ä¸ºheadèŠ‚ç‚¹(headè±¡å¾ä¸€ä¸ªæ‹¿åˆ°è®¸å¯è¯çš„èŠ‚ç‚¹,é™¤é˜Ÿåˆ—ç¬¬ä¸€æ¬¡åˆå§‹åŒ–), ç„¶åè¿”å›åˆ°acquire(), ä¸­é€”æ²¡æœ‰çº¿ç¨‹è¢«æ‰“æ–­å°±æ­£å¸¸å‡ºæ–¹æ³•, lockç»“æŸ</span><br><span class="line"></span><br><span class="line">æ€»ç»“:</span><br><span class="line">å¾—åˆ°æ–¹å¼<span class="number">1</span>: acquire æ—¶ state = <span class="number">0</span>, ä¸”æŠ¢åˆ°äº†.</span><br><span class="line">å¾—åˆ°æ–¹å¼<span class="number">2</span>: æ²¡æŠ¢åˆ°æˆ–ä¸è®©æŠ¢(å…¬å¹³é”), è¿›å…¥é˜Ÿåˆ—ç­‰ä¸Šä¸€ä¸ªæ¥å”¤é†’æˆ‘, ä¸Šä¸€ä¸ªç­‰ä¸Šä¸Šä¸ªæ¥å”¤é†’ä»–, ä¸Šä¸Šä¸ªç­‰ä¸Šä¸Šä¸Šä¸ªå”¤é†’....</span><br><span class="line">    unlock å”¤é†’é˜Ÿåˆ—ç¬¬äºŒä¸ªéå–æ¶ˆçš„çº¿ç¨‹å¹¶åˆ é™¤é˜Ÿåˆ—ç¬¬ä¸€ä¸ªå…ƒç´  [å…¶ä»–å…ƒç´ ç§»ä½]</span><br><span class="line">    è¿™æ ·ç¬¬äºŒä¸ªçº¿ç¨‹å°±å¯ä»¥å”¤é†’éå–æ¶ˆçš„ç¬¬ä¸‰ä¸ªçº¿ç¨‹[ç›¸å¯¹è€Œè¨€çš„ç¬¬ä¸‰ä¸ª,å®é™…ä¸Šå”¤é†’æ—¶è¿˜æ˜¯ç¬¬äºŒä¸ª, åªæ˜¯å”¤é†’åä¼šåˆ é™¤ç¬¬ä¸€ä¸ª, æ‰€ä»¥ç¬¬ä¸‰å˜ç¬¬äºŒ]</span><br></pre></td></tr></table></figure>

<h4 id="è§£é”æµç¨‹-unlock"><a href="#è§£é”æµç¨‹-unlock" class="headerlink" title="è§£é”æµç¨‹ unlock()"></a>è§£é”æµç¨‹ <code>unlock()</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1) release(): é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯, å¹¶æ ¹æ®å½“å‰è®¸å¯è¯æ•°é‡æ˜¯å¦ä¸º0 åˆ¤æ–­æ˜¯å¦å¯ä»¥å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span><br><span class="line">2) tryRelease(): é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯, åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ­£ç¡®(æ˜¯ä¸æ˜¯å½“å‰ç‹¬å é”), è®¸å¯è¯å‡ä¸€</span><br><span class="line">	å½“å‰è®¸å¯è¯æ•°é‡æ˜¯å¦ä¸º 0 è¿”å›æ˜¯å¦å¯ä»¥å”¤é†’é˜Ÿåˆ—çš„ bool æ ‡è¯†.</span><br><span class="line">3) unparkSuccessor(): å”¤é†’é˜Ÿåˆ—ä¸­é™¤headå¤–ç¬¬ä¸€ä¸ªå¤„äºé˜»å¡(éå–æ¶ˆ)çš„èŠ‚ç‚¹(æŸ¥æ‰¾æ–¹å¼, å…ˆçœ‹next, nextçŠ¶æ€ä¸å¯¹åˆ™ä»åå¾€å‰æ‰¾æœ€å‰çš„éå–æ¶ˆçš„èŠ‚ç‚¹, å› ä¸ºnextå¦‚æœä¸ºnull, æ— æ³•æ‰¾nullçš„next).</span><br><span class="line">4) å”¤é†’å, ä¼šå°†headè®¾ç½®ä¸ºå”¤é†’çš„èŠ‚ç‚¹, ä»¥æ­¤è¾¾åˆ°ä¸‹æ¬¡å”¤é†’ä¸‹ä¸€ä¸ªçš„ç›®çš„.</span><br><span class="line"></span><br><span class="line">æ€»ç»“:</span><br><span class="line">å”¤é†’çš„é€»è¾‘å°±æ˜¯å°†æ’é˜Ÿçš„æ‰€æœ‰èŠ‚ç‚¹æŒ¨ä¸ªå”¤é†’, è€ŒèŠ‚ç‚¹è¢«å”¤é†’ååˆä¼šå‡ºé˜Ÿåˆ—; æ‰€ä»¥ä»£ç å°†å‡ºé˜Ÿåˆ—å’Œå”¤é†’é€»è¾‘ä¸€èµ·åš, å…ˆå”¤é†’ä¸‹ä¸€ä¸ª, ä¸‹ä¸€ä¸ªè´Ÿè´£æŠŠå‰ä¸€ä¸ªç§»å‡ºé˜Ÿåˆ—. ç„¶åå”¤é†’è‡ªå·±çš„ä¸‹ä¸€ä¸ª, ä»¥æ­¤ç±»æ¨, å°±å®ç°äº†å”¤é†’å’Œå‡ºé˜Ÿåˆ—çš„æ“ä½œ.</span><br></pre></td></tr></table></figure>

<h3 id="ReentrantReadWriteLock"><a href="#ReentrantReadWriteLock" class="headerlink" title="ReentrantReadWriteLock"></a><code>ReentrantReadWriteLock</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">è¯»é”</span><br><span class="line">	è·å–é” tryAcquireShared(), è‹¥å½“å‰æ²¡æœ‰å†™é”å­˜åœ¨, åˆ™ state + <span class="number">1</span>ä¸ªè¯»å•ä½, ç„¶åè¿”å›è·å–æˆåŠŸ. é˜²æ­¢è¿”å›è·å–å¤±è´¥, è¿›å…¥é˜Ÿåˆ—ä¼‘çœ .</span><br><span class="line">	é‡Šæ”¾é” tryReleaseShared(), state - <span class="number">1</span>ä¸ªè¯»å•ä½, ç„¶åæ ¹æ® state = <span class="number">0</span> åˆ¤æ–­è¿”å›æ˜¯å¦å¯ä»¥å”¤é†’é˜Ÿåˆ—.</span><br><span class="line">	</span><br><span class="line">å†™é”</span><br><span class="line">	è·å–é” tryAcquire(), è‹¥å­˜åœ¨è¯»é”, åˆ™å¤±è´¥, è‹¥å­˜åœ¨å†™é”, åˆ¤æ–­æ˜¯å¦é‡å…¥è·å–, æ˜¯åˆ™è¿”å›è·å–æˆåŠŸ. å¦åˆ™å¤±è´¥; å¤±è´¥å°±æ„å‘³ç€åŠ é˜Ÿåˆ—,ä¼‘çœ .</span><br><span class="line">    é‡Šæ”¾é” tryRelease(), state - <span class="number">1</span>, åˆ¤æ–­ state ä¸­å†™é”æ•°é‡æ˜¯å¦ä¸º<span class="number">0</span>, æ˜¯åˆ™å¯ä»¥å”¤é†’é˜Ÿåˆ—. å¦åˆ™ä»£è¡¨è¿™æ—¶ä¸€ä¸ªå¯é‡å…¥é”çš„é‡Šæ”¾é€»è¾‘.</span><br><span class="line">   </span><br><span class="line">æ€»ç»“: è¯»å†™é”ä¹Ÿå¥½, å¯é‡å…¥é”ä¹Ÿå¥½, CountDownLatch ç­‰å·¥å…·ç±»ä¹Ÿå¥½, éƒ½æ˜¯å¯¹ state æ“ä½œä¸ºå¤š, æˆ–è€…è¯´, å®ç°äº† AQSçš„å®ƒä»¬, åªè´Ÿè´£æ“ä½œ state, è€Œé˜Ÿåˆ—, å”¤é†’, éƒ½äº¤ç»™ AQS æ¥å¤„ç†.</span><br></pre></td></tr></table></figure>



<h3 id="CountDownLatch"><a href="#CountDownLatch" class="headerlink" title="CountDownLatch"></a><code>CountDownLatch</code></h3><h4 id="countDown"><a href="#countDown" class="headerlink" title="countDown()"></a><code>countDown()</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1) state æ•°é‡å‡ä¸€, ç„¶ååˆ¤æ–­ state æ•°é‡æ˜¯å¦ä¸º0, è‹¥æ˜¯åˆ™å”¤é†’ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹.</span><br></pre></td></tr></table></figure>

<h4 id="await"><a href="#await" class="headerlink" title="await()"></a><code>await()</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) new ä¹‹å, state æ•°é‡å¤§äº0, æ‰€ä»¥ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—, ç„¶åçº¿ç¨‹ä¼šè¿›å…¥ä¼‘çœ .</span><br><span class="line">2) ç­‰å¾…countDowné‡Šæ”¾é”, é‡Šæ”¾åˆ°è®¸å¯è¯ä¸º0æ—¶, å”¤é†’ç­‰å¾…é˜Ÿåˆ—çš„çº¿ç¨‹.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“:</p>
<p>åˆ©ç”¨äº†åŠ å…±äº«é”è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ç‰¹æ€§å®ç° <code>await()</code></p>
<p>é‡Šæ”¾å…±äº«é”å‡å°‘è®¸å¯è¯æ•°é‡ä¸”å”¤é†’é˜Ÿåˆ—ä¸­çš„ç­‰å¾…çš„çº¿ç¨‹ å®ç° <code>countDown()</code></p>
</blockquote>
<h3 id="Semaphore"><a href="#Semaphore" class="headerlink" title="Semaphore"></a><code>Semaphore</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸ CountDownLatch ç›¸å, åˆå§‹æ•°é‡ä¸€èˆ¬ä¸º 0, acquire() æ—¶åˆ¤æ–­æ˜¯å¦æœ‰è®¸å¯è¯, æœ‰åˆ™æˆåŠŸ, æ— åˆ™é˜Ÿåˆ—ä¼‘çœ </span><br><span class="line">è€Œ release åˆ™æ˜¯æ·»åŠ ä¸€ä¸ªè®¸å¯è¯, æ·»åŠ åæ€»æ˜¯å”¤é†’é˜Ÿåˆ—.</span><br></pre></td></tr></table></figure>

<h3 id="CycleBarrier"><a href="#CycleBarrier" class="headerlink" title="CycleBarrier"></a><code>CycleBarrier</code></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å«ä¹‰: å‡‘è¶³ä¸€å®šä¸ªæ•°çº¿ç¨‹, ç„¶åæ‰¹é‡å”¤é†’.</span><br><span class="line">await(): åˆ©ç”¨ ReenrantLock çš„ lock å’Œ condition çš„ await è¿›å…¥ä¼‘çœ </span><br><span class="line">å½“å‡‘è¶³åï¼Œç”¨condition çš„ singleAll å”¤é†’æ‰€æœ‰ await çš„çº¿ç¨‹.</span><br></pre></td></tr></table></figure>





<h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a><code>HashMap</code></h3><h4 id="è¯·ç®€è¿°-HashMap-çš„åº•å±‚æ•°æ®ç»“æ„"><a href="#è¯·ç®€è¿°-HashMap-çš„åº•å±‚æ•°æ®ç»“æ„" class="headerlink" title="è¯·ç®€è¿° HashMap çš„åº•å±‚æ•°æ®ç»“æ„"></a>è¯·ç®€è¿° <code>HashMap</code> çš„åº•å±‚æ•°æ®ç»“æ„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. ä½¿ç”¨äº†æ•°ç»„åŠ é“¾è¡¨, ä»¥æ•°ç»„ä¸ºä¸», é“¾è¡¨åŠ çº¢é»‘æ ‘ä¸ºè¡¥å……çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨é”®å€¼å¯¹.</span><br><span class="line">2. å½“é”®å‘é€å†²çª(ç¢°æ’)æ—¶, æ•°æ®å°†ä¸²æˆé“¾è¡¨å­˜äºæ•°ç»„ä¸­, å½“é“¾è¡¨é•¿åº¦è¶…è¿‡æŒ‡å®šå€¼(é»˜è®¤ 8)æ—¶, é“¾è¡¨è½¬æˆçº¢é»‘æ ‘, å½“çº¢é»‘æ ‘é•¿åº¦å°äºæŒ‡å®šå€¼æ—¶(é»˜è®¤ 6), åˆ™åˆè½¬æˆé“¾è¡¨</span><br></pre></td></tr></table></figure>

<h4 id="ä¸ºä»€ä¹ˆ-HashMap-çš„åˆå§‹å®¹é‡ä»¥åŠæ‰©å®¹åçš„å®¹é‡å‡ä¸º-2-çš„æŒ‡æ•°å¹‚"><a href="#ä¸ºä»€ä¹ˆ-HashMap-çš„åˆå§‹å®¹é‡ä»¥åŠæ‰©å®¹åçš„å®¹é‡å‡ä¸º-2-çš„æŒ‡æ•°å¹‚" class="headerlink" title="ä¸ºä»€ä¹ˆ HashMap çš„åˆå§‹å®¹é‡ä»¥åŠæ‰©å®¹åçš„å®¹é‡å‡ä¸º 2 çš„æŒ‡æ•°å¹‚"></a>ä¸ºä»€ä¹ˆ <code>HashMap</code> çš„åˆå§‹å®¹é‡ä»¥åŠæ‰©å®¹åçš„å®¹é‡å‡ä¸º 2 çš„æŒ‡æ•°å¹‚</h4><blockquote>
<p>å› ä¸ºè®¡ç®—æœºåšè¿ç®—æ—¶, å–æ¨¡è¿ç®—é€Ÿåº¦è¿œè¿œæ…¢äºä½è¿ç®—, è€Œè‹¥å®¹é‡å§‹ç»ˆä¸º 2 çš„æŒ‡æ•°å¹‚, åˆ™æ ¹æ® hash è·å–æ•°ç»„ä¸‹æ ‡æ—¶åªéœ€è¦ ä½¿ç”¨ <code>(æ•°ç»„é•¿åº¦-1) &amp; hash å€¼</code> å³å¯ç¡®å®šæ•°ç»„ä¸‹æ ‡, ä¸å–æ¨¡å¾—åˆ°çš„ä¸‹æ ‡ä¸€æ ·å¯é .</p>
<p>è€Œæ‰©å®¹åå, å› ä¸ºéœ€è¦è¿›è¡Œ rehash è¿ç®—æ¥ç¡®å®š æ•°æ®çš„æ–°ä¸‹æ ‡, å¤šæ¬¡è¿›è¡Œå–æ•°ç»„ä¸‹æ ‡åˆ™æ›´èƒ½ä½“ç°ä½è¿ç®—çš„ä¼˜åŠ¿.</p>
</blockquote>
<h4 id="ä¸ºä»€ä¹ˆ-HashMap-çš„åŠ è½½å› å­æ˜¯-0-75-3-4"><a href="#ä¸ºä»€ä¹ˆ-HashMap-çš„åŠ è½½å› å­æ˜¯-0-75-3-4" class="headerlink" title="ä¸ºä»€ä¹ˆ HashMap çš„åŠ è½½å› å­æ˜¯ 0.75 (3/4)"></a>ä¸ºä»€ä¹ˆ <code>HashMap</code> çš„åŠ è½½å› å­æ˜¯ 0.75 (3/4)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä½¿ç”¨æ’é™¤æ³•:</span><br><span class="line">1.è‹¥åŠ è½½å› å­ä¸º 1. åˆ™æ¯æ¬¡ HashMap æ»¡äº†æ‰è¿›è¡Œæ‰©å®¹, å¿…å°†æœ‰æ›´é«˜çš„å‡ ç‡è§¦å‘ hash ç¢°æ’å¯¼è‡´æ•°ç»„ä¸‹æ ‡ä¸€è‡´éœ€è¦è½¬æˆé“¾è¡¨æˆ–çº¢é»‘æ ‘, å¯¼è‡´è¯»å–å’Œæ›´æ–°é€Ÿåº¦é™ä½.</span><br><span class="line">2.è‹¥åŠ è½½å› å­ä¸º 0.5. åˆ™æ¯æ¬¡ HashMap éƒ½æœ‰ä¸€åŠå®¹é‡å‰©ä½™, ç©ºé—´å¤§å¤§æµªè´¹, å¯¹å†…å­˜å¼€é”€å¤ªå¤§. å®¹æ˜“å¼•å‘ OOM äº‹æ•….</span><br><span class="line">3.0.5-1 ä¹‹é—´é‚£ä¹ˆå¤šå¯èƒ½, é€‰å“ªä¸ªéƒ½è¡Œ, ä½†ä½œä¸º HashMap çš„é»˜è®¤å€¼, é€‰ä¸­é—´çš„ 0.75, èµ°ä¸­åº¸ä¹‹è·¯, ä¹Ÿæ˜¯è§£é‡Šçš„é€šçš„.</span><br></pre></td></tr></table></figure>



<h4 id="ä¸ºä»€ä¹ˆ-HashMap-1-8-æ‰©å®¹æ— éœ€-rehash"><a href="#ä¸ºä»€ä¹ˆ-HashMap-1-8-æ‰©å®¹æ— éœ€-rehash" class="headerlink" title="ä¸ºä»€ä¹ˆ HashMap 1.8 æ‰©å®¹æ— éœ€ rehash"></a>ä¸ºä»€ä¹ˆ <code>HashMap</code> 1.8 æ‰©å®¹æ— éœ€ rehash</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. å› ä¸º1.8çš„è·å– hash å€¼çš„ç®—æ³•ä¼˜åŒ–äº†. æ— éœ€ä¸€ä¸ª hashSeed è¿›è¡Œè¾…åŠ©è¿ç®— (ä¸»å› )</span><br><span class="line">2. ç”±äº hash å€¼ä¸å˜, åŸé“¾è¡¨ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹åªæœ‰ 2 ç§å¯èƒ½:</span><br><span class="line">	ä¸€æ˜¯ hash å€¼é«˜äºåŸæ•°ç»„é•¿åº¦, åˆ™å±äºé«˜ä½, è¿™äº›é«˜ä½çš„èŠ‚ç‚¹, æ–°çš„ä¸‹æ ‡ä¸€å®šæ˜¯ (å½“å‰ä¸‹æ ‡ + æ—§æ•°ç»„é•¿åº¦). </span><br><span class="line">	å¦ä¸€ç§æ˜¯ hash å€¼ä½äºåŸæ•°ç»„é•¿åº¦, å±äºä½ä½, è¿™äº›èŠ‚ç‚¹çš„ä¸‹æ ‡æ— éœ€é‡æ–°è®¡ç®—, å¿…ç„¶ä¸å½“å‰ä¸‹æ ‡ä¸€è‡´</span><br><span class="line">	(ä¸ä¿¡è‡ªå·±é‚£å‡ ä¸ªç¤ºä¾‹æ•°æ®ç”¨ç”»å‡ºå®Œæ•´äºŒè¿›åˆ¶è®¡ç®—ä¸€ä¸‹)(ç¥å¥‡çš„ä½è¿ç®—)</span><br><span class="line">3. é‡æ–°è®¡ç®—ä¸‹æ ‡æ—¶, æ ¹æ®ç¬¬ 2 ç‚¹å¯çŸ¥, å…¶ä¸‹æ ‡å¤§å°ä¸€å®šä¸é«˜äº(å½“å‰ä¸‹æ ‡+æ—§æ•°ç»„é•¿åº¦), å³ä¸‹ä¸€æ¬¡å¾ªç¯çš„ä¸‹æ ‡å¿…ç„¶æ¯”ä¸Šä¸€æ¬¡å¾ªç¯çš„ä¸‹æ ‡è¦é«˜, æ‰€ä»¥ 1.8 æºç  resize è¿›è¡Œé«˜ä½ä½åˆ†ç»„ç„¶åè½¬ç§»æ•°æ®æ—¶, æ— éœ€æ‹…å¿ƒä¸‹ä¸€æ¬¡å¾ªç¯ä¼šå°†åˆšåˆšæ”¾åˆ°æ–°æ•°ç»„çš„å€¼è¦†ç›–(ä¸‹æ ‡ç›¸åŒåˆ™ä¼šè¦†ç›–)</span><br><span class="line">4. 1.8 çš„ resize ä¼˜åŒ–äº†ç®—æ³•, ä¿æŒäº†åŸæœ‰çš„é“¾è¡¨é¡ºåº(ä¸çŸ¥é“æœ‰å•¥ç”¨)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»å¾—æ¥è¯´, 1.8 ä¼˜åŒ–äº† hash ç®—æ³•, ä½¿ <code>hashcode</code> çš„é«˜ 16 ä½ä¸ ä½ 16 ä½è¿›è¡Œå¼‚æˆ–è¿ç®—, é™ä½äº†ç¢°æ’ç‡</p>
<p>è€Œ resize ç®—æ³•ä¹Ÿä¼˜åŒ–é“¾è¡¨èŠ‚ç‚¹çš„è¿ç§», é¿å…äº† 1.7 çš„é“¾ç¯äº§ç”Ÿ</p>
<p>æœ€å¤§çš„åŒºåˆ«å°±æ˜¯, 1.7 æ²¡æœ‰å°†äºŒè¿›åˆ¶çš„ç¥å¥‡å‘æŒ¥åˆ°æè‡´, ä¾ç„¶åƒæ™®é€š java ç¨‹åºä¸€èˆ¬é€»è¾‘. è€Œ 1.8 åˆ™å……åˆ†åˆ©ç”¨äº†äºŒè¿›åˆ¶çš„ä¼˜ç‚¹(ä¹Ÿå……åˆ†çš„è®©äººå¤´æ™•), æé«˜äº† <code>HashMap</code> çš„æ•ˆç‡.</p>
</blockquote>
<h4 id="ä¸ºä»€ä¹ˆ-HashMap-ä»é“¾è¡¨è¾¾åˆ°-8-ä¸ªæ—¶è½¬æˆçº¢é»‘æ ‘-è¾¾åˆ°-6-ä¸ªæ—¶è½¬å›é“¾è¡¨"><a href="#ä¸ºä»€ä¹ˆ-HashMap-ä»é“¾è¡¨è¾¾åˆ°-8-ä¸ªæ—¶è½¬æˆçº¢é»‘æ ‘-è¾¾åˆ°-6-ä¸ªæ—¶è½¬å›é“¾è¡¨" class="headerlink" title="ä¸ºä»€ä¹ˆ HashMap ä»é“¾è¡¨è¾¾åˆ° 8 ä¸ªæ—¶è½¬æˆçº¢é»‘æ ‘, è¾¾åˆ° 6 ä¸ªæ—¶è½¬å›é“¾è¡¨?"></a>ä¸ºä»€ä¹ˆ <code>HashMap</code> ä»é“¾è¡¨è¾¾åˆ° 8 ä¸ªæ—¶è½¬æˆçº¢é»‘æ ‘, è¾¾åˆ° 6 ä¸ªæ—¶è½¬å›é“¾è¡¨?</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.æ ¹æ® Poisson distribution å®šå¾‹, å‡‘é½8ä¸ªèŠ‚ç‚¹ç¢°æ’åˆ°åŒä¸€ä¸ªä¸‹æ ‡, ç»„æˆé•¿åº¦ä¸º 8 çš„é“¾è¡¨æ¦‚ç‡æä½, çº¦ä¸º 0.00000006, è€Œè¶…è¿‡ 8 ä¸ªçš„å‡ ç‡åˆ™æ›´ä½, å¤§çº¦ä¸ºåƒä¸‡åˆ†ä¹‹ä¸€. æ‰€ä»¥å°†é˜ˆå€¼è®¾ç½®ä¸º 8, å› ä¸ºè¿™ç§æ¦‚ç‡æä½. å› æ­¤å¯ä»¥å‡å°‘é“¾è¡¨è½¬çº¢é»‘æ ‘çš„, æé«˜å¢åˆ æ”¹æ•ˆç‡.</span><br><span class="line">2.è‹¥è¾¾åˆ° 7 ä¸ªæ—¶è½¬å›é“¾è¡¨, åˆ™å¯èƒ½ä¼šå¯¼è‡´HashMap ä¸åœçš„åœ¨é“¾è¡¨å’Œçº¢é»‘æ ‘ä¹‹é—´è½¬æ¢, æ‰€ä»¥é˜ˆå€¼è®¾ç½®ä¸º 6, å¯èµ·åˆ°ç¼“å†²æ•ˆæœ.</span><br></pre></td></tr></table></figure>



<h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><h4 id="å…³é”®ç±»è§£æ"><a href="#å…³é”®ç±»è§£æ" class="headerlink" title="å…³é”®ç±»è§£æ"></a>å…³é”®ç±»è§£æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext</span><br><span class="line">	æ˜¯ä¸€ä¸ªåªè¯»çš„ bean å®¹å™¨</span><br><span class="line">	å¯ä»¥åŠ è½½è§£æé…ç½®æ–‡ä»¶(å¦‚xml)</span><br><span class="line">	å¯ä»¥å‘å¸ƒäº‹ä»¶å’Œæ³¨å†Œç›‘å¬</span><br><span class="line">	å…·æœ‰å›½é™…åŒ–æ¶ˆæ¯å¤„ç†èƒ½åŠ›</span><br><span class="line">ConfigurableApplicationContext</span><br><span class="line">	æ˜¯ä¸€ä¸ªå…·æœ‰å¯é…ç½®èƒ½åŠ›çš„ å®¹å™¨(å¯è®¾ç½®å„ä¸ªå‚æ•°, å¦‚id, çˆ¶å®¹å™¨)</span><br><span class="line">	å…·æœ‰å®¹å™¨ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µ, å¦‚å¯åŠ¨,åœæ­¢,å…³é—­.</span><br><span class="line">AbstractApplicationContext</span><br><span class="line">	æ¨¡æ¿æ–¹æ³•æ¨¡å¼çš„æŠ½è±¡ç±», å®šä¹‰äº†å®¹å™¨çš„æ¨¡æ¿(refreshæ–¹æ³•), ä½†ç”±å…·ä½“çš„å­ç±»å®ç°éƒ¨åˆ†æ–¹æ³•</span><br><span class="line">	ç®¡ç†Beanå’ŒBeanFactoryçš„PostProcessor</span><br><span class="line">	ç®¡ç†äº‹ä»¶çš„ç›‘å¬å’Œå¤„ç†</span><br><span class="line">AbstractRefreshableApplicationContext</span><br><span class="line">	ä¸ºå¯é‡å¤åˆ·æ–°çš„å®¹å™¨æä¾›åŸºç±»</span><br><span class="line">	åŠ å…¥äº†BeanFactoryçš„ç®¡ç†(åˆ›å»º&#x2F;å…³é—­ç­‰)</span><br><span class="line">AbstractRefreshableConfigApplicationContext</span><br><span class="line">	åŠ å…¥äº†configLocationå­—æ®µ, ç”¨äºæŸäº›å®¹å™¨åˆå§‹åŒ–BeanFactoryå’ŒBean</span><br><span class="line">AbstractXmlApplicationContext</span><br><span class="line">	å®šä¹‰äº†è¯»å–xmlé…ç½®æ–‡ä»¶æ¥åŠ è½½BeanFactoryçš„ä»£ç , ä½¿å¾—å­ç±»åªéœ€æä¾›é…ç½®æ–‡ä»¶åœ°å€æˆ–Resource</span><br><span class="line">ClassPathXmlApplicationContext</span><br><span class="line">	ç»§æ‰¿åŸºç±», æä¾›é…ç½®æ–‡ä»¶åœ°å€çš„æ„é€ æ–¹æ³•, è°ƒç”¨refreshåŠ è½½BeanFactory</span><br><span class="line">						</span><br><span class="line">BeanFactoryPostProcessor</span><br><span class="line">	ç”¨äºç»™BeanFactoryæ·»åŠ æ’ä»¶å¼åŠŸèƒ½, å¦‚é…ç½®æ–‡ä»¶è§£æ $&#123;&#125; å ä½ç¬¦</span><br><span class="line">	å¦‚ConfigurationClassPostProcessor å°†@Configurationç±»ä¸‹çš„å¸¦@Beançš„methodè¿”å›å€¼æ³¨å†Œåˆ°beanDefinitions ä¸­</span><br><span class="line"></span><br><span class="line">BeanPostProcessor</span><br><span class="line">	ç”¨äºç»™beanæ·»åŠ åŠŸèƒ½, å¦‚ApplicationContextAwareçš„è‡ªåŠ¨æ³¨å…¥å°±æ˜¯å¦‚æ­¤å®ç°çš„</span><br></pre></td></tr></table></figure>

<h4 id="å®¹å™¨åˆå§‹åŒ–æµç¨‹"><a href="#å®¹å™¨åˆå§‹åŒ–æµç¨‹" class="headerlink" title="å®¹å™¨åˆå§‹åŒ–æµç¨‹"></a>å®¹å™¨åˆå§‹åŒ–æµç¨‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1) ä»XmlClassPathApplicationContextæ„é€ æ–¹æ³•ä¸­è¿›å…¥ refresh æ–¹æ³•</span><br><span class="line">2) å…ˆè®¾ç½®å®¹å™¨çŠ¶æ€</span><br><span class="line">3) è°ƒç”¨å­ç±»åˆå§‹åŒ– BeanFactory</span><br><span class="line">4) è®¾ç½®BeanFactory ä¸€äº›å±æ€§,æ·»åŠ ä¸€äº›å†…ç½®çš„PostProcessor æ³¨å†Œä¸€äº› environment ç›¸å…³çš„bean</span><br><span class="line">5) å­ç±»è®¾ç½®ä¸€äº›å†…ç½®çš„PostProcessor</span><br><span class="line">6) æ‰«ææ·»åŠ å¹¶æ‰§è¡Œå®¹å™¨å†…çš„ BeanFactoryPostProcessor</span><br><span class="line">7) æ‰«æå®¹å™¨å†…çš„ BeanPostProcessor å¹¶æ³¨å†Œ</span><br><span class="line">8) åˆå§‹åŒ–å›½é™…åŒ–æ¶ˆæ¯å¤„ç†å™¨</span><br><span class="line">9) åˆå§‹åŒ–äº‹ä»¶å¹¿æ’­å¤„ç†å™¨</span><br><span class="line">10) æ‰§è¡Œå­ç±»çš„ refresh é€»è¾‘</span><br><span class="line">11) æ‰«æå®¹å™¨å†…çš„ ApplicationEvent (æŒ‡å®ç°ç±») å¹¶æ³¨å†Œåˆ°äº‹ä»¶å¹¿æ’­å¤„ç†å™¨</span><br><span class="line">12) å®ŒæˆBeanFactoryçš„åˆå§‹åŒ–, å¹¶åŠ è½½ä¸€äº›å•ä¾‹å¯¹è±¡(è®¾ç½®äº†æ€¥äºåŠ è½½çš„bean)</span><br><span class="line">13) åˆå§‹åŒ–LifcycleProcessor, è°ƒç”¨onRefreshæ–¹æ³•, å‘å¸ƒ ContextRefreshedEvent äº‹ä»¶.</span><br><span class="line">14) æ¸…é™¤ä¸€äº›ç¼“å­˜(å¦‚åå°„ç¼“å­˜, æ³¨è§£ç­‰)</span><br></pre></td></tr></table></figure>

<h4 id="æŸäº›å®ç°åŸç†"><a href="#æŸäº›å®ç°åŸç†" class="headerlink" title="æŸäº›å®ç°åŸç†"></a>æŸäº›å®ç°åŸç†</h4><h5 id="å®ç°-ApplicationContextAware-ä¸ºä½•ä¼šè‡ªåŠ¨æ³¨å…¥-applicationContext"><a href="#å®ç°-ApplicationContextAware-ä¸ºä½•ä¼šè‡ªåŠ¨æ³¨å…¥-applicationContext" class="headerlink" title="å®ç° ApplicationContextAware ä¸ºä½•ä¼šè‡ªåŠ¨æ³¨å…¥ applicationContext?"></a>å®ç° <code>ApplicationContextAware</code> ä¸ºä½•ä¼šè‡ªåŠ¨æ³¨å…¥ <code>applicationContext</code>?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆ AbstractApplicationContext#prepareBeanFactory ä¼šæ·»åŠ ä¸€ä¸ªApplicationContextAwareProcessor</span><br><span class="line"><span class="number">2</span>) è¿™ä¸ª beanPostProcessor è´Ÿè´£åœ¨beanåˆå§‹åŒ–ä¹‹å‰æ³¨å…¥contextå¯¹è±¡.</span><br><span class="line"><span class="number">3</span>) è¿™ä¸ª beanPostProcessor çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨ doCreateBean ä¸­çš„ postProcessBeforeInitialization()</span><br></pre></td></tr></table></figure>

<h5 id="å®ç°-ApplicationListener-ä¸ºä½•ä¼šåœ¨äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å®ç°çš„æ–¹æ³•"><a href="#å®ç°-ApplicationListener-ä¸ºä½•ä¼šåœ¨äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å®ç°çš„æ–¹æ³•" class="headerlink" title="å®ç° ApplicationListener ä¸ºä½•ä¼šåœ¨äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å®ç°çš„æ–¹æ³•?"></a>å®ç° <code>ApplicationListener</code> ä¸ºä½•ä¼šåœ¨äº‹ä»¶è§¦å‘æ—¶è‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å®ç°çš„æ–¹æ³•?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) åœ¨ AbstractApplicationContext#registerListeners() ä¸­æ‰«æå®¹å™¨å†…æ‰€æœ‰ç›¸å…³å®ç°ç±»åŠ å…¥åˆ°äº‹ä»¶ç›‘å¬è€…é›†åˆä¸­</span><br><span class="line"><span class="number">2</span>) ç„¶ååœ¨publishEventæ—¶ï¼Œéå†äº‹ä»¶ç›‘å¬è€…é›†åˆè°ƒç”¨beançš„æ–¹æ³•å³å¯ã€‚è§‚å¯Ÿè€…æ¨¡å¼ï¼</span><br><span class="line"><span class="number">3</span>) å¦å¤–ä¹Ÿç”¨äº†BeanPostProcessorå»å®ç°, å« ApplicationListenerDetector, åŠ å…¥æ—¶æœºåŒ<span class="number">1</span>, æ‰§è¡Œæ—¶æœºåŒ<span class="number">1</span>.</span><br><span class="line"><span class="number">4</span>) è‡³äºä¸ºä½•ä½¿ç”¨<span class="number">2</span>ç§æœºåˆ¶ï¼Œä¸å¤šä¾‹æœ‰å…³å§ï¼(scope=<span class="string">"prototype"</span>)</span><br></pre></td></tr></table></figure>

<h5 id="å®ç°Orderæ¥å£æˆ–æ³¨è§£æ—¶å¦‚ä½•è‡ªåŠ¨æ’åºçš„"><a href="#å®ç°Orderæ¥å£æˆ–æ³¨è§£æ—¶å¦‚ä½•è‡ªåŠ¨æ’åºçš„" class="headerlink" title="å®ç°Orderæ¥å£æˆ–æ³¨è§£æ—¶å¦‚ä½•è‡ªåŠ¨æ’åºçš„?"></a>å®ç°<code>Order</code>æ¥å£æˆ–æ³¨è§£æ—¶å¦‚ä½•è‡ªåŠ¨æ’åºçš„?</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1) æ¯”å¦‚è¯´ BeanPostProcesser, å®¹å™¨æ‰«æå, ä¼šåƒå¯¹beané›†åˆæ’åº, å†éå†æ‰§è¡Œ.</span><br><span class="line">2) è¯¦ç»†è¿‡ç¨‹è§ PostProcessorRegistrationDelegate<span class="comment">#sortPostProcessors()</span></span><br></pre></td></tr></table></figure>

<h5 id="å•ä¾‹å¯¹è±¡å¦‚ä½•å®ç°å¾ªç¯ä¾èµ–æ³¨å…¥ï¼Ÿ"><a href="#å•ä¾‹å¯¹è±¡å¦‚ä½•å®ç°å¾ªç¯ä¾èµ–æ³¨å…¥ï¼Ÿ" class="headerlink" title="å•ä¾‹å¯¹è±¡å¦‚ä½•å®ç°å¾ªç¯ä¾èµ–æ³¨å…¥ï¼Ÿ"></a>å•ä¾‹å¯¹è±¡å¦‚ä½•å®ç°å¾ªç¯ä¾èµ–æ³¨å…¥ï¼Ÿ</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆï¼Œ è®¾å®šå¯¹è±¡Aï¼ŒBï¼Œ A æŒæœ‰ B, B æŒæœ‰Aï¼Œ æ„æˆå¾ªç¯</span><br><span class="line">2) æ­¤æ—¶ç¨‹åºè°ƒç”¨getBeanè·å–Aï¼Œåˆ™åœ¨ doCreateBean ä¸­ åˆ›å»ºåå°†beanç¼“å­˜åˆ° singletonFactories ä¸­</span><br><span class="line">3) ç„¶åè®¾ç½®å±æ€§B, è§£æå±æ€§, éœ€è¦è·å–Bå¯¹è±¡</span><br><span class="line">4) è·å–B, åˆ™æ‰§è¡ŒdoCreateBean åæ‰§è¡Œè§£æå±æ€§, éœ€è¦è·å– Aå¯¹è±¡ (åˆä¸€æ¬¡)</span><br><span class="line">5) è·å–A, è¿›å…¥ doGetBean ä¸­çš„ getSingleton, æ­¤æ—¶åˆ¤æ–­singletonFactoriesä¸­æœ‰A, åˆ™å¯ä»¥ç›´æ¥å–å‡ºA</span><br><span class="line">6) è·å¾—Aå, å³å¯å®ŒæˆBçš„å±æ€§èµ‹å€¼, ç„¶åä¼šå®ŒæˆBçš„åˆ›å»º.</span><br><span class="line">7) Båˆ›å»ºå®Œå, Aå°±èƒ½è·å¾—B, åˆ™Aä¹Ÿå®Œæˆäº†å±æ€§èµ‹å€¼, æœ€åå®Œæˆåˆ›å»ºA.</span><br><span class="line">8) åˆ°æ­¤, è¿”å›å³å¯.</span><br><span class="line"></span><br><span class="line">&gt; æ€»ç»“: é¦–æ¬¡è·å–A, åˆ›å»ºAå¯¹è±¡åç¼“å­˜ä¸€ä¸ªå­˜å‚¨Aå¯¹è±¡çš„ ObjectFactory å®ä¾‹, å†è§£æå±æ€§æ—¶è§¦å‘ getBean(B), åŒç†ä¹Ÿä¼šåšç¼“å­˜, ç„¶åä¹Ÿè§£æå±æ€§, è§¦å‘getBean(A), ç¬¬äºŒæ¬¡è·å–A, è¿›å…¥å¦ä¸€ä¸ªé€»è¾‘, è¿”å› ObjectFactory å®ä¾‹ä¸­å­˜å‚¨çš„å¯¹è±¡A, å³å¯å®ŒæˆgetBean(A), ç„¶åå®ŒæˆgetBean(B), å†å®Œæˆå¤–å±‚çš„getBean(A).</span><br></pre></td></tr></table></figure>

<p>TIPS</p>
<blockquote>
<p>è§‚å¯Ÿæºç , å‘ç°æœ‰2ä¸ªç¼“å­˜, ä¸€ä¸ªæ˜¯ <code>singletonFactories</code>, å¦ä¸€ä¸ªæ˜¯ <code>earlySingletonObjects</code>.<br>å…¶ä¸­<code>earlySingletonObjects</code>çš„ç®¡ç†éƒ½åœ¨ <code>getSingleton</code> æ–¹æ³•ä¸­åš, è€Œ <code>singletonFactories</code> åˆ™åœ¨<code>doCreateBean</code>ä¸­åŠ å…¥, åœ¨ <code>getSingleton</code> ä¸­åˆ é™¤(æœ‰<code>earlySingletonObjects</code>åå°±å¯ä»¥åˆ é™¤äº†).<br>è™½ç„¶æœ‰2ä¸ªç¼“å­˜, ä½†å¦‚æœä½ çš„beanæ²¡æœ‰ä½¿ç”¨<code>BeanFactory</code>åˆ›å»º, åˆ™å…¶å®ä¸€ä¸ªç¼“å­˜ä¹Ÿè¶³å¤Ÿäº†<br>(å› ä¸ºè¿™æ ·çš„è¯ <code>singletonFactories</code> æ¯æ¬¡åˆ›å»ºè¿”å›çš„éƒ½æ˜¯åŒä¸€ä¸ª, å› ä¸ºæ­¤æ—¶ <code>singletonFactories</code>å­˜çš„åªæ˜¯ä»£ç åŒ…è£…çš„ä¸€ä¸ªå†…éƒ¨ç±», è€Œéç”¨æˆ·è‡ªå®šä¹‰çš„.)</p>
</blockquote>
<h5 id="InstantiationAwareBeanPostProcessorç­‰ä¸€äº›ç‰¹æ®ŠBeanProcessorçš„æ‰©å±•æ–¹æ³•æ˜¯ä½•æ—¶è‡ªåŠ¨è°ƒç”¨çš„"><a href="#InstantiationAwareBeanPostProcessorç­‰ä¸€äº›ç‰¹æ®ŠBeanProcessorçš„æ‰©å±•æ–¹æ³•æ˜¯ä½•æ—¶è‡ªåŠ¨è°ƒç”¨çš„" class="headerlink" title="InstantiationAwareBeanPostProcessorç­‰ä¸€äº›ç‰¹æ®ŠBeanProcessorçš„æ‰©å±•æ–¹æ³•æ˜¯ä½•æ—¶è‡ªåŠ¨è°ƒç”¨çš„?"></a><code>InstantiationAwareBeanPostProcessor</code>ç­‰ä¸€äº›ç‰¹æ®Š<code>BeanProcessor</code>çš„æ‰©å±•æ–¹æ³•æ˜¯ä½•æ—¶è‡ªåŠ¨è°ƒç”¨çš„?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) é¦–å…ˆ getBeanPostProcessorCache è·å–ä¸€äº›ç‰¹æ®Šçš„BeanPostProcessor</span><br><span class="line"><span class="number">2</span>) å¦‚ InstantiationAwareBeanPostProcessor/SmartInstantiationAwareBeanPostProcessor</span><br><span class="line"><span class="number">3</span>) ç„¶å createBeanæ—¶, ä¼šåœ¨æ­£ç¡®çš„æ—¶æœºä½¿ç”¨åˆ°è¿™äº›ç‰¹æ®Šçš„ PostProcessor, å–å‡ºæ¥, ç„¶åæ‰§è¡Œå¯¹åº”æ–¹æ³•</span><br><span class="line"><span class="number">4</span>) å…·ä½“ä½•æ—¶å¯ä»¥æŸ¥çœ‹ getBeanPostProcessorCache() çš„è°ƒç”¨ä½ç½®ä¸€ä¸€æŸ¥çœ‹.</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨è§£çš„å®ç°"><a href="#æ³¨è§£çš„å®ç°" class="headerlink" title="æ³¨è§£çš„å®ç°"></a>æ³¨è§£çš„å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) é¦–å…ˆæ˜¯æŒ‡å®šåŒ…åæˆ–æŒ‡å®šç±»å</span><br><span class="line">	å¦‚æŒ‡å®šåŒ…ååˆ™scanæ—¶ä¼šæ‰§è¡Œ, å¦‚æŒ‡å®šç±»ååˆ™åœ¨æ„é€ æ–¹æ³•åˆå§‹åŒ– reader æ—¶æ‰§è¡Œ</span><br><span class="line">2) æ— è®ºå“ªç§, æœ€ç»ˆéƒ½ä¼šèµ°ä¸€æ®µä»£ç  AnnotationConfigUtils#registerAnnotationConfigProcessors()</span><br><span class="line"><span class="number">3</span>) è¿™æ®µä»£ç ä¼šæ·»åŠ ä¸€äº› BeanFactoryPostProcessor</span><br><span class="line">	å¦‚ ConfigurationClassPostProcessor è´Ÿè´£è§£æ <span class="meta">@Configuration</span>/<span class="meta">@Import</span>/<span class="meta">@Bean</span> æ³¨è§£</span><br><span class="line">    	postProcessBeanDefinitionRegistry() ä¸­ parse æ‰€æœ‰çš„å¸¦ä»¥ä¸Šæ³¨è§£çš„ beanDefinitions</span><br><span class="line">    	ConfigurationClassParser å°†æ³¨è§£ä¿¡æ¯è§£æä¿å­˜ï¼Œ</span><br><span class="line">    	ç„¶åç”± ConfigurationClassBeanDefinitionReader è´Ÿè´£æ³¨å†Œåˆ°å®¹å™¨ã€‚</span><br><span class="line">	å¦‚ AutowiredAnnotationBeanPostProcessor è´Ÿè´£è§£æ <span class="meta">@Autowired</span>/<span class="meta">@Value</span> æ³¨è§£</span><br><span class="line">    å¦‚ CommonAnnotationBeanPostProcessor è´Ÿè´£è§£æ <span class="meta">@Resource</span> æ³¨è§£</span><br><span class="line">    è§£ææ”¾åœ¨ postProcessProperties() æ–¹æ³•ä¸­ï¼Œ å…ˆæ‰«æbeançš„å­—æ®µå’Œæ–¹æ³•ï¼Œ ç„¶åä¸€ä¸€è°ƒç”¨æ–¹æ³•å’Œä¸ºå­—æ®µæ³¨å…¥å€¼</span><br><span class="line"><span class="number">4</span>) ä¹‹å, ä»–ä¼šå°†æ‰«æçš„ç±»æ”¾åˆ° beanDefinitions ä¸­(æˆ–æŒ‡å®šçš„ç±»æ³¨å†Œè¿›å»)</span><br><span class="line"><span class="number">5</span>) BeanFactoryåŠ è½½å®Œæ¯•å, å›åˆ°AbstractApplicationContextçš„refreshé€»è¾‘</span><br><span class="line">	å¦‚ä¼šæ‰§è¡Œ postProcessBeanFactory(), è°ƒç”¨å‰é¢åŠ å…¥çš„ConfigurationClassPostProcessor</span><br><span class="line">	ç„¶åä¼šæ·»åŠ æ›´å¤šçš„ç±»åˆ°å®¹å™¨ä¸­.</span><br><span class="line">    </span><br><span class="line">æ³¨æ„äº‹é¡¹ï¼š</span><br><span class="line">    <span class="meta">@Configuration</span> å’Œ <span class="meta">@Component</span>çš„åŒºåˆ«ï¼Ÿ</span><br><span class="line">    è§‚å¯Ÿå‘ç°ï¼Œå³ä½¿ä½¿ç”¨<span class="meta">@Component</span> å…¶ä¸‹å¸¦ <span class="meta">@Bean</span> çš„æ–¹æ³•ä¾ç„¶å¯ä»¥æ³¨å…¥åˆ°å®¹å™¨ä¸­ã€‚æ‰€ä»¥ä¼¼ä¹ä¸¤è€…æ²¡æœ‰åŒºåˆ«ï¼Ÿ</span><br><span class="line">    ä»”ç»†æŸ¥çœ‹æºç å’Œèµ„æ–™åï¼Œå‘ç° postProcessBeanFactory() æ–¹æ³•åœ¨ processConfigBeanDefinitions() åè¿˜ä¼šè°ƒç”¨ enhanceConfigurationClasses()</span><br><span class="line">    è€Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­, å¯¹å‰é¢è§£æäº†<span class="class"><span class="keyword">class</span> æ˜¯ <span class="title">CONFIGURATION_CLASS_FULL</span> (å³ä»£è¡¨@<span class="title">Configuration</span>)çš„ç±»</span></span><br><span class="line"><span class="class">    ä¼šç”Ÿæˆä¸€ä¸ª <span class="title">cglib</span> çš„ä»£ç†, è¿™æ ·è·å–@<span class="title">Bean</span>æ³¨è§£çš„æ–¹æ³•çš„<span class="title">bean</span>æ—¶,ä¸ä¼šæ¯æ¬¡è°ƒç”¨æ–¹æ³•<span class="title">new</span> ä¸€ä¸ª, è€Œæ˜¯æœ‰ç¼“å­˜.</span></span><br></pre></td></tr></table></figure>

<h4 id="AOP-æµç¨‹"><a href="#AOP-æµç¨‹" class="headerlink" title="AOP æµç¨‹"></a>AOP æµç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) ä½¿ç”¨ <span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="number">2</span>) <span class="meta">@EnableAspectJAutoProxy</span> ä¸­ä½¿ç”¨äº† <span class="meta">@Import</span>(AspectJAutoProxyRegistrar<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">3) <span class="title">ConfigurationClassPostProcessor</span> ä¼šè§£æ@<span class="title">Import</span>, è¿›å…¥ <span class="title">registerBeanDefinitions</span>() ä¸­</span></span><br><span class="line"><span class="class">4) <span class="title">registerBeanDefinitions</span>() ä¸­æ·»åŠ äº† <span class="title">AnnotationAwareAspectJAutoProxyCreator</span> åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="class">5) <span class="title">AnnotationAwareAspectJAutoProxyCreator</span> æœ¬è´¨ä¸Šæ—¶ä¸€ä¸ª <span class="title">BeanPostProcessor</span></span></span><br><span class="line"><span class="class">6) å› æ­¤åœ¨ <span class="title">createBean</span> æ—¶, ä¼šè¢«è‡ªåŠ¨è°ƒç”¨. å…¶ä¸­ <span class="title">postProcessAfterInitialization</span>() è´Ÿè´£åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="class">7) è€Œ <span class="title">getAdvicesAndAdvisorsForBean</span>() åˆ™è´Ÿè´£æŸ¥æ‰¾å¯¹åº”çš„å¢å¼º. ç„¶åä¼šè°ƒç”¨å­ç±»çš„<span class="title">findCandidateAdvisors</span></span></span><br><span class="line"><span class="class">8) å¦‚ <span class="title">AnnotationAwareAspectJAutoProxyCreator</span>#<span class="title">findCandidateAdvisors</span>() è´Ÿè´£æ³¨è§£ç¼–å†™å¢å¼º@<span class="title">Before</span>/@<span class="title">After</span>ç­‰</span></span><br><span class="line"><span class="class">9) ç®€å•è¯´ä¸‹é€»è¾‘, å°±æ˜¯æŸ¥æ‰¾å®¹å™¨æ‰€æœ‰ç±», åˆ¤æ–­è¿™ä¸ªç±»æœ‰æ²¡æœ‰ @<span class="title">Aspect</span> æ³¨è§£, ç„¶åå…ˆæ‰¾å‡ºæ‰€æœ‰<span class="title">Pointcut</span></span></span><br><span class="line"><span class="class">	å†éå†æ‰€æœ‰æ–¹æ³•, æ‰¾å‡ºæ–¹æ³•ä¸Šå¸¦æœ‰@<span class="title">Before</span>ç­‰æ³¨è§£ä¸”æœ‰å…³è”çš„<span class="title">Pointcut</span>çš„æ–¹æ³•,</span></span><br><span class="line"><span class="class">    ç„¶åä½¿ç”¨è¿™ä¸ªæ–¹æ³•å’Œå…³è”çš„<span class="title">Pointcut</span> æ¥<span class="title">new</span> ä¸€ä¸ª<span class="title">Advisor</span>, åŠ å…¥åˆ°<span class="title">Advisor</span>é›†åˆä¸­, éå†ç»“æŸåè¿”å›å³å¯.</span></span><br><span class="line"><span class="class">10) æŸ¥æ‰¾åˆ°æ‰€æœ‰çš„å¢å¼ºå, å†æ¯”è¾ƒ<span class="title">Pointcut</span>è¡¨è¾¾å¼æ˜¯å¦åŒ¹é…å½“å‰çš„<span class="title">bean</span>, å¦‚å¯ä»¥åˆ™åŠ å…¥.</span></span><br><span class="line"><span class="class">11) æ ¹æ®æ‰¾åˆ°çš„<span class="title">Advisor</span>é›†åˆ, åˆ›å»ºä¸€ä¸ªå¸¦é…ç½®(<span class="title">advisor</span>é›†åˆç­‰)çš„ä»£ç†å¯¹è±¡, ä»£ç†å¯¹è±¡æ‰§è¡Œæ–¹æ³•å‰</span></span><br><span class="line"><span class="class">12) ä¼šå…ˆæ ¹æ®é…ç½®ä¸­çš„<span class="title">advisor</span>é›†åˆç”Ÿæˆä¸€ä¸ªæ‰§è¡Œé“¾, ç„¶ååœ¨æ‹¦æˆªä»£ç†æ–¹æ³•å¤„è°ƒç”¨. æ‰§è¡Œé“¾ä¼šè´Ÿè´£æ‰§è¡Œé€šçŸ¥.</span></span><br><span class="line"><span class="class">13) ä¸åŒçš„é€šçŸ¥ç”±ä¸åŒçš„é€‚é…å™¨æ‰§è¡Œ.</span></span><br></pre></td></tr></table></figure>

<h4 id="Spring-äº‹åŠ¡å®ç°"><a href="#Spring-äº‹åŠ¡å®ç°" class="headerlink" title="Spring äº‹åŠ¡å®ç°"></a>Spring äº‹åŠ¡å®ç°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span>) äº‹åŠ¡æ˜¯ç”±AOPå®ç°çš„, æ‰€ä»¥éœ€è¦æ‰¾åˆ°å¯¹åº”çš„Pointcut å’Œ Advisor</span><br><span class="line"><span class="number">1</span>) æ‰“å¼€äº† <span class="meta">@EnableTransactionManagement</span> æ³¨è§£</span><br><span class="line"><span class="number">2</span>) ç„¶å<span class="meta">@Import</span> äº† TransactionManagementConfigurationSelector</span><br><span class="line"><span class="number">3</span>) ä¹‹åå¯¼å…¥äº† ProxyTransactionManagementConfiguration åˆ°å®¹å™¨ä¸­</span><br><span class="line"><span class="number">4</span>) ProxyTransactionManagementConfiguration å¸¦æœ‰ <span class="meta">@Configuration</span></span><br><span class="line"><span class="number">5</span>) <span class="meta">@Bean</span> æ³¨å…¥äº†ä¸€ä¸ªé€šç”¨çš„Advisor: BeanFactoryTransactionAttributeSourceAdvisor</span><br><span class="line"><span class="number">6</span>) è¿™ä¸ªAdvisorçš„ Pointcut æ˜¯ç”± TransactionAttributeSourcePointcut å®ç°çš„</span><br><span class="line">	å®ç°é€»è¾‘æ˜¯ TransactionAttributeSourcePointcut çš„ matches()</span><br><span class="line">    è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº† getTransactionAttributeSource() è·å– AnnotationTransactionAttributeSource</span><br><span class="line">    ç„¶åé€šè¿‡ getTransactionAttribute() è°ƒç”¨äº† findTransactionAttribute()</span><br><span class="line">    æœ€ç»ˆä½¿ç”¨SpringTransactionAnnotationParser ç±»åˆ¤æ–­æ–¹æ³•æ˜¯å¦æœ‰<span class="meta">@Transactional</span>æ³¨è§£</span><br><span class="line">    å¹¶è§£ææ³¨è§£ä¿¡æ¯ç„¶åè¿”å›. å¦å¤–è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥è·å–<span class="meta">@Transactional</span>æ³¨è§£çš„ä¿¡æ¯, è€Œè¿™é‡Œåªç”¨äºåˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªè¿™ä¸ªæ–¹æ³•.</span><br><span class="line"><span class="number">7</span>) TransactionInterceptor æ˜¯ä¸€ä¸ªAdvisor</span><br><span class="line">    ä¹Ÿå¯ä»¥é€šè¿‡AnnotationTransactionAttributeSourceè·å–<span class="meta">@Transactional</span>æ³¨è§£ä¸Šçš„ä¿¡æ¯</span><br><span class="line">    ç„¶ååœ¨invokeä¸­, æ‹¦æˆªæ–¹æ³•, æ‰“å¼€äº‹åŠ¡, åœ¨æ‰§è¡Œå®Œæ–¹æ³•å, æäº¤äº‹åŠ¡, æŠ¥é”™æ—¶å›æ»šäº‹åŠ¡</span><br><span class="line">    è¿™ä¸ª Advisor ä¸åŒäºä¼ ç»Ÿçš„å‰ç½®/åç½®, è€Œæ˜¯æ›´å…·ä½“çš„ MethodInterceptor.</span><br></pre></td></tr></table></figure>



<h3 id="Spring-Boot-æºç "><a href="#Spring-Boot-æºç " class="headerlink" title="Spring Boot æºç "></a>Spring Boot æºç </h3><h4 id="ç®€åŒ–äº†å¤šå°‘æ“ä½œï¼Ÿ"><a href="#ç®€åŒ–äº†å¤šå°‘æ“ä½œï¼Ÿ" class="headerlink" title="ç®€åŒ–äº†å¤šå°‘æ“ä½œï¼Ÿ"></a>ç®€åŒ–äº†å¤šå°‘æ“ä½œï¼Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.MultipartAutoConfiguration</span><br><span class="line">	æ·»åŠ äº†ä¸€ä¸ªbean StandardServletMultipartResolver, å¹¶è®¾ç½®ä¸Šä¼ æ–‡ä»¶å¤§å°ç­‰å±æ€§</span><br><span class="line">	ä½¿å¾—Spring MVCä¸­çš„ DispatcherServlet å¯ä»¥è·å– multipartResolver, å¤„ç†æ–‡ä»¶ä¸Šä¼ .</span><br><span class="line">    è‹¥ä¸æ˜¯Spring Boot, éœ€è¦åœ¨xmlæˆ–æ³¨è§£ä¸­æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª è¿™æ ·çš„beanæ‰èƒ½å¤„ç†æ–‡ä»¶ä¸Šä¼ , è€Œä¸”é…ç½®æ–‡ä»¶è¿˜è¦è‡ªå·±è¯»å–.</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>.MailSenderAutoConfiguration</span><br><span class="line">    æ·»åŠ äº†ä¸€ä¸ª JavaMailSenderImpl çš„beanåˆ°å®¹å™¨ä¸­, å¹¶è®¾ç½®é‚®ç®±æœåŠ¡å™¨/è´¦å·/å¯†ç ç­‰å±æ€§</span><br><span class="line">    è‹¥ä¸æ˜¯Spring Boot, éœ€è¦åœ¨xmlä¸­é…ç½®ä¸€ä¸ªbeanå³é…ç½®ä»–çš„å±æ€§(é‚®ç®±é…ç½®)</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>.TransactionAutoConfiguration</span><br><span class="line">    åœ¨å†…éƒ¨ç±»æ·»åŠ  <span class="meta">@EnableTransactionManagement</span>ï¼Œå‰©ä¸‹çš„å‚è€ƒä¸Šé¢çš„ Spring äº‹åŠ¡å®ç°</span><br><span class="line">    </span><br><span class="line"><span class="number">4</span>.WebMvcAutoConfiguration</span><br><span class="line">    æ·»åŠ äº† RequestMappingHandlerAdapter/RequestMappingHandlerMapping</span><br><span class="line">    æ·»åŠ äº† ContentNegotiatingViewResolver</span><br></pre></td></tr></table></figure>

<h4 id="å¯åŠ¨æµç¨‹"><a href="#å¯åŠ¨æµç¨‹" class="headerlink" title="å¯åŠ¨æµç¨‹"></a>å¯åŠ¨æµç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) åˆ›å»º SpringApplicationRunListeners ç®¡ç† run è¿‡ç¨‹çš„äº‹ä»¶, ç›‘å¬è€…å–è‡ª spring.factories</span><br><span class="line"><span class="number">2</span>) è§¦å‘ run çš„å¼€å§‹(starting)äº‹ä»¶</span><br><span class="line"><span class="number">3</span>) åˆå§‹åŒ– environment å¯¹è±¡, å¹¶åˆ©ç”¨ run çš„ environmentPrepared äº‹ä»¶å°†application.ymlçš„æ•°æ®æ³¨å…¥</span><br><span class="line"><span class="number">4</span>) æ‰“å° Banner, å¯è‡ªå®šä¹‰ Banner é€šè¿‡ banner.txt æ–‡ä»¶</span><br><span class="line"><span class="number">5</span>) æ ¹æ®webApplicationTypeåˆ›å»ºä¸€ä¸ªApplicationContext å®¹å™¨</span><br><span class="line">    é»˜è®¤ä½¿ç”¨ AnnotationConfigApplicationContext</span><br><span class="line"><span class="number">6</span>) ä¸º context åšä¸€äº›åˆå§‹åŒ–å’Œè®¾ç½®</span><br><span class="line">    è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œ ä½¿å¾— context å¯ä»¥è·å– application.yml ä¸­çš„é…ç½®</span><br><span class="line">    è°ƒç”¨å­ç±»æ‰©å±•çš„è®¾ç½®</span><br><span class="line">    åŠ è½½ å®¹å™¨çš„ initializers</span><br><span class="line">    è§¦å‘ run çš„ contextPrepared äº‹ä»¶</span><br><span class="line">    æ‰“å°æ—¥å¿—</span><br><span class="line">    æ·»åŠ spring boot å¯åŠ¨å‚æ•°ä¿¡æ¯åˆ° bean å®¹å™¨ä¸­</span><br><span class="line">    è®¾ç½®beanFactoryçš„ allowBeanDefinitionOverriding å±æ€§</span><br><span class="line">    è®¾ç½® æ‡’åŠ è½½ç­–ç•¥ï¼Œ æ·»åŠ  postProcessor åˆ™ä¼šå°†æ¯ä¸ª beanDefinition çš„ lazyInit è®¾ç½®ä¸º <span class="keyword">true</span></span><br><span class="line">    æŠŠå¯åŠ¨ç±»<span class="class"><span class="keyword">class</span>å°è£…æˆ <span class="title">BeanDefinition</span> æ”¾åˆ°å®¹å™¨ä¸­, ä½¿å¾—@<span class="title">Configuration</span>ä¹‹ç±»çš„æ³¨è§£ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="class">    è§¦å‘ <span class="title">run</span> çš„ <span class="title">contextLoaded</span> äº‹ä»¶</span></span><br><span class="line"><span class="class">7) è°ƒç”¨ <span class="title">context</span> çš„ <span class="title">refresh</span>()</span></span><br><span class="line"><span class="class">    æ‰§è¡Œ <span class="title">BeanFactoryPostProcessor</span>, å¦‚ <span class="title">ConfigurationClassPostProcessor</span> è§£æ @<span class="title">Import</span> æ³¨è§£</span></span><br><span class="line"><span class="class">    @<span class="title">Import</span> ä¼šå®ç° @<span class="title">EnableAutoConfiguration</span>, æ€»ä¹‹éƒ½æ˜¯ç†Ÿæ‚‰çš„ <span class="title">spring</span> å¥—è·¯. <span class="title">boot</span>çš„ä¸œè¥¿å°±å°‘äº†.</span></span><br><span class="line"><span class="class">8) è°ƒç”¨ç•™ç»™å­ç±»çš„ <span class="title">afterRefresh</span>() æ–¹æ³•, é»˜è®¤ç©ºå®ç°</span></span><br><span class="line"><span class="class">9) æ‰“å°å¯åŠ¨å®Œæ¯•ä¿¡æ¯</span></span><br><span class="line"><span class="class">10) è§¦å‘ <span class="title">run</span> çš„ <span class="title">started</span> äº‹ä»¶</span></span><br><span class="line"><span class="class">11) è°ƒç”¨ å®¹å™¨å†…æ‰€æœ‰çš„ <span class="title">ApplicationRunner</span> å’Œ <span class="title">CommandLineRunner</span> å®ç°ç±», ç±»ä¼¼äº‹ä»¶ç›‘å¬.</span></span><br><span class="line"><span class="class">12) ä½¿ç”¨ <span class="title">spring</span>.<span class="title">factories</span> ä¸­çš„ <span class="title">exceptionReporters</span> å¤„ç†å¯èƒ½å‡ºç°çš„å¼‚å¸¸.</span></span><br><span class="line"><span class="class">13) è§¦å‘ <span class="title">run</span> çš„ <span class="title">running</span> äº‹ä»¶</span></span><br></pre></td></tr></table></figure>



<h4 id="ä¸€äº›ä¸œè¥¿çš„å®ç°åŸç†"><a href="#ä¸€äº›ä¸œè¥¿çš„å®ç°åŸç†" class="headerlink" title="ä¸€äº›ä¸œè¥¿çš„å®ç°åŸç†"></a>ä¸€äº›ä¸œè¥¿çš„å®ç°åŸç†</h4><h5 id="ConfigurationProperties-å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å…¥application-propertiesä¸­é…ç½®çš„å€¼"><a href="#ConfigurationProperties-å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å…¥application-propertiesä¸­é…ç½®çš„å€¼" class="headerlink" title="@ConfigurationProperties å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å…¥application.propertiesä¸­é…ç½®çš„å€¼?"></a><code>@ConfigurationProperties</code> å¦‚ä½•å®ç°è‡ªåŠ¨æ³¨å…¥<code>application.properties</code>ä¸­é…ç½®çš„å€¼?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) é¦–å…ˆåŠ äº† <span class="meta">@EnableConfigurationProperties</span> ä¹Ÿä¼šè§£æé‡Œé¢çš„ <span class="meta">@Import</span> </span><br><span class="line"><span class="number">2</span>) <span class="meta">@Import</span> åˆ™å¼•å…¥äº† EnableConfigurationPropertiesRegistrar<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">3) è¿™æ˜¯ä¸€ä¸ª <span class="title">ImportBeanDefinitionRegistrar</span> çš„å®ç°ç±», ä¼šåœ¨è§£æ @<span class="title">Configuration</span> æ³¨è§£æ—¶è°ƒç”¨æŒ‡å®šæ–¹æ³•</span></span><br><span class="line"><span class="class">4) æŒ‡å®šæ–¹æ³• <span class="title">registerBeanDefinitions</span>() è·å– @<span class="title">EnableConfigurationPropertiesRegistrar</span> çš„æ•°æ®</span></span><br><span class="line"><span class="class">    å¦‚ @<span class="title">EnableConfigurationProperties</span>(<span class="title">RabbitProperties</span>.<span class="title">class</span>) åŠ è½½ <span class="title">RabbitProperties</span>.<span class="title">class</span></span></span><br><span class="line"><span class="class">    ç„¶å, å°†è¿™äº› <span class="title">class</span> éƒ½æ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="class">5) æŒ‡å®šæ–¹æ³•è¿˜æ³¨å†Œäº†ä¸€äº›å·¥å…·<span class="title">bean</span>å’Œä¸€ä¸ªé‡è¦çš„ <span class="title">BeanPostProcessor</span> åœ¨ <span class="title">registerInfrastructureBeans</span>()ä¸­</span></span><br><span class="line"><span class="class">6) <span class="title">registerInfrastructureBeans</span>() åŠ è½½äº† <span class="title">ConfigurationPropertiesBindingPostProcessor</span>.<span class="title">class</span></span></span><br><span class="line"><span class="class">7) åœ¨ <span class="title">postProcessorBeforeInitialization</span>() ä¸­ è°ƒç”¨ <span class="title">ConfigurationPropertiesBinder</span></span></span><br><span class="line"><span class="class">8) è°ƒç”¨é“¾å¾ˆé•¿, æœ€å <span class="title">property</span>.<span class="title">setValue</span>(<span class="title">beanSupplier</span>, <span class="title">bound</span>)</span>;è®¾ç½®äº†å€¼ -- JavaBeanBinder</span><br><span class="line"></span><br><span class="line">æ€»ç»“: å°±æ˜¯å…ˆå°† XxxProperties ç±»å®šä¹‰æ³¨å…¥åˆ°å®¹å™¨ä¸­, è¿™æ ·å¯ä»¥getBean, ç„¶åé€šè¿‡ BeanPostProcessor</span><br><span class="line">    å†å®ä¾‹åŒ–åå°†å±æ€§å€¼ä¸€ä¸€ç»‘å®š.</span><br></pre></td></tr></table></figure>

<h5 id="ConditionalXxx-çš„å®ç°åŸç†"><a href="#ConditionalXxx-çš„å®ç°åŸç†" class="headerlink" title="@ConditionalXxx çš„å®ç°åŸç†"></a><code>@ConditionalXxx</code> çš„å®ç°åŸç†</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) åœ¨ç±»ä¸ŠåŠ ä¸Šæ³¨è§£ <span class="meta">@Conditional</span> æˆ– å¸¦æœ‰ <span class="meta">@Conditional</span> çš„å…¶ä»–æ³¨è§£:å…¶ä»–æ‰©å±•å®ç°</span><br><span class="line"><span class="number">2</span>) åœ¨æ‰€æœ‰çš„æ‰«æç±»å’Œæ³¨è§£çš„åœ°æ–¹,å¦‚è§£æ<span class="meta">@Configuration</span>, AnotatedBeanDefinitionReaderç­‰reader</span><br><span class="line">    ä¼šä½¿ç”¨ ConditionEvaluator çš„ shouldSkip() åˆ¤æ–­æ˜¯å¦å¯ä»¥åŠ è½½, æ—¶æœºç‚¹å¦‚ä¸‹</span><br><span class="line">    AnnotatedBeanDefinitionReader#doRegisterBean() çš„ç¬¬äºŒè¡Œä»£ç </span><br><span class="line">    ConfigurationClassBeanDefinitionReader#loadBeanDefinitionsForBeanMethod() ç¬¬å››è¡Œ</span><br><span class="line">    ConfigurationClassBeanDefinitionReader#loadBeanDefinitionsForConfigurationClass()</span><br><span class="line">    ConfigurationClassParser#doProcessConfigurationClass() å¤„ç† ComponentScan é‚£æ®µ</span><br><span class="line"><span class="number">3</span>) ç„¶åå† shouldSkip ä¸­åˆ¤æ–­ï¼Œ åˆ¤æ–­é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼š</span><br><span class="line">    å…ˆéå†æ‰€æœ‰æ³¨è§£å–å¾—æ‰€æœ‰çš„ <span class="meta">@Conditional</span> ä¸‹çš„ æ‰€æœ‰ value, è¿™ä¸ª value æ˜¯å…·ä½“çš„Conditionå®ç°, å¦‚OnClassCondition</span><br><span class="line">    å®ä¾‹åŒ– Condition ç„¶åæ·»åŠ åˆ° conditionsä¸­</span><br><span class="line">    æ’åºå¹¶éå†è°ƒç”¨ matches(), ä¸€ä¸ªä¸åŒ¹é…åˆ™è¿”å›<span class="keyword">true</span>, ä»£è¡¨åº”è¯¥è·³è¿‡.</span><br><span class="line"></span><br><span class="line">TIPS:</span><br><span class="line">ConditionOutcome å°è£…äº†æ˜¯å¦åŒ¹é…å’ŒåŒ¹é…æ—¥å¿—ä¿¡æ¯[ä¸ºå•¥æˆåŠŸ/ä¸ºå•¥å¤±è´¥]</span><br><span class="line">SpringBootCondition æä¾›äº†é€šç”¨çš„æ ¹æ® ConditionOutcome åˆ¤æ–­æ˜¯å¦åŒ¹é…å¹¶è®°å½•æ—¥å¿—ä¿¡æ¯çš„æŠ½è±¡ç±».</span><br><span class="line">    å­ç±»åªéœ€å®ç° getMatchOutcome(): æ ¹æ® metadata[æ³¨è§£ä¿¡æ¯] è¿”å› ConditionOutcome å¯¹è±¡.</span><br><span class="line">    å› æ­¤, å¦‚æœæˆ‘ä»¬è¦å®ç°è‡ªå·±çš„ Condition, å¯ä»¥ç»§æ‰¿å®ƒ.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦å‘ç° <code>AutoConfigurationImportSelector</code> ä¹Ÿå«æœ‰åˆ¤æ–­Conditionçš„é€»è¾‘,<br>åˆšå¼€å§‹ä»¥ä¸ºæ˜¯ <code>AutoConfiguration</code> çš„ç±»æ²¡æœ‰èµ°ä¹‹å‰è¯´åˆ°çš„åˆ¤æ–­, æ‰€ä»¥è¿™é‡Œè¦åšåˆ¤æ–­.<br>åæ¥æˆ‘ä¸€æƒ³, è¿™æ˜¯ @Import å¼•å…¥çš„, æ‰€ä»¥, æ˜¯èµ°äº†åˆ¤æ–­çš„. å› æ­¤è¿™é‡Œå¤šå‡ºçš„ä¸€ä¸ª <code>AutoConfigurationImportFilter</code>, åº”è¯¥æ˜¯ä¸€ä¸ªé¢å¤–çš„æ’ä»¶, ä¸“é—¨è¿‡æ»¤é…ç½®åœ¨ <code>spring.factories</code> ä¸­çš„ <code>AutoConfiguration</code> ç±»çš„. è€Œæ’ä»¶çš„è¯»å–, ä¹Ÿæ˜¯è¯»å– <code>spring.factories</code> æ¥éå†. </p>
</blockquote>
<h5 id="AutoConfigureAfter-çš„å®ç°åŸç†"><a href="#AutoConfigureAfter-çš„å®ç°åŸç†" class="headerlink" title="@AutoConfigureAfter  çš„å®ç°åŸç†"></a><code>@AutoConfigureAfter</code>  çš„å®ç°åŸç†</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) é¦–å…ˆ AutoConfigurationImportSelector æ˜¯ä¸€ä¸ª DeferredImportSelector  </span><br><span class="line"><span class="number">2</span>) è¿™ç§ DeferredImportSelector ä¼šå»¶è¿ŸåŠ è½½, åŸç†æ˜¯ parse åå†åŠ è½½, è€Œéparseæ‰§è¡Œè¿‡ç¨‹ä¸­å°±åŠ è½½.</span><br><span class="line"><span class="number">3</span>) å»¶è¿ŸåŠ è½½æœºåˆ¶ ä¼šå…ˆè°ƒç”¨ process æ–¹æ³•, å°†è¦åŠ è½½çš„<span class="class"><span class="keyword">class</span>ä¿å­˜èµ·æ¥, ç„¶åå†è°ƒç”¨ <span class="title">selectImports</span> è¿”å›.</span></span><br><span class="line"><span class="class">4) æ­¤æ—¶ <span class="title">AutoConfigurationImportSelector</span>.<span class="title">AutoConfigurationGroup</span> çš„ <span class="title">selectImports</span>() ä¼šè°ƒç”¨ <span class="title">sortAutoConfigurations</span>(), ä¹Ÿå°±æ˜¯è°ƒç”¨äº† <span class="title">AutoConfigurationSorter</span>.<span class="title">getInPriorityOrder</span>()</span></span><br><span class="line"><span class="class">5) <span class="title">getInPriorityOrder</span>() è°ƒç”¨äº† <span class="title">sortByAnnotation</span>() è¿™ä¸ªæ–¹æ³•æ ¹æ®2ä¸ªæ³¨è§£ @<span class="title">AutoConfigureBefore</span> @<span class="title">AutoConfigureAfter</span> æ’åº.</span></span><br><span class="line"><span class="class">6) æœ€åè¿”å›çš„å°±æ˜¯æœ‰åºçš„äº†. å¦å¤–, è¿™ä¸¤ä¸ªæ³¨è§£åªèƒ½ä½œç”¨å† <span class="title">AutoConfiguration</span> ä¸Š.</span></span><br><span class="line"><span class="class"></span></span><br><span class="line">æ€»ç»“:</span><br><span class="line">æ‰€æœ‰çš„ AutoConfiguration æ‰€å¼•å…¥çš„<span class="class"><span class="keyword">class</span>æ–‡ä»¶è§£æå®Œæ¯•å, å†å‡†å¤‡åŠ è½½ä¹‹å‰, è¿›è¡Œæ’åº, ç„¶åä¸€ä¸€åŠ è½½.</span></span><br></pre></td></tr></table></figure>



<h5 id="å„ç§-AutoConfiguration-å®ç°å¤§è‡´æµç¨‹"><a href="#å„ç§-AutoConfiguration-å®ç°å¤§è‡´æµç¨‹" class="headerlink" title="å„ç§ AutoConfiguration å®ç°å¤§è‡´æµç¨‹."></a>å„ç§ <code>AutoConfiguration</code> å®ç°å¤§è‡´æµç¨‹.</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆæ˜¯ @SpringBootApplication å¯ç”¨äº† @EnableAutoConfiguration</span><br><span class="line">2) @EnableAutoConfiguration åˆä½¿ç”¨ @Import å¯¼å…¥äº† AutoConfigurationImportSelector.class</span><br><span class="line">3) ç„¶å AutoConfigurationImportSelector å¯¼å…¥ spring.factoriesæ‰€æœ‰çš„ EnableAutoConfiguration</span><br><span class="line">4) æœ€åï¼Œå½“ä¸€ä¸ªé¡¹ç›®ä¾èµ–ä¸€ä¸ªstarter-xxxï¼Œä¼šç»§æ‰¿starterçš„ä¾èµ–é¡¹, spring-boot-autoconfigure ç”±æ­¤è¢«ä¾èµ–</span><br><span class="line">5) spring-boot-autoconfigure å¸¦æœ‰æ‰€æœ‰ boot å®ç°çš„ AutoConfiguration å’Œ spring.factories é…ç½®</span><br><span class="line">6) æ‰€ä»¥ä¼šåŠ è½½è¯¥é¡¹ç›®ä¸‹ spirng.factories ä¸­å®šä¹‰çš„ EnableAutoConfiguration</span><br><span class="line">7) æ¯ä¸ª AutoConfiguration å®ç°ç±»è¢«å¯¼å…¥åˆ°å®¹å™¨ä¸­å</span><br><span class="line">	åˆè¢« ConfigurationClassPostProcessor è§£æ@Configuration, @Import ç­‰æ³¨è§£ (è€åƒå±‚é¥¼äº†)</span><br><span class="line">	è¿™äº›AutoConfigurationä¼šæ·»åŠ ä¸€äº›æä¾›æœåŠ¡çš„ beanï¼Œæˆ–è€…å†åµŒå¥—ä¸€å±‚@Importï¼Œ@Configurationç­‰ã€‚</span><br><span class="line">	å¦å¤–, è¿™äº›beanè¿˜æ˜¯è¢«è‡ªåŠ¨é…ç½®äº†å±æ€§å€¼çš„, å±æ€§å€¼å“ªé‡Œæ¥? éƒ½åœ¨ application.yml ä¸­, æˆ–æ˜¯é»˜è®¤é…ç½®ä¸­.</span><br><span class="line">9) è¿™æ ·ï¼Œå®¹å™¨ä¸­å°±åŠ å…¥äº†ä¸€ä¸ªæˆ–å¤šä¸ªé…ç½®å¥½çš„beanäº†, å¯ä»¥ç›´æ¥ä½¿ç”¨. å¦‚ stringRedisTemplate, jdbcTemplate</span><br></pre></td></tr></table></figure>

<h5 id="Spring-Boot-æ˜¯å¦‚ä½•è‡ªåŠ¨æ‰«æmainæ–¹æ³•æ‰€åœ¨ç±»æ‰€åœ¨åŒ…çš„"><a href="#Spring-Boot-æ˜¯å¦‚ä½•è‡ªåŠ¨æ‰«æmainæ–¹æ³•æ‰€åœ¨ç±»æ‰€åœ¨åŒ…çš„" class="headerlink" title="Spring Boot æ˜¯å¦‚ä½•è‡ªåŠ¨æ‰«æmainæ–¹æ³•æ‰€åœ¨ç±»æ‰€åœ¨åŒ…çš„?"></a>Spring Boot æ˜¯å¦‚ä½•è‡ªåŠ¨æ‰«æmainæ–¹æ³•æ‰€åœ¨ç±»æ‰€åœ¨åŒ…çš„?</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) é¦–å…ˆæ˜¯ @SpringBootApplication å¯ç”¨äº† @EnableAutoConfiguration</span><br><span class="line">2) @EnableAutoConfiguration åˆä½¿ç”¨ @AutoConfigurationPackage</span><br><span class="line">3) @AutoConfigurationPackage ä¸­çš„ @Import ä¼šè¢«è§£æ, Registrar.class çš„registerBeanDefinitionsä¼šè¢«æ‰§è¡Œ</span><br><span class="line">4) æœ€ç»ˆæ ¹æ®å¸¦æœ‰ @SpringBootApplication çš„ç±»å¯¹åº”çš„åŒ…å, ç„¶åè‡ªåŠ¨æ‰«æåˆ°å®¹å™¨ä¸­, æ•ˆæœåŒ @ComponentScan</span><br></pre></td></tr></table></figure>

<h5 id="application-properties-æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°Environmentä¸­çš„"><a href="#application-properties-æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°Environmentä¸­çš„" class="headerlink" title="application.properties æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°Environmentä¸­çš„?"></a><code>application.properties</code> æ˜¯å¦‚ä½•è¢«åŠ è½½åˆ°Environmentä¸­çš„?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) runæ–¹æ³•ä¸­åˆ›å»ºäº†Environmentå¯¹è±¡, å½“åˆå§‹åŒ–å¥½ä¸€äº›ä¸œè¥¿åä¼šè§¦å‘äº‹ä»¶</span><br><span class="line"><span class="number">2</span>) é€šè¿‡ SpringApplicationRunListeners çš„ environmentPrepared() å‘ŠçŸ¥ç›‘å¬è€…</span><br><span class="line"><span class="number">3</span>) é»˜è®¤å­˜åœ¨ spring.factories ä¸­çš„ EventPublishingRunListener ç›‘å¬è€…è´Ÿè´£è½¬å‘äº‹ä»¶</span><br><span class="line"><span class="number">4</span>) äº‹ä»¶è¢«è½¬å‘åˆ° ApplicationListener ä¸‹çš„ç›‘å¬è€…æ¥å¤„ç†</span><br><span class="line"><span class="number">5</span>) ç›‘å¬è€…é…ç½®åœ¨ spring.factories ä¸­, å…¶ä¸­ ConfigFileApplicationListener ç›‘å¬äº†æ­¤äº‹ä»¶</span><br><span class="line"><span class="number">6</span>) æ­¤ç›‘å¬è€…æ¥å— ApplicationEnvironmentPreparedEvent äº‹ä»¶å</span><br><span class="line"><span class="number">7</span>) åŠ è½½ä¸€äº› postProcessor ä¸“é—¨ç”¨äºå¤„ç† environment å¯¹è±¡çš„ postProcessor</span><br><span class="line"><span class="number">8</span>) å…¶ä»–çš„ postProcessor æš‚æ—¶ä¸ç®¡, çœŸæ­£åšäº†åŠ è½½çš„æ˜¯ postProcessors.add(<span class="keyword">this</span>); è‡ªå·±çš„å®ç°</span><br><span class="line"><span class="number">9</span>) è‡ªå·±çš„å¤„ç†æ–¹æ³•æ˜¯: addPropertySources(), æ­¤æ–¹æ³•å°†ä¼šæ‰«ææŒ‡å®šçš„è·¯å¾„ä¸‹æŒ‡å®šçš„æŸäº›æ–‡ä»¶</span><br><span class="line"><span class="number">10</span>) ç„¶åä½¿ç”¨ spring.factories ä¸‹çš„ PropertySourceLoader ä¸€ä¸€å°è¯•è§£æ</span><br><span class="line"><span class="number">11</span>) æ–‡ä»¶å­˜åœ¨ä¸”è§£ææ­£ç¡®åˆ™åŠ å…¥åˆ° environment çš„ propertySources.</span><br><span class="line">	æŸäº›è·¯å¾„: getSearchLocations() ,é»˜è®¤: classpath:/,classpath:/config/ ...</span><br><span class="line">	æŸäº›æ–‡ä»¶: getSearchNames() ,é»˜è®¤: application</span><br><span class="line"></span><br><span class="line">TIPS: </span><br><span class="line">PropertySourceLoader æœ‰ PropertiesPropertySourceLoader/YamlPropertySourceLoader</span><br><span class="line">ä¸€ä¸ªå°è¯•åç¼€æœ‰ xml/properties, å¦ä¸€ä¸ªæ˜¯ yml/yaml, æ‰€ä»¥æ‰€æœ‰å¯èƒ½æ€§æœ‰:</span><br><span class="line">    classpath:/application.xml; classpath:/application.properties</span><br><span class="line">	classpath:/application.yml; classpath:/application.yaml</span><br><span class="line">    ......</span><br></pre></td></tr></table></figure>

<h5 id="SpringApplication-run-å¦‚ä½•åŠ è½½-tomcat-çš„"><a href="#SpringApplication-run-å¦‚ä½•åŠ è½½-tomcat-çš„" class="headerlink" title="SpringApplication.run() å¦‚ä½•åŠ è½½ tomcat çš„?"></a><code>SpringApplication.run()</code> å¦‚ä½•åŠ è½½ tomcat çš„?</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>) boot çš„ run é‡Œé¢ä¼šåˆ›å»º applicationContext, å¦‚æ˜¯ webApplicationType = SERVLET, åˆ™å®ç°ç±»ä¸º AnnotationConfigServletWebServerApplicationContext</span><br><span class="line">    å¦å¤–ä¸€æ, webApplicationType æ˜¯æ ¹æ® classpath ä¸‹æ˜¯å¦æœ‰å“ªäº›ç±»æ¥æ¨æ–­çš„.</span><br><span class="line"><span class="number">2</span>) è¿™ä¸ªç±»ç»§æ‰¿äº† ServletWebServerApplicationContext</span><br><span class="line"><span class="number">3</span>) ServletWebServerApplicationContext å®ç°äº† onRefresh()</span><br><span class="line"><span class="number">4</span>) onRefresh() è°ƒç”¨äº† createWebServer()</span><br><span class="line"><span class="number">5</span>) createWebServer() ä½¿ç”¨ ServletWebServerFactory.getWebServer() è·å– webServer å¯¹è±¡</span><br><span class="line"><span class="number">6</span>) ServletWebServerFactory ä¼šè¢« ServletWebServerFactoryAutoConfiguration å¼•å…¥</span><br><span class="line">    è¯¦ç»†è§ ServletWebServerFactoryConfiguration.EmbeddedTomcat<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">7) å¼•å…¥åè°ƒç”¨ <span class="title">getWebServer</span>(), å¤§æ¦‚ä¸º <span class="title">new</span> <span class="title">Tomcat</span>(), è®¾ç½®å±æ€§, ç„¶åå¯åŠ¨.</span></span><br><span class="line"><span class="class">8) è‡³æ­¤, <span class="title">run</span>() å¯åŠ¨äº† <span class="title">tomcat</span> æˆ– <span class="title">jetty</span>/<span class="title">undertow</span>.</span></span><br><span class="line"><span class="class"> </span></span><br><span class="line">TIPS:</span><br><span class="line">spring ä½¿ç”¨å·¥å‚æ¨¡å¼è·å–webServer, ç„¶åå·¥å‚åˆé€šè¿‡AutoConfigurationè‡ªåŠ¨æ³¨å…¥(è¿˜ä¼šåˆ¤æ–­Condition).</span><br><span class="line">    è¿™æ ·å¦‚æœæ–°å¢ä¸€ç§ webServer, åªéœ€è¦åœ¨å†™ä¸€ä¸ª AutoConfiguration æ³¨å…¥ä¸€ä¸ª å·¥å‚å³å¯. éå¸¸çµæ´».</span><br></pre></td></tr></table></figure>





<h3 id="Spring-MVC-æºç "><a href="#Spring-MVC-æºç " class="headerlink" title="Spring MVC æºç "></a>Spring MVC æºç </h3><h4 id="å…³é”®ç±»è§£æ-1"><a href="#å…³é”®ç±»è§£æ-1" class="headerlink" title="å…³é”®ç±»è§£æ"></a>å…³é”®ç±»è§£æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">WebMvcConfigurationSupport</span><br><span class="line">	é»˜è®¤æ³¨å†Œäº†å¾ˆå¤šä¸œè¥¿,å¦‚HandlerMappingå‡ ä¸ªå®ç°, HandlerAdaptorå‡ ä¸ªå®ç°</span><br><span class="line"></span><br><span class="line">HandlerMapping</span><br><span class="line">	æ·»åŠ å®¹å™¨å†…æ‰€æœ‰å¸¦æœ‰RequestMapingçš„ç±»çš„å…¬å¼€æ–¹æ³•åˆ° mappings ä¸­</span><br><span class="line">		(AbstractHandlerMethodMapping#afterPropertiesSetä¸­)</span><br><span class="line">    æ ¹æ®requestçš„uriæŸ¥æ‰¾å¯¹åº”çš„HandlerMethod, æ­¥éª¤æ¦‚è¿°:</span><br><span class="line">    	æŠŠRequestMappingæ³¨è§£å†…çš„pathä½œä¸ºkeyä¿æŒåˆ°ä¸€ä¸ªmap1</span><br><span class="line">    	å…¶ä»–ä¿¡æ¯å°è£…æˆmappingä½œä¸ºkeyä¹Ÿä¿æŒåˆ°å¦ä¸€ä¸ªmap2</span><br><span class="line">    	æ ¹æ®uriå» map1 è·å– mapping, å†æ ¹æ®mapping è·å– HandlerMethod</span><br><span class="line">    	å°è£…æˆMatchå¯¹è±¡, ä¸å…¶ä»–åŒ¹é…å¯¹è±¡åšæ¯”è¾ƒå, è¿”å› HandlerMethod</span><br><span class="line"></span><br><span class="line">HandlerAdapter</span><br><span class="line">	åˆå§‹åŒ–å‚æ•°è§£æï¼Œè¿”å›å€¼è§£æç­‰</span><br><span class="line">		(RequestMappingHandlerAdapter#afterPropertiesSet)</span><br><span class="line">	æ ¹æ®Handleç¡®å®šå¯¹åº”çš„HandlerAdapter, ç„¶åæ‰§è¡Œè¿™ä¸ª handler</span><br><span class="line">    å¦‚RequestMappingHandlerAdapter åˆ™è´Ÿè´£æ‰§è¡Œ HandlerMethod</span><br><span class="line">    	ç®€å•è¯´å°±æ˜¯å°è£… HandlerMethod, æ ¹æ®å‚æ•°å€¼è®¾ç½®å‚æ•°, ç„¶åè°ƒç”¨æ–¹æ³•, å†å¤„ç†è¿”å›å€¼å°è£…æˆModelAndView</span><br><span class="line">    å¦å¤–ï¼Œ è¿™é‡Œå¦‚æœä½¿ç”¨äº†@ResponseBodyï¼Œä¼šè¿›å…¥ RequestResponseBodyMethodProcessor</span><br><span class="line">    	ç„¶åä½¿ç”¨messageConvertersï¼ˆjsonï¼‰å†™å…¥åˆ°å“åº”æµ</span><br><span class="line">    	æœ€åmvä¹Ÿç›´æ¥è¿”å›nullï¼Œ ä¸éœ€è¦renderäº†ã€‚</span><br><span class="line"></span><br><span class="line">ViewResolver</span><br><span class="line">	è´Ÿè´£å°†ModelAndViewè§£ææˆHTML, å¦‚JSP, FreeMarker</span><br><span class="line"></span><br><span class="line">HandlerExecutionChian</span><br><span class="line">	ç®¡ç†æ‹¦æˆªå™¨å’Œå°è£…Handler, è´Ÿè´£æ‹¦æˆªå™¨çš„å®é™…è°ƒç”¨é€»è¾‘å®ç°</span><br><span class="line">	</span><br><span class="line">DispatcherServlet</span><br><span class="line">	è°ƒåº¦æ•´ä¸ªHTTPè¯·æ±‚å“åº”æµç¨‹, è°ƒç”¨å„ä¸ªå­ç»„ä»¶è´Ÿè´£æ‰§è¡Œå¤„ç†æ–¹æ³•, è§£æè§†å›¾, å¤„ç†å¼‚å¸¸ç­‰.</span><br></pre></td></tr></table></figure>

<h4 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">GET</span><br><span class="line">HttpServlet#service()</span><br><span class="line">HttpServlet#doGet()</span><br><span class="line">FrameworkServlet#doGet()</span><br><span class="line">FrameworkServlet#processRequest()</span><br><span class="line">FrameworkServlet#doService()</span><br><span class="line">DispatcherServlet#doService()</span><br><span class="line">DispatcherServlet#doDispatch()</span><br><span class="line">	è°ƒç”¨å®¹å™¨å†…æ‰€æœ‰çš„HandlerMappingçš„å®ç°ç±»çš„getHandleræ–¹æ³•, è¿”å›HandlerExecutionChain</span><br><span class="line">	è°ƒç”¨å®¹å™¨å†…æ‰€æœ‰çš„HandlerAdaptorçš„å®ç°ç±»å¯»æ‰¾é€‚åˆçš„å½“å‰Hanlderçš„HandlerAdaptor</span><br><span class="line">	æ‰§è¡Œæ‹¦æˆªå™¨çš„ preHandle æ–¹æ³•, å¹¶æ ¹æ®è¿”å›ç»“æœåˆ¤æ–­æ˜¯å¦æ¥ç»­æ‰§è¡Œ</span><br><span class="line">	HandlerAdaptoræ‰§è¡Œhandleæ–¹æ³•</span><br><span class="line">	è¿›å…¥RequestMappingHandlerAdaptoræ‰§è¡Œhandle-&gt;handlerInternal-&gt;invokeHandlerMethod</span><br><span class="line">	ç”ŸæˆServletInvocableHandlerMethod(å°±æ˜¯å®ç°äº†åå°„è°ƒç”¨æ–¹æ³•å’Œè®¾ç½®å‚æ•°,å¤„ç†è¿”å›å€¼ç­‰æ“ä½œ)</span><br><span class="line">	è°ƒç”¨invokeAndHandle--&gt;invokeForRequest</span><br><span class="line">		å…¶ä¸­getMethodArgumentValuesæŒ¨ä¸ªè°ƒç”¨HandlerMethodArgumentResolverè·å–å‚æ•°å€¼</span><br><span class="line">	ç„¶åæ‰§è¡Œ doInvoke, åˆ©ç”¨åå°„æŠ€æœ¯è°ƒç”¨ Method, method.invoke(obj, args);</span><br><span class="line">	æ‰§è¡Œå®Œå, è¿”å›ç»“æœ, å›åˆ° invokeAndHandle è°ƒç”¨ returnValueHandlers å¤„ç†è¿”å›ç»“æœ</span><br><span class="line">	è¿”å›å å›åˆ° invokeHandlerMethod, è°ƒç”¨ getModelAndView è·å–é€šç”¨çš„è¿”å›å€¼(å¯èƒ½æ˜¯ç©º)</span><br><span class="line">	è¿”å›ModelAndViewå, å›åˆ°doDispatch, è®¾ç½®é»˜è®¤viewName (mvä¸ºç©ºåˆ™ä¸éœ€è¦è®¾ç½®)</span><br><span class="line">	æ‰§è¡Œæ‹¦æˆªå™¨çš„ postHandle æ–¹æ³•</span><br><span class="line">	processDispatchResult ä¸­çš„ render è§£æè§†å›¾åé€šè¿‡response å“åº”è¿™ä¸ªview</span><br><span class="line">	æ ¹æ®å¼‚å¸¸æƒ…å†µæ‰§è¡Œå¼‚å¸¸å¤„ç†å™¨, ä»¥åŠæ‰§è¡Œæ‹¦æˆªå™¨çš„ afterCompletion æ–¹æ³•</span><br></pre></td></tr></table></figure>

<h4 id="æ‹¦æˆªå™¨åŸç†"><a href="#æ‹¦æˆªå™¨åŸç†" class="headerlink" title="æ‹¦æˆªå™¨åŸç†"></a>æ‹¦æˆªå™¨åŸç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ä½•æ—¶åŠ å…¥?</span><br><span class="line">	ä»WebMvcConfigurationSupportçš„å­ç±»ä¸­è°ƒç”¨addInterceptors </span><br><span class="line">	æ·»åŠ ä¸€äº›æ‹¦æˆªå™¨å’Œæ‹¦æˆªå™¨çš„è·¯å¾„é…ç½® InterceptorRegistry å’Œ MappedInterceptor</span><br><span class="line">    å®ç°æ‹¦æˆªå™¨è·¯å¾„åŒ¹é…, åœ¨ new HandlerExecutionChian æ—¶åˆ¤æ–­</span><br><span class="line"></span><br><span class="line">ä½•æ—¶æ‰§è¡Œ?</span><br><span class="line">	DispatcherServlet è´Ÿè´£åœ¨æ­£ç¡®çš„æ—¶æœºè°ƒç”¨ HandlerExecutionChian æ¥è°ƒç”¨ preHanlde ç­‰æ–¹æ³•.</span><br><span class="line">	æ‹¿åˆ° HandlerExecutionChian åè°ƒç”¨ preHanlde</span><br><span class="line">	HandlerAdapteræ‰§è¡Œå®Œhandlerå, è°ƒç”¨ postHandle</span><br><span class="line">	è§£æè§†å›¾å¹¶æ¸²æŸ“åˆ°responseä¹‹å, è°ƒç”¨ afterCompletion</span><br><span class="line">	å¦‚æœä¸­é€”å‡ºç°å¼‚å¸¸, æˆ–preHandleæå‰ç»“æŸ, åˆ™ä¹Ÿè°ƒç”¨afterCompletion</span><br><span class="line"></span><br><span class="line">æ€»ç»“</span><br><span class="line">	DispatcherServlet å»è°ƒç”¨ HandlerExecutionChianå»è°ƒç”¨ æ‹¦æˆªå™¨å…·ä½“æ–¹æ³•. </span><br><span class="line">	å¤æ‚ç‚¹æ˜¯æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨åˆ°è¢«åŠ å…¥åˆ°HandlerExecutionChianæ¯”è¾ƒå¤æ‚ä¸€ç‚¹, ä»¥åŠå¸¦è·¯å¾„åŒ¹é…çš„æ‹¦æˆªå™¨å®ç°ç•¥å¤æ‚ä¸€äº›.</span><br></pre></td></tr></table></figure>



<h3 id="Mybatis-æºç "><a href="#Mybatis-æºç " class="headerlink" title="Mybatis æºç "></a><code>Mybatis</code> æºç </h3><h4 id="å…³é”®ç±»è§£æ-2"><a href="#å…³é”®ç±»è§£æ-2" class="headerlink" title="å…³é”®ç±»è§£æ"></a>å…³é”®ç±»è§£æ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Configuration</span><br><span class="line">	ä½œç”¨: è§£æå’Œä¿å­˜å¤§é…ç½®(mybatiså…¨å±€é…ç½®,å¦‚æ•°æ®åº“è¿æ¥, åˆ«åç­‰), å°é…ç½®(æ¯ä¸ªmapperæ–‡ä»¶)ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">MapperProxy, MapperMethod</span><br><span class="line">	ä½œç”¨: ç”ŸæˆdaoImplä»£ç†å¯¹è±¡å’Œå®ç°æ¥å£æ–¹æ³•: è°ƒç”¨sqlSession æ“ä½œæ–¹æ³•</span><br><span class="line"></span><br><span class="line">Executor</span><br><span class="line">	ä½œç”¨: åè°ƒå’Œç®¡ç†StatementHandler, ParameterHandler, ResultSetHandler, è§£æmapperStatementé…ç½®ä¿¡æ¯æˆBoundSql.</span><br><span class="line"></span><br><span class="line">StatementHandler</span><br><span class="line">	ä½œç”¨: ç”ŸæˆpreparedStatmentå¯¹è±¡(JDBCçš„), è°ƒç”¨executeæ–¹æ³•.</span><br><span class="line"></span><br><span class="line">ParameterHandler</span><br><span class="line">	ä½œç”¨: ç®¡ç†å¹¶ä½¿ç”¨TypeHandlerä¸ºpreparedStatmentå¯¹è±¡è®¾ç½®å‚æ•°,</span><br><span class="line"></span><br><span class="line">ResultSetHandler</span><br><span class="line">	ä½œç”¨: å°†ResultSetç»“æœé›†è½¬æˆæ¥å£è¿”å›å€¼è®¤è¯†çš„æ•°æ®, è´Ÿè´£å»¶è¿ŸåŠ è½½.</span><br></pre></td></tr></table></figure>

<h4 id="ç”Ÿå‘½å‘¨æœŸä¸æ‰§è¡Œæµç¨‹"><a href="#ç”Ÿå‘½å‘¨æœŸä¸æ‰§è¡Œæµç¨‹" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸä¸æ‰§è¡Œæµç¨‹"></a>ç”Ÿå‘½å‘¨æœŸä¸æ‰§è¡Œæµç¨‹</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.è¯»å–é…ç½®æ–‡ä»¶, è§£æxml(æˆ–properties)è·å¾—é…ç½®ä¿¡æ¯(æ•°æ®åº“é…ç½®å’ŒmapperSqlç­‰) Configuration</span><br><span class="line">2.è·å–æ•°æ®åº“è¿æ¥, å¼€å¯äº‹åŠ¡, å‡†å¤‡æ‰§è¡Œsql (openSession)</span><br><span class="line">3.ä½¿ç”¨åŠ¨æ€ä»£ç†æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»</span><br><span class="line">4.ä»£ç†ç±»æ ¹æ®ä»£ç†æ–¹æ³•å¯¹åº”çš„mapperStatementç±»å‹è°ƒç”¨sqlSessionçš„insert,update,delete,selectXxxæ–¹æ³• (MapperProxy, MapperMethod)</span><br><span class="line">4.sqlSessionè°ƒç”¨Executoræ‰§è¡Œsql (Exector, SimpleExecutor, CachingExecutor)</span><br><span class="line">5.Executor ç”ŸæˆStatementHandlerå¯¹è±¡å¹¶è§£æxmlä¸­sqlå‚æ•°, å†ä½¿ç”¨ParameterHandlerè®¾ç½®å‚æ•°. (BaseExecutor, StatmentHandler, ParameterHandler, TypeHandler å‰ä¸‰ä¸ªå¯è¢«æ’ä»¶æ‹¦æˆªä»»æ„æ–¹æ³•)</span><br><span class="line">6.æœ€åä½¿ç”¨OGNLè¡¨è¾¾å¼è§£æåº“å¯¹ if,foreach,whereç­‰æ ‡ç­¾è§£æç”Ÿæˆæœ€æ€»sql (ONGL)</span><br><span class="line">7.æ‰§è¡Œsqlåè·å¾—resultSet, ä½¿ç”¨ ResultSetHandler å¤„ç†åè¿”å›ç»“æœ(resultMap, resultTypeçš„å¤„ç†åœ¨è¿™é‡Œ) (ResultSetHandler å¯è¢«æ’ä»¶æ‹¦æˆªä»»æ„æ–¹æ³•)</span><br><span class="line">8.æ ¹æ®äº‹åŠ¡é…ç½®æäº¤äº‹åŠ¡(è‡ªåŠ¨æäº¤), ä¿å­˜ä¸€çº§ç¼“å­˜</span><br><span class="line">9.å¦‚å¼€å¯äºŒçº§ç¼“å­˜, Executorè¿˜ä¼šè¢«è£…é¥°å™¨æ¨¡å¼åŒ…è£…ä¸€å±‚, å°†ç»“æœç¼“å­˜åˆ°MapperStatementçš„cacheå˜é‡ä¸­.</span><br><span class="line"></span><br><span class="line">TIPS:</span><br><span class="line">1.æ’ä»¶çš„ä½¿ç”¨å®åœ¨Executor, StatementHandler, ParameterHandler, ResultSetHandlerè¿™å‡ ä¸ªå¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™, ä½¿ç”¨jdkåŠ¨æ€ä»£ç†å°†é…ç½®é‡Œé…ç½®çš„å½¢æˆä»£ç†é“¾. è¿”å›ä»£ç†å¯¹è±¡, ä½†è°ƒç”¨æ–¹æ³•æ—¶, ä¼šåˆ¤æ–­æ˜¯å¦æ‹¦æˆªæ­¤æ–¹æ³•å¹¶æ‰§è¡Œæ’ä»¶çš„ä»£ç .</span><br></pre></td></tr></table></figure>

<h4 id="ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼"><a href="#ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼"></a>ä½¿ç”¨åˆ°çš„è®¾è®¡æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1.ä»£ç†æ¨¡å¼</span><br><span class="line">	MapperProxy ç”Ÿæˆ mapper å®ç°ç±» jdkä»£ç†</span><br><span class="line">	Plugin ç”Ÿæˆä»£ç†å¯¹è±¡å®ç°æ’ä»¶ jdkä»£ç†</span><br><span class="line">	ResultSetHandler(LazyLoad) cblib, javassist</span><br><span class="line">2.è£…é¥°è€…æ¨¡å¼</span><br><span class="line">	CachingExecutor: è£…é¥°SimpleExecutoræ·»åŠ äºŒçº§ç¼“å­˜åŠŸèƒ½</span><br><span class="line">	Cache,FifoCache... ä½¿ç”¨è£…é¥°è€…æ¨¡å¼ä¸ºç¼“å­˜æ·»åŠ ä¸åŒç‰¹æ€§(åŠŸèƒ½)</span><br><span class="line">3.é€‚é…å™¨æ¨¡å¼</span><br><span class="line">	StatementHandler</span><br><span class="line">4.è´£ä»»é“¾æ¨¡å¼</span><br><span class="line">	Interceptor(æ‹¦æˆªExecutorã€StatementHandlerã€ParameterHandlerã€ResultSetHandlerå¯¹è±¡)</span><br><span class="line">5.ç­–ç•¥æ¨¡å¼			</span><br><span class="line">	StatementHandler</span><br><span class="line">		PreparedStatementHandler,CallableStatementHandler,SimpleStatementHandler</span><br><span class="line">	Executor</span><br><span class="line">		SimpleExecutor,ReuseExecutor,BatchExecutor</span><br><span class="line">	TypeHandler</span><br><span class="line">		UnknownTypeHandler, IntegerTypeHandler, NStringTypeHandler</span><br><span class="line">6.å»ºé€ å™¨æ¨¡å¼</span><br><span class="line">	org.apache.ibatis.mapping.MappedStatement.Builder</span><br><span class="line">	org.apache.ibatis.builder.xml.XMLConfigBuilder</span><br></pre></td></tr></table></figure>

<h4 id="ä¸€çº§ç¼“å­˜å®ç°"><a href="#ä¸€çº§ç¼“å­˜å®ç°" class="headerlink" title="ä¸€çº§ç¼“å­˜å®ç°"></a>ä¸€çº§ç¼“å­˜å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.putæ—¶æœº: </span><br><span class="line">	org.apache.ibatis.executor.BaseExecutor#queryFromDatabase çš„ localCache.putObject(key, list)</span><br><span class="line">	</span><br><span class="line">2.getæ—¶æœº:</span><br><span class="line">	org.apache.ibatis.executor.BaseExecutor#query çš„ localCache.getObject(key)</span><br><span class="line">	</span><br><span class="line">3.å­˜åœ¨å“ªé‡Œ</span><br><span class="line">	org.apache.ibatis.executor.BaseExecutor#localCache</span><br><span class="line">	è¿™ä¸ªç±»æ¯æ¬¡openSessionä¼šæ–°å»ºä¸€ä¸ªExecutorå®ä¾‹</span><br></pre></td></tr></table></figure>

<h4 id="äºŒçº§ç¼“å­˜å®ç°"><a href="#äºŒçº§ç¼“å­˜å®ç°" class="headerlink" title="äºŒçº§ç¼“å­˜å®ç°"></a>äºŒçº§ç¼“å­˜å®ç°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.putæ—¶æœº: </span><br><span class="line">	org.apache.ibatis.executor.CachingExecutor#queryçš„tcm.putObject</span><br><span class="line">	ç„¶åå®é™…ä¸Šæ˜¯è°ƒç”¨äº†cacheçš„put, cacheå®é™…ä¸Šæ¥è‡ªConfigurationè§£æmapperæ–‡ä»¶æ—¶åˆ›å»ºçš„, å³åŒä¸€ä¸ªmapperå…±ç”¨åŒä¸€ä¸ªcache.</span><br><span class="line">	</span><br><span class="line">2.getæ—¶æœº:</span><br><span class="line">	org.apache.ibatis.executor.CachingExecutor#queryçš„tcm.getObject, cacheå®é™…æ˜¯: åŒä¸Š</span><br><span class="line"></span><br><span class="line">3.removeæ—¶æœº:</span><br><span class="line">	org.apache.ibatis.executor.CachingExecutor#flushCacheIfRequired</span><br><span class="line"></span><br><span class="line">æ³¨æ„äº‹é¡¹: ä¸Šè¿°æ—¶æœºéƒ½æ˜¯TransactionCacheManagerçš„è°ƒç”¨, è€ŒTransactionCacheManagerä¼šæ ¹æ®äº‹åŠ¡çš„æäº¤å’Œå›æ»šæ¥å¤„ç†ç¼“å­˜çš„å†™å…¥ä¸ç§»é™¤æ—¶æœº, å¦‚çœŸå®ç§»é™¤æ—¶æœºæ˜¯ä¸‹ä¸€æ¬¡commitè§¦å‘, çœŸå®å†™å…¥ä¹Ÿæ˜¯commitæ—¶è§¦å‘.</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">4.å­˜åœ¨å“ªé‡Œ</span><br><span class="line">	org.apache.ibatis.mapping.MappedStatement</span><br><span class="line">	ä¹Ÿç®—æ˜¯åœ¨ org.apache.ibatis.session.Configuration ä¸­</span><br></pre></td></tr></table></figure>





<h3 id="Mybatis-Plus"><a href="#Mybatis-Plus" class="headerlink" title="Mybatis-Plus"></a><code>Mybatis-Plus</code></h3><h2 id="IO-ç½‘ç»œ"><a href="#IO-ç½‘ç»œ" class="headerlink" title="IO / ç½‘ç»œ"></a>IO / ç½‘ç»œ</h2><h3 id="AIO-NIO-BIO"><a href="#AIO-NIO-BIO" class="headerlink" title="AIO, NIO, BIO"></a>AIO, NIO, BIO</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BIO: ä» jdk1.4 å‰, é‡‡ç”¨ ServerSocket API è¿›è¡Œç½‘ç»œè¿æ¥, æ‰€æœ‰æ“ä½œéƒ½æ˜¯é˜»å¡çš„(å¦‚ç›‘å¬, è¯»&#x2F;å†™)</span><br><span class="line">NIO: ä» jdk1.4 èµ·, å¯¹äºæ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¾èµ–äº‹ä»¶é©±åŠ¨, åªéœ€è¾ƒå°‘çš„çº¿ç¨‹å³å¯å¤„ç†å¤§é‡è¯·æ±‚</span><br><span class="line">AIO: jdk1.7 èµ·, åœ¨ NIO åŸºç¡€ä¸Šå®ç°å¼‚æ­¥, æ‰€æœ‰äº‹ä»¶é€šçŸ¥ç”±ç³»ç»Ÿé€šçŸ¥, è€ŒéNIO é‚£æ ·è½®è¯¢</span><br></pre></td></tr></table></figure>

<h3 id="TCP-UDP"><a href="#TCP-UDP" class="headerlink" title="TCP/UDP"></a>TCP/UDP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">TCP: æ˜¯é¢å‘è¿æ¥çš„åè®®, æ”¶å‘æ•°æ®å‰, å¿…é¡»å»ºç«‹å¯é çš„è¿æ¥(é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹)</span><br><span class="line">UDP: æ˜¯æ— è¿æ¥çš„åè®®, æ”¶å‘æ•°æ®ä¸éœ€è¦å»ºç«‹è¿æ¥(æ¡æ‰‹)</span><br><span class="line"></span><br><span class="line">åŒºåˆ«:</span><br><span class="line">é€Ÿåº¦: TCP æ»¡, UDP å¿«</span><br><span class="line">æ­£ç¡®æ€§&#x2F;å®Œæ•´æ€§: TCP å¥½, UDP æ— </span><br><span class="line">é¡ºåºæ€§: TCP å¥½, UDP æ— </span><br><span class="line"></span><br><span class="line">åº”ç”¨:</span><br><span class="line">TCP: æ–‡ä»¶ä¸‹è½½, HTTP, DNS, IM é€šè®¯</span><br><span class="line">UDP: ç½‘ç»œæ¸¸æˆ, ç›´æ’­æ¨æµ</span><br></pre></td></tr></table></figure>

<h3 id="Netty"><a href="#Netty" class="headerlink" title="Netty"></a>Netty</h3><blockquote>
<p>å°è£…äº†å¤æ‚çš„NIOæ¥å£, æä¾›äº†ç®€å•çš„ API å®ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯é«˜å¹¶å‘é€šè®¯, å¹¶å°è£…äº†å¾ˆå¤šå·¥å…·, å¦‚å¿ƒè·³è¶…æ—¶, åŠåŒ…å¤„ç†, websocket ç­‰.</p>
</blockquote>
<h2 id="æ•°æ®ç»“æ„ä¸ç®—æ³•"><a href="#æ•°æ®ç»“æ„ä¸ç®—æ³•" class="headerlink" title="æ•°æ®ç»“æ„ä¸ç®—æ³•"></a>æ•°æ®ç»“æ„ä¸ç®—æ³•</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><h4 id="é˜Ÿåˆ—-æ ˆ"><a href="#é˜Ÿåˆ—-æ ˆ" class="headerlink" title="é˜Ÿåˆ—,  æ ˆ"></a>é˜Ÿåˆ—,  æ ˆ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">é˜Ÿåˆ—: å…ˆè¿›å…ˆå‡º FIFO</span><br><span class="line">æ ˆ: LIFO</span><br></pre></td></tr></table></figure>

<h4 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å•å‘é“¾è¡¨: Node&#123;next: Node&#125;</span><br><span class="line">åŒå‘é“¾è¡¨: Node&#123;prev: Node, next: Node&#125;</span><br><span class="line">å¾ªç¯é“¾è¡¨: Node&#123;first: Node, last: Node, prev: Node, next: Node&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">äºŒå‰æ ‘:</span><br><span class="line">	å…ˆåºéå†: æ ¹-&gt;å·¦-&gt;å³</span><br><span class="line">	ä¸­åºéå†: å·¦-&gt;æ ¹-&gt;å³</span><br><span class="line">	ååºéå†: å·¦-&gt;å³-&gt;æ ¹</span><br><span class="line"></span><br><span class="line">çº¢é»‘æ ‘:</span><br><span class="line">	çº¢é»‘æ ‘æ˜¯ä¸€ç§å«æœ‰çº¢é»‘ç»“ç‚¹å¹¶èƒ½è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘.</span><br><span class="line">	ä»»æ„ä¸€ç»“ç‚¹åˆ°æ¯ä¸ªå¶å­ç»“ç‚¹çš„è·¯å¾„éƒ½åŒ…å«æ•°é‡ç›¸åŒçš„é»‘ç»“ç‚¹.</span><br><span class="line">	é€Ÿåº¦: O(log2 n) æœ€å: O(log n)</span><br><span class="line">	å¯¹æ¯” BST: æŸ¥æ‰¾æ›´å¿«, æ’å…¥æ›´æ…¢.</span><br><span class="line">	å¯¹æ¯” AVL: æŸ¥æ‰¾ç•¥æ…¢, æ’å…¥æ›´å¿«.</span><br><span class="line">	</span><br><span class="line">B+æ ‘:</span><br><span class="line">	æ‰€æœ‰è®°å½•èŠ‚ç‚¹å­˜æ”¾åœ¨å¶å­èŠ‚ç‚¹ä¸Šï¼Œä¸”æ˜¯é¡ºåºå­˜æ”¾ï¼Œç”±å„å¶å­èŠ‚ç‚¹æŒ‡é’ˆè¿›è¡Œè¿æ¥ã€‚</span><br><span class="line">	å¦‚æœä»æœ€å·¦è¾¹çš„å¶å­èŠ‚ç‚¹å¼€å§‹é¡ºåºéå†ï¼Œèƒ½å¾—åˆ°æ‰€æœ‰é”®å€¼çš„é¡ºåºæ’åºã€‚</span><br><span class="line">	æŸ¥æ‰¾é€Ÿåº¦å’Œæ ‘é«˜åº¦æœ‰å…³, å¦‚ MySQL æ ‘é«˜åº¦ä¸º 3, åˆ™æ€»æ˜¯æŸ¥è¯¢ 3 æ¬¡æ‰¾åˆ°å­èŠ‚ç‚¹, å³å¾—åˆ°æ•°æ®.</span><br></pre></td></tr></table></figure>



<h3 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h3><h4 id="æ’åºç®—æ³•"><a href="#æ’åºç®—æ³•" class="headerlink" title="æ’åºç®—æ³•"></a>æ’åºç®—æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">å¿«é€Ÿæ’åº: O(nlog(n))</span><br><span class="line">	å°†æ•°ç»„åˆ†ä¸º2åŠï¼Œå¹¶è®¡ç®—ä¸€ä¸ªä¸­é—´å€¼ï¼Œå°†å·¦è¾¹æ‰€æœ‰å¤§äºä¸­é—´å€¼çš„ç§»åˆ°å³è¾¹ï¼ŒæŠŠå³è¾¹æ‰€æœ‰å°äºä¸­é—´å€¼çš„ç§»åˆ°å·¦è¾¹ï¼Œ</span><br><span class="line">	ç„¶ååˆ†åˆ«å¯¹å·¦è¾¹å’Œå³è¾¹é€’å½’å¤„ç†ï¼ˆå†åˆ†2åŠï¼Œå†å–ä¸­é—´å€¼ï¼Œå†ç§»åŠ¨ï¼Œå†é€’å½’ï¼‰ï¼Œç›´åˆ°æ— éœ€é€’å½’ä¸ºæ­¢ã€‚</span><br><span class="line"></span><br><span class="line">å½’å¹¶æ’åº: O(nlog(n))</span><br><span class="line">	å°†æ•°ç»„ä¸æ–­ä¸¤ä¸¤æ‹†åˆ†ï¼Œç›´åˆ°æ— æ³•æ‹†åˆ†ï¼ˆåªæœ‰2ä¸ªå…ƒç´ ï¼‰æ—¶å¼€å§‹å¯¹æ‹†åˆ†åçš„å…ƒç´ è¿›è¡Œæ’åºï¼Œç„¶åä¸æ–­å›æº¯ï¼Œ</span><br><span class="line">	ä¸æ–­æ’åºï¼Œç›´åˆ°ç¬¬ä¸€æ¬¡æ‹†åˆ†ï¼Œå³æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æœ‰åºçš„äº†ã€‚æ’åºæ–¹å¼ä¸ºå…ˆå–ä¸¤ä¸ªéƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªä¸‹æ ‡ï¼Œ</span><br><span class="line">	äº’ç›¸åˆ¤æ–­ï¼Œè°å°è°æ”¾åˆ°æœ‰åºæ•°ç»„ä¸­ï¼Œç„¶åå°çš„é‚£ä¸ªä¸‹æ ‡ç§»ä½ï¼Œç»§ç»­åˆ¤æ–­ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªéƒ¨åˆ†æ‰€æœ‰å…ƒç´ å–å®Œï¼Œ</span><br><span class="line">	åˆ™å°†å¦ä¸€éƒ¨åˆ†å‰©ä½™å…ƒç´ æ‰¹é‡ç›´æ¥æ‹·è´åˆ°æœ‰åºæ•°ç»„å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">å†’æ³¡æ’åº: O(n^2) æœ€å¥½ O(n)</span><br><span class="line">	è¿›è¡Œ n - 1 è½®ï¼Œ æ¯è½®éå†æ•°ç»„ä¸¤ä¸¤æ¯”è¾ƒäº¤æ¢ï¼Œä»è€Œè¾¾åˆ°æŠŠæœ€å¤§çš„äº¤æ¢åˆ°æœ€åé¢ã€‚ä¸‹è½®éå†æ•°ç»„ä¸ªæ•°å‡ä¸€ã€‚</span><br><span class="line"></span><br><span class="line">é€‰æ‹©æ’åº: O(n^2)</span><br><span class="line">	è¿›è¡Œ n - 1 è½®ï¼Œæ¯è½®éå†é€‰æ‹©æ•°ç»„æœ€å°å€¼æ”¾åˆ°æœ€å‰é¢ï¼Œä¸‹è½®éå†æ•°ç»„ä¸ªæ•°å‡ä¸€</span><br><span class="line"></span><br><span class="line">æ’å…¥æ’åº: O(n^2) æœ€å¥½ O(n)</span><br><span class="line">	åˆ†2ä¸ªæ•°ç»„ï¼Œæœ‰åºå’Œæ— åºï¼Œå¼€å±€æœ‰åºé»˜è®¤å«æœ‰æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ— åºå«æœ‰å‰©ä½™çš„å…ƒç´ ã€‚</span><br><span class="line">	éå†æ— åºæ‰€æœ‰å…ƒç´ ï¼Œä»åå‘å‰æ¯”è¾ƒå¤§å°ï¼Œç„¶åè¿›è¡Œæ’å…¥åˆ°æœ‰åºæ•°ç»„ä¸­æˆ–å¯¹æ•°ç»„å…ƒç´ ç§»ä½ã€‚</span><br><span class="line"></span><br><span class="line">å¸Œå°”æ’åº: O(n^1.25)</span><br><span class="line">	å¯¹æ•°ç»„è¿›è¡Œåˆ†ç»„ï¼Œå¯¹æ¯ç»„ä½¿ç”¨æ’å…¥æ’åºçš„ç§»ä½è¿›è¡Œæ’åºï¼Œç¬¬ä¸€æ¬¡åˆ† æ•°ç»„é•¿åº¦&#x2F;2 ç»„ï¼Œ</span><br><span class="line">	ä¸‹ä¸€æ¬¡åˆ†ç»„ä¸ºæ•°ç»„é•¿åº¦&#x2F;2å†&#x2F;2ç»„ï¼Œè‹¥åˆ† é•¿åº¦&#x2F;2 ç»„ï¼Œåˆ™æ¯ç»„2ä¸ªï¼Œ è‹¥åˆ† é•¿åº¦&#x2F;2&#x2F;2 ç»„ï¼Œ</span><br><span class="line">	åˆ™æ¯ç»„ 2*2 ä¸ªï¼Œç›´åˆ°é•¿åº¦ä¸º1. è¿™æ˜¯ä¸€ä¸ªå°†æ•°ç»„åæ®µæ•°æ®å°½å¯èƒ½ä¸å‰æ®µæ•°æ®æ’åºï¼Œ</span><br><span class="line">	æ”¹è¿›æ’å…¥æ’åºåç«¯æ•°æ®è¿‡å°å¯¼è‡´ç§»ä½æ“ä½œè¿‡å¤šçš„é—®é¢˜ã€‚</span><br><span class="line"></span><br><span class="line">åŸºæ•°æ’åº: O(n)</span><br><span class="line">	åˆ›å»º10ä¸ªæ¡¶ï¼Œæ¯ä¸ªæ¡¶å¤§å°å‡ä¸ºæ•°ç»„é•¿åº¦ï¼Œç„¶åéå†æ•°ç»„ï¼Œä»å…ƒç´ çš„æœ€ä½ä½ï¼ˆä¸ªä½ï¼‰å¼€å§‹ï¼Œ</span><br><span class="line">	å–å‡ºå¹¶æ”¾åˆ°å¯¹åº”çš„æ¡¶ï¼ˆå¦‚ä¸ªä½æ˜¯8ï¼Œåˆ™æ”¾åˆ°ç¬¬8ä¸ªæ¡¶ä¸­ï¼‰ï¼Œæ”¾å®Œåï¼Œé¡ºåºéå†æ‰€æœ‰æ¡¶ï¼Œ</span><br><span class="line">	é¡ºåºå–å‡ºæ¯ä¸ªå…ƒç´ ï¼Œç»„æˆæ–°æ•°ç»„ï¼Œå†å°†æ–°æ•°ç»„æŒ‰ä»¥ä¸Šæµç¨‹å¤„ç†åä½ï¼Œå†ç™¾ä½ï¼Œç›´åˆ°æ•°ç»„ä¸­çš„æœ€å¤§æ•°çš„æœ€é«˜ä½ã€‚</span><br><span class="line">	</span><br><span class="line">å †æ’åºï¼š</span><br><span class="line">	ã€‚ã€‚ã€‚</span><br></pre></td></tr></table></figure>

<h4 id="ä¼˜åŒ–ç®—æ³•"><a href="#ä¼˜åŒ–ç®—æ³•" class="headerlink" title="ä¼˜åŒ–ç®—æ³•"></a>ä¼˜åŒ–ç®—æ³•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è´ªå¿ƒç®—æ³•</span><br><span class="line">çˆ¬å±±ç®—æ³•</span><br><span class="line">æ¨¡æ‹Ÿé€€ç«ç®—æ³•</span><br><span class="line">é—ä¼ ç®—æ³•</span><br><span class="line">èšç¾¤æœç´¢ç®—æ³•</span><br></pre></td></tr></table></figure>



<h2 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h2><h3 id="7-å¤§åŸåˆ™"><a href="#7-å¤§åŸåˆ™" class="headerlink" title="7 å¤§åŸåˆ™"></a>7 å¤§åŸåˆ™</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å•ä¸€èŒè´£: æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªèŒè´£(æˆ–æ¯ä¸ªæ–¹æ³•)</span><br><span class="line">æ¥å£éš”ç¦»: ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Š</span><br><span class="line">ä¾èµ–å€’è½¬: é«˜å±‚æ¨¡å—ä¸åº”ä¾èµ–ä½å±‚æ¨¡å—, äºŒè€…éƒ½åº”è¯¥ä¾èµ–æ¥å£è€Œéç»†èŠ‚. ç»†èŠ‚ä¾èµ–æŠ½è±¡, é¢å‘æ¥å£ç¼–ç¨‹</span><br><span class="line">é‡Œå¼æ›¿æ¢: å­ç±»åº”è¯¥åšåˆ°å¯ä»¥æ›¿æ¢çˆ¶ç±», åŠå­ç±»åº”å°½é‡ä¸é‡å†™çˆ¶ç±»æ–¹æ³•.</span><br><span class="line">å¼€é—­åŸåˆ™: å¯¹æä¾›è€…è€Œå·²å¯ä»¥ä¿®æ”¹, å¯¹ä½¿ç”¨è€…è€Œè¨€ä¸éœ€è¦ä¿®æ”¹(å³ä»£ç å…¼å®¹æ€§), å°½é‡ä½¿ç”¨æ‰©å±•å¢åŠ åŠŸèƒ½, è€Œéä¿®æ”¹åŸæœ‰ç±»</span><br><span class="line">è¿ªç±³ç‰¹æ³•åˆ™: ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°äº†è§£(æœ€å°‘çŸ¥é“åŸåˆ™)</span><br><span class="line">åˆæˆå¤ç”¨åŸåˆ™: ä¸€ä¸ªç±»ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„ä»£ç (æ–¹æ³•), å°½é‡ä½¿ç”¨åˆæˆ, è€Œä¸æ˜¯ç»§æ‰¿</span><br></pre></td></tr></table></figure>



<h3 id="åˆ›å»ºå‹"><a href="#åˆ›å»ºå‹" class="headerlink" title="åˆ›å»ºå‹"></a>åˆ›å»ºå‹</h3><h4 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">åŸç†: ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹ã€‚</span><br><span class="line"></span><br><span class="line">é¥¿æ±‰å¼:</span><br><span class="line">	é™æ€å¸¸é‡</span><br><span class="line">	é™æ€ä»£ç å—</span><br><span class="line">æ‡’æ±‰å¼:</span><br><span class="line">	ç›´æ¥åˆ¤æ–­(çº¿ç¨‹ä¸å®‰å…¨)</span><br><span class="line">	æ–¹æ³•åŠ  synchronized(çº¿ç¨‹å®‰å…¨, æ•ˆç‡ä½)</span><br><span class="line">	åˆ¤æ–­åå†åŒæ­¥(é”™è¯¯å†™æ³•)</span><br><span class="line">	åŒé‡åˆ¤æ–­(if-åŒæ­¥-if) (æ¨èå†™æ³•)</span><br><span class="line">	åŒ¿åé™æ€å†…éƒ¨ç±» (ç®€å•, æ¨è)</span><br><span class="line">	æšä¸¾(ç®€å•, ä½†å¯¹è±¡æ–¹æ³•å†™åœ¨æšä¸¾ä¸­, ç•¥æœ‰ä¸é€‚)</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">	java.lang.Runtime#getRuntime()</span><br><span class="line">	java.awt.Desktop#getDesktop()</span><br></pre></td></tr></table></figure>

<h4 id="åŸå‹æ¨¡å¼"><a href="#åŸå‹æ¨¡å¼" class="headerlink" title="åŸå‹æ¨¡å¼"></a>åŸå‹æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">åŸç†: ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œé€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°å¯¹è±¡.</span><br><span class="line">ç¤ºä¾‹: Java çš„ Object å¯¹è±¡çš„ clone æ–¹æ³•, java.util.Arrays.ArrayList#toArray()</span><br><span class="line"></span><br><span class="line">æµ…æ‹·è´: ä»…å¯¹åŸºç¡€ç±»å‹åŠå­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µæ‹·è´å€¼</span><br><span class="line">æ·±æ‹·è´: åŒæ—¶å¯¹å¼•ç”¨ç±»å‹(å¦‚æ•°ç»„,å¯¹è±¡) ä¹Ÿè¿›è¡Œæ‹·è´</span><br><span class="line"></span><br><span class="line">æ·±æ‹·è´å®ç°:</span><br><span class="line">1.é‡å†™ clone, ä¸€ä¸€å¤„ç†æ¯ä¸ªå¼•ç”¨å¯¹è±¡(è°ƒç”¨å¯¹è±¡çš„ clone), éº»çƒ¦, ä¸”è‹¥å¯¹è±¡ä¹‹é—´å…³ç³»å¤æ‚, å…¶ä¸­ä¸€ä¸ªæœªå®ç°æ·±æ‹·è´åˆ™å¯¼è‡´ bug.</span><br><span class="line">2.åˆ©ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–, å¦‚ Json, æˆ– Java è‡ªå¸¦çš„åºåˆ—åŒ–æ–¹å¼(äºŒè¿›åˆ¶)</span><br></pre></td></tr></table></figure>

<h4 id="åˆ›å»ºè€…æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼"><a href="#åˆ›å»ºè€…æ¨¡å¼-ç”Ÿæˆå™¨æ¨¡å¼" class="headerlink" title="åˆ›å»ºè€…æ¨¡å¼(ç”Ÿæˆå™¨æ¨¡å¼)"></a>åˆ›å»ºè€…æ¨¡å¼(ç”Ÿæˆå™¨æ¨¡å¼)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å°è£…ä¸€ä¸ªå¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œå¹¶å…è®¸æŒ‰æ­¥éª¤æ„é€ .</span><br><span class="line">	è‹¥å¯¹è±¡çš„ç”Ÿæˆè¿‡äºå¤æ‚(å­—æ®µæå¤šä¸”èµ‹å€¼è¿˜æœ‰ä¾èµ–å…³ç³», éœ€è¦é¡ºåºè°ƒç”¨), åˆ™å¯å°†èµ‹å€¼è¿‡ç¨‹å°è£…æˆä¸€ä¸ªbuild(), å¹¶æ”¾åˆ°ä¸€ä¸ª Builder ç±»ä¸­. æ­¤ç±»å¯¹å¤–æä¾›å„ä¸ªå­—æ®µçš„èµ‹å€¼æ–¹æ³•å¹¶å…ˆä¿å­˜èµ·æ¥, ç›´åˆ°è°ƒç”¨ build(), æ­¤æ–¹æ³•è¿”å›å¯¹è±¡å®ä¾‹. </span><br><span class="line">	ä½¿ç”¨æ­¤æ¨¡å¼, è°ƒç”¨è€…æ— éœ€å…³æ³¨æ„å»ºè¿‡ç¨‹, åªéœ€è®¾ç½®è‡ªå·±æƒ³è¦çš„å€¼, ç„¶åè°ƒç”¨ build() å³å¯å¾—åˆ°å¯¹è±¡å®ä¾‹. ä¸”è‹¥å¢åŠ æˆ–ä¿®æ”¹å­—æ®µ, æ„é€ è¿‡ç¨‹å˜åŒ–, è°ƒç”¨è€…æ— æ„ŸçŸ¥, æ— éœ€ä¿®æ”¹ä»£ç . ç¬¦åˆå¼€é—­åŸåˆ™.</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: StringBuilder, ä¸€äº›æ¡†æ¶çš„ ConfigurationBuilder(å¦‚ xmpp), ç”¨äºæ„å»ºé…ç½®.</span><br></pre></td></tr></table></figure>

<h4 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	åœ¨åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ä¸å‘å®¢æˆ·æš´éœ²å†…éƒ¨ç»†èŠ‚ï¼Œå¹¶æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„é€šç”¨æ¥å£ã€‚</span><br><span class="line">	æ­¤æ¨¡å¼å¯é¿å…å¤šä¸ªè°ƒç”¨è€…åˆ›å»ºå¯¹è±¡æ—¶åˆ¤æ–­åˆ›å»ºå“ªä¸ªå­ç±»çš„é‡å¤ä»£ç , ä¸”è‹¥å¤šä¸€ä¸ªå­ç±», è°ƒç”¨è€…æ— éœ€ä¿®æ”¹ä»£ç .</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: Spring ApplicationContext çš„ getBean æ–¹æ³•.</span><br></pre></td></tr></table></figure>

<h4 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»ã€‚</span><br><span class="line">	æ­¤æ¨¡å¼è§£å†³äº†ç®€å•å·¥å‚æ¯å¢åŠ ä¸€ä¸ªå­ç±»éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„é—®é¢˜.</span><br><span class="line">	æ­¤æ¨¡å¼å­˜åœ¨é—®é¢˜, è‹¥æ–°å¢ä¸€ä¸ªå­ç±», éœ€åŒæ—¶æ–°å¢ä¸€ä¸ªå­ç±»å·¥å‚, ç³»ç»Ÿå¤æ‚æ€§æ›´é«˜.</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: Calendar, NumberFormat</span><br></pre></td></tr></table></figure>

<h4 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	æä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»º ç›¸å…³çš„å¯¹è±¡å®¶æ—.</span><br><span class="line">  åŒä¸Š, ç”±å­ç±»å·¥å‚å†³å®šåˆ›å»ºå“ªäº›å¯¹è±¡.</span><br><span class="line">	æ­¤æ¨¡å¼æ˜¯å·¥å‚æ–¹æ³•çš„å‡çº§ç‰ˆ, ä¸åŒä¹‹å¤„åœ¨äºå®ƒåŒæ—¶åˆ›å»ºå¤šä¸ªç§ç±»çš„å¯¹è±¡(å·¥å‚ç±»å…·æœ‰å¤šä¸ªæ–¹æ³•).</span><br><span class="line">	æ­¤æ¨¡å¼å°†ä¸€ä¸ªå¯¹è±¡å®¶æ—çš„æ–°å»ºé›†åˆåˆ°ä¸€ä¸ªå·¥å‚ç±»åˆ›å»ºç®¡ç†, è¿™äº›å¯¹è±¡å®¶æ—ç›¸äº’ä¹‹é—´ä¸€èˆ¬æœ‰å…³è”, åœ¨åˆ›å»ºæ—¶å°±å¯ä»¥å¤„ç†è¿™äº›å…³è”. ä¸”å¯¹äº 2 ä¸ªå­ç±»å·¥å‚, ä¸€èˆ¬å¯ä»¥æ— ç¼åˆ‡æ¢, ä½¿å¾—ä¿®æ”¹ä»£ç æä¸ºæ–¹ä¾¿(å³æ¢ä¸€ä¸ªå­ç±»å·¥å‚).</span><br><span class="line">	æ­¤æ¨¡å¼åœ¨æ–°å¢ä¸€ä¸ªå¯¹è±¡å®¶æ—çš„æˆå‘˜æ—¶éå¸¸éº»çƒ¦(å³æ‰€æœ‰å·¥å‚ç±»éœ€è¦æ–°å¢ä¸€ä¸ªæ–¹æ³•), ä½†å†æ–°å¢ä¸€ç±»å¯¹è±¡å®¶æ—æ—¶æ¯”è¾ƒç®€å•(å³æ–°å¢ä¸€ä¸ªå­ç±»å·¥å‚).</span><br></pre></td></tr></table></figure>



<h3 id="ç»“æ„å‹"><a href="#ç»“æ„å‹" class="headerlink" title="ç»“æ„å‹"></a>ç»“æ„å‹</h3><h4 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	æŠŠä¸€ä¸ªæ¥å£è½¬æ¢æˆå¦ä¸€ä¸ªç”¨æˆ·éœ€è¦çš„æ¥å£.</span><br><span class="line">	å®šä¹‰ä¸€ä¸ªç±», å®ç°ç”¨æˆ·éœ€è¦çš„æ¥å£, å¹¶èšåˆä¸€ä¸ªéœ€è¦è½¬æ¢çš„æ¥å£å¯¹è±¡, åœ¨é‡å†™çš„æ–¹æ³•(ç”¨æˆ·éœ€è¦çš„æ–¹æ³•)ä¸­è°ƒç”¨èšåˆçš„å¯¹è±¡çš„æ–¹æ³•, è‹¥éœ€è¦è¿”å›å€¼, ä¸”è¿”å›å€¼ç±»å‹ä¸ä¸€è‡´, åˆ™è¿˜éœ€è¦åœ¨æ–¹æ³•ä¸­å¤„ç†ä¸€ç•ª, ç„¶åè¿”å›. è¿™ä¸ªè¿‡ç¨‹å«åšé€‚é….è¿™ä¸ªç±»å«åšé€‚é…å™¨ç±».</span><br><span class="line">	ä½¿ç”¨æ­¤æ¨¡å¼å¯å¯¹ä¸€äº›è€æ—§æ¥å£é€‚é…å…¼å®¹.</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: java.util.Arrays#asList() å°†æ•°ç»„é€‚é…æˆ List, Spring MVCçš„ HandlerAdapter</span><br></pre></td></tr></table></figure>

<h4 id="è£…é¥°è€…æ¨¡å¼"><a href="#è£…é¥°è€…æ¨¡å¼" class="headerlink" title="è£…é¥°è€…æ¨¡å¼"></a>è£…é¥°è€…æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å°†ä¸€ä¸ªæˆ–å¤šä¸ªåŠŸèƒ½(æ–¹æ³•)åŠ¨æ€çš„æ–°å¢åˆ°ä¸€ä¸ªç±»ä¸­.</span><br><span class="line">	æŠŠéœ€è¦æ–°å¢åŠŸèƒ½ç±»ç§°ä¸º A,å®šä¹‰ä¸€ä¸ªç±»B,å®ç°Açš„ä¸Šå±‚æ¥å£, å¹¶èšåˆä¸€ä¸ªA çš„å®ä¾‹å¯¹è±¡, Bç±»å®ç°çš„æ¥å£ä¸­, å¯¹å…¶ä»–ä¸å…³å¿ƒçš„æ–¹æ³•ç›´æ¥è°ƒç”¨èšåˆçš„å¯¹è±¡çš„æ–¹æ³•. å¯¹äºå…³å¿ƒçš„æ–¹æ³•åˆ™å¯ä»¥åœ¨è°ƒç”¨å‰åè¿›è¡ŒåŠ æ–™å¤„ç†(å¦‚ä¸€ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæ•°, å¯ä»¥åœ¨åŸæ¥çš„è¿”å›å€¼ä¸Šä¹˜ä»¥ 2), åŒæ—¶, Bç±»ä¹Ÿå¯ä»¥æ–°å¢ä¸€äº›å…¶ä»–æ–¹æ³•, è¿™äº›æ–¹æ³•å°±æ˜¯å¤šå‡ºçš„åŠŸèƒ½. Bç±»å°±æ˜¯è£…é¥°è€…ç±», Aå°±æ˜¯è¢«è£…é¥°ç±».</span><br><span class="line">	æ­¤æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯, è£…é¥°ç±»ä¹Ÿå¯ä»¥å½“åšè¢«è£…é¥°ç±», ç„¶åå†æ¥ä¸€å±‚è£…é¥°, å¯ä»¥æ— é™çš„è£…é¥°.</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: java IO æµ</span><br></pre></td></tr></table></figure>

<h4 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	æ§åˆ¶å…¶ä»–å¯¹è±¡çš„è®¿é—®(æ–¹æ³•çº§), å°†ä¸€äº›å‰ç½®æˆ–åç½®çš„å¤„ç†, é€šè¿‡ä»£ç†å¯¹è±¡æ³¨å…¥åˆ°ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å‰å. é¢å‘åˆ‡é¢ç¼–ç¨‹.</span><br><span class="line"></span><br><span class="line">ç±»å‹:</span><br><span class="line">	é™æ€ä»£ç†: å®šä¹‰ä¸€ä¸ªä»£ç†ç±»å®ç°ç›®æ ‡å¯¹è±¡çš„ä¸Šå±‚æ¥å£, å¹¶èšåˆä¸€ä¸ªç›®æ ‡å¯¹è±¡, é‡å†™æ–¹æ³•æ—¶å°†å‰ç½®åç½®å¤„ç†åŠ ä¸Š.</span><br><span class="line">	åŠ¨æ€ä»£ç†: </span><br><span class="line">		JDK åŠ¨æ€ä»£ç†: éœ€è¦ç›®æ ‡å¯¹è±¡æœ‰ä¸Šå±‚æ¥å£(è‡ªç„¶æ¥å£å†…çš„æ–¹æ³•æ‰å¯ä»¥ä»£ç†) </span><br><span class="line">			ä½¿ç”¨java.lang.reflect.Proxy#getProxyClass</span><br><span class="line">		CGLIB åŠ¨æ€ä»£ç†: æ˜¯ä¸ªç±»å°±è¡Œ. å®ç°åŸç†æ˜¯ ASM æ¡†æ¶åŠ¨æ€ç”Ÿæˆç›®æ ‡å¯¹è±¡ç±»çš„å­ç±»å­—èŠ‚ç , ç„¶åé€šè¿‡åå°„ç”Ÿæˆä»£ç†å¯¹è±¡.</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: Spring AOP</span><br></pre></td></tr></table></figure>

<h4 id="æ¡¥æ¥æ¨¡å¼"><a href="#æ¡¥æ¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¥æ¨¡å¼"></a>æ¡¥æ¥æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å°†æŠ½è±¡ä¸å®ç°åˆ†ç¦»å¼€æ¥ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚</span><br><span class="line">	æ¡¥æ¥çš„å«ä¹‰æ˜¯, ä¸€ä¸ªæ¡¥, æ”¾åœ¨å“ªé‡Œéƒ½æœ‰æ¡¥çš„ 2 è¾¹, æ¡¥çš„ 2 è¾¹å¯ä»¥å˜åŒ–, ä½†æ¡¥å§‹ç»ˆä¸å˜. æ­¤å¤„, æ¡¥ä»£è¡¨ä¸€ä¸ªæ“ä½œ(å¦‚æ‰‹æœºä¸Šè¿è¡Œè½¯ä»¶), 2 è¾¹ä»£è¡¨ ä¸€ä¸ªæ“ä½œçš„ 2 ä¸ªç»´åº¦(å¦‚æ‰‹æœºå’Œè½¯ä»¶). åŒæ—¶, æ¡¥æ¥åçš„æ“ä½œä¹Ÿå¯ä»¥è§†ä¸ºä¸€ä¸ªç»´åº¦, ä¸å¦ä¸€ä¸ªç»´åº¦æ¡¥æ¥(å¦‚æ‰‹æœºä¸Šè¿è¡Œè½¯ä»¶å’Œäººè¿™ 2 ä¸ªç»´åº¦, å¯ä»¥è¿›è¡Œæ¡¥æ¥, ç»„æˆ 3 ç»´åº¦åµŒå¥—æ¡¥æ¥).</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: JDBC è·å–è¿æ¥, è·å–è¿æ¥æ˜¯ä¸€ä¸ªç»´åº¦, æ•°æ®åº“æ˜¯ä¸€ä¸ªç»´åº¦, æ•°æ®åº“æœ‰å¤šä¸ª, æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªæ•°æ®åº“ç»´åº¦å˜åŒ–, å¦ä¸€ç»´åº¦ä¸å˜çš„æ¡¥æ¥æ¨¡å¼.</span><br></pre></td></tr></table></figure>

<h4 id="äº«å…ƒæ¨¡å¼"><a href="#äº«å…ƒæ¨¡å¼" class="headerlink" title="äº«å…ƒæ¨¡å¼"></a>äº«å…ƒæ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	åˆ©ç”¨å…±äº«çš„æ–¹å¼æ¥æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ä¸€éƒ¨åˆ†å†…éƒ¨çŠ¶æ€æ˜¯ç›¸åŒçš„ã€‚</span><br><span class="line">	å¦‚å¸¸è§çš„ çº¿ç¨‹æ± , å¸¸é‡æ± ç­‰, ä½¿å¾—å¯¹è±¡çš„è·å–é€Ÿåº¦åŠ å¿«.</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: java.lang.Integer#valueOf() java.lang.Boolean#valueOf()</span><br></pre></td></tr></table></figure>

<h4 id="ç»„åˆæ¨¡å¼"><a href="#ç»„åˆæ¨¡å¼" class="headerlink" title="ç»„åˆæ¨¡å¼"></a>ç»„åˆæ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„æ¥è¡¨ç¤ºâ€œæ•´ä½“&#x2F;éƒ¨åˆ†â€å±‚æ¬¡å…³ç³»ï¼Œå…è®¸ç”¨æˆ·ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†å•ç‹¬å¯¹è±¡å’Œç»„åˆå¯¹è±¡ã€‚</span><br><span class="line">	ä¸€èˆ¬éœ€è¦éƒ¨åˆ†å’Œæ•´ä½“å…·æœ‰ä¸€å®šçš„ç›¸ä¼¼åº¦, æ‰èƒ½å¯¹å…¶è¿›è¡ŒæŠ½è±¡.</span><br><span class="line">	å¯¹éƒ¨åˆ†&#x2F;æ•´ä½“è¿›è¡ŒæŠ½è±¡, å¾—å‡ºä¸€ä¸ªå…¬å…±æŠ½è±¡ç±»æˆ–æ¥å£, å†å®ç°ç±»ä¸­æ ¹æ®å…·ä½“è§’è‰²åšä¸åŒå¤„ç†. </span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">	javax.swing.JComponent#add(Component) </span><br><span class="line">  java.util.Map#putAll(Map)</span><br><span class="line">  java.util.List#addAll(Collection)</span><br><span class="line">  java.util.Set#addAll(Collection)</span><br></pre></td></tr></table></figure>

<h4 id="å¤–è§‚æ¨¡å¼"><a href="#å¤–è§‚æ¨¡å¼" class="headerlink" title="å¤–è§‚æ¨¡å¼"></a>å¤–è§‚æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ï¼Œä»è€Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨.</span><br></pre></td></tr></table></figure>



<h3 id="è¡Œä¸ºå‹"><a href="#è¡Œä¸ºå‹" class="headerlink" title="è¡Œä¸ºå‹"></a>è¡Œä¸ºå‹</h3><h4 id="èŒè´£é“¾-è´£ä»»é“¾-æ¨¡å¼"><a href="#èŒè´£é“¾-è´£ä»»é“¾-æ¨¡å¼" class="headerlink" title="èŒè´£é“¾(è´£ä»»é“¾)æ¨¡å¼"></a>èŒè´£é“¾(è´£ä»»é“¾)æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	ä½¿å¤šä¸ªå¯¹è±¡éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œå°†è¿™äº›å¯¹è±¡è¿æˆä¸€æ¡é“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾å‘é€è¯¥è¯·æ±‚ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢, ä»è€Œé¿å…è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ã€‚</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">	javax.servlet.Filter#doFilter()</span><br><span class="line">	netty çš„ Handler Chain</span><br></pre></td></tr></table></figure>

<h4 id="è§‚å¯Ÿè€…æ¨¡å¼"><a href="#è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="è§‚å¯Ÿè€…æ¨¡å¼"></a>è§‚å¯Ÿè€…æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å®šä¹‰å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶ä¸”è‡ªåŠ¨æ›´æ–°çŠ¶æ€ã€‚</span><br><span class="line">	ä¸»é¢˜ï¼ˆSubjectï¼‰æ˜¯è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œè€Œå…¶æ‰€æœ‰ä¾èµ–è€…ï¼ˆObserverï¼‰ç§°ä¸ºè§‚å¯Ÿè€…ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: </span><br><span class="line">	swing çš„äº‹ä»¶ç›‘å¬(æŒ‰é’®äº‹ä»¶, é¼ æ ‡äº‹ä»¶)</span><br><span class="line">	JS çš„ äº‹ä»¶ç›‘å¬</span><br></pre></td></tr></table></figure>

<h4 id="çŠ¶æ€æ¨¡å¼"><a href="#çŠ¶æ€æ¨¡å¼" class="headerlink" title="çŠ¶æ€æ¨¡å¼"></a>çŠ¶æ€æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒæ‰€å±çš„ç±»ã€‚</span><br><span class="line">	çŠ¶æ€æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥è§£å†³çŠ¶æ€è½¬ç§»çš„é—®é¢˜ï¼Œå½“çŠ¶æ€å‘ç”Ÿè½¬ç§»äº†ï¼Œé‚£ä¹ˆ Context å¯¹è±¡å°±ä¼šæ”¹å˜å®ƒçš„è¡Œä¸º.</span><br></pre></td></tr></table></figure>

<h4 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°è£…æ¯ä¸ªç®—æ³•ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥äº’æ¢ã€‚</span><br><span class="line">	ç­–ç•¥æ¨¡å¼å¯ä»¥è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·ç«¯ã€‚</span><br><span class="line">	ç­–ç•¥æ¨¡å¼ä¸»è¦æ˜¯ç”¨æ¥å°è£…ä¸€ç»„å¯ä»¥äº’ç›¸æ›¿ä»£çš„ç®—æ³•æ—ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°å»æ›¿æ¢ Context ä½¿ç”¨çš„ç®—æ³•.</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: java.util.Comparator#compare() javax.servlet.http.HttpServlet</span><br></pre></td></tr></table></figure>

<h4 id="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"><a href="#æ¨¡æ¿æ–¹æ³•æ¨¡å¼" class="headerlink" title="æ¨¡æ¿æ–¹æ³•æ¨¡å¼"></a>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å®šä¹‰ç®—æ³•æ¡†æ¶ï¼Œå¹¶å°†ä¸€äº›æ­¥éª¤çš„å®ç°å»¶è¿Ÿåˆ°å­ç±»ã€‚</span><br><span class="line">	é€šè¿‡æ¨¡æ¿æ–¹æ³•ï¼Œå­ç±»å¯ä»¥é‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ï¼Œè€Œä¸ç”¨æ”¹å˜ç®—æ³•çš„ç»“æ„ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: java.util.Collections#sort()</span><br></pre></td></tr></table></figure>

<h4 id="å‘½ä»¤æ¨¡å¼"><a href="#å‘½ä»¤æ¨¡å¼" class="headerlink" title="å‘½ä»¤æ¨¡å¼"></a>å‘½ä»¤æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	å°†ä¸€ä¸ªå¯¹è±¡(å‘½ä»¤æ¥æ”¶è€…)çš„æ¯ä¸ªæ“ä½œæ‹†åˆ†åˆ°æ¯ä¸€ä¸ªå‘½ä»¤ç±»ä¸­, å†ä½¿ç”¨ä¸€ä¸ªå‘½ä»¤ç®¡ç†ç±»æ¥ç®¡ç†è¿™äº›å‘½ä»¤. ä½¿å¾—å‘½ä»¤å¯ä»¥æ”¾å…¥é˜Ÿåˆ—ä¸­æœ‰åºæ‰§è¡Œ, ä¸”å¯ä»¥ç»Ÿä¸€è®°å½•å‘½ä»¤çš„æ“ä½œæ—¥å¿—, è¿˜å¯ä»¥æ”¯æŒæ’¤é”€æ“ä½œ(æ¯ä¸ªå‘½ä»¤éƒ½å®ç°å¯¹åº”çš„æ’¤é”€å³å¯).</span><br><span class="line">	æ­¤æ¨¡å¼çš„å¥½å¤„æ˜¯, è‹¥å°†å‘½ä»¤æŠ½è±¡ä¸ºå‡ ä¸ªæ ‡å‡†çš„å‘½ä»¤(å¦‚å¼€,å…³), ç„¶åç®¡ç†å¤šä¸ªå‘½ä»¤æ¥æ”¶è€…(å¦‚ç¯,ç”µè§†æœº,ç©ºè°ƒ)çš„æ“ä½œ, å¯ä½¿æ–°å¢å‘½ä»¤æ¥æ”¶è€…å˜å¾—ç®€å•, å³æ‰©å±•æ€§å¥½.</span><br><span class="line">	</span><br><span class="line">	åˆç§°ä¸‡èƒ½é¥æ§å™¨.</span><br></pre></td></tr></table></figure>

<h4 id="ä¸­ä»‹æ¨¡å¼"><a href="#ä¸­ä»‹æ¨¡å¼" class="headerlink" title="ä¸­ä»‹æ¨¡å¼"></a>ä¸­ä»‹æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	é›†ä¸­ç›¸å…³å¯¹è±¡ä¹‹é—´å¤æ‚çš„æ²Ÿé€šå’Œæ§åˆ¶æ–¹å¼ã€‚é™ä½å­ç³»ç»Ÿä¹‹é—´çš„è€¦åˆ.</span><br><span class="line">	ç±»ä¼¼ä¸€ä¸ªæ¶ˆæ¯æ”¶å‘ä¸­å¿ƒ, è´Ÿè´£å­—ç³»ç»Ÿçš„æ¶ˆæ¯ä¸­è½¬, ä½¿å¾—å­ç³»ç»Ÿä¹‹é—´å¯ä»¥è¿›è¡Œä¸€å®šçš„äº¤äº’.</span><br><span class="line">	</span><br><span class="line">ç¤ºä¾‹: çº¿ç¨‹æ± ç®¡ç†è€…çº¿ç¨‹å’Œè¦æ‰§è¡Œçš„ä»»åŠ¡.</span><br></pre></td></tr></table></figure>

<h4 id="å¤‡å¿˜å½•æ¨¡å¼"><a href="#å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="å¤‡å¿˜å½•æ¨¡å¼"></a>å¤‡å¿˜å½•æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	åœ¨ä¸è¿åå°è£…çš„æƒ…å†µä¸‹è·å¾—å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»è€Œåœ¨éœ€è¦æ—¶å¯ä»¥å°†å¯¹è±¡æ¢å¤åˆ°æœ€åˆçŠ¶æ€ã€‚</span><br><span class="line">	å¦‚å¯¹æ¸¸æˆçš„å½“å‰çŠ¶æ€è¿›è¡Œä¸€ä¸ªä¿å­˜, ç„¶ååœ¨åç»­æ¸¸æˆä¸­æ­»äº¡åå¯ä»¥è¯»å–è¿™ä¸ªçŠ¶æ€é‡æ–°å¼€å§‹.</span><br></pre></td></tr></table></figure>

<h4 id="è®¿é—®è€…æ¨¡å¼"><a href="#è®¿é—®è€…æ¨¡å¼" class="headerlink" title="è®¿é—®è€…æ¨¡å¼"></a>è®¿é—®è€…æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŸç†: </span><br><span class="line">	ä¸ºä¸€ä¸ªå¯¹è±¡ç»“æ„ï¼ˆæ¯”å¦‚ç»„åˆç»“æ„ï¼‰å¢åŠ æ–°èƒ½åŠ›ã€‚</span><br><span class="line">	ä½¿ç”¨è®¿é—®è€…æ¨¡å¼å¯å®ç°é‡è½½çš„åŠ¨æ€ç»‘å®š(å³ä¼ªåŒåˆ†æ´¾), æ•ˆæœä¸é‡è½½æ–¹æ³•å†…ä½¿ç”¨ instanceof æ˜¯ä¸€æ ·çš„, ä½†ä½¿ç”¨è®¿é—®è€…æ¨¡å¼, å¯æ‰©å±•æ€§æ›´å¥½.</span><br></pre></td></tr></table></figure>

<h4 id="è¿­ä»£å™¨æ¨¡å¼"><a href="#è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="è¿­ä»£å™¨æ¨¡å¼"></a>è¿­ä»£å™¨æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	æä¾›ä¸€ç§é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸æš´éœ²èšåˆå¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: java.util.Iterator</span><br></pre></td></tr></table></figure>

<h4 id="è§£é‡Šå™¨æ¨¡å¼"><a href="#è§£é‡Šå™¨æ¨¡å¼" class="headerlink" title="è§£é‡Šå™¨æ¨¡å¼"></a>è§£é‡Šå™¨æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	ä¸ºè¯­è¨€åˆ›å»ºè§£é‡Šå™¨ï¼Œé€šå¸¸ç”±è¯­è¨€çš„è¯­æ³•å’Œè¯­æ³•åˆ†ææ¥å®šä¹‰ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹: EL è¡¨è¾¾å¼, Freemakeræ¨¡æ¿</span><br></pre></td></tr></table></figure>

<h4 id="ç©ºå¯¹è±¡æ¨¡å¼"><a href="#ç©ºå¯¹è±¡æ¨¡å¼" class="headerlink" title="ç©ºå¯¹è±¡æ¨¡å¼"></a>ç©ºå¯¹è±¡æ¨¡å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åŸç†:</span><br><span class="line">	ä½¿ç”¨ä»€ä¹ˆéƒ½ä¸åšçš„ç©ºå¯¹è±¡æ¥ä»£æ›¿ NULL, é¿å…ç©ºå¯¹è±¡åˆ¤æ–­, é¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸.</span><br></pre></td></tr></table></figure>



<h2 id="é«˜å¹¶å‘"><a href="#é«˜å¹¶å‘" class="headerlink" title="é«˜å¹¶å‘"></a>é«˜å¹¶å‘</h2><h3 id="Redis-ç¼“å­˜"><a href="#Redis-ç¼“å­˜" class="headerlink" title="Redis ç¼“å­˜"></a>Redis ç¼“å­˜</h3><h4 id="ç¼“å­˜ç©¿é€-æ”»å‡»å‹"><a href="#ç¼“å­˜ç©¿é€-æ”»å‡»å‹" class="headerlink" title="ç¼“å­˜ç©¿é€(æ”»å‡»å‹)"></a>ç¼“å­˜ç©¿é€(æ”»å‡»å‹)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å«ä¹‰:</span><br><span class="line">	å¯¹äºä¸€ä¸ªä¸å­˜åœ¨çš„ key è¿›è¡Œè®¿é—®, ä¼šå¯¼è‡´æ•°æ®åº“ä¸åœåœ°æŸ¥è¯¢è¿™ä¸ª key è¿›è¡Œç¼“å­˜.</span><br><span class="line">	</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">	1.ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨, ä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿‡æ»¤.</span><br><span class="line">	2.æŸ¥è¯¢åç¼“å­˜ä¸€ä¸ªç©ºç»“æœ, ä½†å¾ˆå¿«è¶…æ—¶.(æœ‰ç¼ºç‚¹, ä½†ç®€å•)</span><br></pre></td></tr></table></figure>

<h4 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">å«ä¹‰:</span><br><span class="line">	ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨æˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ°DBï¼ŒDBç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚</span><br><span class="line">	</span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">	1.è®¾ç½®è¶…æ—¶æ—¶, åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœº</span><br><span class="line">	2.åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯ç¼“å­˜çš„å•çº¿ ç¨‹ï¼ˆè¿›ç¨‹ï¼‰, é¿å…å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“.</span><br></pre></td></tr></table></figure>

<h4 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">å«ä¹‰:</span><br><span class="line">	å•ä¸€çƒ­ç‚¹ key å¤±æ•ˆæ—¶å¯¼è‡´å¤§é‡è¯·æ±‚æ‰“åˆ°æ•°æ®åº“ã€‚</span><br><span class="line"></span><br><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line">	1.åˆ†å¸ƒå¼äº’æ–¥é”(redis,zookper)</span><br><span class="line">	2.æ·»åŠ è¶…æ—¶å­—æ®µè®°å½•è¶…æ—¶(æ¯”å®é™…è¶…æ—¶å°ä¸€äº›), æ¯æ¬¡è·å–æ•°æ®æ ¹æ®å­—æ®µåˆ¤æ–­æ˜¯å¦è¶…æ—¶, è‹¥æ˜¯, åˆ™é©¬ä¸Šå»¶é•¿è¶…æ—¶å­—æ®µ, ç„¶ååŠ è½½æ•°æ®åº“é‡æ–°ç¼“å­˜</span><br><span class="line">	3.redisä¸è®¾ç½®è¿‡æœŸ, é€šè¿‡æ·»åŠ è¶…æ—¶å­—æ®µåˆ¤æ–­, è¶…æ—¶åˆ™ä»£ç å¼‚æ­¥è·‘ä¸€ä¸ªé‡æ–°ç¼“å­˜çš„ä»»åŠ¡(è¿™é‡Œä»£ç éœ€è¦å…ˆæœ¬åœ°åŠ é”, å†åŠ åˆ†å¸ƒå¼é”).</span><br></pre></td></tr></table></figure>



<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><blockquote>
<p>è§£è€¦, å¼‚æ­¥, å‰Šå³°</p>
</blockquote>
<h4 id="è§£è€¦"><a href="#è§£è€¦" class="headerlink" title="è§£è€¦"></a>è§£è€¦</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰:</span><br><span class="line">	ä¸ºé¢å‘æœåŠ¡çš„æ¶æ„ï¼ˆSOAï¼‰æä¾›åŸºæœ¬çš„æœ€ç»ˆä¸€è‡´æ€§å®ç°. å³å°† 2 ä¸ªç³»ç»Ÿçš„äº¤äº’é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—ä¸­è½¬, ä»¥é˜²æ­¢æŸä¸ªç³»ç»Ÿä¸´æ—¶æŒ‚äº†å¯¼è‡´è°ƒç”¨å¤±è´¥.</span><br><span class="line">ç¤ºä¾‹: ä¸‹å•ç³»ç»Ÿè°ƒç”¨åº“å­˜ç³»ç»Ÿ, è‹¥å½“æ—¶åº“å­˜ç³»ç»Ÿæ­£å¥½æŒ‚äº†, åˆ™å¯¼è‡´ä¸‹å•å¤±è´¥. æ­¤æ—¶å°†è¯·æ±‚æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­, åº“å­˜ç³»ç»Ÿè¯»å–æ¶ˆæ¯è¿›è¡Œå¤„ç†, è‹¥å½“æ—¶åº“å­˜æŒ‚äº†ä¹Ÿæ²¡å…³ç³», å¤„ç†å¤±è´¥ä¹Ÿæ²¡å…³ç³»(å¯é‡è¯•, ä¸”é‡è¯•ä»£ç æ¯”è¾ƒç®€å•).</span><br></pre></td></tr></table></figure>

<h4 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰:</span><br><span class="line">	å¯¹äºæŸäº›ä¸è¦æ±‚è¿”å›å€¼çš„è€—æ—¶æ“ä½œ, å¯å¼‚æ­¥å¤„ç†.</span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">	ç”¨æˆ·ä¸‹å•å, éœ€å‘é€å¤šä¸ªä¸‹å•æé†’(å¾®ä¿¡é€šçŸ¥, çŸ­ä¿¡é€šçŸ¥, é‚®ä»¶é€šçŸ¥), æ¯ä¸ªæ“ä½œéƒ½æ¯”è¾ƒè€—æ—¶, å¯è€ƒè™‘å°†å…¶æ”¾å…¥æ¶ˆæ¯é˜Ÿåˆ—åç›´æ¥è¿”å›, ç”±å¦ä¸€æ®µä»£ç è´Ÿè´£è¯»å–æ¶ˆæ¯å‘é€é€šçŸ¥.</span><br></pre></td></tr></table></figure>

<h4 id="å‰Šå³°"><a href="#å‰Šå³°" class="headerlink" title="å‰Šå³°"></a>å‰Šå³°</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å®šä¹‰:</span><br><span class="line">	å°†è¯·æ±‚é«˜å³°æ‰“å¹³, ä½¿å¾—ç³»ç»Ÿå¯ä»¥å¤„ç†è¿‡æ¥.</span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">	æŸæ¬¡ç§’æ€ 1 åˆ†é’Ÿè¿‡æ¥ 1 ä¸‡è¯·æ±‚, è€Œç³»ç»Ÿä¸€åˆ†é’Ÿå¤§æ¦‚åªèƒ½å¤„ç† 1åƒ è¯·æ±‚, ç³»ç»Ÿè¦å¤„ç†å®Œè¿™äº›è¯·æ±‚ç†è®ºéœ€è¦ 10 åˆ†é’Ÿ, ä½†å¦‚æœä¸åšå¤„ç†, è¯·æ±‚ç¬é—´æ‰“è¿‡æ¥, ç³»ç»Ÿç›´æ¥å¡æ­», å¡ä½æ—¶å€™ä¸€åˆ†é’Ÿå¯èƒ½åªèƒ½å¤„ç† 100 è¯·æ±‚. æ­¤æ—¶éœ€è¦å°†æ‰€æœ‰è¯·æ±‚éƒ½æ‰“åˆ°é˜Ÿåˆ—é‡Œé¢, ç³»ç»Ÿå†æ…¢æ…¢ä»é˜Ÿåˆ—ä¸­è¯»å–å¤„ç†.</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/07/09/introduction-docer-savior/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/07/09/introduction-docer-savior/" class="post-title-link" itemprop="url">æ–‡æ¡£ç”Ÿæˆæ’ä»¶ä½¿ç”¨æŒ‡å—</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-07-09 11:07:44" itemprop="dateCreated datePublished" datetime="2021-07-09T11:07:44+08:00">2021-07-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-07-10 11:36:30" itemprop="dateModified" datetime="2021-07-10T11:36:30+08:00">2021-07-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/idea-plugin/" itemprop="url" rel="index"><span itemprop="name">idea-plugin</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/07/09/introduction-docer-savior/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/07/09/introduction-docer-savior/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æ–‡æ¡£ç”Ÿæˆæ’ä»¶ä½¿ç”¨æŒ‡å—"><a href="#æ–‡æ¡£ç”Ÿæˆæ’ä»¶ä½¿ç”¨æŒ‡å—" class="headerlink" title="æ–‡æ¡£ç”Ÿæˆæ’ä»¶ä½¿ç”¨æŒ‡å—"></a>æ–‡æ¡£ç”Ÿæˆæ’ä»¶ä½¿ç”¨æŒ‡å—</h1><h2 id="æ ¹æ®-Spring-MVC-Controller-ä¸‹æ–¹æ³•ç”Ÿæˆæ¥å£æ–‡æ¡£"><a href="#æ ¹æ®-Spring-MVC-Controller-ä¸‹æ–¹æ³•ç”Ÿæˆæ¥å£æ–‡æ¡£" class="headerlink" title="æ ¹æ® Spring MVC Controller ä¸‹æ–¹æ³•ç”Ÿæˆæ¥å£æ–‡æ¡£"></a>æ ¹æ® Spring MVC Controller ä¸‹æ–¹æ³•ç”Ÿæˆæ¥å£æ–‡æ¡£</h2><h3 id="å…ˆçœ‹ç¤ºä¾‹ä»£ç "><a href="#å…ˆçœ‹ç¤ºä¾‹ä»£ç " class="headerlink" title="å…ˆçœ‹ç¤ºä¾‹ä»£ç "></a>å…ˆçœ‹ç¤ºä¾‹ä»£ç </h3><h4 id="UserController"><a href="#UserController" class="headerlink" title="UserController"></a>UserController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gudqs.business.docer.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.gudqs.business.docer.dto.request.ListUserRequest;</span><br><span class="line"><span class="keyword">import</span> cn.gudqs.business.docer.dto.response.BaseResponse;</span><br><span class="line"><span class="keyword">import</span> cn.gudqs.business.docer.dto.response.ListUserResponse;</span><br><span class="line"><span class="keyword">import</span> cn.gudqs.util.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api/v1/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯(åˆ†é¡µ)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> listUserPage è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”¨æˆ·åˆ—è¡¨æ•°æ®-åˆ†é¡µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/listUser"</span>)</span><br><span class="line">    <span class="keyword">public</span> BaseResponse&lt;List&lt;ListUserResponse&gt;&gt; listUserPage(ListUserRequest listUserPage) &#123;</span><br><span class="line">        <span class="comment">// todo æŸ¥è¯¢åˆ†é¡µæ•°æ®</span></span><br><span class="line">        log.info(<span class="string">"listUserPage--&gt; "</span>+ JsonUtils.getJsonString(listUserPage));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> BaseResponse.success(<span class="keyword">new</span> ArrayList&lt;&gt;(), <span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BaseResponse"><a href="#BaseResponse" class="headerlink" title="BaseResponse"></a>BaseResponse</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gudqs.business.docer.dto.response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseResponse</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŠ¶æ€ç </span></span><br><span class="line"><span class="comment">     * 0: ä»£è¡¨æˆåŠŸ</span></span><br><span class="line"><span class="comment">     * -1: ä»£è¡¨æœªçŸ¥å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * &gt;0: ä»£è¡¨å·²çŸ¥å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é”™è¯¯ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ˜¯å¦æˆåŠŸ</span></span><br><span class="line"><span class="comment">     * true: ä»£è¡¨æˆåŠŸ, æ­¤æ—¶ code = 0</span></span><br><span class="line"><span class="comment">     * false: ä»£è¡¨å¤±è´¥, æ­¤æ—¶ code != 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µ-æ€»æ¡æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long totalCount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">BaseResponse&lt;T&gt; <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">BaseResponse&lt;T&gt; <span class="title">success</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> success(data, <span class="number">0L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›ä¸€ä¸ªæˆåŠŸçš„ BaseResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data æºå¸¦çš„æ•°æ®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalCount åˆ†é¡µ-æ€»æ¡æ•°</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> BaseResponse</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">BaseResponse&lt;T&gt; <span class="title">success</span><span class="params">(T data, Long totalCount)</span> </span>&#123;</span><br><span class="line">        BaseResponse&lt;T&gt; baseResponse = <span class="keyword">new</span> BaseResponse&lt;&gt;();</span><br><span class="line">        baseResponse.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">        baseResponse.setCode(<span class="number">0</span>);</span><br><span class="line">        baseResponse.setMessage(<span class="string">"success"</span>);</span><br><span class="line">        baseResponse.setData(data);</span><br><span class="line">        baseResponse.setTotalCount(totalCount);</span><br><span class="line">        <span class="keyword">return</span> baseResponse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ListUserResponse"><a href="#ListUserResponse" class="headerlink" title="ListUserResponse"></a>ListUserResponse</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gudqs.business.docer.dto.response;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListUserResponse</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ˜µç§°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å§“å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String realName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     * #example 110</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String phoneNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ€§åˆ«</span></span><br><span class="line"><span class="comment">     * 0: ä¿å¯†</span></span><br><span class="line"><span class="comment">     * 1: ç”·</span></span><br><span class="line"><span class="comment">     * 2: å¥³</span></span><br><span class="line"><span class="comment">     * #example 2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userGender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å¹´é¾„</span></span><br><span class="line"><span class="comment">     * #example 1024</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer userAge;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·å¤´åƒåœ°å€</span></span><br><span class="line"><span class="comment">     * #example https://mp.weixin.com/p/jewagheiajifejgihewjg.ifew</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æœ€è¿‘ä¸€æ¬¡ç™»å½•æ—¶é—´</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date lastLoginTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ListUserRequest"><a href="#ListUserRequest" class="headerlink" title="ListUserRequest"></a>ListUserRequest</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gudqs.business.docer.dto.request;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥è¯¢ç”¨æˆ·-è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>(callSuper = <span class="keyword">true</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListUserRequest</span> <span class="keyword">extends</span> <span class="title">BasePageRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡ç³Šæœç´¢è¯</span></span><br><span class="line"><span class="comment">     * æ”¯æŒç”¨æˆ·æ˜µç§°, ç”¨æˆ·å§“å, ç”¨æˆ·æ‰‹æœºå·</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String searchKeyword;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨æˆ·æ€§åˆ«</span></span><br><span class="line"><span class="comment">     * 0: ä¿å¯†</span></span><br><span class="line"><span class="comment">     * 1: ç”·</span></span><br><span class="line"><span class="comment">     * 2: å¥³</span></span><br><span class="line"><span class="comment">     * #example 2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤å¹´é¾„èŒƒå›´-èµ·å§‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer ageStart;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤å¹´é¾„èŒƒå›´-ç»“æŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer ageEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-å¼€å§‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date loginTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-ç»“æŸ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Date loginTimeEnd;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BasePageRequest"><a href="#BasePageRequest" class="headerlink" title="BasePageRequest"></a>BasePageRequest</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.gudqs.business.docer.dto.request;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wq</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasePageRequest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µ-å½“å‰é¡µç </span></span><br><span class="line"><span class="comment">     * #example 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µ-åˆ†é¡µå¤§å°</span></span><br><span class="line"><span class="comment">     * #example 20</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><blockquote>
<p>ä»¥ä¸Šéƒ½æ˜¯å¤§å®¶å¸¸å†™çš„åˆ†é¡µä»£ç ï¼Œæ­¤æ—¶æˆ‘åœ¨ <code>listUserPage</code> è¿™ä¸ªæ–¹æ³•ä¸Šå³é”®ï¼Œå¼¹å‡ºèœå•ä¸­é€‰æ‹©ï¼šç”ŸæˆApiæ¥å£æ–‡æ¡£ï¼ˆrestfulï¼‰ï¼Œå¦‚å›¾</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710095319.png" alt="image-20210710095313814"></p>
<p>ç„¶åå°±ä¼šå¾—åˆ°ä¸€ä¸ªå¼¹æ¡†ï¼Œå½“ç„¶å¦‚æœä½ æ ¹æ®æç¤ºç‚¹äº† <code>OK</code>ï¼Œåˆ™ç›´åˆ°ä¸‹æ¬¡é‡å¯ï¼Œéƒ½ä¸ä¼šå†å‡ºç°</p>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710113051.png" alt="image-20210710100138879"></p>
<p>å¼¹æ¡†ä¸­å†…å®¹å¦‚ä¸‹ï¼Œæ­¤å†…å®¹åŒºåŸŸå¯æ»šåŠ¨é¢„è§ˆï¼Œå…¨é€‰å¤åˆ¶ç²˜è´´</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"># æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯(åˆ†é¡µ)</span><br><span class="line">## è¯·æ±‚ä¿¡æ¯</span><br><span class="line"></span><br><span class="line">### è¯·æ±‚åœ°å€</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">http:&#x2F;&#x2F;192.168.0.104:8080&#x2F;api&#x2F;v1&#x2F;user&#x2F;listUser</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">### è¯·æ±‚æ–¹æ³•</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">POST</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">### è¯·æ±‚ä½“ç±»å‹</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">application&#x2F;x-www-form-urlencoded</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">## å…¥å‚</span><br><span class="line">### å…¥å‚ç¤ºä¾‹(Postman&#x3D;&#x3D;&gt; Bulk Edit)</span><br><span class="line">&#39;&#39;&#39;json</span><br><span class="line">pageNumber:1</span><br><span class="line">pageSize:20</span><br><span class="line">searchKeyword:æ¨¡ç³Šæœç´¢è¯&lt;br&gt;æ”¯æŒç”¨æˆ·æ˜µç§°, ç”¨æˆ·å§“å, ç”¨æˆ·æ‰‹æœºå·</span><br><span class="line">gender:2</span><br><span class="line">ageStart:0</span><br><span class="line">ageEnd:0</span><br><span class="line">loginTimeStart:è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-å¼€å§‹</span><br><span class="line">loginTimeEnd:è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-ç»“æŸ</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">### å…¥å‚å­—æ®µè¯´æ˜</span><br><span class="line">| **å­—æ®µ** | **ç±»å‹** | **å¿…å¡«æ€§** | **å«ä¹‰** | **å…¶ä»–ä¿¡æ¯å‚è€ƒ** |</span><br><span class="line">| -------- | -------- | -------- | -------- | -------- |</span><br><span class="line">| pageNumber     | **Integer**     | å¦  |  åˆ†é¡µ-å½“å‰é¡µç  |   |</span><br><span class="line">| pageSize     | **Integer**     | å¦  |  åˆ†é¡µ-åˆ†é¡µå¤§å° |   |</span><br><span class="line">| searchKeyword     | **String**     | å¦  |  æ¨¡ç³Šæœç´¢è¯&lt;br&gt;æ”¯æŒç”¨æˆ·æ˜µç§°, ç”¨æˆ·å§“å, ç”¨æˆ·æ‰‹æœºå· |   |</span><br><span class="line">| gender     | **Integer**     | å¦  |  ç”¨æˆ·æ€§åˆ«&lt;br&gt;0: ä¿å¯†&lt;br&gt;1: ç”·&lt;br&gt;2: å¥³ |   |</span><br><span class="line">| ageStart     | **Integer**     | å¦  |  è¿‡æ»¤å¹´é¾„èŒƒå›´-èµ·å§‹ |   |</span><br><span class="line">| ageEnd     | **Integer**     | å¦  |  è¿‡æ»¤å¹´é¾„èŒƒå›´-ç»“æŸ |   |</span><br><span class="line">| loginTimeStart     | **Date**     | å¦  |  è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-å¼€å§‹ |   |</span><br><span class="line">| loginTimeEnd     | **Date**     | å¦  |  è¿‡æ»¤ç™»å½•æ—¶é—´èŒƒå›´-ç»“æŸ |   |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## å‡ºå‚</span><br><span class="line">### å‡ºå‚ç¤ºä¾‹</span><br><span class="line">&#39;&#39;&#39;json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;code&quot;: 0,</span><br><span class="line">  &quot;message&quot;: &quot;é”™è¯¯ä¿¡æ¯&quot;,</span><br><span class="line">  &quot;success&quot;: false,</span><br><span class="line">  &quot;data&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;nickName&quot;: &quot;ç”¨æˆ·æ˜µç§°&quot;,</span><br><span class="line">      &quot;realName&quot;: &quot;ç”¨æˆ·å§“å&quot;,</span><br><span class="line">      &quot;phoneNumber&quot;: &quot;110&quot;,</span><br><span class="line">      &quot;userGender&quot;: 2,</span><br><span class="line">      &quot;userAge&quot;: 1024,</span><br><span class="line">      &quot;userAvatar&quot;: &quot;https:&#x2F;&#x2F;mp.weixin.com&#x2F;p&#x2F;jewagheiajifejgihewjg.ifew&quot;,</span><br><span class="line">      &quot;lastLoginTime&quot;: &quot;æœ€è¿‘ä¸€æ¬¡ç™»å½•æ—¶é—´&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;totalCount&quot;: 0</span><br><span class="line">&#125;</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line"></span><br><span class="line">### è¿”å›å­—æ®µè¯´æ˜</span><br><span class="line">| **å­—æ®µ** | **ç±»å‹** | **å«ä¹‰** | **å…¶ä»–ä¿¡æ¯å‚è€ƒ** |</span><br><span class="line">| -------- | -------- | -------- | -------- |</span><br><span class="line">| code     | **Integer**     | å¦  |  çŠ¶æ€ç &lt;br&gt;0: ä»£è¡¨æˆåŠŸ&lt;br&gt;-1: ä»£è¡¨æœªçŸ¥å¼‚å¸¸&lt;br&gt;\&gt;0: ä»£è¡¨å·²çŸ¥å¼‚å¸¸ |   |</span><br><span class="line">| message     | **String**     | å¦  |  é”™è¯¯ä¿¡æ¯ |   |</span><br><span class="line">| success     | **Boolean**     | å¦  |  æ˜¯å¦æˆåŠŸ&lt;br&gt;true: ä»£è¡¨æˆåŠŸ, æ­¤æ—¶ code &#x3D; 0&lt;br&gt;false: ä»£è¡¨å¤±è´¥, æ­¤æ—¶ code !&#x3D; 0 |   |</span><br><span class="line">| data     | **List\&lt;ListUserResponse\&gt;**     | å¦  |  è¿”å›æ•°æ® |   |</span><br><span class="line">|â””â”€ nickName     | **String**     | å¦  |  ç”¨æˆ·æ˜µç§° |   |</span><br><span class="line">|â””â”€ realName     | **String**     | å¦  |  ç”¨æˆ·å§“å |   |</span><br><span class="line">|â””â”€ phoneNumber     | **String**     | å¦  |  ç”¨æˆ·æ‰‹æœºå· |   |</span><br><span class="line">|â””â”€ userGender     | **Integer**     | å¦  |  ç”¨æˆ·æ€§åˆ«&lt;br&gt;0: ä¿å¯†&lt;br&gt;1: ç”·&lt;br&gt;2: å¥³ |   |</span><br><span class="line">|â””â”€ userAge     | **Integer**     | å¦  |  ç”¨æˆ·å¹´é¾„ |   |</span><br><span class="line">|â””â”€ userAvatar     | **String**     | å¦  |  ç”¨æˆ·å¤´åƒåœ°å€ |   |</span><br><span class="line">|â””â”€ lastLoginTime     | **Date**     | å¦  |  æœ€è¿‘ä¸€æ¬¡ç™»å½•æ—¶é—´ |   |</span><br><span class="line">| totalCount     | **Long**     | å¦  |  åˆ†é¡µ-æ€»æ¡æ•° |   |</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ç”±äºæ–‡ç« æœ¬èº«å°±æ˜¯Markdownæ ¼å¼ï¼Œæ‰€ä»¥ä¸Šé¢ä¸­ <code>```</code> æˆ‘ç”¨ <code>&#39;&#39;&#39;</code> ä»£æ›¿ï¼Œæˆ‘ç”¨æˆªå›¾æ¥å±•ç¤ºä¸‹æ•ˆæœï¼šæˆªå›¾ä½¿ç”¨ Chrome æ’ä»¶æ‰“å¼€ HTML æ»šåŠ¨æˆªå±å¾—åˆ°ï¼ŒHTML æ˜¯ç”± typora ç”Ÿæˆçš„ï¼</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710101322.png" alt="screencapture-file-Users-wq-File-TempFile-html-2021-07-10-10_09_50"></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><blockquote>
<p>å¦‚æœæœ‰å¤šä¸ªæ–¹æ³•ï¼Œæƒ³ä¸€æ¬¡æ€§ç”Ÿæˆï¼Œåˆ™å¯åœ¨ UserController ä¸Šå³é”®ï¼Œç‚¹å‡»ç”ŸæˆApiæ–‡æ¡£ï¼ˆrestfulï¼‰ ï¼Œå¦‚å›¾ï¼š</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710101619.png" alt="image-20210710101618777"></p>
<blockquote>
<p>æ­¤æ—¶ç”Ÿæˆçš„æ–‡æ¡£ï¼Œå°±æ˜¯å¤šä¸ªæ–¹æ³•å•ç‹¬ç”Ÿæˆçš„æ–‡æ¡£çš„ç®€å•çš„æ‹¼æ¥ã€‚</p>
</blockquote>
<h2 id="æ ¹æ®-Spring-MVC-Controller-çš„æ¥å£ä¿¡æ¯å¯¼å‡ºåˆ°-Postman"><a href="#æ ¹æ®-Spring-MVC-Controller-çš„æ¥å£ä¿¡æ¯å¯¼å‡ºåˆ°-Postman" class="headerlink" title="æ ¹æ® Spring MVC Controller çš„æ¥å£ä¿¡æ¯å¯¼å‡ºåˆ° Postman"></a>æ ¹æ® Spring MVC Controller çš„æ¥å£ä¿¡æ¯å¯¼å‡ºåˆ° Postman</h2><h3 id="é¡¹ç›®è§†å›¾é€‰æ‹©ç±»ã€åŒ…ï¼Œç‚¹å³é”®"><a href="#é¡¹ç›®è§†å›¾é€‰æ‹©ç±»ã€åŒ…ï¼Œç‚¹å³é”®" class="headerlink" title="é¡¹ç›®è§†å›¾é€‰æ‹©ç±»ã€åŒ…ï¼Œç‚¹å³é”®"></a>é¡¹ç›®è§†å›¾é€‰æ‹©ç±»ã€åŒ…ï¼Œç‚¹å³é”®</h3><blockquote>
<p>è¿˜æ˜¯æ²¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å•ä¸ªæ–¹æ³•å•ç‹¬å¯¼å‡ºåˆ° Postman éå¸¸è´¹æ—¶è´¹åŠ›ï¼Œå¯ç”¨æ€§ä¸é«˜ï¼Œå› æ­¤æ–¹æ³•çº§åˆ«çš„å³é”®å¯¼å‡ºï¼Œå¹¶æ²¡æœ‰å®ç°ï¼ä½†æ˜¯å•ä¸ªæ–‡ä»¶çº§åˆ«ï¼Œè¿˜æ˜¯OKçš„ï¼Œåªéœ€åœ¨æ–‡ä»¶å¯¼èˆªè§†å›¾æ‰¾åˆ° UserController ç±»ï¼Œå³é”®ï¼Œç‚¹å‡» å¯¼å‡ºApiåˆ°Postmanå³å¯ï¼å¦‚å›¾</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710102304.png" alt="image-20210710102303483"></p>
<blockquote>
<p>å¦å¤–è¿™ä¸ªå³é”®ï¼Œå…¶å®ä¸ç®¡æ˜¯ç±»ï¼ŒåŒ…ï¼Œè¿˜æ˜¯æ–‡ä»¶å¤¹ï¼Œä¹ƒè‡³æ ¹ç›®å½•ï¼Œéƒ½å¯ä»¥ç‚¹å‡»å¯¼å‡ºåˆ° Postmanï¼Œåªæ˜¯å¯¼å‡ºçš„èŒƒå›´ä¸åŒï¼</p>
<p>ç”±äºèŒƒå›´æ¯”è¾ƒå¤§ï¼Œå› æ­¤è¿‡æ»¤äº†é @Controllerã€@RestController æ³¨è§£çš„ç±»ï¼Œå¯æ”¾å¿ƒä½¿ç”¨ã€‚</p>
</blockquote>
<p>ç‚¹å‡»å¯¼å‡ºåï¼Œä¼šå°† Postman çš„json ç”Ÿæˆåˆ°é¡¹ç›®ä¸‹çš„ api-doc/postman æ–‡ä»¶å¤¹ï¼Œå¦‚å›¾</p>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710102848.png" alt="image-20210710102846460"></p>
<h3 id="æ‰“å¼€Postmanç‚¹å‡»-File-â€“-gt-Import"><a href="#æ‰“å¼€Postmanç‚¹å‡»-File-â€“-gt-Import" class="headerlink" title="æ‰“å¼€Postmanç‚¹å‡» File â€“&gt; Import"></a>æ‰“å¼€Postmanç‚¹å‡» File â€“&gt; Import</h3><p>æ­¤æ—¶æˆ‘ä»¬æ‰“å¼€ Postmanï¼Œä½¿ç”¨å¿«æ·é”® <code>Ctrl + O</code> æˆ– <code>Command + O</code> , æ¥ç€æ‹–æ‹½æ–‡ä»¶è¿‡å»ï¼Œæˆ–ç‚¹å‡» UploadFilesï¼Œå¼¹æ¡†é€‰æ‹©æ–‡ä»¶æ‰“å¼€ï¼Œå¦‚å›¾</p>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710103245.png" alt="image-20210710103242732"></p>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710103323.png" alt="image-20210710103321866"></p>
<h3 id="æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª-Collection"><a href="#æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª-Collection" class="headerlink" title="æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª Collection"></a>æœ€ç»ˆå¾—åˆ°ä¸€ä¸ª Collection</h3><p>å¦‚å›¾ï¼šä¸ç®¡æ˜¯è¯·æ±‚ï¼Œè¿”å›ç¤ºä¾‹ï¼Œæ–‡æ¡£ï¼Œæˆ–è€…è¯´ url å˜é‡ï¼Œbodyå’Œå‚æ•°å¤„ç†ï¼Œéƒ½å¸®ä½ æå®šäº†ï¼Œä½ åªéœ€è¦ä¿®æ”¹ä¸‹å‚æ•°çš„å®é™…å€¼ï¼ˆå¦‚æœä½¿ç”¨ #exampleï¼Œåˆ™è¿™æ­¥ä¹Ÿå¯ä»¥çœç•¥ï¼‰ï¼Œç„¶åç‚¹è“è‰²çš„ Send æŒ‰é’®å°± ok äº†ï¼ˆåƒä¸‡åˆ«å¿˜è®°å¯åŠ¨é¡¹ç›®ï¼‰ï¼</p>
<blockquote>
<p>è¿™é‡Œç®€å•è¯´ä¸‹ï¼Œurl çš„ç»„æˆ</p>
<p>1.http:// è¿™ä¸ªæœ¬åœ°å¼€å‘ä¸€èˆ¬ä¸ç”¨ https å¯¹å§ï¼Œå˜¿å˜¿</p>
<p>2.ip: è¿™ä¸ªä½¿ç”¨ä»£ç éå†ç½‘å¡ï¼Œè¿‡æ»¤æ‰ ipv6ï¼Œ127.0.0.1 åå¾—å‡ºçš„å±€åŸŸç½‘ ipï¼Œå¦‚æœæ²¡æè™šæ‹Ÿæœºå•¥çš„ï¼Œä¸€èˆ¬è·å–æ¯”è¾ƒå‡†ç¡®ï¼Œè¦è¿˜æ˜¯é”™äº†ï¼Œç‚¹å‡» Collection åç§°ï¼Œåœ¨ Variables ä¸‹ä¿®æ”¹ NaN çš„ Current Value å°±å¥½äº†</p>
<p>3.port: è¿™ä¸ªé»˜è®¤8080ï¼Œç„¶åæ”¯æŒ Spring Boot é¡¹ç›®ï¼Œå³è¯»å– application.yml/application.properties æ–‡ä»¶è·å– server.port çš„å€¼ï¼Œå—¯~~ è‹¥å­˜åœ¨ application-xxx è¿™ç§æƒ…å†µï¼Œè¿˜çœŸä¸å¥½å–ï¼Œåªèƒ½è¯»å– spring.profiles.active ä½†æ˜¯ä¹Ÿæœªå¿…å‡†ç¡®ï¼Œæ¯•ç«Ÿæœ‰å¾ˆå¤šåœ°æ–¹æ”¯æŒè®¾ç½®ã€‚ç†è®ºæ€§ideaçš„ä¸œè¥¿éƒ½å¯ä»¥è·å–ï¼Œä½†ideaçš„æ’ä»¶å¼€å‘æ–‡æ¡£æ‰¾ä¸åˆ°è¿™æ–¹é¢çš„ä¿¡æ¯ï¼Œå¤§æ¦‚æ˜¯ä¸ä¼šèŠ±ç²¾åŠ›æäº†ï¼Œæ¯•ç«Ÿé”™äº†ç›´æ¥æ”¹å˜é‡å°±å¥½äº†ï¼Œæ”¹ä¸€å¤„ï¼Œæ‰€æœ‰è¯·æ±‚ç”Ÿæ•ˆã€‚</p>
<p>4.å‰©ä¸‹çš„éƒ¨åˆ†å°±æ˜¯ Controller çš„ @RequestMapping æ³¨è§£ + æ–¹æ³•çš„ @RequestMappingï¼ˆæˆ–@GetMappingä¹‹ç±»ï¼‰æ³¨è§£çš„å€¼æ‹¼å‡‘èµ·æ¥ã€‚è‹¥æ–¹æ³•ä¸º GETï¼Œåˆ™å‚æ•°ä¼šä»¥?xxx=xxx&amp;xx=xx å½¢å¼æ‹¼æ¥ä¸Šå»ï¼Œä¹Ÿå¯åœ¨ Params ä¸‹æŸ¥çœ‹</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210710104429.png" alt="image-20210710104427563"></p>
<h2 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote>
<p>æ€»å¾—æ¥è¯´ï¼Œè¿™ä¸ªæ’ä»¶è¿˜æ˜¯å¤ªç®€å•äº†ï¼Œå…¶å®ä¸ç”¨ä½¿ç”¨æŒ‡å—ï¼ŒçŸ¥é“åœ¨å“ªå³é”®èµ·ä»€ä¹ˆä½œç”¨ï¼Œå°±OKäº†ï¼Œå› ä¸ºå¤„äº†å³é”®ç‚¹å‡»ï¼Œå…¶ä»–ä¸€æ¦‚ä¸ç”¨ä½ ç®¡ï¼ˆåŒ…æ‹¬å¤åˆ¶ï¼‰ï¼å¯è°“æ˜¯å·æ‡’æäº†ã€‚ã€‚ã€‚ã€‚ã€‚ </p>
</blockquote>
<p>è¯´ä¸‹è¿™ä¸ªæ’ä»¶çš„å‘å±•å²ã€‚</p>
<blockquote>
<p>ä¸€å¼€å§‹æ˜¯ç”¨äºå¾®æœåŠ¡çš„æ¥å£æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°å’Œè¿”å›å€¼æ¥ç”Ÿæˆæ–‡æ¡£ç»™å…¶ä»–å¼€å‘çœ‹ï¼Œå½“æ—¶è¿˜æ˜¯è‡ªå·±å†™äº†ä¸ª Utilï¼Œç„¶åä¼  Class ä½œä¸ºå‚æ•°æ¥è§£æå¾—åˆ°å‚æ•°ã€è¿”å›å€¼ç­‰ä¿¡æ¯ï¼Œæœ€ç»ˆç”Ÿæˆæ–‡æ¡£ï¼Œå½“æ—¶çš„æ‰€æœ‰ä¸­æ–‡å¤‡æ³¨ï¼Œéƒ½æ˜¯é€šè¿‡ Swagger çš„æ³¨è§£æ¥å®ç°çš„ï¼Œæ²¡åŠæ³•ï¼Œè¿è¡Œæ—¶æ³¨é‡Šæ—©å¹²æ‰äº†ï¼Œå¾—ä¸åˆ°ã€‚</p>
<p>åæ¥è§‰å¾—è¿™ä¸œè¥¿å¯ä»¥æŠ½å‡ºæ¥ï¼Œä¸è¦è¢«é¡¹ç›®æŸç¼šï¼Œå…ˆæ˜¯æƒ³åˆ°äº†ideaæ’ä»¶ï¼Œä½†æ˜¯å‘ç° Api åŠå…¶ä¸åŒï¼Œideaä¸­ä¹Ÿæ— æ³•è·å– Classï¼Œä¹Ÿå°±æ˜¯å½“æ—¶å†™çš„ä»£ç æ— æ³•å¤ç”¨ï¼Œäºæ˜¯åˆè€ƒè™‘ maven æ’ä»¶ï¼Œå‘ç°è¿™ä¸ªæ˜¯å¯ä»¥å–åˆ° Classï¼Œè¿›è¡Œå¤ç”¨çš„ã€‚</p>
<p>å†™å®Œåï¼Œåˆå‘ç°ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼Œå¿…é¡»è®¾ç½®å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ä½ è¦ç”Ÿæˆé‚£ä¸ªç±»çš„æ–‡æ¡£ï¼Œå¾ˆéº»çƒ¦å•Šè¿™ï¼Œäºæ˜¯æƒ³åˆ°ä¹‹å‰çœ‹ideaæ’ä»¶çš„ä¸€äº›apiå¯ä»¥è·å–åˆ°è¿™äº›ä¿¡æ¯ï¼Œå¹²è„†æ¥äº†ä¸ªç»“åˆï¼Œideaå³é”®è·å–Class çš„å…¨é™å®šåï¼Œä¼ ç»™mavenæ’ä»¶ï¼Œmavenæ’ä»¶æ¥ç”Ÿæˆï¼Œæœ€åideaå¼¹æ¡†å±•ç¤ºã€‚å…¶å®è¿™æ ·ä¹Ÿä¸é”™ï¼Œä½†æ˜¯åˆæœ‰ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œå°±æ˜¯mavenæ’ä»¶å…¶å®ä¾èµ–äº target æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼Œè¿™éƒ¨åˆ†å¿…é¡» compile åæ‰æœ‰ï¼Œä½¿å¾—æ¯æ¬¡è¿è¡Œæ’ä»¶éƒ½è¦å…ˆè·‘compile å†ç”Ÿæˆï¼Œæœ¬æ¥mavenè¿è¡Œé€Ÿåº¦å°±æ…¢ï¼Œè¿™æ ·å°±æ›´æ…¢äº†ã€‚åŠ ä¸Šè¿›åº¦æ¡åè¿˜æ˜¯æ„Ÿè§‰ä½“éªŒæå·®ï¼ï¼ï¼</p>
<p>æœ€ç»ˆï¼Œåœ¨æŸä¸ªå¤œé»‘é£é«˜çš„æ™šä¸Šï¼Œæˆ‘æ­»æ´»ç¡ä¸ç€è§‰ï¼Œå¹²è„†æ‰“å¼€ç”µè„‘ï¼Œç‚¹å‡»å¤‡å¿˜å½•ï¼Œè®°ä¸‹æ˜å¤©æ‘¸é±¼æ—¶é—´è¦å†™ä¸ªçº¯ideaæ’ä»¶ï¼Œç„¶åèººä¸‹æ•°ç¾Šï¼å•Šé‚£æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>ä¸è¿‡è¿™æ’ä»¶æœ€ç»ˆç¡®å®éƒ½æ˜¯åœ¨é—²çš„æ²¡æ´»å¹²çš„æ‘¸é±¼æ—¶é—´å†™çš„ï¼Œæœ€ç»ˆæŠŠåŸæ¥ä»£ç æ‹·è´ä¸€ä»½åˆ°ideaæ’ä»¶é¡¹ç›®ä¸­ï¼Œä¸€è¾¹å‚ç…§ä¸€è¾¹ä½¿ç”¨ideaæä¾›çš„Apiä¿®æ”¹ä»£ç ï¼Œæœ€ç»ˆå¾—åˆ°äº†çº¯ideaæ’ä»¶ç‰ˆæœ¬ï¼</p>
<p>ä¹‹åé‡åˆ°äº†æ¯”è¾ƒå‘çš„ç‚¹å°±æ˜¯æ³›å‹çš„è§£æå’Œå‚æ•°çš„è§£æï¼Œç›®å‰éƒ½è§£å†³äº†ï¼Œå¯ä»¥è¯´æ˜¯éšä¾¿æ€ä¹ˆå†™ï¼Œéƒ½èƒ½è¯†åˆ«äº†ã€‚æ¯”å¦‚æœ€ä¸Šé¢çš„ç¤ºä¾‹ä»£ç çš„ <code>T data</code>ï¼Œè¿™è¿˜æ˜¯å° caseï¼Œå¦‚æœæ”¹æˆ <code>List&lt;T&gt;</code> å‘¢? å¦‚æœå†æ¥ä¸€ä¸ªå¸¦æ³›å‹çš„ç±» <code>PageInfo&lt;T&gt;</code> ,è€Œæˆ‘åŠ ä¸ªå­—æ®µ <code>PageInfo&lt;T&gt; pageData;</code>æ¥æŠŠ T ä¼ ç»™ PageInfo å‘¢ï¼Œè§£æä¼šæœ‰é—®é¢˜å—ï¼Ÿåˆšå¼€å§‹ä¼šï¼Œåæ¥è§£å†³äº†ï¼ï¼ï¼åªèƒ½è¯´æˆ‘è‡ªå·±éƒ½å¿«ç»•æ™•äº†ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯è§£å†³äº†ã€‚è¿™å…¶å®å€¼å¾—å¤ç›˜çš„ï¼Œä¸è¿‡æˆ‘è¿™äººæ¯”è¾ƒæ‡’ï¼Œå°±ä¸æäº†ã€‚å…¶å®è¿™ç§æƒ…å†µç¹å¤šçš„æ—¶å€™ï¼Œè¦å†™ä»£ç ä¸èƒ½åªè€ƒè™‘éƒ¨åˆ†æƒ…å†µï¼Œæˆ–æ˜¯æ¥ä¸€ç§æƒ…å†µåŠ ä¸€ç§æƒ…å†µï¼Œå¿…é¡»æ‰¾åˆ°é€šç”¨çš„æ–¹æ³•ï¼Œå½“ç„¶æœªå¿…ä»€ä¹ˆæ—¶å€™éƒ½æœ‰é€šç”¨çš„æ–¹æ³•ï¼Œä¸è¿‡è¿˜æ˜¯è¦å»è¿½æ±‚çš„ï¼ï¼</p>
</blockquote>
<p>åç»­è¿˜ä¼šå’Œå¤§å®¶åˆ†äº«ä¸€äº›æˆ‘æ’ä»¶ä¸­çš„æ ¸å¿ƒä»£ç ï¼ŒåŒ…æ‹¬ideaæ’ä»¶æä¾›çš„apiï¼Œè‡ªå·±ç™¾åº¦æ‰¾çš„å·¥å…·ç±»ç­‰ç­‰ã€‚</p>
<p>å¦å¤–æˆ‘ä¸Šé¢è¯´çš„å¾®æœåŠ¡é‚£ä¸ªæ¥å£æ–‡æ¡£ï¼Œå…¶å®å°±æ˜¯ä¸å¸¦ï¼ˆrestfulï¼‰åç¼€çš„èœå•é€‰é¡¹ï¼Œå…¶ç”Ÿäº§çš„æ–‡æ¡£ä¸å«æœ‰HTTPåè®®ç›¸å…³çš„ä¿¡æ¯ï¼Œè€Œæ˜¯çº¯ç²¹çš„å…¥å‚ã€å‡ºå‚ã€codeå«ä¹‰ç­‰ã€‚å¦å¤–æ–‡ä»¶è§†å›¾å³é”®æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼Œå¦å¤–å¦ä¸ªå°±æ˜¯æ‰¹é‡ç”Ÿæˆ Markdownæ–‡ä»¶ï¼Œæ¯•ç«Ÿä¸€ä¸ªä¸€ä¸ªå¤åˆ¶ç²˜è´´å¾ˆç´¯çš„ï¼Œè€Œå¾ˆå¤šç¬”è®°è½¯ä»¶éƒ½æ”¯æŒæ‰¹é‡å¯¼å…¥Markdownæ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸å°±ç®€å•äº†ã€‚</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/04/01/simple-principle-spring-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/01/simple-principle-spring-md/" class="post-title-link" itemprop="url">ç®€å•è¯´ Spring åŸç†</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-04-01 21:49:19 / ä¿®æ”¹æ—¶é—´ï¼š23:45:54" itemprop="dateCreated datePublished" datetime="2021-04-01T21:49:19+08:00">2021-04-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/simple-principle/" itemprop="url" rel="index"><span itemprop="name">simple-principle</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/04/01/simple-principle-spring-md/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/04/01/simple-principle-spring-md/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ç®€å•è¯´-Spring-åŸç†"><a href="#ç®€å•è¯´-Spring-åŸç†" class="headerlink" title="ç®€å•è¯´ Spring åŸç†"></a>ç®€å•è¯´ Spring åŸç†</h2><blockquote>
<p>æˆ‘å…ˆæ¥ï¼Œåƒä¸‡åˆ«è¾ƒçœŸï¼Œåƒä¸‡åˆ«è¾ƒçœŸï¼Œåƒä¸‡åˆ«è¾ƒçœŸï¼</p>
</blockquote>
<p>å…ˆçœ‹å®˜ç½‘ä»‹ç»å“ˆ</p>
<blockquote>
<p>The Spring Framework provides a comprehensive programming and configuration model for modern Java-based enterprise applications - on any kind of deployment platform.</p>
<p>A key element of Spring is infrastructural support at the application level: Spring focuses on the â€œplumbingâ€ of enterprise applications so that teams can focus on application-level business logic, without unnecessary ties to specific deployment environments.</p>
</blockquote>
<p>æˆ‘æ¥ç¿»è¯‘ä¸€ä¸‹ï¼Œå°±æ˜¯è¯´ï¼ˆç­‰ç­‰ï¼Œæˆ‘è½¯ä»¶å‘¢ï¼Ÿè°åŠ¨äº†å•Šï¼ï¼‰</p>
<p>é¢ï¼Œå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p>Springæ¡†æ¶ä¸ºä»»ä½•ç±»å‹çš„éƒ¨ç½²å¹³å°ä¸Šçš„åŸºäºJavaçš„ç°ä»£ä¼ä¸šåº”ç”¨ç¨‹åºæä¾›äº†å…¨é¢çš„ç¼–ç¨‹å’Œé…ç½®æ¨¡å‹ã€‚</p>
<p>Springçš„ä¸€ä¸ªå…³é”®å…ƒç´ æ˜¯åœ¨åº”ç”¨ç¨‹åºçº§åˆ«çš„åŸºç¡€æ¶æ„æ”¯æŒï¼šSpringä¸“æ³¨äºä¼ä¸šåº”ç”¨ç¨‹åºçš„â€œç®¡é“â€ï¼Œä»¥ä¾¿å›¢é˜Ÿå¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºçº§åˆ«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸å¿…ä¸ç‰¹å®šçš„éƒ¨ç½²ç¯å¢ƒå»ºç«‹ä¸å¿…è¦çš„è”ç³»ã€‚</p>
</blockquote>
<p>ç®€å•ç†è§£å‘¢å°±æ˜¯è®©ä½ å…³æ³¨ä¸šåŠ¡è€Œéçç¢çš„ã€æ— å…³ç´§è¦çš„å…¶ä»–ä¸œè¥¿ã€‚å¥½çš„ï¼Œé‚£ä¹ˆ Spring æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸éš¾ï¼Œå…ˆè¿™æ ·ï¼Œå†è¿™æ ·ï¼Œç„¶åå†é‚£æ ·ï¼Œæœ€åå†è¿™æ ·ï¼ˆå•Šï¼Œæ”¾é”™äº†ï¼‰</p>
<p>å…¶å®ä¹Ÿä¸éš¾ï¼Œä¸»è¦æ˜¯å®ƒæœ‰ä¸¤å¤§æ³•å®ï¼Œå”‰ï¼ŒçŸ¥é“çš„åŒå­¦è‚¯å®šè¦è¯´äº†å•Šï¼›æˆ‘çŸ¥é“ï¼ŒIOCã€AOPå˜›ï¼æ²¡é”™å°±æ˜¯è¿™ä¸¤ç©æ„ï¼Œå“ªæ€•æ˜¯è¿˜æ²¡å†…å·é‚£ä¼šï¼Œæˆ‘ä¹Ÿå¬è…»äº†ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥å” å¨å” å¨è¿™ä¸¤ç©æ„å®ƒçš„ä¸€äº›åŸç†æˆ–è€…è¯´ç‰¹ç‚¹ã€‚</p>
<h3 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h3><p>å’±å…ˆè¯´è¿™ IOCï¼Œè‹±æ–‡é‚£å°±æ˜¯ Inversion of Controlï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæ§åˆ¶åè½¬ï¼Œä¸è®©ä½ æ§åˆ¶æˆ‘äº†ï¼Œæˆ‘è¦è‡ªå·±æ§åˆ¶è‡ªå·±ï¼Œè¿™å°±æ˜¯æ§åˆ¶åè½¬ï¼Œæˆ‘è¯´é‚£è¿˜å¾—äº†ï¼Œè¿™ç¨‹åºå®ƒä¸å¬è¯äº†éƒ½ï¼å”‰ï¼Œä¸æ˜¯è¿™æ ·ç†è§£çš„ï¼Œå…¶å®å•Šï¼Œè¿™ä»£è¡¨è¿™ç¨‹åºï¼Œå®ƒæˆç†Ÿäº†ï¼Œå®ƒå‘€ï¼Œå¯ä»¥è‡ªå·±å¹²è‡ªå·±è¯¥å¹²çš„äº‹æƒ…äº†ï¼Œä¸éœ€è¦ä½ ç®¡å®ƒäº†ï¼›è¿™æ ·å­æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿæœ‰å•Šï¼Œå°±åƒä½ å®¶çš„ç†Šå­©å­ï¼Œè¿˜å°çš„æ—¶å€™ï¼Œç‰¹åˆ«é»äººï¼Œä¸èƒ½æ²¡äººå¸¦ï¼Œä½ å‘¢ï¼Œæ€»æ˜¯éœ€è¦æ‰¾äººå¸®å¿™çœ‹çœ‹ï¼Œè‡ªå·±æ‰æœ‰ç©ºé—²å‡ºå»ç©ï¼Œåæ¥å‘¢ï¼Œå®ƒé•¿å¤§äº†ï¼Œå®ƒå°±ä¼šè‡ªå·±å‡ºå»ç©äº†ï¼Œç†Šæ˜¯ç†Šäº†ç‚¹ï¼Œä½†ä½ ä¹Ÿç©ºé—²ä¸å°‘å•Šï¼Œæœ‰æ—¶é—´å¯ä»¥çœ‹çœ‹ä¹¦ï¼Œå–å–èŒ¶ï¼Œå¤šå¥½å•Šï¼å’±è¯´å›æ¥å•Šï¼Œè¿™æ§åˆ¶åè½¬å‘¢ï¼Œå°±æ˜¯è®©ä½ å°‘èŠ±è´¹å¿ƒæ€åœ¨è¿™äº›åœ°æ–¹ï¼Œè¿™æ ·ä¸å°±å¯ä»¥åƒå®˜ç½‘è¯´çš„ â€œå¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºçº§åˆ«çš„ä¸šåŠ¡é€»è¾‘â€äº†å—ã€‚</p>
<p>é‚£å‰é¢å‘¢ï¼Œå…¶å®åªæ˜¯IOCçš„ä¸€ä¸ªæ€æƒ³ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå®ç°ï¼Œæ¯•ç«Ÿå•Šï¼Œä½ ä¸èƒ½æŒ‡æœ›å®ƒçœŸçš„èƒ½è‡ªå·±æ§åˆ¶è‡ªå·±ã€‚æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬å·å·å¼•å…¥ä¸€ä¸ªä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯å®¹å™¨ï¼Œç”±è¿™ä¸ªå®¹å™¨æ¥ç®¡ç†å®ƒã€‚è¿™ä¸ªå•Šï¼Œå°±åƒä½ æŠŠä½ å®¶å°å­©é€å¹¼å„¿å›­ï¼Œä½ äº¤é’±ï¼Œå‰©ä¸‹äº¤ç»™å¹¼å„¿å›­ã€‚é‚£ä¹ˆè¯´åˆ°è¿™é‡Œå•Šï¼Œå¤§å®¶åº”è¯¥ä¹Ÿæ˜ç™½äº†ï¼Œå®ƒå‘¢ï¼Œå¹¶ä¸èƒ½è‡ªå·±æ§åˆ¶è‡ªå·±ï¼Œè¿˜æ˜¯å¾—é å®¹å™¨ï¼›é‚£ä¹ˆè¿™ä¸ªå®¹å™¨ï¼Œåˆæ˜¯ä½•æ–¹ç¥åœ£å‘¢ï¼Ÿ</p>
<p>å…¶å®è¿™ä¸ªå®¹å™¨å‘¢ï¼Œä¹Ÿä¸éš¾ï¼Œåå‰¯å…¶å®ï¼Œå°±æ˜¯ä¸€ä¸ªè£…ä¸œè¥¿çš„ä¸œè¥¿ï¼Œæœ‰äººè¯´ä½ å¥—å¨ƒå‘¢ï¼Ÿæˆ‘æ²¡æœ‰ï¼Œä¸è¿‡è¿™å®¹å™¨ç¡®å®ä¸ç¦æ­¢ä½ å¾€å®¹å™¨æ”¾å®¹å™¨ï¼Œæ¯”å¦‚çˆ¶å­å®¹å™¨ï¼Œå°±åƒå­å®¹å™¨å¡è¿›äº†çˆ¶å®¹å™¨é‡Œé¢ï¼Œæœ‰æ—¶å€™å‘¢ï¼Œå°±ä¼šç©¿è¿‡å­å®¹å™¨ï¼Œä»çˆ¶å®¹å™¨å–ä¸œè¥¿ã€‚å¥½äº†å’±è¯´å›æ¥ï¼Œå®¹å™¨å°±æ˜¯ä¸€å­˜ä¸œè¥¿çš„ï¼Œè¿™ä¸œè¥¿å¾ˆå¸¸è§å•Šï¼ŒJava é›†åˆæ¡†æ¶å•Šï¼Œå¤§å­¦å­¦è¿‡ï¼Œè¿˜å­¦äº†å¥½å‡ ä¸ªï¼Œæˆ‘ç°åœ¨è¿˜è®°å¾—ï¼Œä»€ä¹ˆ Listï¼ŒMapï¼ŒSet å•¥çš„ã€‚å¯¹ï¼æ²¡é”™ï¼ŒçœŸè®©ä½ è’™å¯¹äº†ï¼åŸç†ç¡®å®æ˜¯è¿™ä¸ªï¼Œè¿™ä¸ªä¸œè¥¿å‘¢ï¼Œé€‰æ¥é€‰å–ï¼Œæˆ‘ä»¬å°±é€‰ Map å§ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒMap æ˜¯æ•°ç»„+é“¾è¡¨ä¸ºåº•å±‚å®ç°çš„é”®å€¼å¯¹å®¹å™¨å•Šï¼Œå› ä¸ºæœ‰è¿™ä¸ªé”®å€¼å¯¹çš„å­˜åœ¨å‘¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥éå¸¸å‡†ç¡®æ— è¯¯çš„å­˜æ”¾å’Œè¯»å–ï¼Œå°±åƒé“¶è¡Œè´¦æˆ·å§ï¼Œä½ å¾€ä½ è´¦æˆ·å­˜é’±ï¼Œå†ä»ä½ è´¦æˆ·å°±èƒ½å–åˆ°ä¹‹å‰å­˜çš„é’±ï¼Œéå¸¸æœ‰æ•ˆçš„é¿å…äº†â€œä¹±æ‹¿ä¹±æ”¾â€é—®é¢˜ã€‚å¥½çš„ï¼Œé‚£æˆ‘ä»¬å°±è¯´å®Œäº†å®¹å™¨çš„ç¬¬ä¸€ä¸ªç‰¹ç‚¹ï¼Œå°±æ˜¯èƒ½å­˜èƒ½å–ï¼Œè¿™æ—¶å€™ä½ å°±ä¼šè¯´ï¼Œè¿™ä¸åºŸè¯å—ï¼Ÿå•Šç¡®å®ï¼è¡Œï¼Œæˆ‘ä»¬æ•´ç‚¹æ­£å¸¸çš„ç‰¹ç‚¹ï¼Œé‚£å…¶å®æ¥ä¸‹æ¥è¦è¯´çš„ç‰¹ç‚¹å‘¢ï¼Œéƒ½æ˜¯å›´ç»•ç€å–è¿™ä¸ªåŠ¨ä½œçš„ã€‚</p>
<p>å…¶å®ä¸Šé¢çš„ç‰¹ç‚¹å‘¢ï¼Œè¯´çš„ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œè¿™å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿå–çš„åˆæ˜¯ä»€ä¹ˆï¼Ÿæ€»ä¸å¯èƒ½å’Œé“¶è¡Œä¸€æ ·ï¼Œéƒ½æ˜¯é’±å§ï¼å½“ç„¶ä¸æ˜¯ï¼Œè¿™å­˜çš„å‘¢ï¼Œä¸€èˆ¬æ˜¯ Classã€‚ä»€ä¹ˆæ˜¯ Classï¼Ÿ Class å°±æ˜¯ä¸€è®¾è®¡å›¾ï¼Œç…§ç€è¿™ä¸ªè®¾è®¡å›¾å‘¢ï¼Œå®¹å™¨ Duang çš„ä¸€ä¸‹ï¼Œå°±ç»™äº†ä¸€ä¸ªå¯¹è±¡ï¼ä½ è¯´è¿˜æœ‰è¿™å¥½äº‹ï¼Ÿå†™ä¸ªä»£ç è¿˜æœ‰å¯¹è±¡é¢†ï¼Ÿä¸æ˜¯çš„ï¼Œè¿™ä¸ªå¯¹è±¡å‘¢ï¼Œä¸æ˜¯é‚£ä¸ªå¯¹è±¡å“ˆï¼Œè¿™ä¸ªå‘¢ï¼Œæ˜¯ Java å®ä¾‹åŒ–å‡ºæ¥çš„å¯¹è±¡ï¼Œç”¨æ¥è°ƒç”¨æ–¹æ³•ï¼Œè·å–å­—æ®µçš„ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªå®¹å™¨ï¼Œå®ƒè¿˜æ˜¯ä¸ªå·¥å‚ï¼Ÿå®ƒè¿˜èƒ½ç”Ÿäº§å¯¹è±¡å‘¢ï¼æ²¡é”™ï¼Œä½†ä¸¥æ ¼è¯´å¯¹è±¡å…¶å®ä¹Ÿä¸æ˜¯å®ƒç”Ÿäº§çš„ï¼Œå¯¹è±¡å‘¢ï¼Œå…¶å®æ˜¯ JVM ç”Ÿäº§çš„å¯¹ä¸å¯¹ï¼Ÿå®ƒå‘¢ï¼Œå°±è´Ÿè´£åŠ å·¥ï¼Œæ‰€ä»¥è¯´ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ä¸ªåŠ å·¥å·¥å‚ã€‚æ‰€ä»¥å’±è¿™ç¬¬äºŒä¸ªç‰¹ç‚¹å‘¢ï¼Œå°±æ˜¯å·¥å‚ï¼Œèƒ½ç…§ç€è®¾è®¡å›¾åŠ å·¥ä¸€ä¸ªå¯¹è±¡å‡ºæ¥ã€‚ä½ è‚¯å®šè¦è¯´å•¦ï¼Œè¿™æœ‰å•¥ç”¨ï¼Œè¿™ä¸äº§ç”Ÿä¸­é—´å•†å·®ä»·äº†ï¼Œæˆ‘ç›´æ¥æ‰¾ JVM çˆ¸çˆ¸è¡Œä¸è¡Œï¼Ÿåˆ«æ€¥ï¼Œå¯ä»¥æ˜¯å¯ä»¥ï¼Œä½†å’±ç”¨è¿™ä¸ªä¸œè¥¿ï¼Œå°±ä¸€ç‚¹æœ‰å®ƒçš„ç”¨å¤„ï¼Œå¯¹ä¸å¯¹ï¼Ÿè¿™ä¸ï¼Œç¬¬ä¸‰ä¸ªç‰¹ç‚¹å°±æ¥äº†ï¼</p>
<p>é‚£ä¹ˆèªæ˜çš„å°ä¼™ä¼´å‘¢ï¼Œè‚¯å®šå·²ç»çŸ¥é“æˆ‘è¦è®²ä»€ä¹ˆäº†ï¼Ÿå¯¹ï¼Œæ²¡é”™ï¼å°±æ˜¯ä¾èµ–æ³¨å…¥ï¼Œå‰é¢è¯´äº† Class æ˜¯ä¸€ä¸ªè®¾è®¡å›¾ï¼Œä½†æ²¡è¯´æ¸…æ¥šï¼Œè¿™ä¸ªè®¾è®¡å›¾å‘¢ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªå°é›¶ä»¶çš„è®¾è®¡å›¾ï¼Œä½†å’ŒçœŸæ­£çš„é›¶ä»¶è®¾è®¡å›¾è¿˜æ˜¯æœ‰ä¸€äº›ä¸ä¸€æ ·çš„ï¼Œæ¯”æ–¹è¯´å•Šï¼Œå®ƒä¼šå‘Šè¯‰ä½ å®ƒä¸å¦ä¸€ä¸ªé›¶ä»¶çš„å…³ç³»ï¼Œæœ‰äº†è¿™ä¸ªå…³ç³»å‘¢ï¼Œå·¥å‚çš„ä½œç”¨å°±æœ‰äº†ï¼Œå·¥å‚ç”Ÿäº§åˆ°ä¸€åŠï¼Œå‘ç°è¿™ä¸ªé›¶ä»¶è¦åŠ å·¥å¥½å•Šï¼Œè¿˜éœ€è¦å¦ä¸€ä¸ªé›¶ä»¶ï¼Œé‚£å®ƒåˆè½¬å¤´å»ç”Ÿäº§å¦ä¸€ä¸ªé›¶ä»¶ï¼ˆæ˜¯ä¸æ˜¯éå¸¸ä¸ç§‘å­¦ï¼Œä¸åº”è¯¥å…ˆæ‰¹é‡ç”Ÿäº§å‡ºæ¥ï¼Œä¹‹åå†ä¸€èµ·ç»„è£…å—ï¼Ÿï¼‰ï¼Œç”Ÿäº§å¥½äº†å‘¢ï¼Œåˆå›è¿‡æ¥æŒ‰è®¾è®¡å›¾æŠŠå¦ä¸€ä¸ªé›¶ä»¶åŠ åˆ°è¿™ä¸ªé›¶ä»¶ä¸Šå»ã€‚å¦‚æœç”Ÿäº§å¦ä¸€ä¸ªé›¶ä»¶çš„æ—¶å€™å‘ç°ï¼Œä¹Ÿä¾èµ–å¦å¤–æŸä¸ªé›¶ä»¶ï¼Œé‚£ä¹Ÿç…§æ—§ï¼Œå…ˆç”Ÿäº§ä¾èµ–çš„ã€‚è¿™æ—¶å€™ä½ è‚¯å®šä¼šè¯´äº†ï¼Œå¥—å¨ƒå°±ç®—äº†ï¼Œä¸‡ä¸€ä½ ä¾èµ–æˆ‘ï¼Œæˆ‘ä¾èµ–ä½ ï¼Œé‚£ä¸æ— é™å¥—å¨ƒäº†å—ï¼Ÿè¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ‰åŠæ³•è§£å†³ï¼Œä½†æ˜¯è¿™æ–‡ç« å¤ªçŸ­äº†ï¼Œæˆ‘å†™ä¸ä¸‹ï¼ï¼ˆè¯·å«æˆ‘è´¹é©¬ Â· å¿ƒç´¯ï¼‰</p>
<p>æœ€åè¯´ä¸‹å®¹å™¨çš„å¦ä¸€ä¸ªç‰¹ç‚¹ï¼Œå…¶å®éƒ½æ˜¯å±‚å±‚é€’è¿›çš„ï¼Œä½ ç”šè‡³å¯ä»¥è®¤ä¸ºï¼Œåªæœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œéƒ½è¡Œï¼Œçœ‹ä½ æ€ä¹ˆçœ‹ï¼</p>
<p>è¿™ä¸ªç‰¹ç‚¹å‘¢å°±æ˜¯æ’ä»¶ DIYï¼ä¹‹å‰å’±ä¹Ÿè¯´äº†ï¼Œå·¥å‚å‘¢ï¼Œä¸æç”Ÿäº§ï¼Œå…‰åšåŠ å·¥äº†ï¼Œé‚£è¿™ä¸ªåŠ å·¥è¿‡ç¨‹å•Šï¼Œé™¤äº†ä¾èµ–æ³¨å…¥å•Šï¼Œä¸€äº›å±æ€§é…ç½®æ³¨å…¥è¿™æ ·çš„é€šè¿‡é…ç½®çš„æ–¹å¼å»å½±å“å¯¹è±¡ï¼Œèƒ½ä¸èƒ½å¼€æ”¾ä¸€ä¸ªæ¥å£ï¼Œæˆ‘æƒ³æ€ä¹ˆ DIYï¼Œè‡ªå·±å†™ä»£ç æ¥å®ç°å‘¢ï¼Ÿå½“æ—¶æ˜¯å¯ä»¥çš„å•Šï¼è¿™æ ·çš„æ¥å£å‘¢ï¼ŒSpring æ—©å°±å‡†å¤‡å¥½äº†ï¼Œæ‚¨å‘¢ï¼Œåªéœ€è¦å®ç°è¿™ä¸ªæ¥å£ï¼Œå†™ç‚¹ä»£ç ï¼Œå†æŠŠå®ƒæ”¾åˆ°å®¹å™¨é‡Œé¢å»ï¼Œå·¥å‚å‘¢ï¼Œå°±ä¼šåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œä½ çš„ä»£ç ã€‚è€Œä¸”ä»–è¿™ä¸ªæ¥å£å‘¢ï¼Œä¸€å…±æœ‰å¥½å‡ ä¸ªï¼Œæ¯ä¸ªæ¥å£å‘¢ï¼Œä¹Ÿå¥½å¥½å‡ ä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å•Šï¼Œéƒ½æ˜¯ä»£è¡¨äº†ç›¸åº”çš„æ—¶æœºã€‚è¿™æ—¶å€™ä½ å°±è¦é—®äº†ï¼Œè¿™æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿåˆ«æ€¥ï¼Œå’‹çœ‹çœ‹ Spring æ€ä¹ˆç”¨çš„ï¼ï¼ˆå†å¤šå˜´ä¸€å¥å•Šï¼Œå¹²é¢„åŠ å·¥è¿‡ç¨‹ç®—ä»€ä¹ˆï¼Œå¹²é¢„å·¥å‚æœ¬èº«æ‰ç‰›é€¼å‘¢ï¼æˆ‘è¯´çš„å•¥ï¼Œæ‡‚å¾—éƒ½æ‡‚ï¼ï¼‰</p>
<h3 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h3><p>Spring çš„ AOP å•Šï¼Œç»ˆäºè¯´åˆ°äº†ï¼Œå…¶å®å‘¢ï¼Œå°±æ˜¯å¹²é¢„åŠ å·¥è¿‡ç¨‹çš„ä¸€ä¸ªäº§ç‰©ï¼è‘—åå†å²äº‹ä»¶ç‹¸çŒ«æ¢å¤ªå­å¤§å®¶éƒ½å¬è¿‡å§ï¼ŒAOP å‘¢ï¼Œé‚£æ˜¯ä¸€æ¨¡ä¸€æ ·ã€‚è‘—åçš„æ›¹æ“æŒŸå¤©å­ä»¥ä»¤è¯¸ä¾¯éƒ½å¬è¿‡å§ï¼ŒAOP å‘¢ï¼Œè¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·ï¼</p>
<p>è¿™ä¸¤ä¸ªå‘¢ï¼Œä¸€ä¸ªæ˜¯è¯´çš„ AOP çš„å®ç°åŸç†ï¼Œå¦ä¸€ä¸ªè¯´çš„ï¼Œå°±æ˜¯å®ƒçš„ç‰¹ç‚¹ï¼šæŠŠçœŸæ­£çš„å¯¹è±¡å½“å‚€å„¡ä½¿ï¼</p>
<p>å’±å…ˆè¯´è¯´å®ç°åŸç†å•Šï¼Œå…¶å®ä¹Ÿä¸éš¾ï¼ˆè¯·é—®è¿™æ˜¯ç¬¬å‡ éï¼Ÿï¼‰ï¼Œå·¥å‚éƒ½è¢«å’±åŠ«æŒäº†ï¼ŒåŠ å·¥çš„æ—¶å€™ï¼Œå¾—åˆ°æˆå“äº†çš„æ—¶å€™ï¼Œåšä¸€ä¸ªå£³å­ï¼šä»£ç†å¯¹è±¡ï¼ŒæŠŠçœŸæ­£çš„å¯¹è±¡è£…è¿›å»ï¼Œè¿™æ ·å‘¢ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•è¢«è°ƒç”¨ï¼Œéƒ½æ˜¯å…ˆåˆ°ä»£ç†å¯¹è±¡è¿™é‡Œï¼Œä»£ç†å¯¹è±¡å‘¢ï¼Œæ“çºµç€çœŸæ­£çš„å¯¹è±¡ï¼Œå¿ƒæƒ…å¥½äº†ï¼Œå°±æ‰§è¡Œä¸€ä¸‹çœŸæ­£çš„å¯¹è±¡å¯¹åº”çš„æ–¹æ³•ï¼Œå¾—åˆ°åŠ³åŠ¨æœå®åå‘¢ï¼Œå†è¿”å›å‡ºå»ï¼Œè°ä¹Ÿä¸çŸ¥é“çœŸæ­£çš„å¯¹è±¡ã€‚å°±å¥½åƒå…‰å¬ç€æ”¶éŸ³æœºï¼Œä¸çŸ¥é“çš„è¿˜ä»¥ä¸ºå£°éŸ³éƒ½æ˜¯æ”¶éŸ³æœºç”Ÿäº§çš„ï¼Œå…¶å®é‚£å°±æ˜¯ä¸ªä»£ç†ï¼ŒçœŸæ­£åˆ›é€ å£°éŸ³çš„äººï¼Œè¿œåœ¨å¤©æ¶¯å‘¢ï¼æ‰€ä»¥è¯´å•Šï¼ŒAOP çš„ç‰¹ç‚¹æ˜¯ä¸æ˜¯å¦‚æˆ‘æ‰€è¨€å‘¢ï¼</p>
<p>OKå„ä½ï¼Œè¿™å°±æ˜¯è¿™æœŸæ–‡ç« çš„å…¨éƒ¨å†…å®¹å•¦ï¼Œéå¸¸æ„Ÿè°¢ä½ èƒ½çœ‹åˆ°è¿™é‡Œï¼Œå¦‚æœä½ è§‰å¾—å†™çš„è¿˜ä¸é”™çš„è¯ï¼Œæ±‚èµï¼Œæ±‚æ”¶è—ï¼Œæ±‚ç¡¬å¸ï¼ˆè¿™å•¥ç©æ„ï¼‰ï¼Œæ±‚è½¬å‘ï¼Œæœ€é‡è¦çš„æ˜¯ç‚¹ä¸ªå¤§å¤§çš„å…³æ³¨ï¼ä½ çš„æ”¯æŒå°±æ˜¯æˆ‘åšæ–‡ç« çš„æœ€å¤§åŠ¨åŠ›ï¼OKå„ä½ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ï¼ï¼ˆåŠ¨ä½œæŒ‡å¯¼ï¼šä½•åŒå­¦ï¼‰</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/02/04/principle-jvm-memo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/04/principle-jvm-memo/" class="post-title-link" itemprop="url">JVM åº•å±‚æ¢ç§˜ç¬”è®°</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-04 11:07:44" itemprop="dateCreated datePublished" datetime="2021-02-04T11:07:44+08:00">2021-02-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:53:51" itemprop="dateModified" datetime="2021-03-28T19:53:51+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/jvm/" itemprop="url" rel="index"><span itemprop="name">jvm</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/02/04/principle-jvm-memo/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/02/04/principle-jvm-memo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JVM-åº•å±‚æ¢ç§˜ç¬”è®°"><a href="#JVM-åº•å±‚æ¢ç§˜ç¬”è®°" class="headerlink" title="JVM åº•å±‚æ¢ç§˜ç¬”è®°"></a>JVM åº•å±‚æ¢ç§˜ç¬”è®°</h1><h2 id="JVM-é€Ÿè®°"><a href="#JVM-é€Ÿè®°" class="headerlink" title="JVM é€Ÿè®°"></a>JVM é€Ÿè®°</h2><h3 id="ä»€ä¹ˆæ˜¯-JVM"><a href="#ä»€ä¹ˆæ˜¯-JVM" class="headerlink" title="ä»€ä¹ˆæ˜¯ JVM?"></a>ä»€ä¹ˆæ˜¯ JVM?</h3><blockquote>
<p> JVM å°±æ˜¯ç”±ç¼–è¯‘å™¨, ç±»åŠ è½½å™¨, æ‰§è¡Œå¼•æ“, è¿è¡Œæ—¶æ•°æ®åŒºç»„æˆ. å…¶ä¸­æ•°æ®åŒºåŒ…å« å †,æ ˆ,æœ¬åœ°æ–¹æ³•æ ˆ, æ–¹æ³•åŒºå’Œç¨‹åºè®¡æ•°å™¨(PC å¯„å­˜å™¨), å…¶ä¸­æ ˆæ˜¯ç”±å±€éƒ¨å˜é‡è¡¨, æ“ä½œæ•°æ ˆ, åŠ¨æ€é“¾æ¥, è¿”å›åœ°å€ç»„æˆçš„.</p>
</blockquote>
<h3 id="ä½ æ˜¯æ€ä¹ˆå¯¹-jvm-åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„"><a href="#ä½ æ˜¯æ€ä¹ˆå¯¹-jvm-åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„" class="headerlink" title="ä½ æ˜¯æ€ä¹ˆå¯¹ jvm åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„?"></a>ä½ æ˜¯æ€ä¹ˆå¯¹ jvm åƒåœ¾å›æ”¶è¿›è¡Œä¼˜åŒ–çš„?</h3><blockquote>
<p>æ ¹æ®æœåŠ¡å™¨çš„é…ç½®, è°ƒæ•´é’å¹´ä»£å’Œè€å¹´ä»£çš„å†…å­˜å¤§å°åŠæ¯”ä¾‹, åœ¨å›æ”¶é¢‘ç‡å’Œå›æ”¶é€Ÿåº¦ä¸Šåšå–èˆ, ä½¿ç”¨ G1 åƒåœ¾å›æ”¶æœŸæ§åˆ¶ STW åœé¡¿æ—¶é—´, æé«˜ååé‡.</p>
</blockquote>
<h3 id="JVM-å†…å­˜æ¨¡å‹"><a href="#JVM-å†…å­˜æ¨¡å‹" class="headerlink" title="JVM å†…å­˜æ¨¡å‹"></a>JVM å†…å­˜æ¨¡å‹</h3><blockquote>
<p>æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å†…å­˜åŒºåŸŸ, å¤šçº¿ç¨‹ä¹‹é—´é€šä¿¡ä¸»è¦é€šè¿‡å…±äº«å†…å­˜æ¥å®ç°.</p>
</blockquote>
<ul>
<li>æœ‰åºæ€§: åœ¨ CPU æ‰§è¡ŒæŒ‡ä»¤æ—¶, å¯èƒ½ä¼šå¯¹é happens-before æŒ‡ä»¤è¿›è¡Œé‡æ’, ä¼˜åŒ–æ‰§è¡Œæ•ˆç‡. åœ¨å•çº¿ç¨‹æƒ…å†µ, å¾€å¾€ä¸ä¼šäº§ç”Ÿé—®é¢˜, ä½†æ¶‰åŠå¤šçº¿ç¨‹æ—¶, å¯èƒ½å¯¼è‡´ bug.</li>
<li>å¯è§æ€§: ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå…±äº«å˜é‡, å¦ä¸€ä¸ªçº¿ç¨‹ä¸ä¼šçŸ¥é“è¿™ä¸ªæ”¹å˜, è¿™å°±æ˜¯ä¸å¯è§, è¦ç¡®ä¿å¯è§æ€§, ä¸€èˆ¬ä½¿ç”¨ volatile å…³é”®è¯, å½“ç„¶, åŠ é”ä¹Ÿå¯ä»¥.</li>
<li>åŸå­æ€§: å³å¯¹äºæŸä»£ç , å®é™…æ‰§è¡Œæ—¶ä¼šåˆ†ä¸ºå¥½å‡ ä¸ªåŸå­æŒ‡ä»¤, ç¡®ä¿åŸå­æ€§å¿…é¡»åŠ é” (å¦‚synchronized) å¤„ç†</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">happens-before:</span><br><span class="line">è¯»åå†™</span><br><span class="line">å†™åå†™</span><br><span class="line">é”åè§£é”</span><br><span class="line">å¯ä¼ é€’æ€§</span><br></pre></td></tr></table></figure>

<h3 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h3><blockquote>
<p>çº¿ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹ä¸­çš„ä¸åŒæ‰§è¡Œè·¯å¾„, ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªä¸»çº¿ç¨‹.</p>
<p>è¿›ç¨‹æ˜¯ä¸€ä¸ªç¨‹åºçš„æŠ½è±¡, ä¸€ä¸ªç¨‹åºè¿è¡Œåä¸€èˆ¬ä¸ºä¸€ä¸ªè¿›ç¨‹.</p>
</blockquote>
<p>çº¿ç¨‹çŠ¶æ€:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.New (æ–°å»º)</span><br><span class="line">2.Runnable (å°±ç»ª)</span><br><span class="line">3.Running (è¿è¡Œä¸­)</span><br><span class="line">4.Blocked (é˜»å¡)</span><br><span class="line">5.WAITING (ç­‰å¾…)</span><br><span class="line">6.TIMED_WAITING (è¶…æ—¶ç­‰å¾…)</span><br><span class="line">7.Dead (æ­»äº¡)</span><br><span class="line"></span><br><span class="line">[t:threadå¯¹è±¡, obj: åŒæ­¥å—ä¸­çš„å¯¹è±¡]</span><br><span class="line">New: new Thread()</span><br><span class="line">Runnable: t.start(), t.yield()</span><br><span class="line">Running: after t.start() and cpu run it</span><br><span class="line">Blocked: when enter synchronized block</span><br><span class="line">WAITING: obj.wait(), t.join(), LockSupport.park()</span><br><span class="line">TIMED_WAITING: Thread.sleep(x), obj.wait(x), t.join(x)</span><br><span class="line">Dead: when t.run() is over</span><br></pre></td></tr></table></figure>



<h3 id="JVM-å¯¹è±¡ç»“æ„"><a href="#JVM-å¯¹è±¡ç»“æ„" class="headerlink" title="JVM å¯¹è±¡ç»“æ„"></a>JVM å¯¹è±¡ç»“æ„</h3><ul>
<li><strong>å¯¹è±¡å¤´</strong>: å­˜å‚¨å¯¹è±¡è¿è¡Œæ—¶æ•°æ®å’Œç±»å‹æŒ‡é’ˆ<ul>
<li><strong>Mark Word</strong>: è¿è¡Œæ—¶æ•°æ®<ul>
<li>æ ‡å¿—ä½ä¸º01-æœªé”å®š: å¯¹è±¡ hash ç , å¯¹è±¡åˆ†ä»£å¹´é¾„</li>
<li>æ ‡å¿—ä½ä¸º00-è½»é‡çº§é”å®š: æŒ‡å‘é”è®°å½•çš„æŒ‡é’ˆ</li>
<li>æ ‡å¿—ä½ä¸º10-é‡é‡çº§é”å®š: æ‰§è¡Œé‡é‡çº§é”çš„æŒ‡é’ˆ</li>
<li>æ ‡å¿—ä½ä¸º11-GCæ ‡è®°: ç©º, ä¸éœ€è¦è®°å½•ä¿¡æ¯</li>
<li>æ ‡å¿—ä½ä¸º01-å¯åå‘: åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ã€å¯¹è±¡åˆ†ä»£å¹´é¾„</li>
</ul>
</li>
<li><strong>ç±»å‹æŒ‡é’ˆ</strong>ï¼š æŒ‡å‘å¯¹è±¡çš„ç±»çš„å…ƒæ•°æ®çš„æŒ‡é’ˆ</li>
<li><strong>[æ•°ç»„é•¿åº¦]</strong>ï¼š è‹¥å¯¹è±¡æ—¶æ•°ç»„ï¼Œåˆ™ä¼šä¿å­˜æ•°ç»„é•¿åº¦</li>
</ul>
</li>
<li><strong>å®ä¾‹æ•°æ®</strong>ï¼š ä¿å­˜å­—æ®µå†…å®¹ï¼ŒåŒ…æ‹¬çˆ¶çº§</li>
<li><strong>å¯¹é½</strong>ï¼š ç¡®ä¿ 8 å­—èŠ‚ï¼Œå‡‘æ•´</li>
</ul>
<h3 id="åƒåœ¾å›æ”¶"><a href="#åƒåœ¾å›æ”¶" class="headerlink" title="åƒåœ¾å›æ”¶"></a>åƒåœ¾å›æ”¶</h3><h4 id="æ ‡è®°ç®—æ³•"><a href="#æ ‡è®°ç®—æ³•" class="headerlink" title="æ ‡è®°ç®—æ³•"></a>æ ‡è®°ç®—æ³•</h4><ol>
<li><strong>å¼•ç”¨è®¡æ•°æ³•</strong>: é€šè¿‡è®¡ç®—å¯¹è±¡çš„å¼•ç”¨æ•°æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶. ç¼ºç‚¹æ˜¯æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„é—®é¢˜.</li>
<li><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>: ä»æ ¹å¯¹è±¡(ä¸¤ä¸ªæ ˆå¼•ç”¨çš„å¯¹è±¡ã€é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€å¸¸é‡å¼•ç”¨çš„å¯¹è±¡)å‡ºå‘, å¯»æ‰¾æ‰€æœ‰å¼•ç”¨çš„å¯¹è±¡, å½¢æˆæ ¹å¯¹è±¡çš„å¼•ç”¨é“¾, åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸æ ¹å¯¹è±¡çš„å¼•ç”¨é“¾ç›¸å…³è”æ¥å†³å®šå¯¹è±¡æ˜¯å¦å¯å›æ”¶.</li>
</ol>
<h4 id="å›æ”¶ç®—æ³•"><a href="#å›æ”¶ç®—æ³•" class="headerlink" title="å›æ”¶ç®—æ³•"></a>å›æ”¶ç®—æ³•</h4><ol>
<li><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼šæ ‡è®°åç›´æ¥æ¸…é™¤, æ•ˆç‡ä½, äº§ç”Ÿå†…å­˜ç¢ç‰‡</li>
<li><strong>æ ‡è®°-å¤åˆ¶ç®—æ³•</strong>ï¼šéœ€è¦ä¸¤ä¸ªå¤§å°ç›¸åŒçš„å†…å­˜åŒºåŸŸ, å…¶ä¸­ä¸€å—ä¿æŒç©ºé—², å…ˆæ ‡è®°å¯ç”¨å¯¹è±¡, ç„¶åå°†å¯ç”¨å¯¹è±¡å¤åˆ¶åˆ°ç©ºé—²åŒºåŸŸ, å†æ¸…ç©ºæ•´å—å†…å­˜, ä½¿å…¶æ»¡è¶³ä¸€å—ä¿æŒç©ºé—², å¦‚æ­¤å¾ªç¯å³å¯.</li>
<li><strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼šæ ‡è®°åç§»åŠ¨å†…å­˜, ä»¤å†…å­˜ä½¿ç”¨çš„åŒºåŸŸä¸æœªä½¿ç”¨çš„åŒºåŸŸå‡æ— ç¢ç‰‡, ç¼ºç‚¹æ˜¯æ•ˆç‡ä½, æœ‰çš„æ˜¯ç©ºé—´å ç”¨å°‘.</li>
<li><strong>åˆ†ä»£ç®—æ³•</strong>ï¼šå°†å †åˆ†ä¸ºæ–°ç”Ÿä»£ä¸è€å¹´ä»£ï¼Œæ ¹æ®è‡ªä¸ªåŒºåŸŸçš„ç‰¹å®šé‡‡ç”¨ä¸åŒçš„å›æ”¶ç®—æ³•. æ–°ç”Ÿä»£åˆåˆ†ä¸º Eden åŒº(å¤åˆ¶ç®—æ³•)ã€ Survivor åŒº(å› ä½¿ç”¨å¤åˆ¶ç®—æ³•, åˆ†ä¸º Fromã€To ä¸¤å—å†…å­˜åŒºåŸŸ).</li>
</ol>
<h4 id="å›æ”¶å™¨"><a href="#å›æ”¶å™¨" class="headerlink" title="å›æ”¶å™¨"></a>å›æ”¶å™¨</h4><blockquote>
<p>(å‰ 3 ä¸ª Young GC ä½¿ç”¨, åé¢çš„ Full GC ä½¿ç”¨)</p>
</blockquote>
<ol>
<li><strong>Serial</strong> ï¼šå•çº¿ç¨‹ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸€ç›´ STW</li>
<li><strong>ParNew</strong> ï¼šå¤šçº¿ç¨‹ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œè¿˜æ˜¯ä¸€ç›´ STW</li>
<li><strong>Parallel Scavenge</strong> ï¼šå¤šçº¿ç¨‹ï¼Œä½¿ç”¨å¤åˆ¶ç®—æ³•ï¼Œä¸ ParNew ä¸åŒä¹‹å¤„åœ¨äºå…¶å…³æ³¨ååé‡ï¼Œå¹¶å¯é€šè¿‡è°ƒèŠ‚å‚æ•°å¯¹ååé‡è¿›è¡Œæ§åˆ¶</li>
<li><strong>Serial Old</strong>ï¼šå•çº¿ç¨‹ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œè€å¹´ä»£ä½¿ç”¨</li>
<li><strong>Parallel Old</strong> ï¼šå¤šçº¿ç¨‹ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œä¸<strong>Parallel Scavenge</strong>ä¸€æ ·ï¼Œå…³æ³¨ååé‡ã€‚</li>
<li><strong>CMS</strong> ï¼šå¤šçº¿ç¨‹ï¼Œä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œå…¶æ­¥éª¤ä¸ºï¼šåˆå§‹æ ‡è®°(STW)-å¹¶å‘æ ‡è®°-é‡æ–°æ ‡è®°(STW)-æ¸…é™¤ï¼Œå…·æœ‰ä½åœé¡¿çš„æ€§è´¨ï¼Œç¼ºç‚¹æ˜¯å ç”¨CPUèµ„æºä¸¥é‡ï¼Œä¸”äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œæ•´ç†å†…å­˜ç¢ç‰‡ä¾æ—§ä¼šSTW</li>
<li><strong>G1</strong> ï¼šå¤šçº¿ç¨‹ï¼Œä¸CMSç±»ä¼¼ï¼Œä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œæ­¥éª¤ä¸ºï¼šåˆå§‹æ ‡è®°(STW)-å¹¶å‘æ ‡è®°-æœ€ç»ˆæ ‡è®°(STW)-ç­›é€‰æ¸…é™¤(å¯æ§åˆ¶åœé¡¿æ—¶é—´)ï¼Œå…¶ä¼˜ç‚¹æ˜¯å¼•å…¥ Region æ¦‚å¿µï¼Œä¼˜å…ˆæ¸…ç†åƒåœ¾æ›´å¤šçš„ Region</li>
</ol>
<h4 id="å¯¹è±¡åˆ†é…ç­–ç•¥"><a href="#å¯¹è±¡åˆ†é…ç­–ç•¥" class="headerlink" title="å¯¹è±¡åˆ†é…ç­–ç•¥"></a>å¯¹è±¡åˆ†é…ç­–ç•¥</h4><ul>
<li>å¯¹è±¡ä¼˜å…ˆåœ¨ Eden å»åˆ†é…</li>
<li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å°†è¿›å…¥è€å¹´ä»£ï¼Œå¯é…ç½®å¤šå°‘å²è¿›å…¥ï¼ˆé»˜è®¤15å²ï¼‰ï¼Œç†¬è¿‡ä¸€æ¬¡ Minor GC æ¶¨ä¸€å²</li>
<li>åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šï¼Œ Survivor åŒºç©ºé—´ä¸­ç›¸åŒå¹´é¾„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äºç©ºé—´çš„ä¸€åŠï¼Œåˆ™å¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼›</li>
<li>ç©ºé—´åˆ†é…æ‹…ä¿ï¼Œå³é˜²æ­¢æ–°ç”Ÿä»£çš„å¯¹è±¡å¤§é‡å­˜æ´»æ—¶ï¼ŒSurvivor åŒºè£…ä¸ä¸‹ï¼Œåˆ™éœ€è¦åˆ¤å®šè€å¹´ä»£æ˜¯å¦è¿˜æœ‰è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´ï¼ˆå¤§äºæ–°ç”Ÿä»£EdenåŒºæˆ–å¼€å¯å‚æ•°åˆ™å–å†ä»£å­˜æ´»å¹³å‡å€¼ï¼‰ï¼Œè‹¥æœ‰åˆ™å¯æ— éœ€ FullGCï¼Œåä¹‹éœ€è¦FullGC</li>
</ul>
<h2 id="JVM-è¯¦è®°"><a href="#JVM-è¯¦è®°" class="headerlink" title="JVM è¯¦è®°"></a>JVM è¯¦è®°</h2><h3 id="ç»„æˆå›¾"><a href="#ç»„æˆå›¾" class="headerlink" title="ç»„æˆå›¾"></a>ç»„æˆå›¾</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">R(JVM)</span><br><span class="line"></span><br><span class="line">A(ç¼–è¯‘å™¨)</span><br><span class="line">B(ç±»åŠ è½½å™¨)</span><br><span class="line">C(æ‰§è¡Œå¼•æ“)</span><br><span class="line">D(è¿è¡Œæ—¶æ•°æ®åŒº)</span><br><span class="line"></span><br><span class="line">D1(å †)</span><br><span class="line">D2(æ ˆ)</span><br><span class="line">D3(æœ¬åœ°æ–¹æ³•æ ˆ)</span><br><span class="line">D4(æ–¹æ³•åŒº)</span><br><span class="line">D5(ç¨‹åºè®¡æ•°å™¨ Program Count Register)</span><br><span class="line"></span><br><span class="line">D2A(å±€éƒ¨å˜é‡è¡¨)</span><br><span class="line">D2B(æ“ä½œæ•°æ ˆ)</span><br><span class="line">D2C(åŠ¨æ€é“¾æ¥)</span><br><span class="line">D2D(è¿”å›åœ°å€)</span><br><span class="line"></span><br><span class="line">R--&gt;A</span><br><span class="line">R--&gt;B</span><br><span class="line">R--&gt;C</span><br><span class="line">R--&gt;D</span><br><span class="line"></span><br><span class="line">D--&gt;D1</span><br><span class="line">D--&gt;D2</span><br><span class="line">D--&gt;D3</span><br><span class="line">D--&gt;D4</span><br><span class="line">D--&gt;D5</span><br><span class="line"></span><br><span class="line">D2--&gt;D2A</span><br><span class="line">D2--&gt;D2B</span><br><span class="line">D2--&gt;D2C</span><br><span class="line">D2--&gt;D2D</span><br></pre></td></tr></table></figure>

<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><strong>JVM</strong>: </p>
<ul>
<li><strong>ç¼–è¯‘å™¨</strong>ï¼šå¯¹ Java ä»£ç åšä¼˜åŒ–ï¼Œå¹¶å°†ä»£ç ä¸­ç»“æ„ã€æ•°æ®ã€å®é™…ä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ã€‚</li>
<li><strong>ç±»åŠ è½½å™¨</strong>ï¼š<ul>
<li><strong>ç±»åŠ è½½è¿‡ç¨‹</strong>: åŠ è½½ï¼ˆæŠŠå­—èŠ‚ç äºŒè¿›åˆ¶æµåŠ è½½åˆ°æ–¹æ³•åŒºï¼Œå¦‚æ–‡ä»¶åˆ°å†…å­˜ï¼‰ã€éªŒè¯ï¼ˆæ–‡ä»¶æ ¼å¼ã€å…ƒæ•°æ®åˆæ³•æ€§ã€å­—èŠ‚ç æŒ‡ä»¤ç­‰çš„æ ¡éªŒï¼‰ã€å‡†å¤‡ï¼ˆé™æ€å˜é‡åˆ†é…å†…å­˜ã€åˆå§‹åŒ–é›¶å€¼ï¼‰ã€è§£æï¼ˆå­—ç¬¦ç¬¦å·å¼•ç”¨è§£ææˆç›´æ¥å¼•ç”¨ï¼‰ã€åˆå§‹åŒ–ï¼ˆæ‰§è¡Œç”Ÿæˆçš„ cinit æ–¹æ³•ï¼Œé‡Œé¢æ˜¯å¯¹é™æ€å˜é‡çš„èµ‹å€¼æŒ‡ä»¤å’Œ static å—ä»£ç ï¼‰</li>
<li><strong>new å¯¹è±¡è¿‡ç¨‹</strong>: å…ˆè¿›è¡Œç±»åŠ è½½(è‹¥æœªåŠ è½½), æ¥ç€ä¸ºå¯¹è±¡åˆ†é…å†…å­˜(å†…å­˜å¤§å°æ˜¯å›ºå®šçš„), æ¥ç€è®²å†…å­˜ç©ºé—´çš„å­—æ®µå€¼åˆå§‹åŒ–ä¸ºé›¶å€¼(å³å†…å­˜ä¸­çš„å€¼éƒ½æ˜¯æ ¹æ®å­—æ®µç±»å‹æ‰€å¯¹åº”çš„é»˜è®¤å€¼), å¯¹å¯¹è±¡è¿›è¡Œå¿…è¦çš„è®¾ç½®(å¦‚ä¸ç±»ä¿¡æ¯ç»‘å®š, å¯¹è±¡å¤´çš„æ•°æ®åˆå§‹åŒ–ç­‰), åˆ°æ­¤, ä¸€ä¸ªå¯¹è±¡äº§ç”Ÿäº†, ç„¶åå†æ‰§è¡Œå®ƒçš„ init æ–¹æ³•(æ„é€ æ–¹æ³•)å°± ok äº†.</li>
</ul>
</li>
<li><strong>æ‰§è¡Œå¼•æ“</strong>ï¼šä¸»è¦è´Ÿè´£æ–¹æ³•çš„åˆ†æ´¾ï¼Œæ‰§è¡ŒæŒ‡ä»¤æ§åˆ¶æ“ä½œæ•°æ ˆã€‚</li>
<li><strong>è¿è¡Œæ—¶æ•°æ®åŒº</strong>ï¼š<ul>
<li><strong>å †</strong>: æœ€å¤§çš„å†…å­˜åŒºåŸŸ, <strong>çº¿ç¨‹å…±äº«</strong>, ä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹æ•°æ®, ç”±äºåƒåœ¾å›æ”¶çš„åŸå› , ä¹Ÿå¯åˆ†ä¸ºæ–°å¹´ä»£ä¸è€å¹´ä»£, æ–°å¹´ä»£å…·ä½“å¯åˆ†ä¸º Eden åŒº, From Survivor åŒº, To Surviovr åŒº.</li>
<li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>: ä¸æ ˆåŠŸèƒ½ç±»ä¼¼, ä½†æœåŠ¡äº Native æ–¹æ³•, è€ŒNative æ–¹æ³•ä½¿ç”¨ä½•ç§è¯­è¨€å®ç°ç”±å…·ä½“è™šæ‹Ÿæœºå®ç°.</li>
<li><strong>æ–¹æ³•åŒº</strong>: ç”¨äºå­˜å‚¨åŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼Œ<strong>çº¿ç¨‹å…±äº«</strong>.</li>
<li><strong>ç¨‹åºè®¡æ•°å™¨ Program Count Register</strong>: ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´, <strong>çº¿ç¨‹ç§æœ‰</strong>. å­˜å‚¨çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„è¡Œå·, åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–æ­¤å†…å­˜. å½“è¿è¡Œæœ¬åœ°æ–¹æ³•æ—¶, å€¼ä¸ºç©º.</li>
<li><strong>æ ˆ</strong>: æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹, <strong>çº¿ç¨‹ç§æœ‰</strong>, ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒ, æ¯ä¸ªæ–¹æ³•æ‰§è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ ˆæ¡¢, æ–¹æ³•çš„è°ƒç”¨å’Œç»“æŸå¯¹åº”ç€æ ˆæ¡¢çš„å…¥æ ˆå’Œå‡ºæ ˆ. (æ€»ç»“: æ ˆåƒä¸ªé›†åˆ, å­˜å‚¨ç€æ¯ä¸ªæ–¹æ³•çš„æ ˆæ¡¢)<ul>
<li>(ä»¥ä¸‹å±äºæ ˆæ¡¢)</li>
<li>å±€éƒ¨å˜é‡è¡¨: ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡</li>
<li>æ“ä½œæ•°æ ˆ: æ˜¯ä¸€ä¸ªåå…¥å…ˆå‡ºçš„æ ˆï¼Œæ•°æ®çš„å†™å…¥ä¸å†™å‡ºéƒ½ç”±å­—èŠ‚ç æŒ‡ä»¤æ§åˆ¶ï¼Œä¸€å¼€å§‹æ˜¯ç©ºçš„ï¼›è¿™å¾ˆåƒCPUçš„æ“ä½œ</li>
<li>åŠ¨æ€é“¾æ¥: æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆæ¡¢æ‰€å±æ–¹æ³•çš„å¼•ç”¨ï¼Œä¸ºäº†æ”¯æŒæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ä¸­çš„åŠ¨æ€é“¾æ¥ã€‚</li>
<li>æ–¹æ³•å‡ºå£(è¿”å›åœ°å€): æä¾›ç”¨äºå›åˆ°æ–¹æ³•è¢«è°ƒç”¨çš„ä½ç½®çš„åœ°å€ï¼Œä¸€èˆ¬ä¸ºè¿›å…¥å‰PCè®¡æ•°å™¨ä¸­çš„å€¼ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>æ€»ç»“: ç¼–è¯‘Javaæºä»£ç , åˆ›å»ºå†…å­˜å¹¶åˆ’åˆ†åŒºåŸŸ, åŠ è½½ç±»å­—èŠ‚ç , ä»å…¥å£å¼€å§‹æ‰§è¡ŒæŒ‡ä»¤, æœ¬è´¨ä¸Š, æ‰€æœ‰çš„æ‰§è¡Œéƒ½æ˜¯æ–¹æ³•ç›´æ¥çš„ç»„åˆæˆ–åµŒå¥—è€Œæˆ, å› æ­¤æœ€ç»ˆæ‰€æœ‰çš„æŒ‡ä»¤, éƒ½åœ¨æ–¹æ³•æ ˆæ‰§è¡Œ, ä¹Ÿå°±æ˜¯æ“ä½œæ•°æ ˆ. æ‰€ä»¥éœ€è¦äº†è§£å¸¸ç”¨çš„æŒ‡ä»¤, å¦‚å†…å­˜ç›¸å…³, é”ç›¸å…³, æ–¹æ³•è·³è½¬, æŒ‡ä»¤é—´è·³è½¬(if/for).</p>
</blockquote>
<h3 id="æŒ‡ä»¤ï¼ˆæ“ä½œæ•°æ ˆï¼‰"><a href="#æŒ‡ä»¤ï¼ˆæ“ä½œæ•°æ ˆï¼‰" class="headerlink" title="æŒ‡ä»¤ï¼ˆæ“ä½œæ•°æ ˆï¼‰"></a>æŒ‡ä»¤ï¼ˆæ“ä½œæ•°æ ˆï¼‰</h3><ul>
<li><strong>å­—èŠ‚ç ä¸æ•°æ®ç±»å‹</strong><ul>
<li>i å¼€å¤´ä»£è¡¨å¯¹ int ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>l å¼€å¤´ä»£è¡¨å¯¹ long ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>s å¼€å¤´ä»£è¡¨å¯¹ short ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>b å¼€å¤´ä»£è¡¨å¯¹ byte ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>c å¼€å¤´ä»£è¡¨å¯¹ char ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>f å¼€å¤´ä»£è¡¨å¯¹ float ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>d å¼€å¤´ä»£è¡¨å¯¹ double ç±»å‹çš„æ•°æ®æ“ä½œ</li>
<li>a å¼€å¤´ä»£è¡¨å¯¹ reference ç±»å‹çš„æ•°æ®æ“ä½œ</li>
</ul>
</li>
<li><strong>åŠ è½½å’Œå­˜å‚¨æŒ‡ä»¤</strong><ul>
<li>è®²ä¸€ä¸ªå±€éƒ¨å˜é‡åŠ è½½åˆ°æ“ä½œæ ˆ: iloadã€iload_<n>  å³ <strong>load</strong></li>
<li>å°†ä¸€ä¸ªæ•°å€¼ä»æ“ä½œæ•°æ ˆå­˜å‚¨åˆ°å±€éƒ¨å˜é‡è¡¨: istoreã€istore_<n> å³ store</li>
<li>å°†ä¸€ä¸ªå¸¸é‡åŠ è½½åˆ°æ“ä½œæ•°æ ˆ: bipushã€sipushã€ldc</li>
<li>æ‰©å……å±€éƒ¨å˜é‡è¡¨çš„è®¿é—®æ‰€ä»¥çš„æŒ‡ä»¤ï¼š wide</li>
</ul>
</li>
<li><strong>è¿ç®—æŒ‡ä»¤</strong><ul>
<li>åŠ æ³•ï¼ˆiaddã€laddï¼‰ã€å‡æ³•ï¼ˆisubã€lsubï¼‰ã€ä¹˜æ³•ï¼ˆimulã€lmulï¼‰ã€é™¤æ³•ï¼ˆidivã€ldivï¼‰ã€æ±‚ä½™ï¼ˆiremã€lremï¼‰</li>
<li>å–åï¼ˆinegã€lnegï¼‰ã€ä½ç§»ï¼ˆishlã€ishrã€iushrï¼‰ã€æŒ‰ä½æˆ–ï¼ˆiorã€lorï¼‰ã€æŒ‰ä½ä¸ï¼ˆiandã€landï¼‰ã€æŒ‰ä½å¼‚æˆ–ï¼ˆixorã€lxorï¼‰</li>
<li>å±€éƒ¨å˜é‡è‡ªå¢æŒ‡ä»¤ï¼ˆiincï¼‰</li>
<li>æ¯”è¾ƒæŒ‡ä»¤ï¼ˆdcmpgã€dcmplã€fcmpgã€fcmplï¼‰</li>
</ul>
</li>
<li><strong>ç±»å‹è½¬æ¢æŒ‡ä»¤</strong><ul>
<li>å®½åŒ–ä¸éœ€è¦è½¬æ¢ï¼ˆéšå¼ï¼‰</li>
<li>å®…åŒ–æœ‰ i2bã€i2cã€i2sã€l2iã€f2iã€f2lã€d2iã€d2lã€d2f</li>
</ul>
</li>
<li><strong>å¯¹è±¡åˆ›å»ºäºè®¿é—®æŒ‡ä»¤</strong><ul>
<li>åˆ›å»ºå®ä¾‹çš„æŒ‡ä»¤ï¼šnew</li>
<li>åˆ›å»ºæ•°ç»„çš„æŒ‡ä»¤ï¼šnewarrayã€anewarrayã€multianewarray</li>
<li>è®¿é—®ç±»å­—æ®µï¼ˆstatic å­—æ®µï¼‰å’Œå®ä¾‹å­—æ®µçš„æŒ‡ä»¤ï¼šgetfieldã€putfieldã€getstaticã€putstatic</li>
<li>æŠŠä¸€ä¸ªæ•°ç»„å…ƒç´ åº¦åŠ è½½åˆ°æ“ä½œæ•°æ ˆï¼šbaloadã€caloadã€saloadï¼›å³ aload</li>
<li>å°†ä¸€ä¸ªæ“ä½œæ•°æ ˆçš„å€¼å­˜å‚¨åˆ°æ•°ç»„å…ƒç´ ä¸­çš„æŒ‡ä»¤ï¼šbastoreã€castoreã€sastoreã€å³ astore</li>
<li>å–æ•°ç»„é•¿åº¦çš„æŒ‡ä»¤:arraylength</li>
<li>æ£€æŸ¥ç±»å®ä¾‹ç±»å‹çš„æŒ‡ä»¤ï¼šinstanceofã€checkcast</li>
</ul>
</li>
<li><strong>æ“ä½œæ•°æ ˆç®¡ç†æŒ‡ä»¤</strong><ul>
<li>å°†æ“ä½œæ•°æ ˆçš„ç«™å®šä¸€ä¸ªæˆ–ä¸¤ä¸ªå…ƒç´ å‡ºæ ˆï¼špopã€pop2</li>
<li>å¤åˆ¶æ ˆé¡¶ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ•°å€¼å¹¶å°†å¤åˆ¶å€¼æˆ–åŒä»½å¤åˆ¶å€¼é‡æ–°å‹å…¥æ ˆé¡¶ï¼šdupã€dup2ã€dup_x1ã€dup2_x1</li>
<li>å°†æ ˆé¡¶æœ€é¡¶ç«¯çš„ä¸¤ä¸ªå€¼äº’æ¢ï¼š swap</li>
</ul>
</li>
<li><strong>æ§åˆ¶è½¬ç§»æŒ‡ä»¤</strong><ul>
<li>æ¡ä»¶åˆ†æ”¯ï¼šifeqã€ifltã€ifleã€ifneã€ifgtã€ifgeã€ifnullã€ifnonnullã€if_icmpeqâ€¦</li>
<li>å¤åˆæ¡ä»¶åˆ†æ”¯ï¼štableswitchã€lookupswitch</li>
<li>æ— æ¡ä»¶åˆ†æ”¯ï¼šgotoã€goto_wã€jsrã€jsr_wã€ret</li>
</ul>
</li>
<li><strong>æ–¹æ³•è°ƒç”¨å’Œè¿”å›æŒ‡ä»¤</strong><ul>
<li>invokevirtual è°ƒç”¨å¯¹è±¡çš„å®ä¾‹æ–¹æ³•ï¼Œæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹è¿›è¡Œåˆ†æ´¾</li>
<li>invokeinterface è°ƒç”¨æ¥å£æ–¹æ³•ï¼Œæœç´¢å®ç°äº†æ¥å£æ–¹æ³•çš„å¯¹è±¡ï¼Œæ‰¾å‡ºé€‚åˆçš„æ–¹æ³•è°ƒç”¨</li>
<li>invokespecial è°ƒç”¨ä¸€äº›éœ€è¦ç‰¹æ®Šå¤„ç†çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å®ä¾‹åˆå§‹åŒ–æ–¹æ³•ã€ç§æœ‰æ–¹æ³•ã€çˆ¶ç±»æ–¹æ³•</li>
<li>invokestatic è°ƒç”¨é™æ€æ–¹æ³• ï¼ˆstatic æ–¹æ³•ï¼‰</li>
<li>invokedynamic æŒ‡ä»¤ç”¨äºåœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‡ºè°ƒç”¨ç‚¹é™å®šç¬¦æ‰€å¼•ç”¨çš„æ–¹æ³•</li>
<li>è¿”å›æŒ‡ä»¤ ireturnã€lreturnã€freturnã€dreturnã€areturnã€returnï¼ˆ void è¿”å›å€¼æ—¶ï¼‰</li>
</ul>
</li>
<li><strong>å¼‚å¸¸å¤„ç†æŒ‡ä»¤</strong> athrowï¼›å…¶ä»–å¼‚å¸¸ç”±æ¶‰åŠçš„æŒ‡ä»¤æŠ›å‡ºï¼›å¦å¤– catch ä¸æ˜¯ç”±å­—èŠ‚ç æŒ‡ä»¤å®ç°ï¼Œè€Œæ˜¯é‡‡ç”¨å¼‚å¸¸è¡¨</li>
<li><strong>åŒæ­¥æŒ‡ä»¤</strong><ul>
<li>monitorenter ä»¥æ ˆé¡¶å…ƒç´ ä½œä¸ºé”å¼€å§‹åŒæ­¥</li>
<li>monitorexit æ¨å‡ºåŒæ­¥</li>
</ul>
</li>
</ul>
<h3 id="ç±»æ–‡ä»¶ç»“æ„"><a href="#ç±»æ–‡ä»¶ç»“æ„" class="headerlink" title="ç±»æ–‡ä»¶ç»“æ„"></a>ç±»æ–‡ä»¶ç»“æ„</h3><ul>
<li><strong>é­”æ•°</strong> 0xCAFEBABE  å’Œ<strong>ä¸»ç‰ˆæœ¬å·</strong>(åˆ¤æ–­å…¼å®¹æ€§)</li>
<li><strong>å¸¸é‡æ± </strong><ul>
<li>æ–‡æœ¬å­—ç¬¦ä¸²</li>
<li>å£°æ˜ä¸º final çš„å¸¸é‡å€¼</li>
<li>ç±»å’Œæ¥å£çš„å…¨é™å®šå</li>
<li>å­—æ®µçš„åç§°å’Œæè¿°ç¬¦</li>
<li>æ–¹æ³•çš„åç§°å’Œæè¿°ç¬¦</li>
</ul>
</li>
<li><strong>å¸¸é‡æ± ç±»å‹</strong>: å­—ç¬¦, å­—æ®µ, æ–¹æ³•, ç±»å, æ™®é€šç±»å‹å¸¸é‡<ul>
<li>å­—ç¬¦ä¸² CONSTANT_Utf8_info: tag u1, length u2, bytes, u1[]</li>
<li>Integer, Float, Double,String</li>
<li>ç±» CONSTANT_Class_info: tag u1, index u2 (æŒ‡å‘å­—ç¬¦ä¸²)</li>
<li>CONSTANT_Name-AndType_info: tag u1, index u2, index u2</li>
<li>å­—æ®µ CONSTANT_Fieldref_info: tag u1, index u2(æŒ‡å‘ CONSTANT_Class_info), index u2(æŒ‡å‘CONSTANT_Name-AndType_info)</li>
<li>å­—æ®µ CONSTANT_Methodref_info: tag u1, index u2(æŒ‡å‘ CONSTANT_Class_info), index u2(æŒ‡å‘CONSTANT_Name-AndType_info)</li>
</ul>
</li>
<li><strong>è®¿é—®æ ‡è¯†</strong>: ä¸¤ä¸ªå­—èŠ‚, æ ‡è¯†ç±»è¿˜æ˜¯æ¥å£, æ˜¯å¦ public, æ˜¯å¦ final, æ˜¯å¦ abstract, æ˜¯å¦æ³¨è§£, æšä¸¾â€¦</li>
<li><strong>ç±»ç´¢å¼•ã€çˆ¶ç±»ç´¢å¼•ã€æ¥å£ç´¢å¼•é›†åˆ</strong> ï¼šéƒ½æ˜¯ CONSTANT_Class_infoï¼Œå…¶å®å°±æ˜¯å…¨é™å®šå</li>
<li><strong>å­—æ®µè¡¨é›†åˆ</strong>ï¼š ç”±å¤šä¸ªå­—æ®µè¡¨ç»„æˆï¼Œä¸‹é¢ä¸ºå­—æ®µè¡¨çš„æ„æˆ<ul>
<li>access_flags å­—æ®µä¿®é¥°ç¬¦ï¼š æè¿°å­—æ®µæ˜¯å¦ public ï¼Œæ˜¯å¦ privateï¼Œæ˜¯å¦ protected ç­‰ç­‰</li>
<li>name_index å­—æ®µçš„ç®€å•åç§°</li>
<li>descriptor_index å­—æ®µçš„æ•°æ®ç±»å‹, å¦‚ Bï¼ˆbyteï¼‰ã€Cï¼ˆcharï¼‰ã€Dï¼ˆdoubleï¼‰ã€Fï¼ˆfloatï¼‰ã€Lï¼ˆå¯¹è±¡ç±»å‹ï¼‰ã€[Lï¼ˆå¯¹è±¡æ•°ç»„ç±»å‹ï¼‰</li>
<li>attribute_info å­—æ®µçš„é¢å¤–ä¿¡æ¯, å¦‚å­—æ®µä¸ºå¸¸é‡æ—¶ä¼šå«æœ‰é¢å¤–ä¿¡æ¯</li>
</ul>
</li>
<li><strong>æ–¹æ³•è¡¨é›†åˆ</strong>ï¼šæœ‰å¤šä¸ªæ–¹æ³•è¡¨ç»„æˆï¼Œ ä¸‹é¢ä¸ºæ–¹æ³•è¡¨çš„æ„æˆ<ul>
<li>access_flags æ–¹æ³•ä¿®é¥°ç¬¦ï¼šä¿®é¥°æ–¹æ³•æ˜¯å¦ä¸º publicã€æ˜¯å¦ä¸º privateã€æ˜¯å¦ä¸º staticã€æ˜¯å¦ synchronized ç­‰ç­‰</li>
<li>name_index æ–¹æ³•çš„ç®€å•åç§°</li>
<li>descriptor_index æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹, å…ˆå‚æ•°ï¼Œåè¿”å›å€¼ï¼Œä¸”å‚æ•°è¢«æ‹¬å·åŒ…å›´ï¼Œå¦‚ ()Vã€(LLDF)L</li>
<li>attribute_info æ–¹æ³•çš„é¢å¤–ä¿¡æ¯, é‡Œé¢æœ‰åä¸º Code çš„å±æ€§, å­˜æ”¾æ–¹æ³•ä»£ç ç¼–è¯‘æˆçš„å­—èŠ‚ç æŒ‡ä»¤</li>
</ul>
</li>
<li><strong>å±æ€§è¡¨é›†åˆ</strong>ï¼šç±»ã€å­—æ®µå’Œæ–¹æ³•çš„é¢å¤–ä¿¡æ¯å­˜æ”¾å¤„ï¼Œç±»å‹æœ‰<ul>
<li>æ–¹æ³•è¡¨çš„ Codeï¼š</li>
<li>å­—æ®µè¡¨çš„ ConstantValue</li>
<li>æ–¹æ³•è¡¨çš„å¼‚å¸¸ä¿¡æ¯ Exceptions</li>
<li>ç±»ä¸­çš„å†…éƒ¨ç±» InnerClasses</li>
<li>æºç è¡Œå·ä¸å­—èŠ‚ç è¡Œå·çš„å¯¹åº”å…³ç³» LineNumberTable</li>
<li>æ ˆæ¡¢ä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å˜é‡ä¸Javaæºç å®šä¹‰å˜é‡ç›´æ¥çš„å…³ç³» LocalVariableTable</li>
<li>æ³›å‹çš„ç­¾åä¿¡æ¯ Signature</li>
</ul>
</li>
</ul>
<h3 id="ç±»åŠ è½½è¿‡ç¨‹"><a href="#ç±»åŠ è½½è¿‡ç¨‹" class="headerlink" title="ç±»åŠ è½½è¿‡ç¨‹"></a>ç±»åŠ è½½è¿‡ç¨‹</h3><ul>
<li><strong>åŠ è½½</strong><ul>
<li>é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ</li>
<li>å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„æƒŠå¤©å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„</li>
<li>åœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡,ä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</li>
</ul>
</li>
<li><strong>éªŒè¯</strong><ul>
<li>æ–‡ä»¶æ ¼å¼éªŒè¯ï¼ˆå¦‚é­”æ•°ï¼Œç‰ˆæœ¬å·ã€å¸¸é‡çš„ç±»å‹ç­‰ç­‰ï¼‰ä¼šç®€å•æ ¡éªŒå­—èŠ‚æµï¼Œå°†å­—èŠ‚æµè½¬ä¸ºå†…å­˜é‡Œçš„æ•°æ®ç»“æ„</li>
<li>å…ƒæ•°æ®éªŒè¯ï¼ˆè¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ã€ç»§æ‰¿çš„ç±»æ˜¯å¦åˆæ³•ã€éæŠ½è±¡ç±»æ˜¯å¦å®ç°äº†æ‰€æœ‰æŠ½è±¡æ–¹æ³•ç­‰ç­‰ï¼‰</li>
<li>å­—èŠ‚ç éªŒè¯ï¼ˆæ ¡éªŒæ–¹æ³•ä»£ç ä¸­çš„å­—èŠ‚ç æŒ‡ä»¤è¯­ä¹‰æ˜¯å¦æ­£ç¡®ã€ä¿è¯æ–¹æ³•çš„ç±»å‹è½¬æ¢æ—¶æœ‰æ•ˆçš„ï¼‰</li>
<li>ç¬¦å·å¼•ç”¨éªŒè¯ï¼ˆæ ¡éªŒå¸¸é‡åŒºçš„ç¬¦å·å¼•ç”¨æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿è§£æé˜¶æ®µèƒ½æ­£å¸¸æ‰§è¡Œï¼‰</li>
</ul>
</li>
<li><strong>å‡†å¤‡</strong><ul>
<li>ä¸ºé™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œå¹¶åˆå§‹åŒ–ä¸ºé›¶å€¼</li>
</ul>
</li>
<li><strong>è§£æ</strong><ul>
<li>ç±»æˆ–æ¥å£çš„è§£æï¼šè§£æçš„ç¬¦å·å¼•ç”¨çš„ç±»ä¸æ˜¯æ•°ç»„åˆ™éœ€è¦å…ˆåŠ è½½è¿™ä¸ªç±»ï¼Œå†æ ¡éªŒè®¿é—®æƒé™</li>
<li>å­—æ®µè§£æï¼šå…ˆä»è‡ªèº«æ‰¾ï¼Œè‡ªèº«æ— ä¸”å®ç°äº†æ¥å£ï¼Œåˆ™æ‰¾ç»§æ‰¿çš„æ¥å£ä¸­çš„å¼•ç”¨ï¼Œè‡ªèº«æ— ä¹Ÿæ— å®ç°æ¥å£ï¼Œåˆ™æ‰¾çˆ¶ç±»ï¼Œéƒ½æ‰¾ä¸åˆ°åˆ™æŠ¥é”™ï¼Œæ‰¾åˆ°åˆ™æ ¡éªŒæƒé™ã€‚</li>
<li>æ–¹æ³•è§£æï¼šä¸å­—æ®µç±»ä¼¼ï¼Œä»è‡ªèº«åˆ°å®ç°çš„æ¥å£ã€ç»§æ‰¿çš„çˆ¶ç±»ä¸­æ‰¾ï¼Œæ‰¾åˆ°åæ ¡éªŒæƒé™ã€‚</li>
<li>æ¥å£æ–¹æ³•è§£æï¼šä»è‡ªèº«æ¥å£ä¸­æˆ–çˆ¶æ¥å£ä¸­æ‰¾ã€æ‰¾åˆ°æ— éœ€æ ¡éªŒæƒé™ï¼ˆéƒ½æ˜¯ publicï¼‰</li>
</ul>
</li>
<li><strong>åˆå§‹åŒ–</strong><ul>
<li>æ‰§è¡Œ cinit æ–¹æ³•ï¼Œæ–¹æ³•ä¸­æ‰§è¡Œå¯¹é™æ€å˜é‡çš„èµ‹å€¼æŒ‡ä»¤å’Œ static å¿«</li>
<li>çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•ä¸€å®šå…ˆäºå­ç±»æ‰§è¡Œ</li>
<li>æ‰§è¡Œæ—¶ä¼šåŠ é”åŒæ­¥æ‰§è¡Œã€å› æ­¤ä¸è¦è¿›è¡Œè€—æ—¶æ“ä½œ</li>
</ul>
</li>
</ul>
<blockquote>
<p>é¡ºå¸¦ä¸€æç±»åŠ è½½å™¨ï¼Œä½œç”¨æ˜¯åŠ è½½å­—èŠ‚ç äºŒè¿›åˆ¶æµåˆ°è™šæ‹Ÿæœºä¸­ï¼Œé™¤äº†ç³»ç»Ÿé¡¶çº§çš„ç±»åŠ è½½å™¨ï¼ˆç”¨äºåŠ è½½ rt.jarï¼‰æ˜¯ç”± C++ å®ç°å¤–ï¼Œå…¶ä»–çš„ç±»åŠ è½½å™¨éƒ½æ˜¯ Javaä»£ç ï¼Œé€šè¿‡ç»„åˆä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆå³çˆ¶ç±»åŠ è½½å™¨ï¼‰ï¼Œå®ç°åŒäº²å§”æ´¾æ¨¡å‹ï¼šå³æ€»æ˜¯å…ˆé€šè¿‡çˆ¶ç±»åŠ è½½ç±»ï¼Œé™¤éçˆ¶ç±»åŠ è½½å¤±è´¥ï¼›è‹¥è‡ªå·±å®ç°ä¸€ä¸ªç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬éœ€è¦ç»„åˆ ClassLoader.getSystemClassLoader()</p>
<p>ç³»ç»Ÿçš„ç±»åŠ è½½å™¨æœ‰:</p>
<ul>
<li>å¯åŠ¨ç±»åŠ è½½å™¨ Bootstrap ClassLoader åŠ è½½ JAVA_HOME/lib ä¸‹çš„ç±»ï¼Œå¦‚ rt.jar</li>
<li>æ‰©å±•ç±»åŠ è½½å™¨ Extension ClassLoader åŠ è½½ JAVA_HOME/lib/ext ä¸‹çš„ç±»</li>
<li>åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ Application ClassLoader åŠ è½½ classpath ä¸‹çš„ç±»</li>
</ul>
</blockquote>
<h3 id="Java-å†…å­˜æ¨¡å‹"><a href="#Java-å†…å­˜æ¨¡å‹" class="headerlink" title="Java å†…å­˜æ¨¡å‹"></a>Java å†…å­˜æ¨¡å‹</h3><p>ä¸»è¦æ˜¯ä¸ºäº†å±è”½è°ƒå„ç§ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥å®ç° Java ç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å†…å­˜è®¿é—®æ•ˆæœã€‚å¯æœ‰æ•ˆé˜²æ­¢ä¸åŒå¹³å°çš„å¹¶å‘è®¿é—®å› å¹³å°å·®å¼‚æœ‰æ‰€ä¸åŒå¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<ul>
<li><strong>ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜</strong>ï¼šè¿™é‡Œå˜é‡ä¸åŒ…æ‹¬çº¿ç¨‹ç§æœ‰çš„å†…å­˜åŒºåŸŸ<ul>
<li>æ‰€æœ‰å˜é‡éƒ½å­˜å‚¨ä¸»å†…å­˜ä¸­</li>
<li>æ¯æ¡çº¿ç¨‹æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜</li>
<li>çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨åˆ°çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´</li>
<li>çº¿ç¨‹å¯¹å˜é‡çš„æ‰€æœ‰æ“ä½œï¼ˆè¯»å–ã€èµ‹å€¼ç­‰ï¼‰éƒ½å¿…é¡»åœ¨å·¥ä½œå†…å­˜ä¸­è¿›è¡Œï¼Œè€Œä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜çš„å˜é‡ã€‚</li>
<li>ä¸åŒçº¿ç¨‹ä¹‹é—´æ— æ³•ç›´æ¥è®¿é—®å¯¹æ–¹å·¥ä½œå†…å­˜ä¸­çš„å˜é‡</li>
<li>çº¿ç¨‹é—´å˜é‡å€¼çš„ä¼ é€’å‡éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆ</li>
<li>ä¸»å†…å­˜ç±»ä¼¼äºç‰©ç†ç¡¬ä»¶ä¸­çš„å†…å­˜ï¼Œè€Œå·¥ä½œå†…å­˜ä¼˜å…ˆå­˜å‚¨äºå¯„å­˜å™¨å’Œé«˜é€Ÿç¼“å­˜ä¸­ï¼ˆçœ‹ JVM å…·ä½“å®ç°ï¼‰</li>
</ul>
</li>
<li><strong>å†…å­˜é—´äº¤äº’æ“ä½œ</strong><ul>
<li>lockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡è¡¨ç¤ºä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚</li>
<li>unlockï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚</li>
<li>readï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ load åŠ¨ä½œä½¿ç”¨</li>
<li>loadï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠ read æ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</li>
<li>useï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤éƒ½ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li>assignï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li>
<li>storeï¼šå­˜å‚¨ä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€’ç»™ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„ write æ“ä½œä½¿ç”¨</li>
<li>writeï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠ store æ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜ä¸­çš„å˜é‡ä¸­ã€‚</li>
</ul>
</li>
<li><strong>å¯¹äº volatile å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™</strong><ul>
<li>ä¿è¯æ­¤å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ï¼Œä½†ä¸ä¿è¯åŸå­æ€§ï¼Œå› æ­¤éƒ¨åˆ†æ“ä½œä»æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œ å¦‚ i++</li>
<li>ç¦ç”¨æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œ å³ä¿è¯å˜é‡çš„èµ‹å€¼æ“ä½œçš„é¡ºåºä¸ä»£ç ä¸­çš„é¡ºåºä¸€è‡´ï¼›å…¶ä»–å˜é‡å¯èƒ½ä¼šå› æŒ‡ä»¤é‡æ’åºä¼˜åŒ–è€Œä¸ä¸€è‡´ã€‚</li>
</ul>
</li>
<li><strong>å¯¹äº long å’Œ double å‹å˜é‡çš„ç‰¹æ®Šè§„åˆ™</strong><ul>
<li>å¯¹äºè¿™ä¸¤ç±»å‹å˜é‡ï¼Œ JVM è§„èŒƒä¸ä¸¥æ ¼è¦æ±‚å¯¹ 8ä¸ªæ“ä½œï¼ˆreadã€loadç­‰ï¼‰éƒ½å…·æœ‰åŸå­æ€§</li>
<li>ä½†å¤§å¤šæ•°è™šæ‹Ÿæœºå®ç°ä»ä¿è¯äº†è¿™ä¸€ç‚¹ï¼Œæ‰€æœ‰ä¸éœ€è¦æŠŠè¿™ç±»å‹çš„å˜é‡ç‰¹åˆ«çš„æ·»åŠ  volatile ä¿®é¥°</li>
</ul>
</li>
<li><strong>åŸå­æ€§ã€å¯è§æ€§ã€æœ‰åºæ€§</strong><ul>
<li><strong>åŸå­æ€§</strong>ï¼šæœ‰ Java å†…å­˜æ¨¡å‹æ¥ç›´æ¥ä¿è¯åŸå­æ€§å˜é‡æ“ä½œåŒ…æ‹¬ï¼ˆreadã€loadã€assignã€useã€storeã€writeï¼‰ï¼ŒåŸºæœ¬å¯ä»¥è®¤ä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„è®¿é—®è¯»å†™æ˜¯å…·æœ‰åŸå­æ€§çš„ï¼Œå¯ä½¿ç”¨ synchronized å®ç°åŸå­æ€§</li>
<li><strong>å¯è§æ€§</strong>ï¼šæ˜¯æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚volatileã€synchronizedã€final å¯å®ç°å¯è§æ€§</li>
<li><strong>æœ‰åºæ€§</strong>ï¼šå¦‚æœåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æœ‰åºçš„ï¼›å¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æ— åºçš„ã€‚å¯ä½¿ç”¨ volatileã€synchronized å®ç°æœ‰åºæ€§</li>
</ul>
</li>
<li><strong>å…ˆè¡Œå‘ç”ŸåŸåˆ™</strong><ul>
<li>ç¨‹åºæ¬¡åºè§„åˆ™ï¼šåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼ŒæŒ‰ç…§ç¨‹åºä»£ç é¡ºåºï¼Œä¹¦å†™åœ¨å‰çš„æ“ä½œå…ˆè¡Œå‘ç”Ÿäºä¹¦å†™åœ¨åçš„æ“ä½œã€‚</li>
<li>ç®¡ç¨‹é”å®šè§„åˆ™ï¼šä¸€ä¸ª unlock æ“ä½œå…ˆè¡Œå‘ç”Ÿä¸åé¢å¯¹åŒä¸€ä¸ªé”çš„ lock æ“ä½œã€‚</li>
<li>volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile å˜é‡çš„å†™æ“ä½œå…ˆè¡Œå‘ç”Ÿäºåé¢å¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œã€‚</li>
<li>çº¿ç¨‹å¯åŠ¨è§„åˆ™ï¼šThread å¯¹è±¡çš„ start æ–¹æ³•å…ˆè¡Œå‘ç”Ÿäºæ­¤çº¿ç¨‹çš„æ¯ä¸€ä¸ªåŠ¨ä½œ</li>
<li>çº¿ç¨‹ç»ˆæ­¢è§„åˆ™ï¼šçº¿ç¨‹ä¸­æ‰€æœ‰æ“ä½œéƒ½å…ˆè¡Œå‘ç”Ÿäºå¯¹æ­¤çº¿ç¨‹çš„ç»ˆæ­¢æ£€æµ‹ã€‚</li>
<li>çº¿ç¨‹ä¸­æ–­è§„åˆ™ï¼šå¯¹çº¿ç¨‹ interrupt æ–¹æ³•çš„è°ƒç”¨å…ˆè¡Œå‘ç”Ÿäºè¢«ä¸­æ–­çº¿ç¨‹çš„ä»£ç æ£€æµ‹åˆ°ä¸­æ–­äº‹ä»¶çš„å‘ç”Ÿã€‚</li>
<li>å¯¹è±¡ç»ˆç»“è§„åˆ™ï¼šä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–å®Œæˆå…ˆè¡Œå‘ç”Ÿäºä»–çš„ finalize æ–¹æ³•çš„å¼€å§‹</li>
<li>ä¼ é€’æ€§ï¼šå¦‚æœæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Bï¼Œ æ“ä½œ B å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ Cï¼Œé‚£å°±å¯ä»¥å¾—å‡ºæ“ä½œ A å…ˆè¡Œå‘ç”Ÿäºæ“ä½œ C çš„ç»“è®ºã€‚</li>
</ul>
</li>
</ul>
<h3 id="Java-çº¿ç¨‹å®‰å…¨"><a href="#Java-çº¿ç¨‹å®‰å…¨" class="headerlink" title="Java çº¿ç¨‹å®‰å…¨"></a>Java çº¿ç¨‹å®‰å…¨</h3><blockquote>
<p>å®šä¹‰: å½“å¤šä¸ªçº¿ç¨‹è®¿é—®ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœä¸ç”¨è€ƒè™‘è¿™äº›çº¿ç¨‹åœ¨è¿è¡Œæ—¶ç¯å¢ƒä¸‹çš„è°ƒåº¦å’Œäº¤æ›¿æ‰§è¡Œï¼Œä¹Ÿä¸éœ€è¦è¿›è¡Œé¢å¤–åŒæ­¥ï¼ˆå°±æ˜¯è°ƒç”¨è€…ä¸éœ€è¦é¢å¤–åŒæ­¥ï¼Œä»£ç æœ¬èº«å¯ä½¿ç”¨åŒæ­¥ï¼‰ï¼Œæˆ–è€…åœ¨è°ƒç”¨æ–¹è¿›è¡Œä»»ä½•å…¶ä»–çš„åè°ƒæ“ä½œï¼Œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºéƒ½å¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœï¼Œé‚£è¿™ä¸ªå¯¹è±¡æ—¶çº¿ç¨‹å®‰å…¨çš„ã€‚ </p>
<p>ä½œè€…è¯´ï¼šæŠŠâ€œè°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„è¡Œä¸ºâ€ é™å®šä¸º â€œå•è¯è°ƒç”¨â€ ï¼Œä¹Ÿå¯ç§°ä¸ºçº¿ç¨‹å®‰å…¨ã€‚è¿™æ˜¯ä¸ªå¼±åŒ–ã€‚</p>
</blockquote>
<ul>
<li><strong>Java è¯­è¨€ä¸­çš„çº¿ç¨‹å®‰å…¨</strong><ul>
<li><strong>ä¸å¯å˜</strong>ï¼šä¸å¯å˜çš„å¯¹è±¡ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›å¦‚ String</li>
<li><strong>ç»å¯¹çº¿ç¨‹å®‰å…¨</strong>ï¼šä¸å®šä¹‰ç­‰åŒï¼Œè¿‡äºä¸¥æ ¼</li>
<li><strong>ç›¸å¯¹çº¿ç¨‹å®‰å…¨</strong>ï¼šä»…ä¿è¯å¯¹è¿™ä¸ªå¯¹è±¡å•ç‹¬çš„æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚ Vectorã€‚</li>
<li><strong>çº¿ç¨‹å…¼å®¹</strong>ï¼šå¯¹è±¡æœ¬èº«ä¸å®‰å…¨ï¼Œä½†é€šè¿‡æ“ä½œå‰ååŠ åŒæ­¥æ‰‹æ®µæ¥ä¿è¯æ“ä½œçº¿ç¨‹å®‰å…¨ã€‚åˆ™ç§°ä¸ºçº¿ç¨‹å…¼å®¹ï¼Œå¦‚ ArrayListã€‚</li>
<li><strong>çº¿ç¨‹å¯¹ç«‹</strong>ï¼šå³ä½¿ä½¿ç”¨åŒæ­¥æ‰‹æ®µï¼Œè¿˜æ˜¯æ— æ³•åšåˆ°çº¿ç¨‹å®‰å…¨çš„ä»£ç ã€‚æ¯”å¦‚ System.setIn()</li>
</ul>
</li>
<li><strong>çº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</strong><ul>
<li><strong>äº’æ–¥åŒæ­¥</strong>ï¼šå³åªè¢«ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå¦‚ synchronized </li>
<li><strong>éé˜»å¡åŒæ­¥</strong>ï¼šä¸€èˆ¬æŒ‡ä¹è§‚é”ï¼Œå³å…ˆè¿›è¡Œæ“ä½œï¼Œè‹¥æ— å…¶ä»–çº¿ç¨‹äº‰ç”¨å…±äº«æ•°æ®ï¼Œé‚£æ“ä½œå°±æˆåŠŸäº†ï¼›å¦‚æœå…±äº«æ•°æ®æœ‰äº‰ç”¨ï¼Œäº§ç”Ÿäº†å†²çªï¼Œé‚£å°±é‡‡ç”¨å…¶ä»–çš„è¡¥å¿æªæ–½ï¼ˆé€šå¸¸æ˜¯é‡è¯•ï¼‰ï¼›ä¾èµ– CAS åŸå­æ“ä½œï¼Œå³ç³»ç»Ÿåº•å±‚æ”¯æŒ</li>
<li><strong>æ— åŒæ­¥æ–¹æ¡ˆ</strong>ï¼šä¸€èˆ¬æŒ‡ ThreadLocalï¼Œå°†å˜é‡æ§åˆ¶åœ¨çº¿ç¨‹ä¸­ï¼Œä¸ä¸å…¶ä»–çº¿ç¨‹å…±äº«ï¼Œåˆ™ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>
</ul>
</li>
<li><strong>é”ä¼˜åŒ–</strong><ul>
<li><strong>è‡ªæ—‹é”ä¸è‡ªé€‚åº”é”</strong>ï¼šè‡ªæ—‹æŒ‡çº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶ä¸è®©å‡ºCPUèµ„æºï¼Œè€Œæ˜¯å¾ªç¯çš„é‡è¯•æ¥è·å–é”ï¼›è‡ªç„¶ï¼Œå¯ä»¥é…ç½®é‡è¯•æ¬¡æ•°ï¼Œå¯ä»¥é…ç½®æ˜¯å¦å¼€å¯ã€‚è‡ªé€‚åº”æŒ‡çš„æ˜¯è‡ªæ—‹çš„æ—¶é—´æˆ–è€…è¯´æ¬¡æ•°ï¼Œæ ¹æ®è™šæ‹Ÿæœºç»Ÿè®¡çš„è‡ªæ—‹è·å¾—é”çš„æˆåŠŸä¸å¦ï¼Œæ¥å¢é•¿æˆ–ç¼©çŸ­è‡ªæ—‹çš„æ—¶é—´ã€‚</li>
<li><strong>é”æ¶ˆé™¤</strong>ï¼šå³ JVM åˆ¤æ–­æŸäº›ä»£ç çš„å˜é‡æ— éœ€ä½¿ç”¨åŒæ­¥ï¼Œå› ä¸ºè¿™äº›å˜é‡ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹é”è¯»å†™ï¼Œå¦‚æ–¹æ³•é‡Œæ˜¯å±€éƒ¨å˜é‡çš„ StringBuffer å¯¹è±¡çš„ append æ–¹æ³•ã€‚å…¶ä½¿ç”¨ synchronizedï¼Œä½†å±€éƒ¨å˜é‡éƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå¹¶ä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹è¯»å†™ã€‚</li>
<li><strong>é”ç²—åŒ–</strong>ï¼šé¿å…é”ç²’åº¦å¤ªå°å¯¼è‡´é¢‘ç¹çš„äº’æ–¥ï¼Œå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œè™šæ‹Ÿæœºä¼šå¯¹è¿™ç§æƒ…å†µå°†é”çš„èŒƒå›´ç²—åŒ–ã€‚</li>
<li><strong>è½»é‡çº§é”</strong>ï¼šå³å½“ä¸€ä¸ªé”æ²¡æœ‰ä¸¤æ¡ä»¥ä¸Šçš„çº¿ç¨‹äº‰ç”¨çš„æ—¶å€™ï¼Œé€šè¿‡ CAS æ“ä½œåŠ é”å’Œè§£é”ï¼Œæ¯”é‡é‡çº§é”å¼€é”€æ›´å°‘ã€‚è‹¥è¶…è¿‡ä¸¤ä¸ªçº¿ç¨‹äº‰ç”¨ï¼Œåˆ™é€šè¿‡ä¿®æ”¹å¯¹è±¡å¤´æ ‡å¿—ä½å°†é”å‡çº§ä¸ºé‡é‡çº§é”ï¼Œå› ä¸ºæ­¤æ—¶å†ä½¿ç”¨ CAS åè€Œæ˜¯ä¸€ç§æ¶ˆè€—ï¼ˆè¿™æ˜¯å› ä¸º CAS æ€»æ˜¯ä¼šå¤±è´¥ï¼‰</li>
<li><strong>åå‘é”</strong>ï¼šå³ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡é€šè¿‡ CAS è·å¾—è¿™ä¸ªé”åï¼Œä¹‹åå†è·å–å°†ä¸å†éœ€è¦åŠ é”ï¼ˆå³ä½¿é‡Šæ”¾äº†é”ä¹Ÿæ²¡å…³ç³»ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶ä¼šå°†å¯¹è±¡å¤´çš„æ ‡å¿—æ”¹ä¸ºåå‘é”ï¼Œå¹¶è®°å½•çº¿ç¨‹ IDï¼ˆè¿™ä¸ªåŠ¨ä½œä¹Ÿæ˜¯é€šè¿‡ CAS è¿›è¡Œçš„ï¼‰ï¼Œè¿™æ ·ä»¥ååªéœ€è¦å¯¹æ¯”çº¿ç¨‹ IDï¼Œåˆ·è„¸å…¥åœºã€‚</li>
</ul>
</li>
</ul>
<h3 id="å¤§è‡´æµç¨‹"><a href="#å¤§è‡´æµç¨‹" class="headerlink" title="å¤§è‡´æµç¨‹"></a>å¤§è‡´æµç¨‹</h3><ol>
<li>ç¼–è¯‘å™¨ç¼–è¯‘ .java åç¼€æ–‡ä»¶å¾—åˆ°å­—èŠ‚ç æ–‡ä»¶ .classï¼›</li>
<li>ç±»åŠ è½½å™¨åŠ è½½å­—èŠ‚ç æ–‡ä»¶åˆ°è¿è¡Œæ—¶åŒºåŸŸï¼›</li>
<li>æ‰§è¡Œå™¨ä¸ºç±»çš„æ–¹æ³•åˆ›å»ºæ ˆæ¡¢ï¼Œå¹¶ç»“åˆæ“ä½œæ•°æ ˆæ‰§è¡Œå­—èŠ‚ç æŒ‡ä»¤ï¼Œé‡åˆ°æ–¹æ³•è°ƒç”¨çš„æŒ‡ä»¤ï¼Œåˆ™å¯èƒ½éœ€è¦æ ¹æ®å¯¹è±¡ç±»å‹åˆ¤æ–­æ‰§è¡Œå“ªä¸ªå…·ä½“çš„æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/02/03/principle-redis-memo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/03/principle-redis-memo/" class="post-title-link" itemprop="url">Redis åº•å±‚æ¢ç§˜</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-03 19:06:58" itemprop="dateCreated datePublished" datetime="2021-02-03T19:06:58+08:00">2021-02-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:53:21" itemprop="dateModified" datetime="2021-03-28T19:53:21+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/02/03/principle-redis-memo/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/02/03/principle-redis-memo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Redis-åº•å±‚æ¢ç§˜"><a href="#Redis-åº•å±‚æ¢ç§˜" class="headerlink" title="Redis åº•å±‚æ¢ç§˜"></a>Redis åº•å±‚æ¢ç§˜</h1><h2 id="Redis-æ•°æ®ç»“æ„å®ç°åŸç†"><a href="#Redis-æ•°æ®ç»“æ„å®ç°åŸç†" class="headerlink" title="Redis æ•°æ®ç»“æ„å®ç°åŸç†"></a>Redis æ•°æ®ç»“æ„å®ç°åŸç†</h2><blockquote>
<p>copy from <a href="https://juejin.cn/post/6844903856313368589#heading-3" target="_blank" rel="noopener">https://juejin.cn/post/6844903856313368589#heading-3</a></p>
</blockquote>
<h3 id="1-string"><a href="#1-string" class="headerlink" title="1.string"></a>1.string</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sdshdr64 å˜æˆ sdshdr32, åˆ™ç›¸åº”çš„ len å’Œ alloc å˜æˆ uint32_t</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr64</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint64_t</span> len; </span><br><span class="line">    <span class="keyword">uint64_t</span> alloc;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> flags; </span><br><span class="line">    <span class="keyword">char</span> buf[];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  lenï¼šå·²ä½¿ç”¨çš„é•¿åº¦ï¼Œå³å­—ç¬¦ä¸²çš„çœŸå®é•¿åº¦</span></span><br><span class="line"><span class="comment">  allocï¼šé™¤å»æ ‡å¤´å’Œç»ˆæ­¢ç¬¦('\0')åçš„é•¿åº¦</span></span><br><span class="line"><span class="comment">  flagsï¼šä½3ä½è¡¨ç¤ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå…¶ä½™5ä½æœªä½¿ç”¨ï¼ˆæˆ‘æš‚æ—¶æ²¡å‘ç°redisåœ¨å“ªé‡Œä½¿ç”¨è¿‡è¿™ä¸ªå±æ€§ï¼‰</span></span><br><span class="line"><span class="comment">  buf[]ï¼šå­˜å‚¨å­—ç¬¦æ•°æ®</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>redis å†™çš„å­—ç¬¦ä¸²åº“æœ‰ä»¥ä¸‹4ä¸ªä¼˜ç‚¹ï¼š</p>
</blockquote>
<ul>
<li>é™ä½è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶é—´å¤æ‚åº¦åˆ°O(1)</li>
<li>å‡å°‘äº†ä¿®æ”¹å­—ç¬¦ä¸²æ—¶çš„å†…å­˜é‡åˆ†é…æ¬¡æ•°</li>
<li>å…¼å®¹cå­—ç¬¦ä¸²çš„åŒæ—¶ï¼Œæé«˜äº†ä¸€äº›å­—ç¬¦ä¸²å·¥å…·æ–¹æ³•çš„æ•ˆç‡</li>
<li>äºŒè¿›åˆ¶å®‰å…¨ï¼ˆæ•°æ®å†™å…¥çš„æ ¼å¼å’Œè¯»å–çš„æ ¼å¼ä¸€è‡´ï¼‰</li>
</ul>
<blockquote>
<p>æ€»ç»“: string å°±æ˜¯å­—ç¬¦ä¸², ä½† Redis å…¶å®æœ‰å®ç°è‡ªå·±çš„ç±»åº“æé«˜å„æ–¹é¢çš„é€Ÿåº¦, åªèƒ½è¯´, ä¸“ä¸š!!!</p>
</blockquote>
<h3 id="2-list"><a href="#2-list" class="headerlink" title="2.list"></a>2.list</h3><h4 id="ziplist"><a href="#ziplist" class="headerlink" title="ziplist"></a>ziplist</h4><p>ziplistå¹¶ä¸æ˜¯ä¸€ä¸ªç±»åï¼Œå…¶ç»“æ„æ˜¯ä¸‹é¢è¿™æ ·çš„ï¼š <code>&lt;zlbytes&gt;&lt;zltail&gt;&lt;entries&gt;&lt;entry&gt;...&lt;entry&gt;&lt;zlend&gt;</code></p>
<p>å…¶ä¸­å„éƒ¨åˆ†ä»£è¡¨çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>zlbytesï¼š4ä¸ªå­—èŠ‚ï¼ˆ32bitsï¼‰ï¼Œè¡¨ç¤ºziplistå ç”¨çš„æ€»å­—èŠ‚æ•°</li>
<li>zltailï¼š4ä¸ªå­—èŠ‚ï¼ˆ32bitsï¼‰ï¼Œè¡¨ç¤ºziplistä¸­æœ€åä¸€ä¸ªèŠ‚ç‚¹åœ¨ziplistä¸­çš„åç§»å­—èŠ‚æ•°</li>
<li>entriesï¼š2ä¸ªå­—èŠ‚ï¼ˆ16bitsï¼‰ï¼Œè¡¨ç¤ºziplistä¸­çš„å…ƒç´ æ•°</li>
<li>entryï¼šé•¿åº¦ä¸å®šï¼Œè¡¨ç¤ºziplistä¸­çš„æ•°æ®</li>
<li>zlendï¼š1ä¸ªå­—èŠ‚ï¼ˆ8bitsï¼‰ï¼Œè¡¨ç¤ºç»“æŸæ ‡è®°ï¼Œè¿™ä¸ªå€¼å›ºå®šä¸ºffï¼ˆ255ï¼‰</li>
</ul>
<p>è¿™äº›æ•°æ®å‡ä¸ºå°ç«¯å­˜å‚¨ï¼Œæ‰€ä»¥å¯èƒ½æœ‰äº›äººæŸ¥çœ‹æ•°æ®çš„äºŒè¿›åˆ¶æµä¸å…¶å«ä¹‰å¯¹åº”ä¸ä¸Šï¼Œå…¶å®æ˜¯å› ä¸ºè¯»æ•°æ®çš„æ–¹å¼é”™äº†</p>
<p>ziplistå†…éƒ¨é‡‡å–æ•°æ®å‹ç¼©çš„æ–¹å¼è¿›è¡Œå­˜å‚¨ï¼Œå‹ç¼©æ–¹å¼å°±ä¸æ˜¯é‡ç‚¹äº†ï¼Œæˆ‘ä»¬ä»…ä»å®è§‚æ¥çœ‹ï¼Œziplistç±»ä¼¼ä¸€ä¸ªå°è£…çš„æ•°ç»„ï¼Œé€šè¿‡zltailå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œè¿½åŠ å’Œåˆ é™¤å°¾éƒ¨æ•°æ®ã€ä½¿ç”¨entrieså¯ä»¥æ–¹ä¾¿åœ°è®¡ç®—é•¿åº¦</p>
<h4 id="quicklist"><a href="#quicklist" class="headerlink" title="quicklist"></a>quicklist</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">quicklist</span> &#123;</span></span><br><span class="line">    quicklistNode *head;</span><br><span class="line">    quicklistNode *tail;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> count;        <span class="comment">/* ziplistæ‰€æœ‰èŠ‚ç‚¹çš„ä¸ªæ•° */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> len;          <span class="comment">/* quicklistNodeèŠ‚ç‚¹çš„ä¸ªæ•° */</span></span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">fill</span> : <span class="number">16</span>;              <span class="comment">/* å•ä¸ªèŠ‚ç‚¹çš„å¡«å……å› å­ */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> compress : <span class="number">16</span>; <span class="comment">/* å‹ç¼©ç«¯ç»“ç‚¹çš„æ·±åº¦ */</span></span><br><span class="line">&#125; quicklist;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æ˜æ˜¾åœ°çœ‹å‡ºï¼Œquicklistæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨çš„ç»“æ„ï¼Œä½†æ˜¯å†…éƒ¨åˆæ¶‰åŠäº†ziplistï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆè¯´ï¼Œåœ¨å®è§‚ä¸Šï¼Œquicklistæ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œåœ¨å¾®è§‚ä¸Šï¼Œæ¯ä¸€ä¸ªquicklistçš„èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªziplist</p>
<p>åœ¨redis.confä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢ä¸¤ä¸ªå‚æ•°æ¥è¿›è¡Œä¼˜åŒ–ï¼š</p>
<ul>
<li>list-max-ziplist-sizeï¼šè¡¨ç¤ºæ¯ä¸ªquicklistNodeçš„å­—èŠ‚å¤§å°ã€‚é»˜è®¤ä¸º2ï¼Œè¡¨ç¤º8KB</li>
<li>list-compress-depthï¼šè¡¨ç¤ºquicklistNodeèŠ‚ç‚¹æ˜¯å¦è¦å‹ç¼©ã€‚é»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸å‹ç¼©</li>
</ul>
<p>è¿™ç§å­˜å‚¨æ–¹å¼çš„ä¼˜ç‚¹å’Œé“¾è¡¨çš„ä¼˜ç‚¹ä¸€è‡´ï¼Œå°±æ˜¯æ’å…¥å’Œåˆ é™¤çš„æ•ˆç‡å¾ˆé«˜ï¼Œè€Œé“¾è¡¨æŸ¥è¯¢çš„æ•ˆç‡åˆç”±ziplistæ¥è¿›è¡Œå¼¥è¡¥ï¼Œæ‰€ä»¥quicklistå°±æˆä¸ºäº†listæ•°æ®ç»“æ„çš„é¦–é€‰</p>
<blockquote>
<p>æ€»ç»“: æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ + ziplist, åŒæ—¶å…·æœ‰ä¸¤è€…çš„ä¼˜ç‚¹(æŒ‡æ’å…¥é€Ÿåº¦å’ŒæŸ¥è¯¢é€Ÿåº¦, å…·ä½“å’‹å›äº‹, æ€ä¹ˆåšåˆ°çš„.. å®Œå…¨ä¸çŸ¥é“å•Š).</p>
</blockquote>
<h3 id="3-hash"><a href="#3-hash" class="headerlink" title="3.hash"></a>3.hash</h3><h4 id="ziphash"><a href="#ziphash" class="headerlink" title="ziphash"></a>ziphash</h4><p>zipmapå…¶æ ¼å¼å½¢å¦‚ä¸‹é¢è¿™æ ·ï¼š <code>&lt;zmlen&gt;&lt;len&gt;&quot;foo&quot;&lt;len&gt;&lt;free&gt;&quot;bar&quot;&lt;len&gt;&quot;hello&quot;&lt;len&gt;&lt;free&gt;&quot;world&quot;</code></p>
<p>å„éƒ¨åˆ†çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>zmlenï¼š1ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºzipmapçš„æ€»å­—èŠ‚æ•°</li>
<li>lenï¼š1~5ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥å­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦</li>
<li>freeï¼š1ä¸ªå­—èŠ‚ï¼Œæ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„8ä½æ•°ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²åé¢çš„ç©ºé—²æœªä½¿ç”¨å­—èŠ‚æ•°ï¼Œç”±äºä¿®æ”¹ä¸é”®å¯¹åº”çš„å€¼è€Œäº§ç”Ÿ</li>
</ul>
<p>è¿™å…¶ä¸­ç›¸é‚»çš„ä¸¤ä¸ªå­—ç¬¦ä¸²å°±åˆ†åˆ«æ˜¯é”®å’Œå€¼ï¼Œæ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°±è¡¨ç¤º<code>&quot;foo&quot; =&gt; &quot;bar&quot;, &quot;hello&quot; =&gt; &quot;world&quot;</code>è¿™æ ·çš„å¯¹åº”å…³ç³»</p>
<p>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œæ‰€ä»¥åªèƒ½å½“ä½œä¸€ä¸ªè½»é‡çº§çš„hashmapæ¥ä½¿ç”¨</p>
<h4 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dict</span> &#123;</span></span><br><span class="line">    dictType *type;	<span class="comment">/* æŒ‡å‘è‡ªå®šä¹‰ç±»å‹çš„æŒ‡é’ˆï¼Œå¯ä»¥å­˜å‚¨å„ç±»å‹æ•°æ® */</span></span><br><span class="line">    <span class="keyword">void</span> *privdata; <span class="comment">/* ç§æœ‰æ•°æ®çš„æŒ‡é’ˆ */</span></span><br><span class="line">    dictht ht[<span class="number">2</span>];	<span class="comment">/* ä¸¤ä¸ªhashè¡¨ï¼Œä¸€èˆ¬åªæœ‰h[0]æœ‰æ•ˆï¼Œh1[1]åªåœ¨rehashçš„æ—¶å€™æ‰æœ‰å€¼ */</span></span><br><span class="line">    <span class="keyword">long</span> rehashidx; <span class="comment">/* -1ï¼šæ²¡æœ‰åœ¨rehashçš„è¿‡ç¨‹ä¸­ï¼Œå¤§äºç­‰äº0ï¼šè¡¨ç¤ºæ‰§è¡Œrehashåˆ°ç¬¬å‡ æ­¥ */</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> iterators; 	<span class="comment">/* æ­£åœ¨éå†çš„è¿­ä»£å™¨ä¸ªæ•° */</span></span><br><span class="line">&#125; dict;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£çš„</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span> *key;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *val;</span><br><span class="line">        <span class="keyword">uint64_t</span> u64;</span><br><span class="line">        <span class="keyword">int64_t</span> s64;</span><br><span class="line">        <span class="keyword">double</span> d;</span><br><span class="line">    &#125; v;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">dictEntry</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; dictEntry;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬çŸ¥é“è¿™æ˜¯é‡‡ç”¨é“¾å¼ç»“æ„å­˜å‚¨å°±è¶³å¤Ÿäº†</p>
<p>è¿™ç§æ–¹å¼ä¼šæ¶ˆè€—è¾ƒå¤šçš„å†…å­˜ï¼Œæ‰€ä»¥ä¸€èˆ¬æ•°æ®è¾ƒå°‘æ—¶ä¼šé‡‡ç”¨è½»é‡çº§çš„zipmap</p>
<blockquote>
<p>æ€»ç»“: æ˜¯ä¸ªé“¾è¡¨, ç¼ºç‚¹æ˜¯æ¶ˆè€—å†…å­˜é«˜, å› æ­¤æ•°æ®è¾ƒå°‘ä¼šé‡‡ç”¨ zipmap è¿™ç§â€¦. æŒ‰å­—èŠ‚ç²¾æ‰“ç»†ç®—çš„æ–¹å¼å­˜å‚¨.</p>
</blockquote>
<h3 id="4-set"><a href="#4-set" class="headerlink" title="4.set"></a>4.set</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">intset</span> &#123;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> encoding;</span><br><span class="line">    <span class="keyword">uint32_t</span> length;</span><br><span class="line">    <span class="keyword">int8_t</span> contents[];</span><br><span class="line">&#125; intset;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å„å­—æ®µå«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>encodingï¼šæ•°æ®ç¼–ç æ ¼å¼ï¼Œè¡¨ç¤ºæ¯ä¸ªæ•°æ®å…ƒç´ ç”¨å‡ ä¸ªå­—èŠ‚å­˜å‚¨ï¼ˆå¯å–çš„å€¼æœ‰2ã€4ï¼Œå’Œ8ï¼‰</li>
<li>lengthï¼šå…ƒç´ ä¸ªæ•°</li>
<li>contentsï¼šæŸ”æ€§æ•°ç»„ï¼Œè¿™éƒ¨åˆ†å†…å­˜å•ç‹¬åˆ†é…ï¼Œä¸åŒ…å«åœ¨intsetä¸­</li>
</ul>
<p>intsetæœ‰ä¸€ä¸ªæ•°æ®å‡çº§çš„æ¦‚å¿µï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ª16ä½æ•´æ•°çš„setï¼Œè¿™æ—¶å€™æ’å…¥äº†ä¸€ä¸ª32ä½æ•´æ•°ï¼Œæ‰€ä»¥å°±å¯¼è‡´æ•´ä¸ªé›†åˆéƒ½å‡çº§ä¸º32ä½æ•´æ•°ï¼Œä½†æ˜¯åè¿‡æ¥å´ä¸è¡Œï¼Œè¿™ä¹Ÿå°±æ˜¯æŸ”æ€§æ•°ç»„çš„ç”±æ¥</p>
<p>å¦‚æœé›†åˆè¿‡å¤§ï¼Œä¼šé‡‡ç”¨dictçš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨</p>
<blockquote>
<p>æ€»ç»“: åº•å±‚æ˜¯ä¸ªæ•°ç»„çš„ inset ç»“æ„ä½“, å¦å¤–é›†åˆè¿‡å¤§ä¼šé‡‡ç”¨ dict æ¥å­˜å‚¨.</p>
</blockquote>
<h3 id="5-zset"><a href="#5-zset" class="headerlink" title="5.zset"></a>5.zset</h3><p>zsetï¼Œæœ‰å¾ˆå¤šåœ°æ–¹ä¹Ÿå«åšsorted setï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹çš„ç»“æ„ï¼Œå…¶é”®è¢«ç§°ä¸ºmemberï¼Œä¹Ÿå°±æ˜¯é›†åˆå…ƒç´ ï¼ˆzsetä¾ç„¶æ˜¯setï¼Œæ‰€ä»¥memberä¸èƒ½ç›¸åŒï¼‰ï¼Œå…¶å¯¹åº”çš„å€¼è¢«ç§°ä¸ºscoreï¼Œæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºä¼˜å…ˆçº§ï¼Œç”¨äºæ’åˆ—zsetçš„é¡ºåº</p>
<p>å…¶ä¹Ÿæœ‰ä¸¤ç§å­˜å‚¨æ–¹å¼ï¼Œä¸€ç§æ˜¯ziplist/zipmapçš„æ ¼å¼ï¼Œè¿™ç§æ–¹å¼æˆ‘ä»¬å°±ä¸è¿‡å¤šä»‹ç»äº†ï¼Œåªéœ€è¦äº†è§£è¿™ç§æ ¼å¼å°†æ•°æ®æŒ‰ç…§scoreçš„é¡ºåºæ’åˆ—å³å¯</p>
<p>å¦ä¸€ç§å­˜å‚¨æ ¼å¼æ˜¯é‡‡ç”¨äº†skiplistï¼Œæ„ä¸ºè·³è·ƒè¡¨ï¼Œå¯ä»¥çœ‹æˆå¹³è¡¡æ ‘æ˜ å°„çš„æ•°ç»„ï¼Œå…¶æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦å’Œå¹³è¡¡æ ‘åŸºæœ¬æ²¡æœ‰å·®åˆ«ï¼Œä½†æ˜¯å®ç°æ›´ä¸ºç®€å•ï¼Œå½¢å¦‚ä¸‹é¢è¿™æ ·çš„ç»“æ„ï¼ˆå›¾æ¥æº<a href="https://www.cnblogs.com/thrillerz/p/4505550.html" target="_blank" rel="noopener">è·³è·ƒè¡¨çš„åŸç†ï¼‰</a>ï¼š</p>
<p><img src="https://user-gold-cdn.xitu.io/2019/5/29/16b042094c9cec82?imageView2/0/w/1280/h/960/ignore-error/1" alt="ä¾‹å›¾"></p>
<blockquote>
<p>æ€»ç»“: çœ‹ä¸æ‡‚â€¦.</p>
<p>å†çœ‹çœ‹è¿™ä¸ªå§â€¦ æ›´ç»†è‡´ä¸€ç‚¹! <a href="https://juejin.cn/post/6844904192042074126" target="_blank" rel="noopener">https://juejin.cn/post/6844904192042074126</a></p>
</blockquote>
<h2 id="Redis-çš„æŒä¹…åŒ–"><a href="#Redis-çš„æŒä¹…åŒ–" class="headerlink" title="Redis çš„æŒä¹…åŒ–"></a>Redis çš„æŒä¹…åŒ–</h2><blockquote>
<p> æ‘˜è®°ä¸€ä¸‹: copy from <a href="https://mp.weixin.qq.com/s/zfkhQFEBkKSRsfKF63R94A" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/zfkhQFEBkKSRsfKF63R94A</a></p>
</blockquote>
<h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><p>å†™RDBæ–‡ä»¶æ˜¯Redisçš„ä¸€ç§æŒä¹…åŒ–æ–¹å¼ã€‚åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ï¼ŒRDBæ–‡ä»¶æ˜¯ä¸€ä¸ªç´§å‡‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯ä¸€ä¸ªæ–‡ä»¶éƒ½ä»£è¡¨äº†<strong>æŸä¸€ä¸ªæ—¶åˆ»</strong>ï¼ˆæ‰§è¡Œforkçš„æ—¶åˆ»ï¼‰Rediså®Œæ•´çš„æ•°æ®å¿«ç…§ï¼Œæ¢å¤æ•°æ®æ—¶ï¼Œå°†å¿«ç…§æ–‡ä»¶è¯»å…¥å†…å­˜å³å¯ã€‚</p>
<p><strong>è§¦å‘ä¿å­˜RDBæ–‡ä»¶4ç§æƒ…å†µ</strong></p>
<ol>
<li>æ‰‹åŠ¨æ‰§è¡Œsaveå‘½ä»¤ã€bgsave</li>
<li>æ»¡è¶³é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„saveç›¸å…³é…ç½®é¡¹æ—¶ï¼Œè‡ªåŠ¨è§¦å‘</li>
<li>æ‰‹åŠ¨æ‰§è¡Œflushall</li>
<li>å…³é—­redis , æ‰§è¡Œ shutdown å‘½ä»¤</li>
</ol>
<p><strong>å¦‚ä½•è®©redisåŠ è½½rdbæ–‡ä»¶ï¼Ÿ</strong></p>
<p>åªéœ€è¦å°†rdbæ–‡ä»¶æ”¾åœ¨redisçš„å¯åŠ¨ç›®å½•ä¸‹ï¼Œrediså…¶ä¸­æ—¶ä¼šè‡ªåŠ¨åŠ è½½å®ƒã€‚</p>
<p><strong>RDBæ¨¡å¼çš„ä¼˜ç¼ºç‚¹ï¼š</strong></p>
<p>ä¼˜ç‚¹ï¼šRDBè¿‡ç¨‹ä¸­ï¼Œç”±å­è¿›ç¨‹ä»£æ›¿ä¸»è¿›ç¨‹è¿›è¡Œå¤‡ä»½çš„IOæ“ä½œã€‚ä¿è¯äº†ä¸»è¿›ç¨‹ä»ç„¶æä¾›é«˜æ€§èƒ½çš„æœåŠ¡ã€‚é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®å¤‡ä»½æ¢å¤è¿‡ç¨‹ã€‚</p>
<p>ç¼ºç‚¹ï¼š</p>
<ol>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯æ¯éš”ä¸€æ®µæ—¶é—´è¿›è¡Œä¸€æ¬¡æ•°æ®å¤‡ä»½ï¼Œæ‰€ä»¥ä¸€æ—¦å‡ºç°æœ€åä¸€æ¬¡æŒä¹…åŒ–çš„æ•°æ®ä¸¢å¤±ï¼Œå°†ä¸¢å¤±å¤§è§„æ¨¡çš„æ•°æ®ã€‚</li>
<li>fork()å­è¿›ç¨‹æ—¶ä¼šå ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœåœ¨fork()å­è¿›ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œçˆ¶è¿›ç¨‹å¤¯ä½äº†ï¼Œé‚£ä¹Ÿå°±æ˜¯rediså¡ä½äº†ï¼Œä¸èƒ½å¯¹å¤–æä¾›æœåŠ¡ã€‚æ‰€ä»¥ä¸è¦è®©ç”ŸæˆRDBæ–‡ä»¶çš„æ—¶é—´é—´éš”å¤ªé•¿ï¼Œä¸ç„¶æ¯æ¬¡ç”Ÿæˆçš„RDBæ–‡ä»¶è¿‡å¤§å¯¹Redisæœ¬èº«ä¹Ÿæ˜¯æœ‰å½±å“çš„ã€‚</li>
</ol>
<img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203195703.png" alt="image-20210203195701943" style="zoom:50%;" />

<blockquote>
<p>æ€»ç»“: æ¯éš”ä¸€æ®µæ—¶é—´(ä¸€èˆ¬æ¯”è¾ƒä¹…)è§¦å‘çš„å…¨é‡å¤‡ä»½, å¤‡ä»½é€Ÿåº¦å–å†³äºä½¿ç”¨æƒ…å†µ, å¤‡ä»½æ—¶ Redis ä»ç„¶å¯è¯»å¯å†™, ä½†å†™è¿˜æ˜¯æœ‰äº›é—®é¢˜. ç¼ºç‚¹æ˜¯å®•æœºå®¹æ˜“ä¸¢å¤±è¾ƒä¹…çš„æ•°æ®.</p>
</blockquote>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><p>Append Only Fileï¼Œä»–ä¹Ÿæ˜¯Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚å³å°†æ‰€æœ‰çš„å†™å‘½ä»¤éƒ½ä»¥æ—¥å¿—çš„æ–¹å¼è¿½åŠ è®°å½•ä¸‹æ¥ï¼ˆåªè¿½åŠ ï¼Œä¸ä¿®æ”¹ï¼‰ï¼Œæ¢å¤çš„æ—¶å€™å°†è¿™ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤è¯»å‡ºæ¥å›æ”¾ã€‚</p>
<p><strong>aofæ¨¡å¼çš„ä¼˜ç¼ºç‚¹</strong><br><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ol>
<li>aofæ˜¯ç”¨è¿½åŠ çš„å½¢å¼å†™ï¼Œæ²¡æœ‰éšæœºç£ç›˜IOé‚£æ ·çš„å¯»å€å¼€é”€ï¼Œæ€§èƒ½è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚</li>
<li>aofå¯ä»¥æ›´å¥½çš„ä¿æŠ¤æ•°æ®ä¸ä¸¢å¤±æˆ–è€…å°½å¯èƒ½çš„å°‘ä¸¢å¤±ï¼šè®¾ç½®è®©redisæ¯ç§’åŒæ­¥ä¸€æ¬¡æ•°æ®ï¼Œå³ä½¿rediså®•æœºäº†ï¼Œæœ€å¤šä¹Ÿå°±ä¸¢å¤±1ç§’çš„æ•°æ®ã€‚</li>
<li>å³ä½¿aofçœŸçš„ä½“ç§¯å¾ˆå¤§ï¼Œä¹Ÿå¯ä»¥è®¾ç½®åå°é‡å†™ï¼Œä¸å½±å“å®¢æˆ·ç«¯çš„é‡å†™ã€‚</li>
<li>aofé€‚åˆåšç¾éš¾æ€§çš„è¯¯åˆ é™¤ç´§æ€¥æ¢å¤ï¼šæ¯”å¦‚ä¸å°å¿ƒæ‰§è¡Œäº†flushallï¼Œç„¶åå¯ä»¥åœ¨å‘ç”Ÿrewriteä¹‹å‰ å¿«é€Ÿå¤‡ä»½ä¸‹aofæ–‡ä»¶ï¼Œå»æ‰æœ«å°¾çš„ flushallï¼Œé€šè¿‡æ¢å¤æœºåˆ¶æ¢å¤æ•°æ®ã€‚</li>
</ol>
<p><strong>ç¼ºç‚¹</strong>ï¼šä½¿ç”¨aofä¸€ç›´è¿½åŠ å†™ï¼Œå¯¼è‡´aofçš„ä½“ç§¯è¿œå¤§äºRDBæ–‡ä»¶çš„ä½“ç§¯ï¼Œæ¢å¤æ•°æ®ã€ä¿®å¤çš„é€Ÿåº¦è¦æ¯”rdbæ…¢å¾ˆå¤šã€‚</p>
<p>aofçš„é‡å†™</p>
<blockquote>
<p>AOFé‡‡å–çš„æ˜¯æ–‡ä»¶è¿½åŠ çš„æ–¹å¼,æ–‡ä»¶çš„ä½“ç§¯è¶Šæ¥è¶Šå¤§,ä¸ºäº†ä¼˜åŒ–è¿™ç§ç°è±¡,å¢åŠ äº†é‡å†™æœºåˆ¶,å½“aofæ–‡ä»¶çš„ä½“ç§¯åˆ°è¾¾æˆ‘ä»¬åœ¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶ä¸Šçš„é˜•å€¼æ—¶,å°±ä¼šè§¦å‘é‡å†™ç­–ç•¥,åªä¿ç•™å’Œæ•°æ®æ¢å¤ç›¸å…³çš„å‘½ä»¤ã€‚</p>
</blockquote>
<p>æ‰‹åŠ¨è§¦å‘é‡å†™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redisä¼šforkå‡ºä¸€æ¡æ–°çš„è¿›ç¨‹</span></span><br><span class="line"><span class="comment"># åŒæ ·æ˜¯å…ˆå¤åˆ¶åˆ°ä¸€ä»½æ–°çš„ä¸´æ—¶æ–‡ä»¶,æœ€åå†rename,éå†æ¯ä¸€æ¡è¯­å¥,è®°å½•ä¸‹æœ‰setçš„è¯­å¥</span></span><br><span class="line">bgrewriteaof</span><br></pre></td></tr></table></figure>

<h3 id="RDBå’ŒAOFçš„é€‰æ‹©"><a href="#RDBå’ŒAOFçš„é€‰æ‹©" class="headerlink" title="RDBå’ŒAOFçš„é€‰æ‹©"></a>RDBå’ŒAOFçš„é€‰æ‹©</h3><ul>
<li>å¦‚æœæˆ‘ä»¬çš„redisåªæ˜¯ç®€å•çš„ä½œä¸ºç¼“å­˜ï¼Œé‚£ä¸¤è€…éƒ½ä¸è¦ä¹Ÿæ²¡äº‹ã€‚</li>
<li>å¦‚æœæ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œé‚£ä¸è¦ä»…ä»…ä½¿ç”¨RDBï¼Œå› ä¸ºä¸€æ—¦å‘ç”Ÿæ•…éšœï¼Œä½ ä¼šä¸¢å¤±å¾ˆå¤šæ•°æ®ã€‚</li>
<li>åŒæ—¶å¼€å¯ä¸¤è€…: åœ¨è¿™ç§æƒ…å†µä¸‹,redisä¼˜å…ˆåŠ è½½çš„æ˜¯aof,å› ä¸ºå®ƒçš„æ•°æ®å¾ˆå¯èƒ½æ¯”rdbæ›´å…¨,ä½†æ˜¯å¹¶ä¸å»ºè®®åªæ˜¯ç”¨aof,å› ä¸ºaofä¸æ˜¯é‚£ä¹ˆçš„å®‰å…¨,å¾ˆå¯èƒ½å­˜åœ¨æ½œåœ¨çš„bugã€‚</li>
</ul>
<p><strong>æ¨èï¼š</strong></p>
<ul>
<li>å»ºè®®åœ¨ä»æœºslaveä¸Šåªå¤‡ä»½rdbæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ã€‚</li>
<li>å¦‚æœå¯åŠ¨äº†aof,æˆ‘ä»¬å°½é‡å‡å°‘rewriteçš„é¢‘ç‡,åŸºç¡€å¤§å°è®¾ç½®ä¸º5Gå®Œå…¨å¯ä»¥,èµ·æ­¥ä¹Ÿè¦3Gã€‚</li>
<li>å¦‚æœæˆ‘ä»¬ä¸é€‰æ‹©aof, è€Œæ˜¯é€‰æ‹©äº†ä¸»ä»å¤åˆ¶çš„æ¶æ„å®ç°é«˜å¯ç”¨åŒæ ·å¯ä»¥,èƒ½çœæ‰ä¸€å¤§ç¬”IOæ“ä½œ,ä½†æ˜¯æ„å¤–å‘ç”Ÿçš„è¯,ä¼šä¸¢å¤±åå‡ åˆ†é’Ÿçš„æ•°æ®ã€‚</li>
</ul>
<img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203195723.png" alt="image-20210203195722608" style="zoom:50%;" />



<blockquote>
<p>æ€»ç»“: AOF è®°å½•çš„æ˜¯å¯¹Redisæ•°æ®åº“åšæ›´æ”¹çš„å‘½ä»¤åˆ—è¡¨, ç±»ä¼¼ MySQL çš„ binlog.</p>
</blockquote>
<h2 id="ä¸€è‡´æ€§-Hash-ç®—æ³•"><a href="#ä¸€è‡´æ€§-Hash-ç®—æ³•" class="headerlink" title="ä¸€è‡´æ€§ Hash ç®—æ³•"></a>ä¸€è‡´æ€§ Hash ç®—æ³•</h2><blockquote>
<p>copy from <a href="https://juejin.cn/post/6844903670430040078#heading-1" target="_blank" rel="noopener">https://juejin.cn/post/6844903670430040078#heading-1</a></p>
</blockquote>
<blockquote>
<p>æ€»è®¡: ä¸€ä¸ªé€‰å–é›†ç¾¤å†…æœåŠ¡å™¨çš„ç®—æ³•, ä½¿å…¶åœ¨å¤§é‡çš„è¯·æ±‚ä¸‹å¯åšåˆ°æµé‡å‡åŒ€çš„è½åˆ°æ¯å°æœåŠ¡å™¨ä¸Š.</p>
<p>é¦–å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µ, å°±æ˜¯ hash ç¯, å…¶æ˜¯ hash çš„å–å€¼èŒƒå›´å¤§å°, å±•å¼€å°±æ˜¯ èŒƒå›´ä¸‹é™-èŒƒå›´ä¸Šé™, å›´èµ·æ¥åˆ™æ˜¯ä¸€ä¸ªç¯.</p>
<p>å®ç°åŸç†æ˜¯, å¯¹æ¯ä¸ªæœåŠ¡å™¨å– hash, è®°å½•ä¸‹ hash ä½ç½®, å†å¯¹æ¯ä¸ªè¯·æ±‚çš„ç‰¹å®šä¿¡æ¯(å¦‚ip, Redis Key)ä¹Ÿå– hash, åœ¨æ ¹æ®è¿™ä¸¤ä¸ª hash å¤§å°å…³ç³», é¡ºæ—¶é’ˆ(æ‰¾æ¯”å…¶æ›´å¤§çš„)å¯»æ‰¾ç¦»å¾—æœ€è¿‘çš„æœåŠ¡å™¨;</p>
<p>å› ä¸ºå¤§é‡çš„è¯·æ±‚ä¼šå‡åŒ€çš„æ•£è½åœ¨ hash ç¯ä¸Š, è¿™ä¸ªæ˜¯ hash ç®—æ³•å†³å®šçš„æ€§è´¨, åŒç†å¤§é‡çš„æœåŠ¡å™¨èŠ‚ç‚¹ä¹Ÿä¼šå‡è¡¡çš„æ•£è½åœ¨ hash å€¼èŒƒå›´å†…, å› æ­¤æ€»ä½“æ¥çœ‹, è¯·æ±‚æ€»æ˜¯å‡åŒ€çš„æ‰“è½åˆ°æ¯å°æœåŠ¡å™¨.</p>
<p>ä½†è¿™ä¹Ÿå¼•å‡ºä¸€ä¸ªé—®é¢˜, å°±æ˜¯ hash å€¼èŒƒå›´è¿‡å¤§, è€ŒæœåŠ¡å™¨æ•°é‡è¿‡å°‘, æ— æ³•ä¿è¯æœåŠ¡å™¨å‡è¡¡çš„æ•£è½åœ¨æ•´ä¸ª hash ä¸Š, å› æ­¤å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹, ä½¿å¾—æ¯ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„ hash ä¸åŸèŠ‚ç‚¹ä¸ä¸€è‡´, ç„¶åæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºå¤§é‡çš„(æ¯”å¦‚1000)è™šæ‹ŸèŠ‚ç‚¹, è®¡ç®—çš„ hash åˆ™ä¼šå‡åŒ€çš„æ•£è½åœ¨ hash ç¯ä¸Šäº†.</p>
</blockquote>
<blockquote>
<p>å†æ€»ç»“: å……åˆ†åˆ©ç”¨ hash ç®—æ³•çš„ç‰¹æ€§, ä»¥åŠåŠ å…¥å– hash æ‰¾è·ç¦»è¿‘çš„æœåŠ¡å™¨è¿™ä¸ªç†å¿µ, ä½¿å¾—å³ä½¿å¯¹æœåŠ¡å™¨è¿›è¡Œä¼¸ç¼©, ä¹Ÿå¯ä»¥é™ä½è¢«å½±å“çš„key.</p>
</blockquote>
<h3 id="å¯¹æ¯”-HashSlot"><a href="#å¯¹æ¯”-HashSlot" class="headerlink" title="å¯¹æ¯” HashSlot"></a>å¯¹æ¯” HashSlot</h3><p>äº†è§£äº†ä¸€è‡´æ€§Hashç®—æ³•çš„ç‰¹ç‚¹åï¼Œæˆ‘ä»¬ä¹Ÿä¸éš¾å‘ç°ä¸€äº›ä¸å°½äººæ„çš„åœ°æ–¹ï¼š</p>
<ul>
<li>æ•´ä¸ªåˆ†å¸ƒå¼ç¼“å­˜éœ€è¦ä¸€ä¸ªè·¯ç”±æœåŠ¡æ¥åšè´Ÿè½½å‡è¡¡ï¼Œå­˜åœ¨å•ç‚¹é—®é¢˜ï¼ˆå¦‚æœè·¯ç”±æœåŠ¡æŒ‚äº†ï¼Œæ•´ä¸ªç¼“å­˜ä¹Ÿå°±å‡‰äº†ï¼‰</li>
<li>Hashç¯ä¸Šçš„èŠ‚ç‚¹éå¸¸å¤šæˆ–è€…æ›´æ–°é¢‘ç¹æ—¶ï¼ŒæŸ¥æ‰¾æ€§èƒ½ä¼šæ¯”è¾ƒä½ä¸‹</li>
</ul>
<p>é’ˆå¯¹è¿™äº›é—®é¢˜ï¼ŒRedisåœ¨å®ç°è‡ªå·±çš„åˆ†å¸ƒå¼é›†ç¾¤æ–¹æ¡ˆæ—¶ï¼Œè®¾è®¡äº†å…¨æ–°çš„æ€è·¯ï¼šåŸºäºP2Pç»“æ„çš„HashSlotç®—æ³•ï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š</p>
<ol>
<li><p>ä½¿ç”¨HashSlot</p>
<p>ç±»ä¼¼äºHashç¯ï¼ŒRedis Clusteré‡‡ç”¨HashSlotæ¥å®ç°Keyå€¼çš„å‡åŒ€åˆ†å¸ƒå’Œå®ä¾‹çš„å¢åˆ ç®¡ç†ã€‚</p>
<p>é¦–å…ˆé»˜è®¤åˆ†é…äº†16384ä¸ªSlotï¼ˆè¿™ä¸ªå¤§å°æ­£å¥½å¯ä»¥ä½¿ç”¨2kbçš„ç©ºé—´ä¿å­˜ï¼‰ï¼Œæ¯ä¸ªSlotç›¸å½“äºä¸€è‡´æ€§Hashç¯ä¸Šçš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ¥å…¥é›†ç¾¤çš„æ‰€æœ‰å®ä¾‹å°†å‡åŒ€åœ°å æœ‰è¿™äº›Slotï¼Œè€Œæœ€ç»ˆå½“æˆ‘ä»¬Setä¸€ä¸ªKeyæ—¶ï¼Œä½¿ç”¨<code>CRC16(Key) % 16384</code>æ¥è®¡ç®—å‡ºè¿™ä¸ªKeyå±äºå“ªä¸ªSlotï¼Œå¹¶æœ€ç»ˆæ˜ å°„åˆ°å¯¹åº”çš„å®ä¾‹ä¸Šå»ã€‚</p>
<p>é‚£ä¹ˆå½“å¢åˆ å®ä¾‹æ—¶ï¼ŒSlotå’Œå®ä¾‹é—´çš„å¯¹åº”è¦å¦‚ä½•è¿›è¡Œå¯¹åº”çš„æ”¹åŠ¨å‘¢ï¼Ÿ</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼ŒåŸæœ¬æœ‰3ä¸ªèŠ‚ç‚¹A,B,Cï¼Œé‚£ä¹ˆä¸€å¼€å§‹åˆ›å»ºé›†ç¾¤æ—¶Slotçš„è¦†ç›–æƒ…å†µæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">èŠ‚ç‚¹A	0ï¼5460</span><br><span class="line">èŠ‚ç‚¹B	5461ï¼10922</span><br><span class="line">èŠ‚ç‚¹C	10923ï¼16383</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å‡è®¾è¦å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹Dï¼ŒRedisClusterçš„åšæ³•æ˜¯å°†ä¹‹å‰æ¯å°æœºå™¨ä¸Šçš„ä¸€éƒ¨åˆ†Slotç§»åŠ¨åˆ°Dä¸Šï¼ˆæ³¨æ„è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ„å‘³ç€è¦å¯¹èŠ‚ç‚¹Då†™å…¥çš„KVå‚¨å­˜ï¼‰ï¼ŒæˆåŠŸæ¥å…¥åSlotçš„è¦†ç›–æƒ…å†µå°†å˜ä¸ºå¦‚ä¸‹æƒ…å†µï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">èŠ‚ç‚¹A	1365-5460</span><br><span class="line">èŠ‚ç‚¹B	6827-10922</span><br><span class="line">èŠ‚ç‚¹C	12288-16383</span><br><span class="line">èŠ‚ç‚¹D	0-1364,5461-6826,10923-12287</span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure>

<p>åŒç†åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯å°†å…¶åŸæ¥å æœ‰çš„Slotä»¥åŠå¯¹åº”çš„KVå‚¨å­˜å‡åŒ€åœ°å½’è¿˜ç»™å…¶ä»–èŠ‚ç‚¹ã€‚</p>
</li>
<li><p>P2PèŠ‚ç‚¹å¯»æ‰¾</p>
<p>ç°åœ¨æˆ‘ä»¬è€ƒè™‘å¦‚ä½•å®ç°å»ä¸­å¿ƒåŒ–çš„è®¿é—®ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºè®¿é—®é›†ç¾¤ä¸­çš„å“ªä¸ªèŠ‚ç‚¹ï¼Œä½ éƒ½èƒ½å¤Ÿæ‹¿åˆ°æƒ³è¦çš„æ•°æ®ã€‚å…¶å®è¿™æœ‰ç‚¹ç±»ä¼¼äºè·¯ç”±å™¨çš„è·¯ç”±è¡¨ï¼Œå…·ä½“è¯´æ¥å°±æ˜¯ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜æœ‰å®Œæ•´çš„<code>HashSlot - èŠ‚ç‚¹</code>æ˜ å°„è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“è‡ªå·±æ‹¥æœ‰å“ªäº›Slotï¼Œä»¥åŠæŸä¸ªç¡®å®šçš„Slotç©¶ç«Ÿå¯¹åº”ç€å“ªä¸ªèŠ‚ç‚¹ã€‚</li>
<li>æ— è®ºå‘å“ªä¸ªèŠ‚ç‚¹å‘å‡ºå¯»æ‰¾Keyçš„è¯·æ±‚ï¼Œè¯¥èŠ‚ç‚¹éƒ½ä¼šé€šè¿‡<code>CRC(Key) % 16384</code>è®¡ç®—è¯¥Keyç©¶ç«Ÿå­˜åœ¨äºå“ªä¸ªSlotï¼Œå¹¶å°†è¯·æ±‚è½¬å‘è‡³è¯¥Slotæ‰€åœ¨çš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ä¸¤ä¸ªè¦ç‚¹ï¼š<strong>æ˜ å°„è¡¨</strong>å’Œ<strong>å†…éƒ¨è½¬å‘</strong>ï¼Œè¿™æ˜¯é€šè¿‡è‘—åçš„<strong><a href="https://blog.csdn.net/chen77716/article/details/6275762" target="_blank" rel="noopener">Gossipåè®®</a></strong>æ¥å®ç°çš„ã€‚</p>
</li>
</ol>
<blockquote>
<p>æ€»ç»“: æ˜ å°„è¡¨è®°å½•äº†æˆ‘è¿™ä¸ª key è®¡ç®— hash ä½äºçš„æ§½å±äºå“ªä¸ªèŠ‚ç‚¹, è‹¥æ˜¯èŠ‚ç‚¹è‡ªèº«, åˆ™å¤„ç†è¯·æ±‚, è‹¥ä¸æ˜¯åˆ™è½¬å‘åˆ°é‚£ä¸ªèŠ‚ç‚¹. </p>
</blockquote>
<h2 id="CAPç†è®º"><a href="#CAPç†è®º" class="headerlink" title="CAPç†è®º"></a>CAPç†è®º</h2><blockquote>
<p>æ‘˜è®°ä¸€ä¸‹: copy from <a href="https://mp.weixin.qq.com/s/zfkhQFEBkKSRsfKF63R94A" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/zfkhQFEBkKSRsfKF63R94A</a></p>
</blockquote>
<ul>
<li><strong>C(Consistency å¼ºä¸€è‡´æ€§)</strong></li>
<li><strong>A(Availabilityå¯ç”¨æ€§)</strong></li>
<li><strong>P(Partition toleranceåˆ†åŒºå®¹é”™æ€§)</strong></li>
</ul>
<p>CAP çš„ç†è®ºæ ¸å¿ƒæ˜¯: ä¸€ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿ,ä¸å¯èƒ½å¾ˆå¥½çš„æ»¡è¶³ä¸€è‡´æ€§,å¯ç”¨æ€§,åˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚,æœ€å¤šåŒæ—¶åªèƒ½æ»¡è¶³ä¸¤ä¸ª.å› æ­¤CAPåŸç†å°†nosqlåˆ†æˆäº†ä¸‰å¤§åŸåˆ™:</p>
<ul>
<li>CA- å•ç‚¹é›†ç¾¤,æ»¡è¶³å¼ºä¸€è‡´æ€§å’Œå¯ç”¨æ€§,æ¯”å¦‚è¯´oracle,æ‰©å±•æ€§æ”¶åˆ°äº†é™åˆ¶ã€‚</li>
<li>CP- æ»¡è¶³ä¸€è‡´æ€§,å’Œåˆ†åŒºå®¹é”™æ€§<strong>Rediså’ŒMongoDBéƒ½å±äºè¿™ç§ç±»å‹ã€‚</strong></li>
<li>AP- é€‰æ‹©äº†å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§,ä»–ä¹Ÿæ˜¯å¤§å¤šæ•°ç½‘ç«™çš„é€‰æ‹©,å®¹å¿æ•°æ®å¯ä»¥æš‚æ—¶ä¸ä¸€è‡´,ä½†æ˜¯ä¸å®¹å¿ç³»ç»ŸæŒ‚æ‰ã€‚</li>
</ul>
<h2 id="Redis-é…ç½®æ–‡ä»¶"><a href="#Redis-é…ç½®æ–‡ä»¶" class="headerlink" title="Redis é…ç½®æ–‡ä»¶"></a>Redis é…ç½®æ–‡ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## å¯åŠ¨redisçš„æ–¹å¼</span></span><br><span class="line"> 2./redis-server /path/to/redis.conf</span><br><span class="line"> 3</span><br><span class="line"> 4<span class="comment"># å¯ä»¥åƒä¸‹é¢è¿™æ ·è®©åœ¨å½“å‰é…ç½®æ–‡ä»¶åŒ…å«å¼•ç”¨å…¶ä»–é…ç½®æ–‡ä»¶</span></span><br><span class="line"> 5include /path/to/local.conf</span><br><span class="line"> 6include /path/to/other.conf</span><br><span class="line"> 7</span><br><span class="line"> 8<span class="comment"># æŒ‡å®šå“ªäº›å®¢æˆ·ç«¯å¯ä»¥è¿æ¥ä½¿ç”¨redis</span></span><br><span class="line"> 9Examples:</span><br><span class="line">10bind 192.168.1.100 10.0.0.1  <span class="comment"># æŒ‡å®šip</span></span><br><span class="line">11bind 127.0.0.1 ::1 <span class="comment"># ä»…é™äºæœ¬æœºå¯è®¿é—®</span></span><br><span class="line">12</span><br><span class="line">13<span class="comment"># æ˜¯å¦å¤„äºå—ä¿æŠ¤çš„æ¨¡å¼ï¼Œé»˜è®¤å¼€å¯</span></span><br><span class="line">14protected-mode yes</span><br><span class="line">15</span><br><span class="line">16<span class="comment"># å¯¹å¤–æš´éœ²çš„ç«¯å£</span></span><br><span class="line">17port 16379</span><br><span class="line">18</span><br><span class="line">19<span class="comment"># TCPçš„é€šç”¨é…ç½®</span></span><br><span class="line">20tcp-backlog 511</span><br><span class="line">21timeout 0</span><br><span class="line">22tcp-keepalive 300</span><br><span class="line">23</span><br><span class="line">24<span class="comment"># æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œé»˜è®¤ä¸ºno</span></span><br><span class="line">25daemonize yes</span><br><span class="line">26</span><br><span class="line">27<span class="comment"># å¦‚æœè¿›ç¨‹åœ¨åå°è¿è¡Œï¼Œéœ€è¦æŒ‡å®šè¿™ä¸ªpidæ–‡ä»¶</span></span><br><span class="line">28pidfile /var/run/redis_6379.pid</span><br><span class="line">29</span><br><span class="line">30<span class="comment"># æ—¥å¿—çº§åˆ«</span></span><br><span class="line">31<span class="comment"># debug æµ‹è¯•å¼€å‘èŠ‚ç‚¹</span></span><br><span class="line">32<span class="comment"># verbose (å’Œdubugå¾ˆåƒï¼Œä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—)</span></span><br><span class="line">33<span class="comment"># notice (ç”Ÿäº§ç¯å¢ƒä½¿ç”¨)</span></span><br><span class="line">34<span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">35loglevel notice</span><br><span class="line">36</span><br><span class="line">37<span class="comment"># æ—¥å¿—æ–‡ä»¶å</span></span><br><span class="line">38logfile <span class="string">""</span></span><br><span class="line">39</span><br><span class="line">40<span class="comment"># æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤16ä¸ª</span></span><br><span class="line">41databases 16</span><br><span class="line">42</span><br><span class="line">43<span class="comment"># æ˜¯å¦æ€»æ˜¯æ˜¾ç¤ºlogo</span></span><br><span class="line">44always-show-logo yes</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47<span class="comment"># è®¾ç½®redisçš„ç™»é™†å¯†ç ï¼ˆé»˜è®¤æ²¡æœ‰å¯†ç ï¼‰</span></span><br><span class="line">48<span class="comment"># è®¾ç½®å®Œå¯†ç åï¼Œä½¿ç”¨redis-cliç™»é™†æ—¶ï¼Œä½¿ç”¨auth password è®¤è¯ç™»é™†</span></span><br><span class="line">49requirepass foobared</span><br><span class="line">50</span><br><span class="line">51<span class="comment"># è®¾ç½®èƒ½è¿æ¥ä¸Šredisçš„å®¢æˆ·ç«¯çš„æœ€å¤§æ•°é‡</span></span><br><span class="line">52maxclients 10000</span><br><span class="line">53</span><br><span class="line">54<span class="comment"># ç»™redisè®¾ç½®æœ€å¤§çš„å†…å­˜å®¹é‡</span></span><br><span class="line">55maxmemory &lt;bytes&gt;</span><br><span class="line">56</span><br><span class="line">57<span class="comment"># å†…å­˜è¾¾åˆ°ä¸Šé™åçš„å¤„ç†ç­–ç•¥</span></span><br><span class="line">58<span class="comment"># volatile-lru -&gt; åªé’ˆå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUç§»é™¤</span></span><br><span class="line">59<span class="comment"># allkeys-lru -&gt; åˆ é™¤LRUç®—æ³•çš„Key</span></span><br><span class="line">60<span class="comment"># volatile-lfu -&gt; ä½¿ç”¨å…·æœ‰è¿‡æœŸé›†çš„å¯†é’¥åœ¨è¿‘ä¼¼çš„LFUä¸­è¿›è¡Œé©±é€ã€‚</span></span><br><span class="line">61<span class="comment"># allkeys-lfu -&gt; ä½¿ç”¨è¿‘ä¼¼çš„LFUé€€å‡ºä»»ä½•å¯†é’¥ã€‚</span></span><br><span class="line">62<span class="comment"># volatile-random -&gt; éšæœºåˆ é™¤å³å°†è¿‡æœŸçš„key</span></span><br><span class="line">63<span class="comment"># allkeys-random -&gt; éšæœºåˆ é™¤</span></span><br><span class="line">64<span class="comment"># volatile-ttl -&gt; åˆ é™¤å³å°†è¿‡æœŸçš„</span></span><br><span class="line">65<span class="comment"># noeviction -&gt; æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">66maxmemory-policy noeviction</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203194805.png" alt="image-20210203194803411"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/02/01/principle-mysql-memo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/01/principle-mysql-memo/" class="post-title-link" itemprop="url">MySQL æ¢ç§˜ç¬”è®°</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-02-01 15:21:08" itemprop="dateCreated datePublished" datetime="2021-02-01T15:21:08+08:00">2021-02-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:53:35" itemprop="dateModified" datetime="2021-03-28T19:53:35+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/interview/" itemprop="url" rel="index"><span itemprop="name">interview</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/02/01/principle-mysql-memo/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/02/01/principle-mysql-memo/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL-æ¢ç§˜ç¬”è®°"><a href="#MySQL-æ¢ç§˜ç¬”è®°" class="headerlink" title="MySQL æ¢ç§˜ç¬”è®°"></a>MySQL æ¢ç§˜ç¬”è®°</h1><h2 id="ç”±SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹å¼•å‡º-MySQL-æ ¸å¿ƒç»„ä»¶"><a href="#ç”±SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹å¼•å‡º-MySQL-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="ç”±SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹å¼•å‡º MySQL æ ¸å¿ƒç»„ä»¶"></a>ç”±SQLè¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹å¼•å‡º MySQL æ ¸å¿ƒç»„ä»¶</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.å®¢æˆ·ç«¯å‘é€ SQL è¯­å¥ç»™ MySQL.</span><br><span class="line">2.MySQL çš„ Server å±‚ä¸å®¢æˆ·ç«¯é€šä¿¡, å¾—åˆ° SQL è¯­å¥.</span><br><span class="line">3.Server å±‚å…ˆæ£€æŸ¥ç¼“å­˜, åè°ƒç”¨åˆ†æå™¨.</span><br><span class="line">4.åˆ†æå™¨è§£æ SQL è¯­å¥å¾—åˆ°è§£ææ ‘, ç„¶åè°ƒç”¨ä¼˜åŒ–å™¨.</span><br><span class="line">5.ä¼˜åŒ–å™¨åŸºäºæˆæœ¬æ§åˆ¶æ¥å¯»æ‰¾è¾ƒä¼˜è§£, å¦‚é€»è¾‘è½¬æ¢/é€‰å–ç´¢å¼•/è®¡ç®—æˆæœ¬/æ”¹è¿›è®¡åˆ’, æœ€ç»ˆå¾—åˆ°æŸ¥è¯¢è®¡åˆ’; ç„¶åè°ƒç”¨æ‰§è¡Œå™¨</span><br><span class="line">5.æ‰§è¡Œå™¨æ ¹æ®æŸ¥è¯¢è®¡åˆ’æ‰§è¡Œå­˜å‚¨å¼•æ“å¹¶è·å–è¿”å›ç»“æœå†è¿”å›ç»™å®¢æˆ·ç«¯.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å­˜å‚¨å¼•æ“ InnoDB</span></span><br><span class="line">0.å…ˆæ ¹æ®è¯­å¥çš„ <span class="built_in">where</span> æŸ¥è¯¢éœ€è¦æ“ä½œçš„åˆ—, è‹¥å•æ¡, å•ä¸ªæ‰§è¡Œ, å¤šæ¡(æœªçŸ¥, éå†æ‰§è¡Œä¸å¤ªå¯èƒ½...)</span><br><span class="line">1.ç”±äºäº‹åŠ¡æ˜¯è‡ªåŠ¨å¼€å¯çš„(é»˜è®¤è®¾ç½®), å› æ­¤å•æ¡è¯­å¥ä¹Ÿä¼šè‡ªåŠ¨è¢«äº‹åŠ¡åŒ…å›´.</span><br><span class="line">2.æ‰€ä»¥å…ˆå†™ undo <span class="built_in">log</span>(é»˜è®¤ç½®äºå…±äº«è¡¨ç©ºé—´), å†™è¿™ä¸ªæ˜¯ç”¨äºäº‹åŠ¡å›æ»šçš„.</span><br><span class="line">3.æ¥ç€å°†ä¿®æ”¹å†™å…¥åˆ° Buffer Pool(å³ä¿®æ”¹å†…å­˜ä¸­çš„å€¼).</span><br><span class="line">4.äºŒé˜¶æ®µæäº¤ç¬¬ä¸€é˜¶æ®µ, å†™ redo <span class="built_in">log</span>, æ­¤ä½œç”¨ä¸ºé˜²æ­¢å†™ binlog æ—¶å®•æœºé€ æˆæ•°æ®ä¸ä¸€è‡´(å‰ææ˜¯å¼€äº† binlog); è¿™é‡Œæ ‡è®° redo <span class="built_in">log</span> ä¸º prepare çŠ¶æ€.</span><br><span class="line">5.æ¥ç€å†™ binlog, è‹¥æœ‰ä»åº“é›†ç¾¤, åº”è¯¥è¿˜è¦ç­‰å¾…ä»åº“åŒæ­¥.</span><br><span class="line">6.äºŒé˜¶æ®µæäº¤ç¬¬äºŒé˜¶æ®µ, å†™å®Œ binlog å, å°† redo <span class="built_in">log</span> æ ‡è®°æˆ commit, ä»£è¡¨è¿™æ¬¡æäº¤å’Œ binlog ä¿æŒäº†ä¸€è‡´.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># PS äºŒé˜¶æ®µæäº¤ä¼šæ ‡è®° redo log ä¸º prepare çŠ¶æ€, è¿™æ ·å¦‚æœæ•°æ®åº“å®•æœº(åœ¨å†™ binlog æ—¶)å†é‡å¯, è¯»å–åˆ°è¿™ä¸ªæ ‡å¿—, å°±çŸ¥é“æäº¤ä¸æ˜¯å®Œæ•´çš„, äºæ˜¯å°±è¦é€šè¿‡åˆ¤æ–­ binlog çš„LSN åšä¸€äº›å¤„ç†äº†.(å•¥å¤„ç†æˆ‘ä¹Ÿä¸çŸ¥é“, å¯èƒ½æ˜¯ç…§å¸¸æäº¤, ä¹Ÿå¯èƒ½æ˜¯å›æ»š)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>PS: é€‰å–ç´¢å¼•åªèƒ½ç”¨ä¸€ä¸ªç´¢å¼•, é™¤äº† union å¥½åƒä¼šè§¦å‘åˆå¹¶ç´¢å¼•, ä½†åˆå¹¶åä¹Ÿç®—ä¸€ä¸ªç´¢å¼•.</p>
<p>å³ä½¿æ˜¯ update è¯­å¥ä¹Ÿä¼šä½¿ç”¨ä¼˜åŒ–å™¨å¯»æ‰¾æŸ¥è¯¢è®¡åˆ’, å› ä¸ºå½“å¸¦æ¡ä»¶æ—¶, éœ€è¦å…ˆé”å®šè®°å½•, å†è¿›è¡Œä¿®æ”¹.</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203163808.png" alt="image-20210203163806936"></p>
<h3 id="å‡ ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä½œç”¨"><a href="#å‡ ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä½œç”¨" class="headerlink" title="å‡ ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä½œç”¨"></a>å‡ ä¸ªæ ¸å¿ƒç»„ä»¶çš„ä½œç”¨</h3><ul>
<li>è¿æ¥å™¨: ç½‘ç»œç¼–ç¨‹å»ºç«‹ç«¯å£ç›‘å¬, æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„SQLè¯­å¥</li>
<li>åˆ†æå™¨: å¯¹SQLè¿›è¡Œè¯­æ³•ã€è¯æ³•ä¸Šçš„åˆ†æã€‚</li>
<li>ä¼˜åŒ–å™¨: ç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€é€‰æ‹©ç´¢å¼•ã€‚<ul>
<li>*<em>é€»è¾‘è½¬æ¢: *</em>åŒ…æ‹¬å¦å®šæ¶ˆé™¤ã€ç­‰å€¼ä¼ é€’å’Œå¸¸é‡ä¼ é€’ã€å¸¸é‡è¡¨è¾¾å¼æ±‚å€¼ã€å¤–è¿æ¥è½¬æ¢ä¸ºå†…è¿æ¥ã€å­æŸ¥è¯¢è½¬æ¢ã€è§†å›¾åˆå¹¶ç­‰ï¼›</li>
<li>*<em>ä¼˜åŒ–å‡†å¤‡: *</em>ä¾‹å¦‚ç´¢å¼• ref å’Œ range è®¿é—®æ–¹æ³•åˆ†æã€æŸ¥è¯¢æ¡ä»¶æ‰‡å‡ºå€¼ï¼ˆfan outï¼Œè¿‡æ»¤åçš„è®°å½•æ•°ï¼‰åˆ†æã€å¸¸é‡è¡¨æ£€æµ‹ï¼›</li>
<li>*<em>åŸºäºæˆæœ¬ä¼˜åŒ–: *</em>åŒ…æ‹¬è®¿é—®æ–¹æ³•å’Œè¿æ¥é¡ºåºçš„é€‰æ‹©ç­‰ï¼›</li>
<li>*<em>æ‰§è¡Œè®¡åˆ’æ”¹è¿›: *</em>ä¾‹å¦‚è¡¨æ¡ä»¶ä¸‹æ¨ã€è®¿é—®æ–¹æ³•è°ƒæ•´ã€æ’åºé¿å…ä»¥åŠç´¢å¼•æ¡ä»¶ä¸‹æ¨ã€‚</li>
</ul>
</li>
<li>æ‰§è¡Œå™¨: æ“ä½œæ‰§è¡Œå¼•æ“ï¼Œè·å–SQLçš„æ‰§è¡Œç»“æœ</li>
<li>å­˜å‚¨å¼•æ“(æ‰§è¡Œå¼•æ“): è´Ÿè´£å…·ä½“çš„è¯­å¥æ‰§è¡Œ, æŸ¥è¯¢ç­‰.</li>
</ul>
<blockquote>
<p>PS: åŸºæ•°(å€¼æŸåˆ—æ•°æ®å»é‡åå‰©ä½™ä¸ªæ•°, ä¼°ç®—å¾—åˆ°) ä¼šè¢«ç”¨äºåˆ†æç´¢å¼•çš„è¿‡æ»¤æ•ˆæœ.</p>
</blockquote>
<blockquote>
<p>ç„¶åæ˜¯å­˜å‚¨å¼•æ“é‡Œé¢çš„ä¸€äº›æ¦‚å¿µ</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å­˜å‚¨å¼•æ“ä¸­</span></span><br><span class="line">Buffer Pool: ç”¨äºç¼“å­˜è¡¨æ•°æ®çš„æ”¹åŠ¨, æœ‰è‡ªå·±çš„è½ç›˜æ—¶æœº.</span><br><span class="line"></span><br><span class="line">Redo <span class="built_in">log</span> Buffer: ç”¨äºç¼“å­˜ redo <span class="built_in">log</span>, æœ‰è‡ªå·±çš„è½ç›˜æ—¶æœº.</span><br><span class="line">	commit äº‹åŠ¡æ—¶è½ç›˜</span><br><span class="line">	å¯é…ç½® everysec æ¯ç§’è§¦å‘è½ç›˜</span><br><span class="line"></span><br><span class="line">Binlog Buffer: ç”¨äºç¼“å­˜ binlog, å³è®°å½•æ¯ä¸ªæ”¹åŠ¨, æœ‰è‡ªå·±çš„è½ç›˜æ—¶æœº.</span><br><span class="line">	commit äº‹åŠ¡æ—¶</span><br><span class="line">		</span><br><span class="line">undo <span class="built_in">log</span> æ–‡ä»¶: é»˜è®¤å­˜äºå…±äº«è¡¨ç©ºé—´ä¸­, ä¹Ÿå¯å•ç‹¬å­˜æ”¾äºä¸€ä¸ªè¡¨ç©ºé—´. ä¿å­˜ undo <span class="built_in">log</span>, æœ‰ç˜¦èº«æœºåˆ¶.</span><br><span class="line"></span><br><span class="line">redo <span class="built_in">log</span>: ç”¨äºä¿å­˜ Buffer Pool å‘é€çš„å˜åŠ¨. é˜²æ­¢ Buffer Pool çš„è„é¡µæœªåˆ·æ–°åˆ°ç£ç›˜å°±å®•æœºå¯¼è‡´æ•°æ®ä¸¢å¤±.</span><br><span class="line">binlog: è®°å½•é€»è¾‘è¡¨çš„æ”¹åŠ¨, å¯ç”¨äºé›†ç¾¤åŒæ­¥æ•°æ®, å®¡è®¡SQLæ¸—é€, å¤‡ä»½/æ¢å¤æ•°æ®åº“.</span><br><span class="line">undo <span class="built_in">log</span>: ç”¨äºä¿å­˜äº‹åŠ¡ä¸­çš„æ”¹åŠ¨, ä¾¿äºäº‹åŠ¡å¤±è´¥è§¦å‘å›æ»šæ—¶å›æ»šæ•°æ®.</span><br><span class="line"></span><br><span class="line">redo <span class="built_in">log</span> vs binlog</span><br><span class="line">ä¸€ä¸ª(redo <span class="built_in">log</span>)ä¿å­˜æ•°æ®é¡µå˜åŠ¨, è€Œæ•°æ®é¡µæ˜¯å®é™…çš„ç‰©ç†ç©ºé—´åŠ è½½åˆ°å†…å­˜ä¸­çš„ç¼“å­˜, æ‰€ä»¥è®°å½•çš„æ˜¯ç‰©ç†ä¸Šçš„æ”¹åŠ¨.</span><br><span class="line">ä¸€ä¸ª(binlog)ä¿å­˜é€»è¾‘ä¸Šçš„æ”¹åŠ¨, æ¯”å¦‚ xx è¡¨çš„ id=xxx çš„è¡Œçš„ xx åˆ—æ•°æ®ä¿®æ”¹ä¸ºäº† xx. æˆ–è€…å“ªå¼ è¡¨æ–°å¢äº†ä¸€è¡Œ, æ•°æ®æ˜¯ xxx...  æ‰€ä»¥è®°å½•çš„æ˜¯é€»è¾‘ä¸Šçš„æ”¹åŠ¨.</span><br><span class="line">ä¸¤è€…æœ€å¤§çš„åŒºåˆ«å°±æ˜¯ redo <span class="built_in">log</span> æ˜¯å¤§å°æ˜¯æœ‰é™çš„, åˆ°äº†ä¸€å®šçš„å¤§å°, ä¼šå°†æ— ç”¨çš„æ•°æ®åˆ æ‰, è€Œ binlog æ›´æ˜¯ä¸€ç§å¤‡ä»½, åªä¼šè¶Šæ¥è¶Šå¤§... è€Œä¸”æ²¡æ³•é€šè¿‡ç˜¦èº«ä¿æŒæŸä¸ªå¤§å°...</span><br></pre></td></tr></table></figure>



<h2 id="äº‹åŠ¡çš„å®ç°"><a href="#äº‹åŠ¡çš„å®ç°" class="headerlink" title="äº‹åŠ¡çš„å®ç°"></a>äº‹åŠ¡çš„å®ç°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># äº‹åŠ¡å›æ»š</span></span><br><span class="line">1.undo <span class="built_in">log</span>: åˆ† insert/update, update åˆåˆ† update/delete; ä½†æ— è®ºå•¥ç±»å‹, ç›®çš„éƒ½æ˜¯è¾…åŠ©äº‹åŠ¡å›æ»š, </span><br><span class="line">	å…¶ä¸­ insert æ¯”è¾ƒç®€å•, å½“å›æ»šæ—¶æ ¹æ®è®°å½•ä¸‹çš„ä¸»é”®(è”åˆä¸»é”®)é€šè¿‡ç´¢å¼•æ‰¾åˆ°å¯¹åº”è¡Œ, åˆ é™¤å³å¯.</span><br><span class="line">	å½“å›æ»šæ—¶ update æ˜¯æ ¹æ®è®°å½•çš„ä¸»é”®æ‰¾åˆ°è®°å½•å, å†æ ¹æ®è®°å½•ä¸‹çš„ä¿®æ”¹è¿‡çš„åˆ—æ•°æ®, åå‘ä¿®æ”¹å›å».</span><br><span class="line">	å½“å›æ»šæ—¶ delete æ˜¯æ ¹æ®è®°å½•çš„æ•´è¡Œæ•°æ®, ç„¶å insert å›å».</span><br><span class="line">2.ä½†ä¸€ä¸ªäº‹åŠ¡å¾€å¾€ä¸æ­¢ä¸€æ¡ SQL, å› æ­¤ä¹Ÿä¸æ­¢ä¸€ä¸ª undo <span class="built_in">log</span>, æ¯å¢åŠ ä¸€æ¡ SQL, undo <span class="built_in">log</span> ä¹Ÿéšä¹‹å¢åŠ , è¿™äº› undo <span class="built_in">log</span> ä¼šç»„æˆä¸€ä¸ªé“¾æ¡.</span><br><span class="line">2.è‹¥ä¸ºå•ä¸ªäº‹åŠ¡, å½“å›æ»šæ—¶, æƒ…å†µæ¯”è¾ƒç®€å•, å³åªéœ€ä»é“¾æ¡å°¾éƒ¨, åå‘éå†, å¾€å‰å›æ»šæ¯ä¸ª undo <span class="built_in">log</span> å°±è¡Œäº†.</span><br><span class="line">3.è‹¥ä¸ºå¤šä¸ªäº‹åŠ¡, ä¸å•ä¸ªäº‹åŠ¡ç±»ä¼¼, åªæ˜¯è¿˜éœ€è¦æ³¨æ„é“¾æ¡çš„ç»´æŠ¤(å³ç»´æŒé“¾æ¡çš„è¿é€šæ€§)</span><br><span class="line"></span><br><span class="line"><span class="comment"># éš”ç¦»çº§åˆ«</span></span><br><span class="line">1.åŸç†æ˜¯å¼€å¯äº‹åŠ¡ä¼šåˆ›å»ºä¸€ä¸ª ReadView, å…¶ä½œç”¨æ˜¯åˆ¤æ–­ undo <span class="built_in">log</span> é“¾æ¡ä¸­å“ªäº›æ•°æ®æ˜¯å¯è¯»çš„.</span><br><span class="line">2.å…ˆè¯´ ReadView, å…¶å­˜æœ‰å½“å‰äº‹åŠ¡ id, äº‹åŠ¡å¯åŠ¨æ—¶é‚£ä¼šæœªæäº¤çš„äº‹åŠ¡ id åˆ—è¡¨, æ‰€æœ‰æœªæäº¤äº‹åŠ¡ä¸­æœ€å°çš„äº‹åŠ¡, ä¸‹ä¸€ä¸ªäº‹åŠ¡id; è¿™é‡Œé¢æœªæäº¤çš„äº‹åŠ¡æ˜¯é‡ç‚¹.</span><br><span class="line">3.RR: å¯é‡å¤è¯», äº‹åŠ¡ä¸€å¼€å¯åˆ™åˆ›å»ºä¸€ä¸ª ReadView, ç›´åˆ°äº‹åŠ¡ç»“æŸ; æ¥ç€å€’ç€éå†é“¾æ¡, ç›´åˆ° undo <span class="built_in">log</span> æ˜¯æ¯”è‡ªå·±å°ä¸”ä¸åœ¨æœªæäº¤äº‹åŠ¡ä¸­çš„äº‹åŠ¡è®°å½•æ—¶åœä¸‹, ä»…è·å–æ­¤æ—¶çš„æ•°æ®, ç”±äºäº‹åŠ¡å¼€å¯è¿‡ç¨‹ä¸­, ReadView ä¸æ”¹å˜, å› æ­¤æ•´ä¸ªäº‹åŠ¡è¿‡ç¨‹ä¸­çš„è¯»å–æ€»æ˜¯ä¸€è‡´çš„.</span><br><span class="line">4.RC: è¯»å·²æäº¤, å’Œ RR ç•¥æœ‰ä¸åŒ, ä¸åŒä¹‹å¤„åœ¨äºå…¶æ¯æ¬¡ select éƒ½ä¼šé‡æ–°è·å– ReadView, è¿™ä½¿å¾—è‹¥æœ‰äº‹åŠ¡æäº¤å, å† select æ•°æ®, åˆ™ç”Ÿæˆçš„ ReadView æ•°æ®ä¼šå‘ç”Ÿå˜åŒ–(å³æœªæäº¤äº‹åŠ¡ id åˆ—è¡¨ä¸­å°‘äº†åˆšåˆšæäº¤çš„äº‹åŠ¡). å› æ­¤åŒæ ·çš„é€»è¾‘è¿›è¡Œåˆ¤æ–­, RC èƒ½è¯»å–åˆ°å·²æäº¤çš„äº‹åŠ¡çš„æ”¹åŠ¨.</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS: å±…ç„¶é—®æˆ‘ è¯»æœªæäº¤??  é‚£ä¸æ˜¯ä¸éœ€è¦ ReadView å°±èƒ½å®ç°å—...</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å›¾ä¸ºå›æ»šå¯¹åº”çš„ undo é“¾; ä»¥åŠéš”ç¦»çº§åˆ«åŸç†çš„ ReadView.</p>
</blockquote>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203155235.png" alt="image-20210203155232258"></p>
<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210203155257.png" alt="image-20210203155256012"></p>
<h2 id="MySQL-é€Ÿè®°"><a href="#MySQL-é€Ÿè®°" class="headerlink" title="MySQL é€Ÿè®°"></a>MySQL é€Ÿè®°</h2><h3 id="SQL-ä¼˜åŒ–"><a href="#SQL-ä¼˜åŒ–" class="headerlink" title="SQL ä¼˜åŒ–"></a>SQL ä¼˜åŒ–</h3><h4 id="ç´¢å¼•åŸç†"><a href="#ç´¢å¼•åŸç†" class="headerlink" title="ç´¢å¼•åŸç†"></a>ç´¢å¼•åŸç†</h4><blockquote>
<p>MySQL ç´¢å¼•ä¸€èˆ¬é€‰æ‹© B+æ ‘åšä¸ºæ•°æ®ç»“æ„å­˜å‚¨. B+ æ ‘çš„ä¼˜ç‚¹æ˜¯, å¯¹æ–‡ä»¶IOçš„è®¿é—®æ¬¡æ•°æ§åˆ¶åœ¨ 3 æ¬¡, ä¿è¯é€Ÿåº¦çš„åŒæ—¶, èƒ½å­˜å‚¨åƒä¸‡è¡Œæ•°æ®.</p>
</blockquote>
<h4 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.å¯¹å¸¸ç”¨åˆ—æ·»åŠ ç´¢å¼•, è§†å…·ä½“æƒ…å†µé€‰æ‹©å•ä¸€ç´¢å¼•æˆ–å¤åˆç´¢å¼•(ä¸€èˆ¬ä¸ºå¤åˆ)</span><br><span class="line">2.é€šè¿‡ Explain è¯­å¥åˆ†ææ‰§è¡Œè®¡åˆ’, å°† type æå‡åˆ°è‡³å°‘ index çº§åˆ«.</span><br><span class="line">3.é€šè¿‡ Explain è¯­å¥åˆ†ææ‰§è¡Œè®¡åˆ’, å°† extra ä¸­ Using filesortæ¶ˆé™¤(æ’åºåˆ—åŠ ç´¢å¼•), Using join bufferæ¶ˆé™¤ (é€šè¿‡ç»™å…³è”è¡¨çš„å…³è”åˆ—åŠ ç´¢å¼•), Using temporary (ä¸€èˆ¬é€šè¿‡åˆ†ç»„åˆ—åŠ ç´¢å¼•), Using where(æ ¹æ®æœ€å·¦åŸåˆ™å¯¹æ¡ä»¶åˆ—åŠ å¤åˆç´¢å¼•)</span><br></pre></td></tr></table></figure>



<h3 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ACID:</span><br><span class="line">A: åŸå­æ€§, å¤šä¸ªæ“ä½œè¦ä¹ˆéƒ½åš, è¦ä¹ˆéƒ½ä¸åš</span><br><span class="line">C: ä¸€è‡´æ€§, æ•°æ®åº“æ–‡ä»¶çš„çŠ¶æ€å¿…é¡»ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€.</span><br><span class="line">I: éš”ç¦»æ€§, äº‹ç‰©ä¹‹é—´ç›¸äº’éš”ç¦», äº’ä¸å½±å“.</span><br><span class="line">D: æŒç»­æ€§, ä¸€ä¸ªäº‹åŠ¡ä¸€ä½†æäº¤, åˆ™å¯¹æ•°æ®åº“çš„æ”¹å˜æ˜¯æ°¸ä¹…çš„.</span><br></pre></td></tr></table></figure>



<h4 id="éš”ç¦»çº§åˆ«"><a href="#éš”ç¦»çº§åˆ«" class="headerlink" title="éš”ç¦»çº§åˆ«"></a>éš”ç¦»çº§åˆ«</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.è¯»æœªæäº¤: å¯è¯»å–å…¶ä»–æœªæäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ(å¦‚æ›´æ–°äº†æŸä¸ªå­—æ®µ), å¯èƒ½ä¼šé€ æˆè¯»å–é”™è¯¯çš„æ•°æ®(æœªæäº¤çš„äº‹åŠ¡å›æ»šäº†), é€ æˆè„è¯».</span><br><span class="line">2.è¯»å·²æäº¤: å¯è¯»å–å…¶ä»–å·²æäº¤äº‹åŠ¡çš„æ‰§è¡Œç»“æœ, 2æ¬¡è¯»å–æ•°æ®è¿˜æ˜¯å¯èƒ½ä¸ä¸€è‡´(å…¶ä»–äº‹åŠ¡åˆæäº¤äº†), é€ æˆä¸å¯é‡å¤è¯».</span><br><span class="line">3.å¯é‡å¤è¯»: ç¡®ä¿åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–æ•°æ®æ—¶, ä¼šçœ‹åˆ°ç›¸åŒçš„æ•°æ®. ä½†å¯èƒ½é€ æˆå¹»è¯», å¦‚æ‰¹é‡ä¿®æ”¹ç™»å½•å¯†ç å, å¦ä¸€ä¸ªäº‹åŠ¡æ–°å¢äº†ä¸€æ¡è®°å½•, å¯¼è‡´æ–°çºªå½•æœªä¿®æ”¹.</span><br><span class="line">4.ä¸²è¡ŒåŒ–: äº‹åŠ¡ä¸²è¡ŒåŒ–æ‰§è¡Œ, æ•ˆç‡ä½.</span><br></pre></td></tr></table></figure>

<h4 id="MySQL-é»˜è®¤éš”ç¦»çº§åˆ«"><a href="#MySQL-é»˜è®¤éš”ç¦»çº§åˆ«" class="headerlink" title="MySQL é»˜è®¤éš”ç¦»çº§åˆ«"></a>MySQL é»˜è®¤éš”ç¦»çº§åˆ«</h4><p><code>å¯é‡è¯»è¯»</code></p>
<h3 id="æ•°æ®åº“é”"><a href="#æ•°æ®åº“é”" class="headerlink" title="æ•°æ®åº“é”"></a>æ•°æ®åº“é”</h3><h4 id="é”åŸç†"><a href="#é”åŸç†" class="headerlink" title="é”åŸç†"></a>é”åŸç†</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¡Œé”: åˆ†ä¸ºæ’å®ƒé”(X) å’Œå…±äº«é”(S). å³å†™é”å’Œè¯»é”.</span><br><span class="line">è¡¨é”: åˆ†ä¸ºå…ƒæ•°æ®é”(MDL)å’Œè¡¨é”.</span><br></pre></td></tr></table></figure>

<h4 id="é”è§¦å‘æ–¹å¼"><a href="#é”è§¦å‘æ–¹å¼" class="headerlink" title="é”è§¦å‘æ–¹å¼"></a>é”è§¦å‘æ–¹å¼</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¡Œé”: éšå¼(æ¡ä»¶å¸¦æœ‰ç´¢å¼•åˆ™é”å¯¹åº”åˆ—, ä¸å¸¦ç´¢å¼•åˆ™é”å…¨éƒ¨è¡Œ, RR æ€»ä¼šå¸¦æœ‰ GAP é”, RC ä¸ä¼š), æ˜¾å¼(ä½¿ç”¨ for update, lock in share mode)</span><br><span class="line">è¡¨é”: éšå¼(å¯¹æ•´ä¸ªè¡¨ä¸å¸¦æ¡ä»¶è¿›è¡Œå¢åˆ æ”¹, æˆ–ä»»ä½• DDL æ“ä½œ) æ˜¾ç¤º(ä½¿ç”¨ for update, lock in share mode)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/01/30/source-code-spring-cloud-gateway/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/30/source-code-spring-cloud-gateway/" class="post-title-link" itemprop="url">Spring Gateway æºç ç¬”è®°</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-30 17:07:38" itemprop="dateCreated datePublished" datetime="2021-01-30T17:07:38+08:00">2021-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:51:22" itemprop="dateModified" datetime="2021-03-28T19:51:22+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-code/" itemprop="url" rel="index"><span itemprop="name">source-code</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-cloud/" itemprop="url" rel="index"><span itemprop="name">spring-cloud</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/01/30/source-code-spring-cloud-gateway/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/30/source-code-spring-cloud-gateway/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring-Gateway-æºç ç¬”è®°"><a href="#Spring-Gateway-æºç ç¬”è®°" class="headerlink" title="Spring Gateway æºç ç¬”è®°"></a>Spring Gateway æºç ç¬”è®°</h1><h2 id="å…³é”®ç±»"><a href="#å…³é”®ç±»" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">1.DispatcherHandler</span><br><span class="line">	Spring Webflux çš„æ ¸å¿ƒç±», è´Ÿè´£åè°ƒ HandlerMapping å’Œ HandlerAdapter</span><br><span class="line"></span><br><span class="line">2.HandlerMapping</span><br><span class="line">	Spring Webflux çš„æ ¸å¿ƒç±», è´Ÿè´£æ ¹æ®è¯·æ±‚ä¿¡æ¯æŸ¥æ‰¾ handler</span><br><span class="line"></span><br><span class="line">3.HandlerAdapter</span><br><span class="line">	Spring Webflux çš„æ ¸å¿ƒç±», è´Ÿè´£æ‰§è¡Œ handler</span><br><span class="line">	</span><br><span class="line">4.RoutePredicateHandlerMapping</span><br><span class="line">	Spring Gateway å®ç°çš„ HandlerMapping, è´Ÿè´£æ ¹æ®è°“è¯æŸ¥æ‰¾ Route å¯¹è±¡å¹¶è¿”å› handler(FilteringWebHandler)</span><br><span class="line"></span><br><span class="line">5.FilteringWebHandler</span><br><span class="line">	æ˜¯ä¸€ä¸ª handler</span><br><span class="line">	ç”¨äºè·å– route å¯¹è±¡çš„ä¿¡æ¯(ä¸»è¦æ˜¯ GatewayFilter), ç„¶åå°è£…æ‰€æœ‰æ‹¦æˆªå™¨(åŒ…æ‹¬ GlobalFilter)åˆ° DefaultGatewayFilterChain, æŒ¨ä¸ªæ‰§è¡Œ, å€’å™å›å½’.</span><br><span class="line">	</span><br><span class="line">6.RoutePredicateFactory</span><br><span class="line">	è°“è¯å®ç°ç±»çš„å·¥å‚ç±»</span><br><span class="line">	è´Ÿè´£åˆ›å»ºå…·ä½“çš„è°“è¯å·¥å‚(å¦‚ Path, Method, Before ç­‰)</span><br><span class="line">	apply() è¿”å›ä¸€ä¸ª Predicate</span><br><span class="line">	</span><br><span class="line">7.Predicate</span><br><span class="line">	å®šä¹‰äº† <span class="built_in">test</span> æ–¹æ³•, è¿”å› Boolean å€¼, <span class="literal">true</span> ä»£è¡¨åŒ¹é…, <span class="literal">false</span> ä»£è¡¨ä¸åŒ¹é…(æŒ‡åŒ¹é… Route)</span><br><span class="line">	</span><br><span class="line">8.GlobalFilter/GatewayFilter</span><br><span class="line">	å®šä¹‰äº†ä¸€ä¸ªæ‹¦æˆªæ–¹æ³•, å¯æ‹¦æˆªè¯·æ±‚è¿›è¡Œç›¸åº”å¤„ç†</span><br><span class="line">	</span><br><span class="line">9.AsyncPredicate/AndAsyncPredicate</span><br><span class="line">	AsyncPredicate æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–¹æ³•(å•æ–¹æ³•æ¥å£), æ–¹æ³•è¢«è°ƒç”¨æ—¶ä¼šè°ƒç”¨ä¿å­˜çš„ Predicate ç±»å‹å­—æ®µçš„ <span class="built_in">test</span>() æ–¹æ³•.</span><br><span class="line">  AndAsyncPredicate æ˜¯ä¸€ä¸ªå·¦å³ç»“æ„çš„ AsyncPredicate, è¿›è¡Œåˆ¤æ–­æ—¶å…ˆåˆ¤æ–­å·¦è¾¹, å†åˆ¤æ–­å³è¾¹</span><br><span class="line">  è‹¥ä¸æ–­çš„ and, ä¼šå½¢æˆæ ‘ç»“æ„. æ‰€ä»¥æ‰§è¡Œæ—¶ç±»ä¼¼éå†äºŒå‰æ ‘.</span><br><span class="line"></span><br><span class="line">10.RouteDefinitionRouteLocator</span><br><span class="line">	è´Ÿè´£ä»ä¸åŒçš„ Locator(å¦‚é…ç½®æ–‡ä»¶) è·å– RouteDefinition, å¹¶è´Ÿè´£å°† RouteDefinition è½¬æˆ Route å¯¹è±¡</span><br><span class="line">	</span><br><span class="line">11.RouteDefinition</span><br><span class="line">	åŒ…å«æœ‰è·¯ç”±çš„æ‰€æœ‰é…ç½®ä¿¡æ¯, å«è°“è¯, æ‹¦æˆªå™¨, id, url ç­‰ç­‰, ä½†éƒ½æ˜¯å­—ç¬¦ä¸².</span><br><span class="line">	</span><br><span class="line">12.Route</span><br><span class="line">	å«æœ‰çš„é…ç½®ä¿¡æ˜¯è½¬åŒ–å¥½äº†çš„, å¦‚ Predicate å’Œ GatewayFilter.</span><br><span class="line">	</span><br><span class="line">13.NettyRoutingFilter</span><br><span class="line">	ä½¿ç”¨ netty å‘é€ http/wss ç­‰è¯·æ±‚.</span><br><span class="line"></span><br><span class="line">14.GatewayFilterFactory</span><br><span class="line">	æ‹¦æˆªå™¨å®ç°ç±»çš„å·¥å‚ç±»</span><br><span class="line">	è´Ÿè´£åˆ›å»ºå…·ä½“çš„ GatewayFilter å¯¹è±¡.</span><br><span class="line"></span><br><span class="line">15.AbstractConfigurable</span><br><span class="line">	è´Ÿè´£å¤„ç†è°“è¯çš„é…ç½®å’Œæ‹¦æˆªå™¨çš„é…ç½®è½¬åŒ–æˆä¸åŒçš„ Class é…ç½®.</span><br><span class="line">	å®é™…ä¸Šç”± shortcutFieldOrder å±æ€§é…åˆ Binder å®ç°.</span><br><span class="line">	å³æŒ‰ shortcutFieldOrder é…ç½®çš„å­—æ®µåˆ—è¡¨, æŒ‰é¡ºåºä» PropertySource ä¸­è¯»å–æ•°æ®è¿›è¡Œç»‘å®š; è€Œ PropertySource åˆ™æ˜¯ä» RouteDefinition çš„é…ç½®ä¿¡æ¯åŠ å…¥åˆ° Map åå†ç”¨ MapConfigurationPropertySource åŒ…è£… Map è€Œå¾—åˆ°çš„.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: é™¤äº†è°“è¯å·¥å‚å’Œæ‹¦æˆªå™¨å·¥å‚è¿™å—çš„å®ç°å¤æ‚, å…¶ä»–éƒ½ç®—æ¯”è¾ƒç®€å•, å“ªæ€•å“åº”å¼ç¼–ç¨‹çš„ä»£ç åˆ°å¤„éƒ½æ˜¯, ä¹Ÿè¿˜æ˜¯å¯ä»¥å¤§è‡´çš„ç†è§£ä»£ç çš„æ„æ€.</p>
<p>è¿™ä¸¤ä¸ªå·¥å‚å…¶å®åŸºæœ¬æ˜¯åŒä¸€å¥—é€»è¾‘, åŒä¸€å¥—ä»£ç , å°±æ˜¯æœ‰ä¸€ä¸ªæ¥å£åä¸åŒ, ç„¶åå…¶ä½œç”¨ä¹Ÿä¸åŒ, ä½†å¾ˆç›¸ä¼¼.</p>
</blockquote>
<h2 id="è°“è¯­çš„å®ç°åŸç†-å¦‚ä½•åˆ¤æ–­å“ªäº›è¯·æ±‚è¯¥èµ°å“ªä¸ªé“"><a href="#è°“è¯­çš„å®ç°åŸç†-å¦‚ä½•åˆ¤æ–­å“ªäº›è¯·æ±‚è¯¥èµ°å“ªä¸ªé“" class="headerlink" title="è°“è¯­çš„å®ç°åŸç†(å¦‚ä½•åˆ¤æ–­å“ªäº›è¯·æ±‚è¯¥èµ°å“ªä¸ªé“)?"></a>è°“è¯­çš„å®ç°åŸç†(å¦‚ä½•åˆ¤æ–­å“ªäº›è¯·æ±‚è¯¥èµ°å“ªä¸ªé“)?</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1.Spring gateway åŸºäº Spring webflux, å› æ­¤ä¼šæ‰§è¡Œ DispatcherHandler, è¿™æ˜¯ä¸€ä¸ª WebHandler, æ‰€ä»¥ä¼šè°ƒç”¨ DispatcherHandler.handle(), è¿™ä¸ªç±»é€šè¿‡ HandlerMapping æŸ¥æ‰¾å¯¹åº”çš„ handler æ¥æ‰§è¡Œ.</span><br><span class="line">2.åœ¨åˆå§‹åŒ–æ—¶ä¼šä»å®¹å™¨ä¸­æŸ¥æ‰¾ HandlerMapping ç±»å‹çš„ bean, ç”¨äºæŸ¥æ‰¾ handler; è€Œ gateway å®ç°äº†ä¸€ä¸ª RoutePredicateHandlerMapping(GatewayAutoConfiguration ä¸­æ³¨å†Œè¿›å»çš„); å› æ­¤è¿™é‡Œæ˜¯å…¥å£!!!</span><br><span class="line">3.å†çœ‹ RoutePredicateHandlerMapping çš„é€»è¾‘, å…¶é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±», å› æ­¤ä¼šåœ¨ getHandlerInternal() ä¸­è·å– handler. æ¥ç€å›é¡¾ä¸‹ Route å¯¹è±¡çš„è·å–.</span><br><span class="line">4.å…¶ä½¿ç”¨ RouteDefinitionRouteLocator å¯¹è±¡æ¥è°ƒç”¨ PropertiesRouteDefinitionLocator.getRouteDefinitions() è·å– RouteDefinition é›†åˆå¯¹è±¡(è¿™é‡Œè¿˜æœ‰å¥½å‡ ä¸ªä¸åŒçš„ Locator), ç„¶ååœ¨ RouteDefinitionRouteLocator.convertToRoute() ä¸­å°† RouteDefinition è½¬æˆ Route å¯¹è±¡, æ­¤æ—¶ä¼šè°ƒç”¨ RouteDefinitionRouteLocator.combinePredicates() å°† RouteDefinition ä¸­çš„ PredicateDefinition é›†åˆä¿¡æ¯è½¬æˆäº† AsyncPredicate å¯¹è±¡é›†åˆ. è¿™ä¸ª AsyncPredicate æ˜¯é€šè¿‡è§£æè°“è¯å­—ç¬¦ä¸², æ ¹æ®è°“è¯åç§°è·å–å·¥å‚ç±»(PredicateFactory)å†è°ƒç”¨ç›¸åº”å·¥å‚ç±»çš„æ–¹æ³•(apply æ–¹æ³•)ç”Ÿæˆå«ç›¸åº”é€»è¾‘åˆ¤æ–­çš„ GatewayPredicate ç±»(åˆ¤æ–­é€»è¾‘åœ¨ <span class="built_in">test</span> æ–¹æ³•ä¸­); é¡ºå¸¦ä¸€æè°“è¯é…ç½®ä¿¡æ¯æ˜¯ ä» apply çš„å‚æ•°ä¸­ä¼ é€’è¿‡æ¥çš„.</span><br><span class="line">5.Spring Gateway é»˜è®¤æ³¨å…¥äº†å¾ˆå¤šå·¥å‚(è§ GatewayAutoConfiguration), å¦‚ Host,Path,Method,Query,Cookie ç­‰ç­‰.</span><br><span class="line">6.è¿™æ · åœ¨ RoutePredicateHandlerMapping.lookupRoute() ä¸­çš„ r.getPredicate().apply(exchange) å°±ä¼šæ‰§è¡Œ Route ä¸­çš„è°“è¯åˆ¤æ–­, ä»…ä¿ç•™åŒ¹é…çš„ Route, ç„¶åå†å‰©ä¸‹çš„ Route ä¸­å–ç¬¬ä¸€ä¸ªè¿”å›. æœ€åå°† Route å¯¹è±¡å­˜åˆ° exchange ä¸­, ç„¶åè¿”å› FilteringWebHandler. </span><br><span class="line">7.è¿™æ˜¯ä¸€ä¸ª WebHandler, ä¼šç”±è‡ªå¸¦çš„é€‚é…å™¨ SimpleHandlerAdapter æ‰§è¡Œ, å³è°ƒç”¨å…¶ handle æ–¹æ³•.</span><br><span class="line">8.FilteringWebHandler ä» exchange ä¸­å–å‡º Route å¯¹è±¡, åœ¨å°† globalFilter å’Œ gatewayFilter æ”¾åˆ°é›†åˆä¸­(ç›¸å½“äºé“¾)å†é€’å½’è°ƒç”¨æ‰€æœ‰ Filter; å…¶ä¸­æœ‰å‡ ä¸ª Filter ä¼šæ‰§è¡Œè¯·æ±‚, å³å°†è¯·æ±‚åˆ†å‘åˆ°æŒ‡å®šåœ°å€. å¦‚ NettyRoutingFilter(è§ GatewayAutoConfiguration).</span><br><span class="line">9.åˆ°æ­¤ä»¥å°† Spring gateway æ¥æ”¶åˆ°çš„è¯·æ±‚æ ¹æ®è°“è¯­åŒ¹é…å¯¹åº”çš„ Route(è·¯ç”±) å†æ‰§è¡Œæ‰€æœ‰çš„ Filter åè¯·æ±‚ route é…ç½®çš„åœ°å€.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: ä» Spring webflux çš„å…¥å£, å…ˆ getHandler(), å¾—åˆ°çš„æ˜¯è¿”å›å€¼ FilteringWebHandler, è¿™ä¸ªè¿”å›å€¼ä¼šè¢« SimpleHandlerAdapter æ‰§è¡Œ, ä½†ä¸è°“è¯çš„é€»è¾‘æ— å…³; ä½† getHandler() è¿˜å°†é…ç½®æ–‡ä»¶(ä»¥åŠå…¶ä»–åœ°æ–¹)è·å–åˆ°çš„ RouteDefinition è½¬æˆ Route å¯¹è±¡, åŒæ—¶ä¹Ÿå°† RouteDefinition ä¸­çš„ PredicateDefinition è½¬æ¢æˆäº† Predicate, å†å°†å¤šä¸ª Predicate ç»„æˆæ ‘ç»“æ„å˜æˆä¸€ä¸ª AsyncPredicate; ç„¶åè°ƒç”¨ AsyncPredicate éå†æ‰§è¡Œæ¯ä¸ªè°“è¯åˆ¤æ–­. æœ‰ä¸€ä¸ªè¿”å› false, åˆ™æ•´ä¸ªç»“æœè¿”å› false (æŒ‡ and ç›¸è¿). å¦‚æ­¤ä¾¿å®Œæˆäº†æ ¹æ®è°“è¯åˆ¤æ–­æ˜¯å¦åŒ¹é… Route!!</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"></span><br><span class="line">A1(DispatcherHandler)</span><br><span class="line">A2(HandlerMapping#getHandler)</span><br><span class="line">A3(RoutePredicateHandlerMapping#getHandlerInternal)</span><br><span class="line">A4(RouteDefinitionRouteLocator#getRouteDefinitions)</span><br><span class="line">A5(RouteDefinition)</span><br><span class="line">A6(RouteDefinitionRouteLocator#convertToRoute)</span><br><span class="line">A7(Route)</span><br><span class="line">A8(RouteDefinitionRouteLocator#combinePredicates)</span><br><span class="line">A9(PredicateDefinition#è°“è¯é…ç½®ä¿¡æ¯)</span><br><span class="line">A0(AsyncPredicate#å¯æ‰§è¡Œçš„è°“è¯)</span><br><span class="line"></span><br><span class="line">B0(PredicateFactory#apply)</span><br><span class="line">B1(GatewayPredicate#test è°“è¯åˆ¤æ–­)</span><br><span class="line">B2(GlobalFilter å« NettyRoutingFilter)</span><br><span class="line">B3(FilteringWebHandler)</span><br><span class="line">B4(SimpleHandlerAdapter#é€‚é…å™¨)</span><br><span class="line">B5(DefaultGatewayFilterChain#æ‹¦æˆªå™¨é“¾)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A1--è°ƒç”¨--&gt;A2</span><br><span class="line">A2--è°ƒç”¨å­ç±»--&gt;A3</span><br><span class="line"></span><br><span class="line">A3--åè§¦å‘æ‰€æœ‰--&gt;A0</span><br><span class="line">A0--é€šè¿‡--&gt;B1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A4--ä»é…ç½®æ–‡ä»¶ç­‰åœ°æ–¹è·å¾—--&gt;A5</span><br><span class="line">A5--é€šè¿‡--&gt;A6</span><br><span class="line"></span><br><span class="line">A6--è¿˜è°ƒç”¨--&gt;A8</span><br><span class="line">A8--å°†--&gt;A9</span><br><span class="line">A9--é€šè¿‡è°ƒç”¨--&gt;B0</span><br><span class="line">B0--å¾—åˆ° Predicate å¯¹è±¡, å†ç”±å¤šä¸ªå¯¹è±¡ç»„åˆå¾—åˆ°--&gt;A0</span><br><span class="line"></span><br><span class="line">B1--è¿”å›åŒ¹é…çš„--&gt;A7</span><br><span class="line">A7--å°†å…¶å­˜åˆ° exchange å¯¹è±¡ä¸­, ç„¶åè¿”å›--&gt;B3</span><br><span class="line"></span><br><span class="line">B4--è´Ÿè´£æ‰§è¡Œ--&gt;B3</span><br><span class="line">B3--ä» exchange å¯¹è±¡è·å– Route åå†å°†--&gt;B2</span><br><span class="line">B2--æ‰“åŒ…å°è£…æˆä¸€ä¸ª--&gt;B5</span><br><span class="line"></span><br><span class="line">B5--æœ€ç»ˆä¼šæ‰§è¡Œ--&gt;G1(NettyRoutingFilter#å‘èµ·HTTPè¯·æ±‚)</span><br><span class="line"></span><br><span class="line">A1--è°ƒç”¨--&gt;B4</span><br></pre></td></tr></table></figure>





<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210131004943.png" alt="iShot2021-01-31 00.48.56"></p>
<h2 id="ä¸-LoadBalancer-å¯¹æ¥æ­¥éª¤"><a href="#ä¸-LoadBalancer-å¯¹æ¥æ­¥éª¤" class="headerlink" title="ä¸ LoadBalancer å¯¹æ¥æ­¥éª¤"></a>ä¸ LoadBalancer å¯¹æ¥æ­¥éª¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.ä¸Šé¢è®²åˆ°æ‰§è¡Œæ‰€æœ‰çš„ Filter, é‚£ä¹ˆé™¤äº†ç”¨æˆ·é…ç½®çš„ GatewayFilter, Gateway é…ç½®çš„å…¨å±€ Filter ä¹Ÿä¼šæ‰§è¡Œ(è§ GatewayAutoConfiguration); è€Œè´Ÿè´£å¤„ç† lb:// çš„ Filter æ˜¯ ReactiveLoadBalancerClientFilter (è§ GatewayReactiveLoadBalancerClientAutoConfiguration) </span><br><span class="line">2.å…·ä½“æ–¹æ³•ä¸º ReactiveLoadBalancerClientFilter.filter(), å…¶é€»è¾‘æ˜¯å–å‡º host, è°ƒç”¨ LoadBalancer çš„ choose() è·å– ServiceInstance, ç„¶åå°† url put å› exchange çš„ä¸Šä¸‹æ–‡ä¸­å­˜èµ·æ¥å³å¯.</span><br></pre></td></tr></table></figure>



<h2 id="æ‹¦æˆªå™¨çš„æ‰§è¡Œæ–¹å¼"><a href="#æ‹¦æˆªå™¨çš„æ‰§è¡Œæ–¹å¼" class="headerlink" title="æ‹¦æˆªå™¨çš„æ‰§è¡Œæ–¹å¼?"></a>æ‹¦æˆªå™¨çš„æ‰§è¡Œæ–¹å¼?</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ‹¦æˆªé“¾æ˜¯è‚¯å®šçš„, æ‰€æœ‰çš„ Filter éƒ½å¯ä»¥å…ˆæ‰§è¡Œè‡ªå·±é€»è¾‘, å†ä½¿ç”¨ chain è§¦å‘ä¸‹ä¸€ä¸ª Filter ç›´åˆ°æ— æ‹¦æˆªå™¨</span></span><br><span class="line"><span class="comment">// ç„¶åå¼€å§‹è¿”å›, å› ä¸ºæ˜¯é¡ºåºè¿›å…¥, æ‰€ä»¥æ˜¯å€’å™è¿”å›</span></span><br><span class="line"><span class="comment">// è¿”å›åæ­£å¸¸æ˜¯ä¸€è·¯ä¸æ–­å¾€å›è¿”å›, ä½†ä½ çš„ Filter ä¹Ÿå¯ä»¥åœ¨ è°ƒç”¨ chain çš„æ—¶å€™ä¸ç›´æ¥è¿”å›, è€Œæ˜¯å…ˆæš‚å­˜è¿”å›å€¼, å†é€šè¿‡ exchange å¯¹è±¡(æ­¤æ—¶æ‰§è¡Œäº†å…¶ä»– Filter åŒ…æ‹¬å®é™…è¯·æ±‚ä¹Ÿæ‰§è¡Œäº†, å› æ­¤ä¼šæœ‰å“åº”æ•°æ®)å–å‡ºå“åº”æ•°æ®(æˆ–è¿”å›å€¼), è¿›è¡Œä¿®æ”¹, å† return æš‚å­˜çš„å˜é‡.</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultGatewayFilterChain</span> <span class="keyword">implements</span> <span class="title">GatewayFilterChain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> index;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> List&lt;GatewayFilter&gt; filters;</span><br><span class="line"></span><br><span class="line">  DefaultGatewayFilterChain(List&lt;GatewayFilter&gt; filters) &#123;</span><br><span class="line">    <span class="keyword">this</span>.filters = filters;</span><br><span class="line">    <span class="keyword">this</span>.index = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="title">DefaultGatewayFilterChain</span><span class="params">(DefaultGatewayFilterChain parent, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.filters = parent.getFilters();</span><br><span class="line">    <span class="keyword">this</span>.index = index;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> List&lt;GatewayFilter&gt; <span class="title">getFilters</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> filters;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Mono&lt;Void&gt; <span class="title">filter</span><span class="params">(ServerWebExchange exchange)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Mono.defer(() -&gt; &#123;</span><br><span class="line">      <span class="comment">// è¿™é‡ŒæŒ¨ä¸ªå–å‡º, è™½ç„¶æ²¡æœ‰å¯¹ filters è¿›è¡Œ pop æ“ä½œå•¥çš„, ä½†æ˜¯ä¸‹ä¸€ä¸ªæ‰§è¡Œå®Œå, ä¼šè°ƒç”¨ chain.filter</span></span><br><span class="line">      <span class="comment">// ç­‰äºåœ¨é€’å½’è¿›å…¥è¿™ä¸ªæ–¹æ³•, è™½ç„¶æ˜¯ä¸åŒå¯¹è±¡çš„.. ä½†å› ä¸ºç»´æŠ¤äº† parent å’Œ index çš„å€¼</span></span><br><span class="line">      <span class="comment">// ä½¿å¾— this.index &lt; filters.size() è¿™ä¸ªé€’å½’ç»ˆæ­¢æ¡ä»¶å¾—ä»¥æ­£ç¡®æ‰§è¡Œ. å› æ­¤å’Œé€’å½’æ˜¯ç±»ä¼¼çš„.</span></span><br><span class="line">      <span class="comment">// ä¹Ÿå°±æ˜¯è¯´, æœ€åæ‰€æœ‰ filter æ‰§è¡Œå®Œå, ä¹Ÿä¼šä¸æ–­çš„å›å½’.</span></span><br><span class="line">      <span class="comment">// é‚£ä¹ˆ, æœ€åçš„ Filter å®Œæˆè¯·æ±‚(æ¯”å¦‚ http è¯·æ±‚), å¾—åˆ°çš„ response ä¼šå­˜åœ¨ exchange ä¸­</span></span><br><span class="line">      <span class="comment">// è¿™æ ·å›å½’è¿‡ç¨‹(ä¹Ÿå°±æ˜¯ chain.filter æ–¹æ³•ä¹‹åå¾—ä»£ç å°±å¯ä»¥å–å¾—æ•°æ®è¿›è¡Œå¹²é¢„)</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.index &lt; filters.size()) &#123;</span><br><span class="line">        GatewayFilter filter = filters.get(<span class="keyword">this</span>.index);</span><br><span class="line">        DefaultGatewayFilterChain chain = <span class="keyword">new</span> DefaultGatewayFilterChain(<span class="keyword">this</span>, <span class="keyword">this</span>.index + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> filter.filter(exchange, chain);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Mono.empty(); <span class="comment">// complete</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/01/30/source-code-spring-cloud-alibaba-sentinel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/30/source-code-spring-cloud-alibaba-sentinel/" class="post-title-link" itemprop="url">Spring Cloud Alibaba Sentinel æºç ç¬”è®°</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-30 15:19:26" itemprop="dateCreated datePublished" datetime="2021-01-30T15:19:26+08:00">2021-01-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:51:39" itemprop="dateModified" datetime="2021-03-28T19:51:39+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-cloud-alibaba/" itemprop="url" rel="index"><span itemprop="name">spring-cloud-alibaba</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-code/" itemprop="url" rel="index"><span itemprop="name">source-code</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/01/30/source-code-spring-cloud-alibaba-sentinel/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/30/source-code-spring-cloud-alibaba-sentinel/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Sentinel-ä¸-Openfeign-æ•´åˆ"><a href="#Sentinel-ä¸-Openfeign-æ•´åˆ" class="headerlink" title="Sentinel ä¸ Openfeign æ•´åˆ"></a>Sentinel ä¸ Openfeign æ•´åˆ</h2><h3 id="å…³é”®ç±»"><a href="#å…³é”®ç±»" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">1.SentinelFeignAutoConfiguration</span><br><span class="line">	æ³¨å…¥äº† Feign.Builder(å³ SentinelFeign.Builder) åˆ°å®¹å™¨ä¸­</span><br><span class="line"></span><br><span class="line">2.SentinelFeign.Builder</span><br><span class="line">	é‡å†™ build æ–¹æ³•æ³¨å…¥ sentinel çš„ InvocationHandler(SentinelInvocationHandler)</span><br><span class="line"></span><br><span class="line">3.SentinelInvocationHandler</span><br><span class="line">	æ‹¦æˆªæ–¹æ³•, åŒ…è£…æ–¹æ³•ä¸ºä¸€ä¸ªèµ„æº, è¿›è¡Œæµæ§é™çº§ç­‰å¤„ç†</span><br><span class="line">	</span><br><span class="line">4.SentinelAutoConfiguration</span><br><span class="line">	æ³¨å…¥äº† SentinelResourceAspect æ¥æ”¯æŒ @SentinelResource æ³¨è§£</span><br><span class="line">	æ³¨å…¥äº† SentinelBeanPostProcessor æ¥å¤„ç† @SentinelRestTemplate</span><br><span class="line">	æ³¨å…¥äº† SentinelDataSourceHandler æ¥åŠ è½½å„ç§æ•°æ®æºä¸ºè§„åˆ™é…ç½®</span><br><span class="line"></span><br><span class="line">5.SentinelResourceAspect</span><br><span class="line">	å¯¹åŠ äº† @SentinelResource çš„æ–¹æ³•æ·»åŠ  @Around é€šçŸ¥, åŒ…å›´åŸæ–¹æ³•å·²å®ç°æµæ§é™çº§ç­‰å¤„ç†.</span><br><span class="line">	</span><br><span class="line">6.SentinelBeanPostProcessor</span><br><span class="line">	å¯¹åŠ äº† @SentinelRestTemplate æ³¨è§£çš„ RestTemplate bean, æ·»åŠ ä¸€ä¸ª SentinelProtectInterceptor</span><br><span class="line"></span><br><span class="line">7.SentinelDataSourceHandler</span><br><span class="line">	è§£æ spring.cloud.sentinel.datasource çš„é…ç½®, åŠ è½½é…ç½®çš„è§„åˆ™åˆ° Sentinel ä¸­.</span><br><span class="line">	</span><br><span class="line">8.SentinelProtectInterceptor</span><br><span class="line">	åŒ…è£… RestTemplate çš„è¯·æ±‚, ä½¿å…¶å¯è¢«æµæ§é™çº§ç­‰æ“ä½œ.</span><br></pre></td></tr></table></figure>





<h3 id="æ•´åˆæ­¥éª¤"><a href="#æ•´åˆæ­¥éª¤" class="headerlink" title="æ•´åˆæ­¥éª¤"></a>æ•´åˆæ­¥éª¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.Feign é‚£è¾¹çš„æ­¥éª¤æ˜¯, å…ˆä»å®¹å™¨ä¸­è·å– Feign.Builder å¯¹è±¡, å¹¶ä¸” FeignContext ä¹Ÿä¼šæ³¨å…¥ä¸€ä¸ªé»˜è®¤çš„ Builder å¯¹è±¡, ä½†æ˜¯æ¯•ç«Ÿæ˜¯å­å®¹å™¨, ä¼˜å…ˆçº§æ²¡æœ‰çˆ¶å®¹å™¨é«˜(åŠ è½½é…ç½®æ›´å, æ‰€ä»¥ @ConditionalOnMissingBean è§¦å‘, å­å®¹å™¨å°±ä¸æ³¨å†Œäº†). å› æ­¤æˆ‘ä»¬åœ¨çˆ¶å®¹å™¨ä¸­ä¸­é…ç½®ä¸€ä¸ª Builder å°±èƒ½è¿›è¡Œå¯¹æ¥.</span><br><span class="line">2.Feign çš„å®ç°æ˜¯é€šè¿‡ JDK ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡æ‹¦æˆªæ–¹æ³•æ¥æ„é€ å¹¶æ‰§è¡Œ HTTP è¯·æ±‚, å› æ­¤å…¶éœ€è¦ä¸€ä¸ª InvocationHandler æ¥æ‹¦æˆªé…ç½®; åœ¨ Feign ä¸­, é€šè¿‡å­—æ®µ invocationHandlerFactory æ¥åˆ›å»ºè¿™ä¸ª InvocationHandler, æ‰€ä»¥æˆ‘ä»¬æ³¨å…¥è‡ªå·±å®ç°çš„ Builder éœ€è¦è®¾ç½®è¿™ä¸ªå­—æ®µ.</span><br><span class="line">3.å³ SentinelFeign.Builder.build() ä¸­è°ƒç”¨ super.invocationHandlerFactory(xxx) æ¥è®¾ç½®.</span><br><span class="line">4.xxx æ˜¯åŒ¿åå†…éƒ¨ç±», ç›´æ¥çœ‹ create æ–¹æ³•, è¿™é‡Œæ ¹æ® @FeignClient æ³¨è§£çš„é…ç½®(fallback/fallbackFactory) åˆ›å»ºäº†ä¸€ä¸ª SentinelInvocationHandler</span><br><span class="line">5.SentinelInvocationHandler.invoke() çš„é€»è¾‘æ˜¯ä½¿ç”¨ SphU.entry() åŒ…å›´ feign ç”Ÿæˆçš„ method(è¿™ä¸ª method æ˜¯å¹²æ­£äº‹çš„: æ‰§è¡Œè´Ÿè½½å‡è¡¡å’Œå‘é€ Http è¯·æ±‚), è¿™å°±å¯¹è¿™ä¸ª method è¿›è¡Œæµé‡æ§åˆ¶äº†; ç„¶åè¿˜åœ¨ catch ä¸­å¤„ç† fallback.</span><br><span class="line">6.è‡³æ­¤, ä¸ feign çš„å¯¹æ¥å°±å®Œæˆäº†</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: æ–°å»ºä¸€ä¸ª Builder ä»¤ç”Ÿæˆçš„ Feign å¯¹è±¡æŒæœ‰æˆ‘ä»¬æŒ‡å®šçš„ invocationHandlerFactory, ä½¿å…¶åˆ›å»ºä»£ç†å¯¹è±¡æ—¶ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„ SentinelInvocationHandler æ‹¦æˆªå¯¹è±¡æ–¹æ³•; è¿™æ ·å°±æŠŠæ–¹æ³•çš„æ‰§è¡ŒåŒ…å›´èµ·æ¥, è¿›è¡Œæµé‡æ§åˆ¶å’Œç†”æ–­é™çº§(catch å¼‚å¸¸è°ƒç”¨ fallback)äº†.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"></span><br><span class="line">A1(FeignClientsRegistrar)</span><br><span class="line">A2(FeignClientFactoryBean)</span><br><span class="line">A3(çœŸå® XxxService æ¥å£)</span><br><span class="line">A4(SentinelInvocationHandler)</span><br><span class="line">A5(SentinelFeignAutoConfiguration)</span><br><span class="line">A6(Feign.Builder å³ SentinelFeign.Builder)</span><br><span class="line">A7(Feign å¯¹è±¡)</span><br><span class="line">A8(ä»£ç†å¯¹è±¡)</span><br><span class="line">A9( sentinel å°†æ–¹æ³•å½“åšèµ„æºè¿›è¡Œæ‹¦æˆª)</span><br><span class="line">B1(åœ¨ catch ä¸­å¤„ç† fallback ç†”æ–­é€»è¾‘)</span><br><span class="line"></span><br><span class="line">A1--æ‰«æ FeignClient æ³¨è§£, æ³¨å…¥--&gt;A2</span><br><span class="line"></span><br><span class="line">A3--è¢« controller è°ƒç”¨, è§¦å‘--&gt;A4</span><br><span class="line"></span><br><span class="line">A5--æ³¨å…¥äº†ä¸€ä¸ª--&gt;A6</span><br><span class="line">A2--è°ƒç”¨--&gt;A6</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A6--çš„ build æ–¹æ³•åˆ›å»ºä¸€ä¸ª--&gt;A7</span><br><span class="line">A7--è°ƒç”¨ newInstance æ–¹æ³•åˆ›å»ºäº†å«--&gt;A4</span><br><span class="line">A8--ç”¨æ¥ä»£æ›¿--&gt;A3</span><br><span class="line">A4--çš„--&gt;A8</span><br><span class="line"></span><br><span class="line">A4--è°ƒç”¨--&gt;A9</span><br><span class="line">A9--ç„¶å--&gt;B1</span><br></pre></td></tr></table></figure>





<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210130163421.png" alt="image-20210130163418057"></p>
<h3 id="æ•´åˆ-FeignCircuitBreaker-Builder-æ­¥éª¤"><a href="#æ•´åˆ-FeignCircuitBreaker-Builder-æ­¥éª¤" class="headerlink" title="æ•´åˆ FeignCircuitBreaker.Builder æ­¥éª¤"></a>æ•´åˆ FeignCircuitBreaker.Builder æ­¥éª¤</h3><blockquote>
<p>å³ä¸æ³¨å…¥è‡ªå·±çš„ Builder, ä½¿ç”¨ openfeign æä¾›çš„ Builder, é€šè¿‡æ‰©å±• CircuitBreakerFactory(å³æ‰©å±• CircuitBreaker) æ¥å®ç°æµæ§é™çº§(å€’æ˜¯ fallback çš„å¤„ç†ä¾¿è½»æ¾äº†ä¸å°‘)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.åœ¨ SentinelCircuitBreakerAutoConfiguration æ³¨å…¥ä¸€ä¸ª CircuitBreakerFactory.</span><br><span class="line">2.åœ¨ Openfeign ä¸­, ä¼šè°ƒç”¨å…¶ create() åˆ›å»ºå¾—åˆ°ä¸€ä¸ª CircuitBreaker (å³ SentinelCircuitBreaker)</span><br><span class="line">3.æ¥ç€ä¼šåœ¨ FeignCircuitBreakerInvocationHandler.invoke() ä¸­è·å–è¿™ä¸ª CircuitBreaker, è°ƒç”¨å…¶ run() å°†è¦æ‰§è¡Œçš„ method äº¤ç»™ SentinelCircuitBreaker æ¥å¤„ç†.</span><br><span class="line">4.SentinelCircuitBreaker ä¸­ run() çš„å®ç°å°±æ˜¯ç®€å•çš„ SphU.entry() æ¥åŒ…è£…æ–¹æ³•ä¸ºèµ„æºè¿›è¡Œæµæ§é™çº§, è‡³äº fallback åˆ™ç›´æ¥è°ƒç”¨ apply äº¤ç”± Openfeign å¤„ç†.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: ä¸å†™è‡ªå·±çš„ Builder, ç®€å•å¤šäº†! ä¸»è¦æ˜¯å»æ‰äº† fallback ç›¸å…³é…ç½®çš„è·å–ä¸å¤„ç†.</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://gudqs7.github.io/2021/01/29/source-code-spring-cloud-server-discover-and-register/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="gudqs7">
      <meta itemprop="description" content="å¿ƒç´¯æ²¡é’±èººå°¸ä¸­">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="gudqs7's note">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/29/source-code-spring-cloud-server-discover-and-register/" class="post-title-link" itemprop="url">Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æºç ç¬”è®° (Nacos/Consul/Eureka)</a>
        </h2>

        <div class="post-meta">
			
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>

              <time title="åˆ›å»ºæ—¶é—´ï¼š2021-01-29 13:21:23" itemprop="dateCreated datePublished" datetime="2021-01-29T13:21:23+08:00">2021-01-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">æ›´æ–°äº</span>
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-28 19:49:43" itemprop="dateModified" datetime="2021-03-28T19:49:43+08:00">2021-03-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">åˆ†ç±»äº</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/source-code/" itemprop="url" rel="index"><span itemprop="name">source-code</span></a>
                </span>
                  ï¼Œ
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/spring-cloud/" itemprop="url" rel="index"><span itemprop="name">spring-cloud</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqusï¼š</span>
    
    <a title="disqus" href="/2021/01/29/source-code-spring-cloud-server-discover-and-register/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/29/source-code-spring-cloud-server-discover-and-register/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Spring-Cloud-æœåŠ¡æ³¨å†Œä¸å‘ç°æºç ç¬”è®°-Nacos-Consul-Eureka"><a href="#Spring-Cloud-æœåŠ¡æ³¨å†Œä¸å‘ç°æºç ç¬”è®°-Nacos-Consul-Eureka" class="headerlink" title="Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æºç ç¬”è®° (Nacos/Consul/Eureka)"></a>Spring Cloud æœåŠ¡æ³¨å†Œä¸å‘ç°æºç ç¬”è®° (Nacos/Consul/Eureka)</h1><h2 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h2><h3 id="å…³é”®ç±»"><a href="#å…³é”®ç±»" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡æ³¨å†Œ</span></span><br><span class="line">1.EurekaClientAutoConfiguration</span><br><span class="line">	æ³¨å†Œäº†ä¼—å¤šçš„ bean</span><br><span class="line">	ä¸€éƒ¨åˆ†ç”¨äºå’Œ Eureka Server äº¤äº’</span><br><span class="line">	ä¸€éƒ¨åˆ†å’Œ Commons é¡¹ç›®å¯¹æ¥</span><br><span class="line">	æ³¨å†Œäº†(EurekaClient/EurekaAutoServiceRegistration/ApplicationInfoManager/EurekaRegistration)</span><br><span class="line">	   </span><br><span class="line">2.EurekaClient</span><br><span class="line">	ä¸ Eureka Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Eureka Server ç«¯æ³¨å†Œ/æ³¨é”€æœåŠ¡å®ä¾‹</span><br><span class="line">	åœ¨æ„é€ æ–¹æ³•å’Œ shutdown æ–¹æ³•ä¸­æ ¹æ®é…ç½®å¤„ç†è‡ªåŠ¨æ³¨å†Œå’Œè‡ªåŠ¨æ³¨é”€.</span><br><span class="line"></span><br><span class="line">3.InstanceInfoReplicator</span><br><span class="line">	è´Ÿè´£å®šä¹‰ä¸€ä¸ªæ³¨å†Œæˆ–æ›´æ–°æœåŠ¡å®ä¾‹çš„ä»»åŠ¡</span><br><span class="line">	è´Ÿè´£ç®¡ç†ä»»åŠ¡æ‰§è¡Œå™¨</span><br><span class="line"></span><br><span class="line">4.RestTemplateEurekaHttpClient</span><br><span class="line">	è´Ÿè´£æ ¹æ®æœåŠ¡å®ä¾‹ä¿¡æ¯æ„é€ æ³¨å†Œ/æ³¨é”€çš„ Http è¯·æ±‚</span><br><span class="line">	ä½¿ç”¨ RestTemplate å‘é€è¯·æ±‚</span><br><span class="line">	</span><br><span class="line">5.EurekaAutoServiceRegistration</span><br><span class="line">	è´Ÿè´£ç®¡ç†æœåŠ¡å®ä¾‹çš„è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€, ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸæŒ‚é’©</span><br><span class="line"></span><br><span class="line">6.ApplicationInfoManager</span><br><span class="line">	è´Ÿè´£ç®¡ç†æœåŠ¡å®ä¾‹çŠ¶æ€å˜æ›´äº‹ä»¶(å³ç®¡ç†ç›‘å¬è€…å¹¶åœ¨é€‚å½“æ—¶æœºè§¦å‘ä»–ä»¬)</span><br><span class="line"></span><br><span class="line">7.ApplicationInfoManager.StatusChangeListener</span><br><span class="line">	çŠ¶æ€æ”¹å˜äº‹ä»¶ç›‘å¬è€…ç±»</span><br><span class="line">	</span><br><span class="line">8.EurekaHealthCheckHandler</span><br><span class="line">	æœåŠ¡å®ä¾‹çŠ¶æ€å¥åº·æ£€æŸ¥ç±», æ³¨å†Œ/æ³¨é”€æœåŠ¡å®ä¾‹å‰ä¼šè°ƒç”¨æ­¤ç±»è¿›è¡Œæ£€æŸ¥å…¶çŠ¶æ€</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å‘ç°</span></span><br><span class="line">1.BlockingLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	è´Ÿè´£è°ƒç”¨å®é™…çš„è´Ÿè½½å‡è¡¡å™¨å»é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span><br><span class="line">	è´Ÿè´£è°ƒåº¦è´Ÿè½½å‡è¡¡æ•´ä¸ªè¿‡ç¨‹, è§¦å‘ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸ.</span><br><span class="line">	</span><br><span class="line">2.RoundRobinLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	å®é™…çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ç®—æ³•ç±»</span><br><span class="line">	è´Ÿè´£è¿æ¥ ServiceInstanceListSupplier ä»å…¶ä¸­è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">3.ServiceInstanceListSupplier</span><br><span class="line">	å®šä¹‰äº†è·å–æœåŠ¡å®ä¾‹å®ä¾‹åˆ—è¡¨çš„æ¥å£(ä»»æ„æ–¹å¼)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClient</span><br><span class="line">	å®šä¹‰äº†ä»æœåŠ¡ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨çš„æ¥å£(æ›´æ˜ç¡®äº†)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClientServiceInstanceListSupplier</span><br><span class="line">	ServiceInstanceListSupplier çš„å®ç°ç±»</span><br><span class="line">	è¿æ¥ ReactiveDiscoveryClient ç±», å°†æœåŠ¡ç«¯è·å–é“å¾·æœåŠ¡å®ä¾‹åˆ—è¡¨è¿”å›å‡ºå»</span><br><span class="line">	</span><br><span class="line">5.EurekaDiscoveryClient</span><br><span class="line">	å®ç°äº† DiscoveryClient æ¥å£</span><br><span class="line">	è´Ÿè´£è°ƒç”¨ EurekaClient ä» Eureka Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨.</span><br><span class="line"></span><br><span class="line">6.EurekaClient</span><br><span class="line">	ä¸ Eureka Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Eureka Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line">	åœ¨æ„é€ æ–¹æ³•å’Œ shutdown æ–¹æ³•ä¸­æ ¹æ®é…ç½®å¤„ç†è‡ªåŠ¨æ³¨å†Œå’Œè‡ªåŠ¨æ³¨é”€.</span><br><span class="line"></span><br><span class="line">7.EurekaServiceInstance</span><br><span class="line">	æœåŠ¡å®ä¾‹ä¿¡æ¯å¯¹è±¡</span><br><span class="line">	å®ç° ServiceInstance, ä¸ Commons å¯¹æ¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»ç»“</span></span><br><span class="line">å®ç°äº† Commons çš„ DiscoveryClient æ¥å£(å³ EurekaDiscoveryClient), äºæ˜¯æœåŠ¡å‘ç°å®ç°äº†;</span><br><span class="line">å®ç°äº† Commons çš„ ServiceRegisty æ¥å£(å³ EurekaServiceRegistry), äºæ˜¯æœåŠ¡æ³¨å†Œä¹Ÿå®ç°äº†.</span><br><span class="line">å†æ€»ç»“: Commons å¤§å‘å¥½.</span><br></pre></td></tr></table></figure>





<h3 id="æœåŠ¡æ³¨å†Œæµç¨‹"><a href="#æœåŠ¡æ³¨å†Œæµç¨‹" class="headerlink" title="æœåŠ¡æ³¨å†Œæµç¨‹"></a>æœåŠ¡æ³¨å†Œæµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># EurekaClient æ„é€ æ–¹æ³•è§¦å‘(å‰æ shouldRegisterWithEureka ä¸º true)</span></span><br><span class="line">1.EurekaClientAutoConfiguration è®©å®¹å™¨é‡Œæ³¨å†Œäº†ä¸€ä¸ª EurekaClient</span><br><span class="line">2.EurekaClient è¿™ä¸ªç±»åœ¨æ„é€ æ–¹æ³•ä¸­çš„ initScheduledTasks() ç”Ÿæˆäº†ä¸€ä¸ª InstanceInfoReplicator å¯¹è±¡</span><br><span class="line">3.ç„¶åè°ƒç”¨å…¶ instanceInfoReplicator.start(), é€»è¾‘æ˜¯æ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡(ä»…æ‰§è¡Œä¸€æ¬¡), å®šæ—¶ä»»åŠ¡æ‰§è¡Œ run()</span><br><span class="line">4.run() é‡Œé¢ä¼šæ‰§è¡Œ discoveryClient.register() ä¹Ÿå°±æ˜¯æ³¨å†Œå®ä¾‹ä¿¡æ¯åˆ° Eureka ä¸Šå».</span><br><span class="line">5.register() é‡Œé¢ä¼šè°ƒç”¨ RestTemplateEurekaHttpClient<span class="comment">#register() </span></span><br><span class="line">6.è¿™ä¸ªæ–¹æ³•æ˜¯æ„é€ ä¸€ä¸ª HTTP è¯·æ±‚, åœ°å€ä¸º serviceUrl + <span class="string">"apps/"</span> + info.getAppName(), Method ä¸º POST, å³ Eureka server çš„ip/apps/æœåŠ¡å®ä¾‹åç§°(å¦‚spring.application.name), å½“ç„¶è¯·æ±‚ body è¿˜ä¼šå¸¦ä¸Šå®ä¾‹ä¿¡æ¯ info å¯¹è±¡.</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ ¹æ®å®¹å™¨ç”Ÿå‘½å‘¨æœŸè§¦å‘</span></span><br><span class="line">1.EurekaClientAutoConfiguration è®©å®¹å™¨é‡Œæ³¨å†Œäº†ä¸€ä¸ª EurekaAutoServiceRegistration.</span><br><span class="line">2.è¿™ä¸ªç±»å³æ˜¯ SmartLifecycle(ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸç»‘å®š), ä¹Ÿæ˜¯ SmartApplicationListener(ç›‘å¬å®¹å™¨åŠ è½½/å…³é—­äº‹ä»¶)</span><br><span class="line">3.å› æ­¤å…¶å¯¹åº”çš„ start()/stop() å’Œ onApplicationEvent() éƒ½å®ç°äº†å¯¹åº”çš„é€»è¾‘.</span><br><span class="line">4.å¦‚ start() çš„é€»è¾‘ä¸ºè°ƒç”¨ EurekaServiceRegistry<span class="comment">#register()</span></span><br><span class="line">5.register() å…ˆä¿®æ”¹æœ¬åœ°æœåŠ¡å®ä¾‹çš„è£…å¡«, å†é€šè¿‡ com.netflix.discovery.DiscoveryClient<span class="comment">#registerHealthCheck() æ¥å¾€ä»»åŠ¡ç®¡ç†å™¨ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡, åå°æ‰§è¡Œ, ä»»åŠ¡ InstanceInfoReplicator#onDemandUpdate()</span></span><br><span class="line">6.æ­¤ä»»åŠ¡å°±æ˜¯æœ€ç»ˆä¹Ÿä¼šè°ƒç”¨å‰é¢æåˆ°çš„ (4) ä¸­çš„ run(). ç„¶åå°±æ³¨å†Œä¸Šå»äº†.</span><br><span class="line"></span><br><span class="line"><span class="comment"># PS</span></span><br><span class="line">(6) ä¸­çš„ä»»åŠ¡, ä¸çŠ¶æ€ç›‘å¬æ˜¯ä¸€è‡´çš„</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: å®¹å™¨æ³¨å†Œ EurekaClient, è°ƒç”¨æ„é€ æ–¹æ³•å®Œæˆå¤§é‡åˆå§‹åŒ–å·¥ä½œå, å¦èµ·ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ restTemplate å‘é€ HTTP è¯·æ±‚å°†å½“å‰æœåŠ¡å®ä¾‹ä¿¡æ¯å‘é€ç»™ Eureka server. å®ŒæˆæœåŠ¡æ³¨å†Œå·¥ä½œ.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"></span><br><span class="line">A(EurekaClientAutoConfiguration)</span><br><span class="line">A1(EurekaClient)</span><br><span class="line">A2(InstanceInfoReplicator)</span><br><span class="line">A3(EurekaClient#register)</span><br><span class="line">A4(RestTemplateEurekaHttpClient)</span><br><span class="line">A5(RestTemplate)</span><br><span class="line">A6(Eureka Server)</span><br><span class="line">A7(EurekaHttpResponse)</span><br><span class="line"></span><br><span class="line">A--è®©å®¹å™¨é‡Œæ³¨å†Œä¸€ä¸ª--&gt;A1</span><br><span class="line">A1--åœ¨æ„é€ æ–¹æ³•ä¸­ç”Ÿæˆä¸€ä¸ª--&gt;A2</span><br><span class="line">A2--åœ¨ run æ–¹æ³•ä¸­è°ƒç”¨--&gt;A3</span><br><span class="line">A3--åˆæŠŠæœåŠ¡å®ä¾‹ä¿¡æ¯äº¤ç»™--&gt;A4</span><br><span class="line">A4--æ ¹æ®æœåŠ¡å®ä¾‹ä¿¡æ¯æ„é€ HTTPè¯·æ±‚--&gt;A5</span><br><span class="line">A5--å°†æœåŠ¡å®ä¾‹ä¿¡æ¯å‘é€ç»™--&gt;A6</span><br><span class="line">A6--è¿”å›ä¸€ä¸ª--&gt;A7</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210129172741.png" alt="image-20210129171345329"></p>
<h3 id="æœåŠ¡æ³¨é”€æµç¨‹"><a href="#æœåŠ¡æ³¨é”€æµç¨‹" class="headerlink" title="æœåŠ¡æ³¨é”€æµç¨‹"></a>æœåŠ¡æ³¨é”€æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®¹å™¨å…³é—­(é…ç½®äº†å®¹å™¨ shouldUnregisterOnShutdown=true)</span></span><br><span class="line">1.åœ¨ DiscoveryClient<span class="comment">#shutdown() ä¸­æ ¹æ® shouldUnregisterOnShutdown åˆ¤æ–­æ˜¯å¦éœ€è¦æ³¨é”€</span></span><br><span class="line">2.ç„¶ååœ¨ unregister() ä¸­è°ƒç”¨ RestTemplateEurekaHttpClient<span class="comment">#cancel() </span></span><br><span class="line">3.cancel() ä¸­ä½¿ç”¨ restTemplate æ„é€  Method ä¸º DELETE, URL ä¸º serviceUrl + <span class="string">"apps/"</span> + appName + <span class="string">'/'</span> + id çš„è¯·æ±‚å¹¶å‘é€ç»™ Eureka server å‘ŠçŸ¥å…¶æ³¨é”€ appName ä¸‹å¯¹åº”çš„æœåŠ¡å®ä¾‹(æ ¹æ® id).</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥æ”¶åˆ°å®¹å™¨å…³é—­äº‹ä»¶</span></span><br><span class="line">1.EurekaClientAutoConfiguration è®©å®¹å™¨é‡Œæ³¨å†Œäº†ä¸€ä¸ª EurekaAutoServiceRegistration.</span><br><span class="line">2.è¿™ä¸ªç±»å³æ˜¯ SmartLifecycle(ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸç»‘å®š), ä¹Ÿæ˜¯ SmartApplicationListener(ç›‘å¬å®¹å™¨åŠ è½½/å…³é—­äº‹ä»¶)</span><br><span class="line">3.å› æ­¤å…¶å¯¹åº”çš„ start()/stop() å’Œ onApplicationEvent() éƒ½å®ç°äº†å¯¹åº”çš„é€»è¾‘.</span><br><span class="line">4.å¦‚ stop() çš„é€»è¾‘ä¸ºè°ƒç”¨ EurekaServiceRegistry<span class="comment">#deregister()</span></span><br><span class="line">5.deregister() çš„ä½œç”¨æ˜¯æ‰§è¡Œ ApplicationInfoManager<span class="comment">#setInstanceStatus() å°†çŠ¶æ€æ”¹ä¸º DOWN</span></span><br><span class="line">6.å› ä¸º ApplicationInfoManager è¿™ä¸ªç±»ä¸“é—¨ç®¡ç†çŠ¶æ€å˜åŒ–äº‹ä»¶, å› æ­¤è¿˜ä¼šå°†äº‹ä»¶å‘å¸ƒå‡ºå». </span><br><span class="line">7.è€Œåœ¨ initScheduledTasks ä¸­å°±æ·»åŠ äº†è¿™æ ·çš„ä¸€ä¸ªç›‘å¬è€…, èµ·ä½œç”¨ä¸ºè°ƒç”¨ InstanceInfoReplicator<span class="comment">#onDemandUpdate()</span></span><br><span class="line">8.æ¥ç€ä¼šè°ƒç”¨ InstanceInfoReplicator<span class="comment">#run(), ç¬¬ä¸€è¡Œä»£ç  refreshInstanceInfo() ä¼šç¡®ä¿çŠ¶æ€ä¸ºæœ€æ–°çš„(é‚£ä¹Ÿè¿˜æ˜¯ DOWN)</span></span><br><span class="line">9.ä½†æ˜¯å…¶æœ€ç»ˆå¹¶ä¸æ˜¯è°ƒç”¨ cancel æ³¨é”€, è€Œ register æ³¨å†Œ, ä¸è¿‡å…¶ä¸­çš„çŠ¶æ€æ˜¯ DOWN, å› æ­¤ä¼šæœ‰ server é‚£è¾¹åˆ¤æ–­; æ‰€ä»¥å®¹å™¨å…³é—­äº‹ä»¶å¹¶ä¸ä¼šè§¦å‘ cancel, ä½†æ•ˆæœåº”æ˜¯ä¸€æ ·çš„.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: è¦ä¹ˆæ˜¯ shutdown() ä¸­ unregister è°ƒç”¨äº† cancel(), å‘å‡ºäº† Method ä¸º DELETE çš„è¯·æ±‚æ¥æ³¨é”€; è¦ä¹ˆå°±æ˜¯ EurekaClientAutoConfiguration ä¸­ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸåšå…³è”, å…¨ç¨‹ä½¿ç”¨ register æ¥å£æ¥æ›´æ–°çŠ¶æ€.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line"></span><br><span class="line">A(å®¹å™¨å…³é—­#close)</span><br><span class="line">A1(DiscoveryClient#shutdown)</span><br><span class="line">A2(DiscoveryClient#unregister)</span><br><span class="line">A3(RestTemplateEurekaHttpClient#cancel)</span><br><span class="line">A4(RestTemplate)</span><br><span class="line">A5(Eureka Server) </span><br><span class="line"></span><br><span class="line">A--è§¦å‘--&gt;A1</span><br><span class="line">A1--è°ƒç”¨--&gt;A2</span><br><span class="line">A2--è°ƒç”¨--&gt;A3</span><br><span class="line">A3--æ„é€ HTTPè¯·æ±‚äº¤ç»™--&gt;A4</span><br><span class="line">A4--å‘é€æ³¨é”€ç”³è¯·ç»™--&gt;A5</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210129171241.png" alt="image-20210129171237603"></p>
<h3 id="æœåŠ¡å‘ç°æµç¨‹"><a href="#æœåŠ¡å‘ç°æµç¨‹" class="headerlink" title="æœåŠ¡å‘ç°æµç¨‹"></a>æœåŠ¡å‘ç°æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1.Spring Cloud Commons ä¸­æ³¨å†Œäº†ä¸€ä¸ª ServiceInstanceListSupplier, å…·ä½“ä¸º(DiscoveryClientServiceInstanceListSupplier)</span><br><span class="line">2.è¿™ä¸ªç±»çš„ä½œç”¨æ˜¯å€ŸåŠ© ReactiveDiscoveryClient çš„ getInstances(String serviceId) æ–¹æ³•å‘ LoadBalancer æä¾›ä»å…·ä½“çš„ server(å¦‚Eureka) è·å–æœåŠ¡å®ä¾‹å¯¹è±¡åˆ—è¡¨, è¿™æ ·åªè¦å®ç° ReactiveDiscoveryClient å¹¶æ”¾å…¥å®¹å™¨å°±å¯ä»¥å’Œ Spring cloud LoadBalancer å¯¹æ¥äº†.</span><br><span class="line">3.åœ¨ EurekaDiscoveryClientConfiguration ä¸­è®©å®¹å™¨æ³¨å†Œäº†ä¸€ä¸ª DiscoveryClient(å…·ä½“ä¸º EurekaDiscoveryClient).</span><br><span class="line">4.å› ä¸º Spring Cloud Commons åšäº†å¤§é‡çš„é¢„å¤‡å¯¹æ¥å·¥ä½œ, æ‰€ä»¥å¯¹æ¥å…¶å®å°±ç»“æŸäº†.</span><br><span class="line">5.é‚£å†ç®€å•è¯´ä¸‹ EurekaDiscoveryClient çš„å®ç°, å³æ³¨å…¥ä¸€ä¸ª EurekaClient eurekaClient, ç„¶åè°ƒç”¨ DiscoveryClient<span class="comment">#getInstancesByVipAddress() å°±è·å–åˆ°äº† ServiceInstance åˆ—è¡¨.</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: Commons ä¸­å‡†å¤‡å¥½äº†å¯¹æ¥çš„æ–¹å¼: å®ç° DiscoveryClient æ¥å£, æ¥ç€æˆ‘ä»¬çš„ç¡®å®ç°äº† DiscoveryClient æ¥å£, å³ EurekaDiscoveryClient, è€Œè¿™è¿™ä¸ªç±»åˆ™ä¼šè°ƒç”¨ EurekaClient çš„ getInstancesByVipAddress ä» Eureka Server ç«¯è·å–æ³¨å†Œäº†çš„æœåŠ¡å®ä¾‹ä¿¡æ¯.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line"></span><br><span class="line">A1(BlockingLoadBalancerClient#ä½äºCommonsé¡¹ç›®)</span><br><span class="line">A2(RoundRobinLoadBalancer#ä½äºCommonsé¡¹ç›®)</span><br><span class="line">A4(LoadBalancerClientConfiguration#ä½äºCommonsé¡¹ç›®)</span><br><span class="line">A5(DiscoveryClientServiceInstanceListSupplier)</span><br><span class="line">A6(EurekaDiscoveryClient#getInstances)</span><br><span class="line">A7(EurekaClient#getInstancesByVipAddress)</span><br><span class="line">A9(Eureka Server)</span><br><span class="line">A8(ServiceInstance é›†åˆ)</span><br><span class="line"></span><br><span class="line">A1--choose æ–¹æ³•è°ƒç”¨--&gt;A2</span><br><span class="line">A2--choose æ–¹æ³•è°ƒç”¨--&gt;A5</span><br><span class="line">A4--æ³¨å…¥ä¸€ä¸ª--&gt;A5</span><br><span class="line">A5--è°ƒç”¨--&gt;A6</span><br><span class="line">A6--è°ƒç”¨--&gt;A7</span><br><span class="line">A7--ä»--&gt;A9</span><br><span class="line">A9--è·å–--&gt;A8</span><br><span class="line">A10(EurekaDiscoveryClientConfiguration)--æ³¨å…¥ä¸€ä¸ª--&gt;A6</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210129233856.png" alt="image-20210129233854498"></p>
<h2 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h2><h3 id="å…³é”®ç±»-1"><a href="#å…³é”®ç±»-1" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡æ³¨å†Œ</span></span><br><span class="line">1.ConsulAutoServiceRegistrationAutoConfiguration</span><br><span class="line">	è´Ÿè´£æ·»åŠ è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€ç›¸å…³çš„ bean</span><br><span class="line">	æ³¨å†Œäº† ConsulAutoServiceRegistration/ConsulAutoServiceRegistrationListener/ConsulAutoRegistration</span><br><span class="line">	</span><br><span class="line">2.ConsulServiceRegistryAutoConfiguration</span><br><span class="line">	è´Ÿè´£æ³¨å†ŒæœåŠ¡æ³¨å†Œç›¸å…³çš„ bean</span><br><span class="line">	æ³¨å†Œäº† ConsulServiceRegistry</span><br><span class="line">	</span><br><span class="line">3.ConsulDiscoveryClientConfiguration</span><br><span class="line">	è´Ÿè´£æ³¨å†ŒæœåŠ¡å‘ç°ç›¸å…³çš„ bean</span><br><span class="line">	æ³¨å†Œäº† ConsulDiscoveryClient</span><br><span class="line">	</span><br><span class="line">4.ConsulServiceRegistry</span><br><span class="line">	è´Ÿè´£ä¸ ConsulClient å¯¹æ¥, å†æä¾›æ³¨å†Œ/æ³¨é”€åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">5.ConsulClient</span><br><span class="line">	ä¸ Consul Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Consul Server ç«¯æ³¨å†Œ/æ³¨é”€æœåŠ¡å®ä¾‹</span><br><span class="line"></span><br><span class="line">6.AgentConsulClient</span><br><span class="line">	è´Ÿè´£æ ¹æ®æœåŠ¡å®ä¾‹ä¿¡æ¯æ„é€ æ³¨å†Œ/æ³¨é”€çš„ Http è¯·æ±‚</span><br><span class="line">	</span><br><span class="line">7.ConsulAutoServiceRegistration/ConsulAutoServiceRegistrationListener</span><br><span class="line">	è´Ÿè´£ç®¡ç†æœåŠ¡å®ä¾‹çš„è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€, ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸæŒ‚é’©</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å‘ç°</span></span><br><span class="line">1.BlockingLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	è´Ÿè´£è°ƒç”¨å®é™…çš„è´Ÿè½½å‡è¡¡å™¨å»é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span><br><span class="line">	è´Ÿè´£è°ƒåº¦è´Ÿè½½å‡è¡¡æ•´ä¸ªè¿‡ç¨‹, è§¦å‘ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸ.</span><br><span class="line">	</span><br><span class="line">2.RoundRobinLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	å®é™…çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ç®—æ³•ç±»</span><br><span class="line">	è´Ÿè´£è¿æ¥ ServiceInstanceListSupplier ä»å…¶ä¸­è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">3.ServiceInstanceListSupplier</span><br><span class="line">	å®šä¹‰äº†è·å–æœåŠ¡å®ä¾‹å®ä¾‹åˆ—è¡¨çš„æ¥å£(ä»»æ„æ–¹å¼)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClient</span><br><span class="line">	å®šä¹‰äº†ä»æœåŠ¡ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨çš„æ¥å£(æ›´æ˜ç¡®äº†)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClientServiceInstanceListSupplier</span><br><span class="line">	ServiceInstanceListSupplier çš„å®ç°ç±»</span><br><span class="line">	è¿æ¥ ReactiveDiscoveryClient ç±», å°†æœåŠ¡ç«¯è·å–é“å¾·æœåŠ¡å®ä¾‹åˆ—è¡¨è¿”å›å‡ºå»</span><br><span class="line">	</span><br><span class="line">5.ConsulDiscoveryClient</span><br><span class="line">	å®ç°äº† DiscoveryClient æ¥å£</span><br><span class="line">	è´Ÿè´£è°ƒç”¨ ConsulClient ä» Consul Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨.</span><br><span class="line"></span><br><span class="line">6.ConsulClient</span><br><span class="line">	ä¸ Consul Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Consul Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">7.ConsulServiceInstance</span><br><span class="line">	æœåŠ¡å®ä¾‹ä¿¡æ¯å¯¹è±¡</span><br><span class="line">	å®ç° ServiceInstance, ä¸ Commons å¯¹æ¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»ç»“</span></span><br><span class="line">å®ç°äº† Commons çš„ DiscoveryClient æ¥å£(å³ ConsulDiscoveryClient), äºæ˜¯æœåŠ¡å‘ç°å®ç°äº†;</span><br><span class="line">å®ç°äº† Commons çš„ ServiceRegisty æ¥å£(å³ ConsulServiceRegistry), äºæ˜¯æœåŠ¡æ³¨å†Œä¹Ÿå®ç°äº†.</span><br><span class="line">å†æ€»ç»“: Commons å¤§å‘å¥½.</span><br></pre></td></tr></table></figure>

<h3 id="æœåŠ¡æ³¨å†Œæµç¨‹-1"><a href="#æœåŠ¡æ³¨å†Œæµç¨‹-1" class="headerlink" title="æœåŠ¡æ³¨å†Œæµç¨‹"></a>æœåŠ¡æ³¨å†Œæµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.ConsulAutoServiceRegistration è°ƒç”¨ org.springframework.cloud.consul.serviceregistry.ConsulServiceRegistry<span class="comment">#register() å®Œæˆæ³¨å†Œ</span></span><br><span class="line">2.æ¥ç€ register() è°ƒç”¨ ConsulClient<span class="comment">#agentServiceRegister()</span></span><br><span class="line">3.ç„¶åä¼šè°ƒç”¨ AgentConsulClient<span class="comment">#agentServiceRegister()</span></span><br><span class="line">4.ç”Ÿæˆå¹¶å‘é€è¯·æ±‚, è¯·æ±‚åœ°å€ä¸º /v1/agent/service/register</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: å…¶å®å’Œ Eureka å·®ä¸å¤š, åªæ˜¯æˆ‘è·³è¿‡äº†ä¸€ç‚¹ç‚¹ç»†èŠ‚. åŸºæœ¬æ˜¯å°±æ˜¯ ä¸ ServiceRegistry äº¤äº’äº†, éå¸¸çš„é…åˆ Commons é¡¹ç›®, å°±åƒä¸€ä¸ªäººå†™çš„ä¸€æ ·â€¦</p>
</blockquote>
<h3 id="æœåŠ¡å‘ç°æµç¨‹-1"><a href="#æœåŠ¡å‘ç°æµç¨‹-1" class="headerlink" title="æœåŠ¡å‘ç°æµç¨‹"></a>æœåŠ¡å‘ç°æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.é¦–å…ˆæ˜¯ DiscoveryClientServiceInstanceListSupplier ä¼šè°ƒç”¨ ConsulDiscoveryClient<span class="comment">#getInstances()</span></span><br><span class="line">2.æ¥ç€ getInstances() ä¼šè°ƒç”¨ ConsulClient<span class="comment">#getHealthServices()</span></span><br><span class="line">3.ç„¶åå°±æ˜¯å‘é€ HTTP è¯·æ±‚äº†, è¯·æ±‚åœ°å€ä¸º /v1/health/service/, è¿”å›çš„å¯¹è±¡å°è£…å¤„ç†ä¸‹å¾—åˆ° ServiceInstance çš„å®ç°ç±» ConsulServiceInstance.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: è¿™æ¬¡çœŸçš„æ˜¯å’Œ Eureka ç±»ä¼¼, ä» Commons åˆ° ConsulDiscoveryClient, æµç¨‹æ˜¯ä¸€æ ·çš„. è€Œå…¶å® ConsulDiscoveryClient çš„é€»è¾‘ä¹Ÿå’Œ EurekaDiscoverClient ç±»ä¼¼â€¦ åªèƒ½è¯´å…¶å®æœåŠ¡æ³¨å†Œå‘ç°è¿™ä¸ªæ¡†æ¶, æˆ‘ä»¬å…³æ³¨çš„åŠŸèƒ½å…¶å®å¹¶ä¸æ˜¯éš¾ç‚¹. éš¾ç‚¹æ˜¯ server ç«¯çš„ç®¡ç†.</p>
</blockquote>
<h2 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h2><h3 id="å…³é”®ç±»-2"><a href="#å…³é”®ç±»-2" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœåŠ¡æ³¨å†Œ</span></span><br><span class="line">1.NacosServiceRegistryAutoConfiguration</span><br><span class="line">	è´Ÿè´£æ·»åŠ è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€ç›¸å…³çš„ bean</span><br><span class="line">	æ³¨å†Œäº† NacosAutoServiceRegistration/NacosServiceRegistry/NacosRegistration</span><br><span class="line">	</span><br><span class="line">2.NacosDiscoveryClientConfiguration</span><br><span class="line">	è´Ÿè´£æ³¨å†ŒæœåŠ¡å‘ç°ç›¸å…³çš„ bean</span><br><span class="line">	æ³¨å†Œäº† NacosDiscoveryClient</span><br><span class="line">	</span><br><span class="line">3.NacosServiceRegistry</span><br><span class="line">	è´Ÿè´£ä¸ NamingService å¯¹æ¥, å†æä¾›æ³¨å†Œ/æ³¨é”€åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">4.NamingService</span><br><span class="line">	ä¸ Nacos Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Nacos Server ç«¯æ³¨å†Œ/æ³¨é”€æœåŠ¡å®ä¾‹</span><br><span class="line">	è°ƒç”¨ NamingProxy</span><br><span class="line"></span><br><span class="line">5.NamingProxy</span><br><span class="line">	è´Ÿè´£æ ¹æ®æœåŠ¡å®ä¾‹ä¿¡æ¯æ„é€ æ³¨å†Œ/æ³¨é”€çš„ Http è¯·æ±‚</span><br><span class="line">	</span><br><span class="line">6.NacosAutoServiceRegistration</span><br><span class="line">	è´Ÿè´£ç®¡ç†æœåŠ¡å®ä¾‹çš„è‡ªåŠ¨æ³¨å†Œ/æ³¨é”€, ä¸å®¹å™¨ç”Ÿå‘½å‘¨æœŸæŒ‚é’©</span><br><span class="line"></span><br><span class="line">7.NacosRegistration</span><br><span class="line">	æœ¬åœ°å®ä¾‹å¯¹è±¡, ç›¸æ¯”æœåŠ¡å®ä¾‹æ•°æ®æ›´å¤š</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æœåŠ¡å‘ç°</span></span><br><span class="line">1.BlockingLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	è´Ÿè´£è°ƒç”¨å®é™…çš„è´Ÿè½½å‡è¡¡å™¨å»é€‰æ‹©ä¸€ä¸ªæœåŠ¡å®ä¾‹</span><br><span class="line">	è´Ÿè´£è°ƒåº¦è´Ÿè½½å‡è¡¡æ•´ä¸ªè¿‡ç¨‹, è§¦å‘ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸ.</span><br><span class="line">	</span><br><span class="line">2.RoundRobinLoadBalancer (Commons é¡¹ç›®ä¸Š)</span><br><span class="line">	å®é™…çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ç®—æ³•ç±»</span><br><span class="line">	è´Ÿè´£è¿æ¥ ServiceInstanceListSupplier ä»å…¶ä¸­è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">3.ServiceInstanceListSupplier</span><br><span class="line">	å®šä¹‰äº†è·å–æœåŠ¡å®ä¾‹å®ä¾‹åˆ—è¡¨çš„æ¥å£(ä»»æ„æ–¹å¼)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClient</span><br><span class="line">	å®šä¹‰äº†ä»æœåŠ¡ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨çš„æ¥å£(æ›´æ˜ç¡®äº†)</span><br><span class="line"></span><br><span class="line">4.DiscoveryClientServiceInstanceListSupplier</span><br><span class="line">	ServiceInstanceListSupplier çš„å®ç°ç±»</span><br><span class="line">	è¿æ¥ ReactiveDiscoveryClient ç±», å°†æœåŠ¡ç«¯è·å–é“å¾·æœåŠ¡å®ä¾‹åˆ—è¡¨è¿”å›å‡ºå»</span><br><span class="line">	</span><br><span class="line">5.NacosDiscoveryClient</span><br><span class="line">	å®ç°äº† DiscoveryClient æ¥å£</span><br><span class="line">	è´Ÿè´£è°ƒç”¨ NamingService ä» Nacos Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨.</span><br><span class="line"></span><br><span class="line">6.NamingService</span><br><span class="line">	ä¸ Nacos Server ç«¯äº¤äº’</span><br><span class="line">	è´Ÿè´£å‘ Nacos Server ç«¯è·å–æœåŠ¡å®ä¾‹åˆ—è¡¨</span><br><span class="line"></span><br><span class="line">7.NacosServiceInstance</span><br><span class="line">	æœåŠ¡å®ä¾‹ä¿¡æ¯å¯¹è±¡</span><br><span class="line">	å®ç° ServiceInstance, ä¸ Commons å¯¹æ¥</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ€»ç»“</span></span><br><span class="line">å®ç°äº† Commons çš„ DiscoveryClient æ¥å£(å³ NacosDiscoveryClient), äºæ˜¯æœåŠ¡å‘ç°å®ç°äº†;</span><br><span class="line">å®ç°äº† Commons çš„ ServiceRegisty æ¥å£(å³ ConsulServiceRegistry), äºæ˜¯æœåŠ¡æ³¨å†Œä¹Ÿå®ç°äº†.</span><br><span class="line">å†æ€»ç»“: Commons å¤§å‘å¥½.</span><br></pre></td></tr></table></figure>



<h3 id="æœåŠ¡æ³¨å†Œæµç¨‹-2"><a href="#æœåŠ¡æ³¨å†Œæµç¨‹-2" class="headerlink" title="æœåŠ¡æ³¨å†Œæµç¨‹"></a>æœåŠ¡æ³¨å†Œæµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1.NacosAutoServiceRegistration è°ƒç”¨ NacosServiceRegistry<span class="comment">#register å®Œæˆæ³¨å†Œ</span></span><br><span class="line">2.æ¥ç€ register() è°ƒç”¨ NacosNamingService<span class="comment">#registerInstance()</span></span><br><span class="line">3.ç„¶åä¼šè°ƒç”¨ NamingProxy<span class="comment">#registerService()</span></span><br><span class="line">4.ç”Ÿæˆå¹¶å‘é€è¯·æ±‚, è¯·æ±‚åœ°å€ä¸º /nacos/v1/ns/instance</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: è¿™å’Œ Consul å·®ä¸å¤š; è¿˜æ˜¯ç»§æ‰¿ AbstractAutoServiceRegistration æ¥ä¸ ServiceRegistry äº¤äº’äº†, ä¹Ÿæ˜¯éå¸¸çš„é…åˆ Commons é¡¹ç›®å•Š!!</p>
</blockquote>
<h3 id="æœåŠ¡å‘ç°æµç¨‹-2"><a href="#æœåŠ¡å‘ç°æµç¨‹-2" class="headerlink" title="æœåŠ¡å‘ç°æµç¨‹"></a>æœåŠ¡å‘ç°æµç¨‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.é¦–å…ˆæ˜¯ DiscoveryClientServiceInstanceListSupplier ä¼šè°ƒç”¨ NacosDiscoveryClient<span class="comment">#getInstances()</span></span><br><span class="line">2.æ¥ç€ getInstances() ä¼šè°ƒç”¨ NacosServiceDiscovery<span class="comment">#getInstances()</span></span><br><span class="line">3.ç„¶åå°±æ˜¯å‘é€ HTTP è¯·æ±‚äº†, è¯·æ±‚åœ°å€ä¸º /nacos/v1/ns/instance/list, è¿”å›çš„å¯¹è±¡å°è£…å¤„ç†ä¸‹å¾—åˆ° ServiceInstance çš„å®ç°ç±» NacosServiceInstance.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: ä¾ç„¶æ˜¯å’Œ Eureka/Consul ç±»ä¼¼, ä» Commons åˆ° NacosDiscoveryClient, æµç¨‹æ˜¯ä¸€æ ·çš„. è€Œå…¶å® NacosDiscoveryClient çš„é€»è¾‘ä¹Ÿå’Œ ConsulDiscoveryClient/EurekaDiscoverClient ç±»ä¼¼, æœ€ç»ˆæ€»æ˜¯å‘èµ· HTTP æŸ¥è¯¢ server ç«¯, æ‰€ä»¥ server ç«¯çš„ä»£ç æ‰æ¯”è¾ƒæœ‰è¶£å•Š.</p>
</blockquote>
<h2 id="Nacos-Config"><a href="#Nacos-Config" class="headerlink" title="Nacos Config"></a>Nacos Config</h2><h3 id="Nacos-Config-Client-åŠ è½½-nacos-server-é…ç½®åŸç†"><a href="#Nacos-Config-Client-åŠ è½½-nacos-server-é…ç½®åŸç†" class="headerlink" title="Nacos Config Client åŠ è½½ nacos server é…ç½®åŸç†"></a>Nacos Config Client åŠ è½½ nacos server é…ç½®åŸç†</h3><h4 id="å…³é”®ç±»-3"><a href="#å…³é”®ç±»-3" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">1.NacosConfigBootstrapConfiguration</span><br><span class="line">	æ³¨å†Œäº†ä¸€ä¸ª NacosPropertySourceLocator</span><br><span class="line"></span><br><span class="line">2.NacosPropertySourceLocator</span><br><span class="line">	ç”¨äºä» nacos server ä¸ŠåŠ è½½ dataId å¯¹åº”çš„é…ç½®æ–‡ä»¶åˆ° environment çš„ PropertySource é›†åˆä¸­.</span><br><span class="line">	</span><br><span class="line">3.ConfigService</span><br><span class="line">	ç”¨äºä¸ nacos server é€šä¿¡, è·å–é…ç½®æ–‡ä»¶, ä¹ƒè‡³è®¢é˜…æ›´æ–°</span><br><span class="line">	</span><br><span class="line">4.NacosPropertySourceBuilder</span><br><span class="line">	å€ŸåŠ© ConfigService ä¸ NacosDataParserHandler ä» nacos è·å– NacosPropertySource</span><br><span class="line">	</span><br><span class="line">5.NacosDataParserHandler</span><br><span class="line">	ç”¨äºåºåˆ—åŒ–(è½¬ç )æœåŠ¡ç«¯çš„é…ç½®æ–‡ä»¶æ•°æ®ä¸ºä¸€ä¸ª PropertySource(å³ NacosPropertySource)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªåŠ¨åˆ·æ–°</span></span><br><span class="line">1.NacosConfigAutoConfiguration</span><br><span class="line">2.NacosContextRefresher</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: ConfigService ä¸ NacosDataParserHandler æ˜¯ä¸¤ä¸ªå¹²äº‹çš„, å…¶ä»–éƒ½æ˜¯æ¸£æ¸£!!!</p>
</blockquote>
<h4 id="ä»-server-è·å–é…ç½®æµç¨‹"><a href="#ä»-server-è·å–é…ç½®æµç¨‹" class="headerlink" title="ä» server è·å–é…ç½®æµç¨‹"></a>ä» server è·å–é…ç½®æµç¨‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.åœ¨ NacosConfigBootstrapConfiguration ä¸­æ³¨å†Œäº†ä¸€ä¸ª PropertySourceLocator(å³ NacosPropertySourceLocator), å¯ç”¨äºä¸º environment æ·»åŠ  PropertySource</span><br><span class="line">2.ç„¶åå®ç° locate æ–¹æ³•, å³ NacosPropertySourceLocator<span class="comment">#locate()</span></span><br><span class="line">3.åœ¨ locate() çš„æœ€åé¢, è°ƒç”¨äº† loadApplicationConfiguration()</span><br><span class="line">4.è¿™ä¸ªæ–¹æ³•é€šè¿‡å¤šæ¬¡è°ƒç”¨ loadNacosDataIfPresent() åŠ è½½ dataId å’Œä¸åŒæ–‡ä»¶åç¼€ä»¥åŠprofile ç»„å’Œå¾—åˆ°ä¸åŒçš„ dataId.</span><br><span class="line">5.loadNacosDataIfPresent() è°ƒç”¨äº† loadNacosPropertySource()</span><br><span class="line">6.å…¶æœ€ç»ˆè°ƒç”¨äº† NacosPropertySourceBuilder<span class="comment">#loadNacosData()</span></span><br><span class="line">7.loadNacosData() è°ƒç”¨ ConfigService<span class="comment">#getConfig() </span></span><br><span class="line">8.getConfig() ä¼šä½¿ç”¨ ClientWorker<span class="comment">#getServerConfig() å‘èµ· HTTP è¯·æ±‚ä» nacos server è·å–é…ç½®æ–‡ä»¶. å…¶è¯·æ±‚åœ°å€æ˜¯ /v1/cs/configs</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> è¿˜æ˜¯æŒºç®€å•çš„, å‘ä¸ª HTTP è·å–é…ç½®æ–‡ä»¶, ç„¶åè½¬åŒ–æˆä¸€ä¸ª PropertySource, å†åœ¨ NacosPropertySourceLocator çš„ locate ä¸­æ‰”è¿› environment ä¸­å». Bingo!!!</p>
</blockquote>
<h4 id="ä»-server-å®æ—¶æ›´æ–°åŸç†"><a href="#ä»-server-å®æ—¶æ›´æ–°åŸç†" class="headerlink" title="ä» server å®æ—¶æ›´æ–°åŸç†"></a>ä» server å®æ—¶æ›´æ–°åŸç†</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.åœ¨ NacosConfigAutoConfiguration æ³¨å†Œäº†ä¸€ä¸ª NacosContextRefresher</span><br><span class="line">2.å…¶å®ç°äº† ApplicationListener&lt;ApplicationReadyEvent&gt;, ä¹Ÿå°±æ˜¯ä¼šåœ¨å®¹å™¨å‡†å¤‡äº‹ä»¶è§¦å‘åè°ƒç”¨ NacosContextRefresher<span class="comment">#registerNacosListenersForApplications()</span></span><br><span class="line">3.åœ¨è¿›è¡Œä¸¤ä¸ªé…ç½®åˆ¤æ–­å(å³ isRefreshEnabled() å’Œ PropertySource çš„ isRefreshable), è°ƒç”¨ NacosContextRefresher<span class="comment">#registerNacosListener() </span></span><br><span class="line">4.è¿™ä¸ªæ–¹æ³•é€šè¿‡ NacosConfigService<span class="comment">#addListener() æ³¨å†Œä¸€ä¸ª AbstractSharedListener ç›‘å¬è€…åˆ° cacheData.</span></span><br><span class="line">5.è€Œ ClientWorker<span class="comment">#checkConfigInfo() ä¸­æ·»åŠ çš„ LongPollingRunnable ä»»åŠ¡, ä¼šåœ¨ run() ä¸­æ‰§è¡Œ getServerConfig() è·å–æœåŠ¡é…ç½®æ–‡ä»¶, ç„¶åä¸å½“å‰ç¼“å­˜å¯¹æ¯” md5, è‹¥æ›´æ–°åˆ™é€šè¿‡ cacheData å–å‡ºåˆšåˆšæ·»åŠ çš„ listener, è§¦å‘äº‹ä»¶(å³ receiveConfigInfo() )</span></span><br><span class="line">6.è§¦å‘ååˆä¼šå†å‘å¸ƒä¸€ä¸ª RefreshEvent äº‹ä»¶</span><br><span class="line">7.æ¥ç€æµè½¬åˆ° RefreshEventListener.onApplicationEvent()</span><br><span class="line">8.ç„¶ååˆä¼šè°ƒç”¨ ContextRefresher.refresh(), è¿™ä¸ªæ–¹æ³•ä¸­çš„ refreshEnvironment() ä¼šè°ƒç”¨ addConfigFilesToEnvironment(), è¿™æ–¹æ³•å…ˆå¤åˆ¶ä¸€ä¸ª StandardEnvironment, å°†å…¶æ”¾å…¥åˆ° SpringApplication ä¸­, å†è°ƒç”¨ SpringApplication çš„ run() èµ°ä¸€é, ä¼šè§¦å‘ NacosPropertySourceLocator.locate(), äºæ˜¯å¤åˆ¶çš„ environment é‡Œé¢æœ‰æ–°æ•°æ®äº†, å†å°†å…¶æ‹·è´æ›¿æ¢åˆ°å½“å‰çš„ environment. å®Œæˆ environment çš„åˆ·æ–°. </span><br><span class="line">9.æ¥ç€å‘å¸ƒä¸€ä¸ª EnvironmentChangeEvent äº‹ä»¶, ç”¨æ¥åˆ·æ–° @ConfigurationProperties æ³¨è§£çš„ Bean. (è¿™ä¹ˆå–œæ¬¢äº‹ä»¶?ä¸æ„§æ˜¯å†™å‡º RocketMQ çš„é˜¿é‡Œå•Š!!!)</span><br><span class="line">10.æ¥ç€åœ¨ ConfigurationPropertiesRebinder ä¸­æ¥æ”¶åˆ°è¿™ä¸ªäº‹ä»¶, è§¦å‘ onApplicationEvent()</span><br><span class="line">11.ç„¶åä¼šæ‰§è¡Œ ConfigurationPropertiesRebinder<span class="comment">#rebind()</span></span><br><span class="line">12.å…¶é€»è¾‘æ˜¯å°† postProcessBeforeInitialization ä¸­å­˜èµ·æ¥çš„ ConfigurationPropertiesBean ç±»å‹çš„ map éå†, è¿›è¡Œé‡æ–°ç»‘å®š(å³ destroyBean åå† initializeBean, åˆ™ä¼šä»æ–°é…ç½®é‡æ–°èµ‹å€¼).</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ç»“: æœ‰çš„åœ°æ–¹(NacosContextRefresher)ç›‘å¬å®¹å™¨åˆå§‹åŒ–æ·»åŠ é…ç½®æ›´æ–°çš„ç›‘å¬è€…, è‡ªå·±ä¸å¹²æ´»åªå‘å¸ƒé…ç½®åˆ·æ–°äº‹ä»¶;</p>
<p>æœ‰çš„åœ°æ–¹(ClientWorker)æ·»åŠ è½®è¯¢ä»»åŠ¡è·å–æœåŠ¡ç«¯é…ç½®æ–‡ä»¶ä¸æœ¬åœ° cacheData å¯¹æ¯” md5 æ¥åˆ¤æ–­æ˜¯å¦è§¦å‘é…ç½®æ›´æ–°çš„ç›‘å¬è€…;</p>
<p>ç„¶åæœ‰çš„åœ°æ–¹(RefreshEventListener)ç›‘å¬é…ç½®åˆ·æ–°äº‹ä»¶ç„¶åç”¨ SpringApplication.run() é€šè¿‡è§¦å‘ NacosPropertySourceLocator#locate() ä¸ºä¸€ä¸ªå¤åˆ¶å‡ºæ¥çš„ environment å¯¹è±¡æ·»åŠ ä»æœåŠ¡ç«¯è·å–æœ€æ–°é…ç½®, å†æ‹·è´åˆ°å½“å‰çš„ environment å¯¹è±¡, å®Œæˆ environment é…ç½®çš„åˆ·æ–°, ä¹‹åå‘å¸ƒ environment åˆ·æ–°äº‹ä»¶;</p>
<p>æœ‰çš„åœ°æ–¹(ConfigurationPropertiesRebinder)ç›‘å¬ environment åˆ·æ–°äº‹ä»¶, ç„¶åä¸º @ConfigurationProperties æ³¨è§£ç”Ÿæˆçš„ bean é‡æ–°ç»‘å®šé…ç½®.</p>
<p>å†æ€»ç»“: æŒºå¥½çš„, å¥¥è¿ç«ç‚¬æ‰‹å•Šè¿™æ˜¯, ä¸åœä¼ é€’!!!!!</p>
</blockquote>
<h4 id="å…³é”®ç±»-4"><a href="#å…³é”®ç±»-4" class="headerlink" title="å…³é”®ç±»"></a>å…³é”®ç±»</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">1.NacosConfigAutoConfiguration</span><br><span class="line">	æ³¨å†Œä¸€ä¸ªç›‘å¬å®¹å™¨åˆå§‹åŒ–äº‹ä»¶çš„ bean (NacosContextRefresher)</span><br><span class="line"></span><br><span class="line">2.NacosContextRefresher</span><br><span class="line">	å†åˆå§‹åŒ–äº‹ä»¶è§¦å‘åæ·»åŠ ä¸€ä¸ª AbstractSharedListener ç›‘å¬è€…åˆ° cacheData</span><br><span class="line"></span><br><span class="line">3.AbstractSharedListener</span><br><span class="line">	å½“æœåŠ¡ç«¯é…ç½®ä¸æœ¬åœ°ä¸åŒåè§¦å‘</span><br><span class="line">	è§¦å‘åå‘å¸ƒ RefreshEvent äº‹ä»¶</span><br><span class="line"></span><br><span class="line">4.CacheData</span><br><span class="line">	ç®¡ç†é…ç½®æ›´æ–°äº‹ä»¶ç›‘å¬è€…</span><br><span class="line">	å¯¹æ¯”æœåŠ¡ç«¯é…ç½®ä¸æœ¬åœ°é…ç½®çš„ md5</span><br><span class="line">	md5 ä¸åŒåˆ™è§¦å‘ AbstractSharedListener</span><br><span class="line">	</span><br><span class="line">5.RefreshEvent</span><br><span class="line">	é€šè¿‡å®¹å™¨å‘å¸ƒ</span><br><span class="line">	å½“æœåŠ¡ç«¯é…ç½®å‘é€æ›´æ–°è§¦å‘</span><br><span class="line">	è§¦å‘åè°ƒç”¨ ContextRefresher<span class="comment">#refresh()</span></span><br><span class="line">	</span><br><span class="line">6.LongPollingRunnable</span><br><span class="line">	è½®è¯¢ä»»åŠ¡, è·å–æœåŠ¡ç«¯æœ€æ–°é…ç½®, ä¸ cacheData å¯¹æ¯”</span><br><span class="line"></span><br><span class="line">7.ClientWorker</span><br><span class="line">	ç®¡ç†è½®è¯¢ä»»åŠ¡(LongPollingRunnable)</span><br><span class="line">	è´Ÿè´£ä¸ nacos æœåŠ¡ç«¯é€šä¿¡</span><br><span class="line">	</span><br><span class="line">8.ContextRefresher</span><br><span class="line">	ç›‘å¬ RefreshEvent äº‹ä»¶</span><br><span class="line">	è´Ÿè´£è·å–æœåŠ¡ç«¯æœ€æ–°é…ç½®åˆ° environment å¯¹è±¡ä¸­</span><br><span class="line">	å‘å¸ƒ EnvironmentChangeEvent äº‹ä»¶</span><br><span class="line">	</span><br><span class="line">9.EnvironmentChangeEvent</span><br><span class="line">	é€šè¿‡å®¹å™¨å‘å¸ƒ</span><br><span class="line">	å½“ environment å¯¹è±¡æ›´æ–°åè§¦å‘</span><br><span class="line">	è§¦å‘åè°ƒç”¨ ConfigurationPropertiesRebinder<span class="comment">#rebind()</span></span><br><span class="line">	</span><br><span class="line">10.ConfigurationPropertiesRebinder</span><br><span class="line">	ç›‘å¬ EnvironmentChangeEvent äº‹ä»¶</span><br><span class="line">	è´Ÿè´£é‡æ–°ç»‘å®šç”¨äº† @ConfigurationProperties æ³¨è§£çš„ Bean çš„å€¼</span><br></pre></td></tr></table></figure>





<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"></span><br><span class="line">A1(NacosConfigAutoConfiguration)</span><br><span class="line">A2(NacosContextRefresher)</span><br><span class="line">A3(ApplicationReadyEvent)</span><br><span class="line">A4(NacosContextRefresher#registerNacosListener)</span><br><span class="line">A5(NacosConfigService#addListener)</span><br><span class="line"> </span><br><span class="line">A7(ClientWorker)</span><br><span class="line">A8(LongPollingRunnable#è½®è¯¢ä»»åŠ¡)</span><br><span class="line">A9(NacosConfigService#getServerConfig)</span><br><span class="line">B1(AbstractSharedListener#é…ç½®æ›´æ–°äº‹ä»¶çš„ç›‘å¬è€…)</span><br><span class="line">B2(cacheData)</span><br><span class="line">B3(RefreshEvent)</span><br><span class="line">B4(RefreshEventListener)</span><br><span class="line">B5(ContextRefresher#refresh)</span><br><span class="line">B6(ContextRefresher#refreshEnvironment)</span><br><span class="line">B7(ContextRefresher#addConfigFilesToEnvironment)</span><br><span class="line">B8(SpringApplication#run)</span><br><span class="line">B9(StandardEnvironment)</span><br><span class="line">C1(NacosPropertySourceLocator#locate)</span><br><span class="line">C2(å½“å‰å®¹å™¨çš„ environment å¯¹è±¡)</span><br><span class="line">C3(EnvironmentChangeEvent)</span><br><span class="line">C4(ConfigurationPropertiesRebinder#onApplicationEvent)</span><br><span class="line">C5(ConfigurationPropertiesRebinder#rebind)</span><br><span class="line">C6(ç”¨äº† ConfigurationProperties æ³¨è§£ Bean)</span><br><span class="line"></span><br><span class="line">A1--æ³¨å†Œäº†ä¸€ä¸ª--&gt;A2</span><br><span class="line">A2--ç›‘å¬äº†--&gt;A3</span><br><span class="line">A3--äº‹ä»¶è§¦å‘åè°ƒç”¨--&gt;A4</span><br><span class="line">A4--é€šè¿‡--&gt;A5</span><br><span class="line">A5--æ³¨å†Œäº†ä¸€ä¸ª--&gt;B1</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">A7--æ„é€ æ–¹æ³•ä¸­åˆ›å»ºäº†ä¸€ä¸ª--&gt;A8</span><br><span class="line">A8--run æ–¹æ³•ä¸­è°ƒç”¨--&gt;A9</span><br><span class="line">A9--è·å–æœ€æ–°é…ç½®ä¸--&gt;B2</span><br><span class="line"></span><br><span class="line">B2--æ¯”è¾ƒ md5, ä¸åŒåˆ™è§¦å‘--&gt;B1</span><br><span class="line">B1--äº‹ä»¶è§¦å‘åå‘å¸ƒ--&gt;B3</span><br><span class="line">B4--ç›‘å¬äº†--&gt;B3</span><br><span class="line">B3--äº‹ä»¶è§¦å‘åè°ƒç”¨--&gt;B5</span><br><span class="line">B5--è°ƒç”¨--&gt;B6</span><br><span class="line">B6--è°ƒç”¨--&gt;B7</span><br><span class="line">B7--åˆ©ç”¨--&gt;B8</span><br><span class="line">B7--å¤åˆ¶å½“å‰å®¹å™¨ environment å¯¹è±¡åˆ°--&gt;B9</span><br><span class="line">B8--è§¦å‘--&gt;C1</span><br><span class="line">C1--è·å–äº†æœ€æ–°é…ç½®åˆ°--&gt;B9</span><br><span class="line">B9--å¤åˆ¶æœ€æ–°é…ç½®å›åˆ°--&gt;C2</span><br><span class="line"></span><br><span class="line">C2--æ›´æ–°å®Œé…ç½®åå‘å¸ƒ--&gt;C3</span><br><span class="line">G1(ConfigurationPropertiesRebinder)--ç›‘å¬äº†--&gt;C3</span><br><span class="line">C3--äº‹ä»¶è§¦å‘åè°ƒç”¨--&gt;C4</span><br><span class="line">C4--è°ƒç”¨--&gt;C5</span><br><span class="line">C5--è·å–æ–°é…ç½®ç»‘å®šåˆ°--&gt;C6</span><br></pre></td></tr></table></figure>





<p><img src="https://gitee.com/gudqs7/many-images/raw/master/Mac-PicGo/20210130001118.png" alt=""></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="ä¸‹ä¸€é¡µ"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="gudqs7"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">gudqs7</p>
  <div class="site-description" itemprop="description">å¿ƒç´¯æ²¡é’±èººå°¸ä¸­</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">åˆ†ç±»</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">æ ‡ç­¾</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/gudqs7" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;gudqs7" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:gudqs7@gmail.com" title="E-Mail â†’ mailto:gudqs7@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">gudqs7</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://gudqs7s-note.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>

</body>
</html>
